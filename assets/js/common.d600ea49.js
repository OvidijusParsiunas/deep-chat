/*! For license information please see common.d600ea49.js.LICENSE.txt */
"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2076],{5149(e,t,n){n.d(t,{a:()=>s});const r=new Set(["children","localName","ref","style","className"]),i=new WeakMap,a=(e,t,n,r,a)=>{const s=a?.[t];void 0===s?(e[t]=n,null==n&&t in HTMLElement.prototype&&e.removeAttribute(t)):n!==r&&((e,t,n)=>{let r=i.get(e);void 0===r&&i.set(e,r=new Map);let a=r.get(t);void 0!==n?void 0===a?(r.set(t,a={handleEvent:n}),e.addEventListener(t,a)):a.handleEvent=n:void 0!==a&&(r.delete(t),e.removeEventListener(t,a))})(e,s,n)},s=({react:e,tagName:t,elementClass:n,events:i,displayName:s})=>{const o=new Set(Object.keys(i??{})),l=e.forwardRef((s,l)=>{const u=e.useRef(new Map),c=e.useRef(null),d={},h={};for(const[e,t]of Object.entries(s))r.has(e)?d["className"===e?"class":e]=t:o.has(e)||e in n.prototype?h[e]=t:d[e]=t;return e.useLayoutEffect(()=>{if(null===c.current)return;const e=new Map;for(const t in h)a(c.current,t,s[t],u.current.get(t),i),u.current.delete(t),e.set(t,s[t]);for(const[t,n]of u.current)a(c.current,t,void 0,n,i);u.current=e}),e.useLayoutEffect(()=>{c.current?.removeAttribute("defer-hydration")},[]),d.suppressHydrationWarning=!0,e.createElement(t,{...d,ref:e.useCallback(e=>{c.current=e,"function"==typeof l?l(e):null!==l&&(l.current=e)},[l])})});return l.displayName=s??n.name,l}},50363(e,t,n){n.d(t,{A:()=>a});var r=n(78478),i=(n(96540),n(74848));function a(e){return(0,i.jsx)(r.A,{children:()=>{const t=n(78152).DeepChat;return(0,i.jsx)(t,{...e,children:e.children})}})}},78152(e,t,n){function r(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function i(){return i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},i.apply(null,arguments)}function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=u(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}),e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function s(e){var t="function"==typeof Map?new Map:void 0;return s=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(p())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&v(i,n.prototype),i}(e,arguments,f(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),v(n,e)},s(e)}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n){return t=f(t),function(e,t){if(t&&("object"==E(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}(e,p()?Reflect.construct(t,n||[],f(e).constructor):t.apply(e,n))}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(p=function(){return!!e})()}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}function v(e,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},v(e,t)}function g(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var l=r&&r.prototype instanceof o?r:o,u=Object.create(l.prototype);return y(u,"_invoke",function(n,r,i){var a,o,l,u=0,c=i||[],d=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,o=0,l=e,h.n=n,s}};function p(n,r){for(o=n,l=r,t=0;!d&&u&&!i&&t<c.length;t++){var i,a=c[t],p=h.p,f=a[2];n>3?(i=f===r)&&(l=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(o=0,h.v=r,h.n=a[1]):p<f&&(i=n<3||a[0]>r||r>f)&&(a[4]=n,a[5]=r,h.n=f,o=0))}if(i||n>1)return s;throw d=!0,r}return function(i,c,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&p(c,f),o=c,l=f;(t=o<2?e:l)||!d;){a||(o?o<3?(o>1&&(h.n=-1),p(o,l)):h.n=l:h.v=l);try{if(u=2,a){if(o||(i="next"),t=a[i]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=a.return)&&t.call(a),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);a=e}else if((t=(d=h.n<0)?l:n.call(r,h))!==s)break}catch(t){a=e,o=1,l=t}finally{u=1}}return{value:t,done:d}}}(n,i,a),!0),u}var s={};function o(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=[][r]?t(t([][r]())):(y(t={},r,function(){return this}),t),d=u.prototype=o.prototype=Object.create(c);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,y(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=u,y(d,"constructor",u),y(u,"constructor",l),l.displayName="GeneratorFunction",y(u,i,"GeneratorFunction"),y(d),y(d,i,"Generator"),y(d,r,function(){return this}),y(d,"toString",function(){return"[object Generator]"}),(g=function(){return{w:a,m:h}})()}function y(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}y=function(e,t,n,r){function a(t,n){y(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},y(e,t,n,r)}function b(e,t,n,r,i,a,s){try{var o=e[a](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function k(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){b(a,r,i,s,o,"next",e)}function o(e){b(a,r,i,s,o,"throw",e)}s(void 0)})}}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){w(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function w(e,t,n){return(t=A(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,A(r.key),r)}}function x(e,t,n){return t&&T(e.prototype,t),n&&T(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function A(e){var t=function(e,t){if("object"!=E(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=E(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==E(t)?t:t+""}n.r(t),n.d(t,{DeepChat:()=>Au});var M="classList",I="style",R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div";return document.createElement(e)},P=function(){return x(function e(){C(this,e)},null,[{key:"render",value:function(e,t){var n=R();n.id="error-view",n.innerText=t,e.replaceChildren(n)}}])}(),O=function(){function e(){C(this,e)}return x(e,null,[{key:"onLoad",value:function(e){e.innerHTML='<div id="loading-validate-key-property"></div>'}},{key:"createElements",value:function(){var e=R();return e.id="validate-property-key-view",e}},{key:"render",value:function(t,n,r){var i=e.createElements(),a={onSuccess:n,onFail:P.render.bind(this,t,"Your 'key' has failed authentication"),onLoad:e.onLoad.bind(this,i)};r.key&&r.verifyKey(r.key,a),t.replaceChildren(i)}}])}(),L="service",B="text",N="html",F="error",D="https://deepchat.dev/docs/",j="ai",U="user",H="assistant",q="error-message-text",z="deep-chat-outer-container-role-",G="empty-message",W="deep-chat-top-message",K="deep-chat-middle-message",V="deep-chat-bottom-message",X="src",J="type",Z="file",Y="files",Q="image",$="images",ee="camera",te="gifs",ne="audio",re="microphone",ie="mixedFiles",ae="any",se="file-message",oe="start",le="messages",ue="role",ce=function(e){return JSON.parse(JSON.stringify(e))};function de(e){return e.charAt(0).toUpperCase()+e.slice(1)}function he(e,t,n,r){var i="\n".concat(de(t)," message: ").concat(JSON.stringify(e)," \n"),a=n?"".concat(de(t)," message after interceptor: ").concat(function(e){return e&&JSON.stringify(e)}(r)," \n"):"";return i+a}var pe=function(e,t,n,r){return"".concat(he(e,t,n,r),"Make sure the ").concat(t," message is using the Response format: ").concat(D,"connect/#Response \nYou can also augment it using the responseInterceptor property: ").concat(D,"interceptors#responseInterceptor")},fe=function(e,t){var n="request";return"".concat(he(e,n,t),"Make sure the ").concat(n,' message is using the {body: {text: string}} format, e.g: {body: {text: "Model Response"}}')},me=function(e,t,n){var r="response";return"".concat(he(e,r,t,n),"Make sure the ").concat(r,' message is using the {text: string} format, e.g: {text: "Model Response"}')},ve=function(e){return"".concat(e," failed - please wait for chat view to render before calling this property.")},ge="Invalid API Key",ye="Failed to connect",be="Request settings have not been set up",ke="No file was added",_e="Image was not found",Se="Multi-response arrays are not supported for streaming",we="Make sure the events are using {text: string} or {html: string} format.\nYou can also augment them using the responseInterceptor property: ".concat(D,"interceptors#responseInterceptor"),Ee="No valid stream events were sent.\n".concat(we),Ce="Please define a `function_handler` property inside the service config.",Te="Function tool response must be an array or contain a text property",xe="Failed to fetch history",Ae="inside-start",Me="inside-end",Ie="outside-start",Re="outside-end",Pe="dropup-menu",Oe="default",Le="hover",Be="click",Ne="active",Fe="disabled",De=function(){function e(){C(this,e)}return x(e,null,[{key:"unsetStyle",value:function(e,t){var n=Object.keys(t).reduce(function(e,t){return e[t]="",e},{});Object.assign(e[I],n)}},{key:"unsetActivityCSSMouseStates",value:function(t,n){n[Be]&&e.unsetStyle(t,n[Be]),n[Le]&&e.unsetStyle(t,n[Le])}},{key:"unsetAllCSSMouseStates",value:function(t,n){e.unsetActivityCSSMouseStates(t,n),n[Oe]&&e.unsetStyle(t,n[Oe])}},{key:"processStateful",value:function(e){var t=e[Oe]||{},n=Object.assign(ce(t),null==e?void 0:e[Le]),r=Object.assign(ce(n),null==e?void 0:e[Be]);return w(w(w({},Oe,t),Le,n),Be,r)}},{key:"mergeStatefulStyles",value:function(e){var t=w(w(w({},Oe,{}),Le,{}),Be,{});return e.forEach(function(e){t[Oe]=Object.assign(t[Oe],e[Oe]),t[Le]=Object.assign(t[Le],e[Le]),t[Be]=Object.assign(t[Be],e[Be])}),t}},{key:"overwriteDefaultWithAlreadyApplied",value:function(e,t){Object.keys(e[Oe]||[]).forEach(function(n){var r,i=n;t[I][i]&&null!=(r=e[Oe])&&r[i]&&(e[Oe][n]=t[I][i])})}},{key:"applyToStyleIfNotDefined",value:function(e,t){for(var n in t){var r=t[n];""===e[n]&&r&&(e[n]=r)}}}])}(),je=function(){function e(){C(this,e)}return x(e,null,[{key:"attemptAppendStyleSheetToHead",value:function(t){if(!t.fontFamily||t.fontFamily===e.DEFAULT_FONT_FAMILY){var n=document.getElementsByTagName("head")[0];if(!Array.from(n.getElementsByTagName("link")).some(function(t){return t.getAttribute("href")===e.FONT_URL})){var r=R("link");r.rel="stylesheet",r.href=e.FONT_URL,n.appendChild(r)}}}}])}();je.FONT_URL="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap",je.DEFAULT_FONT_FAMILY="'Inter', sans-serif, Avenir, Helvetica, Arial";var Ue=je,He=function(){function e(){C(this,e)}return x(e,null,[{key:"apply",value:function(t,n){if(n)try{e.applyStyleSheet(t,n)}catch(r){e.addStyleElement(t,n)}}},{key:"applyStyleSheet",value:function(e,t){var n=new CSSStyleSheet;n.replaceSync(e),t.adoptedStyleSheets.push(n)}},{key:"addStyleElement",value:function(e,t){var n=R("style");n.innerHTML=e,t.appendChild(n)}},{key:"applyDefaultStyleToComponent",value:function(t,n){n&&De.applyToStyleIfNotDefined(t,n),De.applyToStyleIfNotDefined(t,e.DEFAULT_COMPONENT_STYLE)}}])}();He.DEFAULT_COMPONENT_STYLE={height:"350px",width:"320px",borderTop:"1px solid #cacaca",borderRight:"1px solid #cacaca",borderLeft:"1px solid #cacaca",borderBottom:"1px solid #cacaca",fontFamily:Ue.DEFAULT_FONT_FAMILY,fontSize:"0.9rem",backgroundColor:"white",position:"relative",overflow:"hidden"};var qe=He,ze=function(){function e(){C(this,e)}return x(e,null,[{key:"buildElement",value:function(){var e=R();e[M].add("tooltip");var t=R("span");return t[M].add("tooltip-text"),e.appendChild(t),e}},{key:"tryCreateConfig",value:function(e,t){if(t)return"boolean"==typeof t?w({},B,e):w(w(w({},B,t[B]||e),"timeout",t.timeout||0),"style",t[I])}},{key:"traverseParentUntilContainer",value:function(e){for(var t=e;t.parentElement;)t=t.parentElement;return t}},{key:"setPosition",value:function(t,n){var r=n.getRootNode().host.getBoundingClientRect(),i=t.getBoundingClientRect(),a=n.getBoundingClientRect().width/2,s=i.left+i.width/2;n[I].left="".concat(s-a-r.left,"px"),n[I].top="".concat(i.top-36-r.top,"px");var o=n.getBoundingClientRect();o.left<r.left?n[I].left="".concat(e.OVERFLOW_NEW_POSITION_PX,"px"):o.right>r.right&&(n[I].left="".concat(r.width-o.width-e.OVERFLOW_NEW_POSITION_PX,"px"))}},{key:"display",value:function(t,n,r){return r||(r=e.traverseParentUntilContainer(t).nextSibling),n[B]&&(r.children[0].textContent=n[B]),{timeout:setTimeout(function(){r[I].visibility="visible",e.setPosition(t,r),n[I]&&Object.assign(r[I],n[I])},n.timeout||0),element:r}}},{key:"hide",value:function(e,t){clearTimeout(e.timeout),e.element[I].visibility="hidden",t[I]&&De.unsetStyle(e.element,t[I]),e.element[I].left="",e.element[I].top=""}}])}();ze.OVERFLOW_NEW_POSITION_PX=4;var Ge=ze,We=x(function e(){C(this,e)});We.IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),We.IS_CHROMIUM=window.chrome,We.IS_MOBILE=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);var Ke=We,Ve=function(e){return e.ESCAPE="Escape",e.ENTER="Enter",e.TAB="Tab",e.ARROW_UP="ArrowUp",e.ARROW_DOWN="ArrowDown",e.ARROW_RIGHT="ArrowRight",e.ARROW_LEFT="ArrowLeft",e.BACKSPACE="Backspace",e.DELETE="Delete",e.META="Meta",e.CONTROL="Control",e}(Ve||{}),Xe=function(){function e(){C(this,e)}return x(e,null,[{key:"add",value:function(t,n,r,i){void 0!==r&&t.addEventListener("keydown",e.onKeyDown.bind(this,r)),t.oninput=e.onInput.bind(this,r,i),t.addEventListener("paste",function(e){var t;e.preventDefault(),null!=(t=e.clipboardData)&&t[Y].length&&n.addFilesToAnyType(Array.from(e.clipboardData[Y]))})}},{key:"onKeyDown",value:function(t,n){var r=n.target.textContent;r&&r.length>=t&&!e.PERMITTED_KEYS.has(n.key)&&!e.isKeyCombinationPermitted(n)&&n.preventDefault()}},{key:"isKeyCombinationPermitted",value:function(e){return"a"===e.key&&(e.ctrlKey||e.metaKey)}},{key:"onInput",value:function(e,t,n){var r=n.target,i=r.textContent||"";void 0!==e&&i.length>e&&(r.textContent=i.substring(0,e),$e.focusEndOfInput(r)),null==t||t()}}])}();Xe.PERMITTED_KEYS=new Set([Ve.BACKSPACE,Ve.DELETE,Ve.ARROW_RIGHT,Ve.ARROW_LEFT,Ve.ARROW_DOWN,Ve.ARROW_UP,Ve.META,Ve.CONTROL,Ve.ENTER]);var Je=Xe,Ze=function(){return x(function e(){C(this,e)},null,[{key:"sanitizePastedTextContent",value:function(e){var t,n;e.preventDefault();var r=null==(t=e.clipboardData)?void 0:t.getData("text/plain");r&&(null==(n=document.execCommand)||n.call(document,"insertText",!1,r))}}])}(),Ye=function(){function e(t,n,r,i){var a,s,o,l,u=this;C(this,e),this._isComposing=!1;var c=e.processConfig(n,t.textInput);this.elementRef=e.createContainerElement(null==(a=null==c?void 0:c.styles)?void 0:a.container),this._config=c,this.inputElementRef=this.createInputElement(null==(s=t.defaultInput)?void 0:s[B],i),e.addFilesToAnyType(r,null==(o=t.defaultInput)?void 0:o[Y]),this.elementRef.appendChild(this.inputElementRef),t.setPlaceholderText=this.setPlaceholderText.bind(this),t.setPlaceholderText((null==(l=this._config.placeholder)?void 0:l[B])||"Ask me anything!"),this._browserStorage=i,setTimeout(function(){Je.add(u.inputElementRef,r,u._config.characterLimit,t._validationHandler),u._onInput=n.onInput})}return x(e,[{key:"clear",value:function(){var e,t,n,r=window.scrollY;this.inputElementRef[M].contains("text-input-".concat(Fe))||(Object.assign(this.inputElementRef[I],null==(e=this._config.placeholder)?void 0:e[I]),this.inputElementRef.textContent="",$e.focusEndOfInput(this.inputElementRef),null==(t=this._onInput)||t.call(this,!1),null==(n=this._browserStorage)||n.addInputText("")),Ke.IS_CHROMIUM&&window.scrollTo({top:r})}},{key:"createInputElement",value:function(t,n){var r,i,a,s,o=R();return o.id=e.TEXT_INPUT_ID,o[M].add("text-input-styling"),o[ue]="textbox","string"==typeof t?o.innerText=t:null!=n&&n.trackInputText&&(o.innerText=n.get().inputText||""),Ke.IS_MOBILE&&o.setAttribute("tabindex","0"),Ke.IS_CHROMIUM&&e.preventAutomaticScrollUpOnNewLine(o),"boolean"==typeof this._config[Fe]&&!0===this._config[Fe]?(o.contentEditable="false",o[M].add("text-input-".concat(Fe)),o.setAttribute("aria-".concat(Fe),"true")):(o.contentEditable="true",o.removeAttribute("aria-".concat(Fe)),this.addEventListeners(o)),Object.assign(o[I],null==(r=this._config.styles)?void 0:r[B]),Object.assign(o[I],null==(i=this._config.placeholder)?void 0:i[I]),null!=(s=null==(a=this._config.placeholder)?void 0:a[I])&&s.color||o.setAttribute("textcolor",""),o}},{key:"removePlaceholderStyle",value:function(){var e,t,n,r;!this.inputElementRef[M].contains("text-input-".concat(Fe))&&null!=(e=this._config.placeholder)&&e[I]&&(De.unsetStyle(this.inputElementRef,null==(t=this._config.placeholder)?void 0:t[I]),Object.assign(this.inputElementRef[I],null==(r=null==(n=this._config)?void 0:n.styles)?void 0:r[B]))}},{key:"addEventListeners",value:function(e){var t,n,r=this;null!=(t=this._config.styles)&&t.focus&&(e.onfocus=function(){var e;return Object.assign(r.elementRef[I],null==(e=r._config.styles)?void 0:e.focus)},e.onblur=this.onBlur.bind(this,this._config.styles.focus,null==(n=this._config.styles)?void 0:n.container)),e.addEventListener("keydown",this.onKeydown.bind(this)),e.addEventListener("input",this.onInput.bind(this)),e.addEventListener("paste",Ze.sanitizePastedTextContent),e.addEventListener("compositionstart",function(){return r._isComposing=!0}),e.addEventListener("compositionend",function(){return r._isComposing=!1})}},{key:"onBlur",value:function(e,t){De.unsetStyle(this.elementRef,e),t&&Object.assign(this.elementRef[I],t)}},{key:"onKeydown",value:function(e){var t;e.key===Ve.ENTER&&!Ke.IS_MOBILE&&!this._isComposing&&!e.ctrlKey&&!e.shiftKey&&(e.preventDefault(),null==(t=this.submit)||t.call(this))}},{key:"onInput",value:function(){var e,t;this.isTextInputEmpty()?Object.assign(this.inputElementRef[I],null==(e=this._config.placeholder)?void 0:e[I]):this.removePlaceholderStyle(),null==(t=this._onInput)||t.call(this,!0)}},{key:"setPlaceholderText",value:function(e){this.inputElementRef.setAttribute("deep-chat-placeholder-text",e),this.inputElementRef.setAttribute("aria-label",e)}},{key:"isTextInputEmpty",value:function(){return""===this.inputElementRef.textContent}}],[{key:"processConfig",value:function(e,t){var n,r,i,a;return null!=t||(t={}),null!==(n=t[Fe])&&void 0!==n||(t[Fe]=e.isTextInputDisabled),null!==(r=t.placeholder)&&void 0!==r||(t.placeholder={}),null!==(i=(a=t.placeholder)[B])&&void 0!==i||(a[B]=e.textInputPlaceholderText),t}},{key:"createContainerElement",value:function(e){var t=R();return t.id="text-input-container",Object.assign(t[I],e),t}},{key:"preventAutomaticScrollUpOnNewLine",value:function(e){var t;e.addEventListener("keydown",function(){t=window.scrollY}),e.addEventListener("input",function(){t!==window.scrollY&&window.scrollTo({top:t})})}},{key:"addFilesToAnyType",value:function(e,t){t&&e.addFilesToAnyType(Array.from(t).map(function(e){return e}))}}])}();Ye.TEXT_INPUT_ID="text-input";var Qe=Ye,$e=function(){function e(){C(this,e)}return x(e,null,[{key:"focusEndOfInput",value:function(e){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();null==n||n.removeAllRanges(),null==n||n.addRange(t),(Ke.IS_MOBILE||Ke.IS_SAFARI)&&e.focus()}},{key:"focusFromParentElement",value:function(t){var n=t.querySelector("#".concat(Qe.TEXT_INPUT_ID));n&&e.focusEndOfInput(n)}}])}(),et="Authentication",tt="Authorization",nt="Unauthorized",rt="Authorization header",it="Invalid",at="Incorrect",st="authentication_error",ot="invalid_request_error",lt="Content-Type",ut="application/json",ct="object",dt="completed",ht="Bearer ",pt="GET",ft="POST",mt="Upload an audio file",vt="function_call",gt="input_audio",yt="image_url",bt=function(){function e(){C(this,e)}return x(e,null,[{key:"addElements",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){return e.appendChild(t)})}},{key:"isScrollbarAtBottomOfElement",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.CODE_SNIPPET_GENERATION_JUMP,r=t.scrollHeight,i=t.clientHeight;return t.scrollTop>=r-i-n}},{key:"cloneElement",value:function(e){var t=e.cloneNode(!0);return e.parentNode.replaceChild(t,e),t}},{key:"scrollToBottom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;e.scrollButton&&e.scrollButton.hiddenElements.size>0&&e.scrollButton.clearHidden(),n?e.elementRef.scrollTo({left:0,top:n.offsetTop}):t?e.elementRef.scrollTo({left:0,top:e.elementRef.scrollHeight,behavior:"smooth"}):e.elementRef.scrollTop=e.elementRef.scrollHeight}},{key:"scrollToTop",value:function(e){e.scrollTop=0}},{key:"isVisibleInParent",value:function(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect();return n.bottom>r.top&&n.top<r.bottom}},{key:"waitForScrollEnd",value:function(e,t){var n=-1,r=0,i=function(){var a=e.scrollTop;if(a===n){if(++r>2)return void t()}else r=0,n=a;requestAnimationFrame(i)};requestAnimationFrame(i)}},{key:"assignButtonEvents",value:function(e,t){e.onclick=t,e.onkeydown=function(e){e.key===Ve.ENTER&&setTimeout(t)}}}])}();bt.CODE_SNIPPET_GENERATION_JUMP=1;var kt=bt,_t=function(){function e(){C(this,e)}return x(e,null,[{key:"speak",value:function(e,t){if(!t.audio&&window.SpeechSynthesisUtterance){var n=new SpeechSynthesisUtterance(e);Object.assign(n,t),speechSynthesis.speak(n)}}},{key:"processConfig",value:function(t,n){var r={};setTimeout(function(){if("object"==E(t)&&(t.audio&&(r.audio=t.audio),t.lang&&(r.lang=t.lang),t.pitch&&(r.pitch=t.pitch),t.rate&&(r.rate=t.rate),t.volume&&(r.volume=t.volume),t.voiceName)){var e=window.speechSynthesis.getVoices().find(function(e){var n;return e.name.toLocaleLowerCase()===(null==(n=t.voiceName)?void 0:n.toLocaleLowerCase())});e&&(r.voice=e)}n(r)},e.LOAD_VOICES_MS)}}])}();_t.LOAD_VOICES_MS=200;var St=_t,wt=function(){function e(){C(this,e)}return x(e,null,[{key:"colorToHex",value:function(e){var t=R();return t[I].color=e,document.body.appendChild(t),"#".concat(window.getComputedStyle(t).color.match(/\d+/g).map(function(e){return parseInt(e).toString(16).padStart(2,"0")}).join(""))}},{key:"setDots",value:function(t,n){var r,i;if(null!=(i=null==(r=null==n?void 0:n.styles)?void 0:r.bubble)&&i.color){var a=e.colorToHex(n.styles.bubble.color);t[I].setProperty("--loading-message-color",a),t[I].setProperty("--loading-message-color-fade","".concat(a,"33"))}else t[I].setProperty("--loading-message-color","#848484"),t[I].setProperty("--loading-message-color-fade","#55555533")}},{key:"setRing",value:function(t,n){var r=n||{},i=r.color,a=r.width,s=r.height,o=r.margin,l=r.border;if(i){var u=e.colorToHex(i);t[I].setProperty("--loading-history-color",u)}else t[I].setProperty("--loading-history-color","#dbdbdb");t[I].setProperty("--loading-history-height",s||"57px"),t[I].setProperty("--loading-history-width",a||"57px"),t[I].setProperty("--loading-history-margin",o||"7px"),t[I].setProperty("--loading-history-border",l||"6px solid")}}])}();wt.BUBBLE_CLASS="deep-chat-loading-message-bubble",wt.DOTS_CONTAINER_CLASS="deep-chat-loading-message-dots-container";var Et=wt,Ct=function(){return x(function e(){C(this,e)},null,[{key:"checkForContainerStyles",value:function(e,t){var n=e.containerStyle;n&&(Object.assign(t[I],n),console[F]("The containerStyle property".concat(xt,"1.3.14.")),console[F]("".concat(At,"the style property instead: ").concat(D,"styles#style")))}},{key:"handleResponseProperty",value:function(e){return console[F]("The {result: ....} response object type".concat(xt,"1.3.0.")),console[F]("".concat(At,"the new response object: ").concat(D,"connect#Response")),e.result}},{key:"processHistory",value:function(e){var t=e.initialMessages;if(t)return console[F]("The initialMessages property".concat(xt,"2.0.0.")),console[F]("".concat(At,"the history property instead: ").concat(D,"messages/#history")),t}},{key:"processHistoryFile",value:function(e){var t=e[Z];t&&(console[F]("The file property in MessageContent".concat(xt,"1.3.17.")),console[F]("".concat(At,"the files array property: ").concat(D,"messages/#MessageContent")),e[Y]=[t])}},{key:"processValidateInput",value:function(e){var t=e.validateMessageBeforeSending;if(t)return console[F]("The validateMessageBeforeSending property".concat(xt,"1.3.24.")),console[F]("".concat(At,"validateInput: ").concat(D,"interceptors#validateInput")),t}},{key:"processSubmitUserMessage",value:function(e){return console[F]("The submitUserMessage(text: string) argument string type".concat(xt,"1.4.4.")),console[F]("".concat(At,"the new argument type: ").concat(D,"methods#submitUserMessage")),w({},B,e)}},{key:"flagHTMLUpdateClass",value:function(e){var t;null!=(t=e.children[0])&&t[M].contains("deep-chat-update-message")&&(console[F]('The "deep-chat-update-message" html class'.concat(xt,"1.4.4.")),console[F]("".concat(At,"using {..., overwrite: true} object: ").concat(D,"connect#Response")))}},{key:"processConnect",value:function(e){var t=e;t.request&&(t.connect?Object.assign(t.connect,t.request):t.connect=t.request,console[F]("The request property".concat(xt,"2.0.0.")),console[F]("".concat(Mt,"connect object: ").concat(D,"connect#connect-1")))}},{key:"checkForStream",value:function(e){var t=e.stream;if(t)return console[F]("The stream property".concat(Rt,"the connect object in version 2.0.0.")),console[F]("".concat(Mt,"connect object: ").concat(D,"connect#connect-1")),t}},{key:"fireOnNewMessage",value:function(e,t){var n,r=e;r.onNewMessage&&(console[F]("The onNewMessage event".concat(xt,"2.0.0.")),console[F]("".concat(Mt,"onMessage event: ").concat(D,"events#onMessage")),null==(n=r.onNewMessage)||n.call(r,t)),e.dispatchEvent(new CustomEvent("new-message",{detail:t}))}},{key:"processFileConfigConnect",value:function(e){var t=e;t.request&&(console[F]("The request property in file configuration".concat(xt,"2.0.0.")),console[F]("Please use the connect property instead: ".concat(D,"files")),t.connect||(t.connect=t.request))}},{key:"processMessageStyles",value:function(e){if(e){var t=ce(e),n=t.loading;return n&&(n.outerContainer||n.innerContainer||n.bubble||n.media)&&(console[F]("The loading message styles are defined using LoadingMessageStyles interface".concat(Tt,"2.1.0.")),console[F]("Check it out here: ".concat(D,"messages/styles#LoadingMessageStyles")),t.loading={message:{styles:n}}),t}}},{key:"processDemo",value:function(e){return"boolean"==typeof e||e.displayLoadingBubble&&(console[F]("The demo displayLoadingBubble property".concat(xt,"2.1.0.")),console[F]("Please use displayLoading instead: ".concat(D,"modes#demo")),e.displayLoading={message:!0}),e}},{key:"processCohere",value:function(e){var t=e,n="".concat(Mt,"official documentation: ").concat(D,"directConnection/Cohere");return t.chat&&(console[F]("Cohere chat property".concat(xt,"2.2.3.")),console[F](n),delete t.chat),t.textGeneration?(console[F]("Cohere textGeneration".concat(It,"2.2.3.")),console[F](n),delete t.textGeneration,!1):!t.summarization||(console[F]("Cohere summarization".concat(It,"2.2.3.")),console[F](n),delete t.summarization,!1)}},{key:"processStreamHTMLWrappers",value:function(e){if(e&&E(e)===ct){var t=e.htmlWrappers;return t?(console[F]("The htmlWrappers property".concat(Rt,"Deep Chat's base").concat(Tt,"2.3.0.")),console[F]("Check it out here: ".concat(D,"messages/HTML#htmlWrappers")),t):void 0}}},{key:"processFocusMode",value:function(e){return!e||"boolean"==typeof e||e.scroll&&(console[F]("The scroll property in focusMode has been changed to smoothScroll".concat(Tt,"2.3.0.")),console[F]("Check it out here: ".concat(D,"modes#focusMode")),e.smoothScroll=!0),e}},{key:"processPosition",value:function(e){if(!e)return e;var t="Position names have been updated".concat(Tt,"2.3.1.");return"inside-left"===e?(console[F](t),Ae):"inside-right"===e?(console[F](t),Me):"outside-left"===e?(console[F](t),Ie):"outside-right"===e?(console[F](t),Re):e}},{key:"processBrowserStorage",value:function(e){var t=e.get();t&&Array.isArray(t)&&e.addMessages(t)}}])}(),Tt=" since version ",xt=" is deprecated ".concat(Tt),At="Please change to using ",Mt="Please see the ",It=" is not supported ".concat(Tt),Rt=" has been moved to ",Pt=function(){function e(){C(this,e)}return x(e,null,[{key:"mouseUp",value:function(e,t){De.unsetAllCSSMouseStates(e,t),Object.assign(e[I],t[Oe]),Object.assign(e[I],t[Le])}},{key:"mouseDown",value:function(e,t){Object.assign(e[I],t[Be])}},{key:"mouseLeave",value:function(e,t){De.unsetAllCSSMouseStates(e,t),Object.assign(e[I],t[Oe])}},{key:"mouseEnter",value:function(e,t){Object.assign(e[I],t[Le])}},{key:"add",value:function(t,n){t.addEventListener("mouseenter",e.mouseEnter.bind(this,t,n)),t.addEventListener("mouseleave",e.mouseLeave.bind(this,t,n)),t.addEventListener("mousedown",e.mouseDown.bind(this,t,n)),t.addEventListener("mouseup",e.mouseUp.bind(this,t,n))}}])}(),Ot={"deep-chat-button":{styles:w(w(w({},Oe,{backgroundColor:"white",padding:"5px",paddingLeft:"7px",paddingRight:"7px",border:"1px solid #c2c2c2",borderRadius:"6px",cursor:"pointer"}),Le,{backgroundColor:"#fafafa"}),Be,{backgroundColor:"#f1f1f1"})}},Lt=Object.keys(Ot),Bt=function(){function e(){C(this,e)}return x(e,null,[{key:"applySuggestionEvent",value:function(e,t){setTimeout(function(){t.addEventListener(Be,function(){var n,r;null==(r=e.submitUserMessage)||r.call(e,w({},B,(null==(n=t.textContent)?void 0:n.trim())||""))})})}},{key:"isElementTemporary",value:function(e){var t;return!!e&&(null==(t=e.bubbleElement.children[0])?void 0:t[M].contains("deep-chat-temporary-message"))}},{key:"doesElementContainDeepChatClass",value:function(e){return Lt.find(function(t){return e[M].contains(t)})}},{key:"applyEvents",value:function(e,t){var n=Ot[t].events;Object.keys(n||[]).forEach(function(t){e.addEventListener(t,null==n?void 0:n[t])})}},{key:"getProcessedStyles",value:function(e,t,n){var r=Array.from(t[M]).reduce(function(t,n){var r,i=null==(r=e[n])?void 0:r.styles;return i&&e[n].styles&&t.push(i),t},[]),i=Ot[n].styles;if(i){var a=ce(i);a[Oe]&&De.overwriteDefaultWithAlreadyApplied(a,t),r.unshift(a)}var s=De.mergeStatefulStyles(r);return De.processStateful(s)}},{key:"applyDeepChatUtilities",value:function(t,n,r){Lt.forEach(function(t){var i=r.getElementsByClassName(t);Array.from(i||[]).forEach(function(r){var i=e.getProcessedStyles(n,r,t);Nt.applyStylesToElement(r,i),e.applyEvents(r,t)})});var i=r.getElementsByClassName("deep-chat-suggestion-button");Array.from(i).forEach(function(n){return e.applySuggestionEvent(t,n)})}}])}(),Nt=function(){function e(){C(this,e)}return x(e,null,[{key:"applyStylesToElement",value:function(e,t){var n=De.processStateful(t);Pt.add(e,n),Object.assign(e[I],n[Oe])}},{key:"applyEventsToElement",value:function(e,t){Object.keys(t).forEach(function(n){var r=t[n];r&&e.addEventListener(n,r)})}},{key:"applyClassUtilitiesToElement",value:function(t,n){var r=n.events,i=n.styles;r&&e.applyEventsToElement(t,r),i&&!Bt.doesElementContainDeepChatClass(t)&&e.applyStylesToElement(t,i)}},{key:"applyCustomClassUtilities",value:function(t,n){Object.keys(t).forEach(function(r){var i=n.getElementsByClassName(r);Array.from(i).forEach(function(n){t[r]&&e.applyClassUtilitiesToElement(n,t[r])})})}},{key:"apply",value:function(t,n){Bt.applyDeepChatUtilities(t,t.htmlClassUtilities,n),e.applyCustomClassUtilities(t.htmlClassUtilities,n)}},{key:"traverseNodes",value:function(t,n){t.nodeType===Node.ELEMENT_NODE&&n.push(t.outerHTML),t.childNodes.forEach(function(t){e.traverseNodes(t,n)})}},{key:"splitHTML",value:function(t){var n=(new DOMParser).parseFromString(t,"text/html"),r=[];return n.body.childNodes.forEach(function(t){e.traverseNodes(t,r)}),r}},{key:"isTemporaryBasedOnHTML",value:function(e){var t=R();return t.innerHTML=e,Bt.isElementTemporary({outerContainer:t,bubbleElement:t,innerContainer:t})}},{key:"replaceElementWithNewClone",value:function(e,t){var n,r=(t||e).cloneNode(!0);return null==(n=e.parentNode)||n.replaceChild(r,e),r}},{key:"tryAddWrapper",value:function(t,n,r,i){if(n&&i){var a=(null==r?void 0:r[i])||(null==r?void 0:r[Oe]);if(a)return t.innerHTML=a,{contentEl:e.getTargetWrapper(t),wrapper:!0}}return{contentEl:t,wrapper:!1}}},{key:"getTargetWrapper",value:function(e){return e.getElementsByClassName("html-wrapper")[0]||e}}])}(),Ft=function(){function e(){C(this,e)}return x(e,null,[{key:"createElements",value:function(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=t.createMessageElementsOnOrientation("",r,i,a);return s.bubbleElement[M].add(e.HTML_BUBBLE_CLASS),Nt.tryAddWrapper(s.bubbleElement,n,t._customWrappers,r).contentEl.innerHTML=n,s}},{key:"overwriteElements",value:function(e,t,n){n.bubbleElement.innerHTML=t,Nt.apply(e,n.outerContainer),Ct.flagHTMLUpdateClass(n.bubbleElement)}},{key:"overwrite",value:function(t,n,r,i){var a=t.messageToElements,s=Ir.overwriteMessage(a,i,n,r,N,e.HTML_BUBBLE_CLASS);return s&&e.overwriteElements(t,n,s),s}},{key:"create",value:function(t,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=e.createElements(t,n,r,a);return Ir.fillEmptyMessageElement(s.bubbleElement,n),Nt.apply(t,s.outerContainer),Ct.flagHTMLUpdateClass(s.bubbleElement),t.applyCustomStyles(s,r,!1,null==(i=t.messageStyles)?void 0:i[N]),s}},{key:"add",value:function(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!=i&&i.status){var s=this.overwrite(t,n,r,t.messageElementRefs);if(s)return s;i.status=!1}if(!(a&&t.messageElementRefs.length>0&&Nt.isTemporaryBasedOnHTML(n))){var o=e.create(t,n,r,a);return a||t.appendOuterContainerElemet(o.outerContainer),o}}}])}();Ft.HTML_BUBBLE_CLASS="html-message";var Dt,jt=Ft,Ut=function(){return x(function e(){C(this,e)},null,[{key:"katex",value:function(e,t,n){var r=(n||{}).delimiter||"$";if(1!==r.length)throw new Error("invalid delimiter");t.inline.ruler.push("katex",function(e,t){var n=e.pos,i=e.posMax,a=n;if(e[X].charAt(a)!==r)return!1;for(++a;a<i&&e[X].charAt(a)===r;)++a;var s=e[X].slice(n,a);if(s.length>2)return!1;for(var o=a,l=0;a<i;){var u=e[X].charAt(a);if("{"!==u||0!==a&&"\\"===e[X].charAt(a-1)){if("}"!==u||0!==a&&"\\"===e[X].charAt(a-1)){if(u===r&&0===l){for(var c=a,d=a+1;d<i&&e[X].charAt(d)===r;)++d;if(d-c===s.length){if(!t){var h=e[X].slice(o,c).replace(/[ \n]+/g," ").trim();e.push({type:"katex",content:h,block:s.length>1,level:e.level})}return e.pos=d,!0}}}else if((l-=1)<0)return!1}else l+=1;a+=1}return t||(e.pending+=s),e.pos+=s.length,!0},n),t.block.ruler.push("katex",function(e,t,n){var i=!1,a=e.bMarks[t]+e.tShift[t],s=e.eMarks[t];if(a+1>s)return!1;var o=e[X].charAt(a);if(o!==r)return!1;var l=a,u=(a=e.skipChars(a,o))-l;if(2!==u)return!1;for(var c=t;!(++c>=n||(a=l=e.bMarks[c]+e.tShift[c],s=e.eMarks[c],a<s&&e.tShift[c]<e.blkIndent));)if(!(e[X].charAt(a)!==r||e.tShift[c]-e.blkIndent>=4||(a=e.skipChars(a,o),a-l<u||(a=e.skipSpaces(a),a<s)))){i=!0;break}u=e.tShift[t],e.line=c+(i?1:0);var d=e.getLines(t+1,c,u,!0).replace(/[ \n]+/g," ").trim();return e.tokens.push({type:"katex",params:null,content:d,lines:[t,e.line],level:e.level,block:!0}),!0},n),t.renderer.rules.katex=function(t,n){return function(t,n){var r;return(null==(r=window.katex)?void 0:r.renderToString(t,S({displayMode:n,throwOnError:!1,output:"mathml"},e)))||""}(t[n].content,t[n].block)},t.renderer.rules.katex.delimiter=r}}])}();function Ht(e){return(Dt=Dt||document.createElement("textarea")).innerHTML="&"+e+";",Dt.value}var qt=Object.prototype.hasOwnProperty;function zt(e){return[].slice.call(arguments,1).forEach(function(t){if(t){if("object"!=E(t))throw new TypeError(t+"must be object");Object.keys(t).forEach(function(n){e[n]=t[n]})}}),e}var Gt=/\\([\\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function Wt(e){return e.indexOf("\\")<0?e:e.replace(Gt,"$1")}function Kt(e){return!(e>=55296&&e<=57343||e>=64976&&e<=65007||!(65535&~e)||65534==(65535&e)||e>=0&&e<=8||11===e||e>=14&&e<=31||e>=127&&e<=159||e>1114111)}function Vt(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}var Xt=/&([a-z#][a-z0-9]{1,31});/gi,Jt=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;function Zt(e,t){var n=0,r=Ht(t);return t!==r?r:35===t.charCodeAt(0)&&Jt.test(t)&&Kt(n="x"===t[1].toLowerCase()?parseInt(t.slice(2),16):parseInt(t.slice(1),10))?Vt(n):e}function Yt(e){return e.indexOf("&")<0?e:e.replace(Xt,Zt)}var Qt=/[&<>"]/,$t=/[&<>"]/g,en={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function tn(e){return en[e]}function nn(e){return Qt.test(e)?e.replace($t,tn):e}var rn={};function an(e,t){return++t>=e.length-2?t:"paragraph_open"===e[t].type&&e[t].tight&&"inline"===e[t+1].type&&0===e[t+1].content.length&&"paragraph_close"===e[t+2].type&&e[t+2].tight?an(e,t+2):t}rn.blockquote_open=function(){return"<blockquote>\n"},rn.blockquote_close=function(e,t){return"</blockquote>"+sn(e,t)},rn.code=function(e,t){return e[t].block?"<pre><code>"+nn(e[t].content)+"</code></pre>"+sn(e,t):"<code>"+nn(e[t].content)+"</code>"},rn.fence=function(e,t,n,r,i){var a,s,o=e[t],l="",u=n.langPrefix;if(o.params){if(s=(a=o.params.split(/\s+/g)).join(" "),function(e,t){return!!e&&qt.call(e,t)}(i.rules.fence_custom,a[0]))return i.rules.fence_custom[a[0]](e,t,n,r,i);l=' class="'+u+nn(Yt(Wt(s)))+'"'}return"<pre><code"+l+">"+(n.highlight&&n.highlight.apply(n.highlight,[o.content].concat(a))||nn(o.content))+"</code></pre>"+sn(e,t)},rn.fence_custom={},rn.heading_open=function(e,t){return"<h"+e[t].hLevel+">"},rn.heading_close=function(e,t){return"</h"+e[t].hLevel+">\n"},rn.hr=function(e,t,n){return(n.xhtmlOut?"<hr />":"<hr>")+sn(e,t)},rn.bullet_list_open=function(){return"<ul>\n"},rn.bullet_list_close=function(e,t){return"</ul>"+sn(e,t)},rn.list_item_open=function(){return"<li>"},rn.list_item_close=function(){return"</li>\n"},rn.ordered_list_open=function(e,t){var n=e[t];return"<ol"+(n.order>1?' start="'+n.order+'"':"")+">\n"},rn.ordered_list_close=function(e,t){return"</ol>"+sn(e,t)},rn.paragraph_open=function(e,t){return e[t].tight?"":"<p>"},rn.paragraph_close=function(e,t){var n=!(e[t].tight&&t&&"inline"===e[t-1].type&&!e[t-1].content);return(e[t].tight?"":"</p>")+(n?sn(e,t):"")},rn.link_open=function(e,t,n){var r=e[t].title?' title="'+nn(Yt(e[t].title))+'"':"",i=n.linkTarget?' target="'+n.linkTarget+'"':"";return'<a href="'+nn(e[t].href)+'"'+r+i+">"},rn.link_close=function(){return"</a>"},rn.image=function(e,t,n){var r=' src="'+nn(e[t].src)+'"',i=e[t].title?' title="'+nn(Yt(e[t].title))+'"':"";return"<img"+r+(' alt="'+(e[t].alt?nn(Yt(Wt(e[t].alt))):"")+'"')+i+(n.xhtmlOut?" /":"")+">"},rn.table_open=function(){return"<table>\n"},rn.table_close=function(){return"</table>\n"},rn.thead_open=function(){return"<thead>\n"},rn.thead_close=function(){return"</thead>\n"},rn.tbody_open=function(){return"<tbody>\n"},rn.tbody_close=function(){return"</tbody>\n"},rn.tr_open=function(){return"<tr>"},rn.tr_close=function(){return"</tr>\n"},rn.th_open=function(e,t){var n=e[t];return"<th"+(n.align?' style="text-align:'+n.align+'"':"")+">"},rn.th_close=function(){return"</th>"},rn.td_open=function(e,t){var n=e[t];return"<td"+(n.align?' style="text-align:'+n.align+'"':"")+">"},rn.td_close=function(){return"</td>"},rn.strong_open=function(){return"<strong>"},rn.strong_close=function(){return"</strong>"},rn.em_open=function(){return"<em>"},rn.em_close=function(){return"</em>"},rn.del_open=function(){return"<del>"},rn.del_close=function(){return"</del>"},rn.ins_open=function(){return"<ins>"},rn.ins_close=function(){return"</ins>"},rn.mark_open=function(){return"<mark>"},rn.mark_close=function(){return"</mark>"},rn.sub=function(e,t){return"<sub>"+nn(e[t].content)+"</sub>"},rn.sup=function(e,t){return"<sup>"+nn(e[t].content)+"</sup>"},rn.hardbreak=function(e,t,n){return n.xhtmlOut?"<br />\n":"<br>\n"},rn.softbreak=function(e,t,n){return n.breaks?n.xhtmlOut?"<br />\n":"<br>\n":"\n"},rn.text=function(e,t){return nn(e[t].content)},rn.htmlblock=function(e,t){return e[t].content},rn.htmltag=function(e,t){return e[t].content},rn.abbr_open=function(e,t){return'<abbr title="'+nn(Yt(e[t].title))+'">'},rn.abbr_close=function(){return"</abbr>"},rn.footnote_ref=function(e,t){var n=Number(e[t].id+1).toString(),r="fnref"+n;return e[t].subId>0&&(r+=":"+e[t].subId),'<sup class="footnote-ref"><a href="#fn'+n+'" id="'+r+'">['+n+"]</a></sup>"},rn.footnote_block_open=function(e,t,n){return(n.xhtmlOut?'<hr class="footnotes-sep" />\n':'<hr class="footnotes-sep">\n')+'<section class="footnotes">\n<ol class="footnotes-list">\n'},rn.footnote_block_close=function(){return"</ol>\n</section>\n"},rn.footnote_open=function(e,t){return'<li id="fn'+Number(e[t].id+1).toString()+'"  class="footnote-item">'},rn.footnote_close=function(){return"</li>\n"},rn.footnote_anchor=function(e,t){var n="fnref"+Number(e[t].id+1).toString();return e[t].subId>0&&(n+=":"+e[t].subId),' <a href="#'+n+'" class="footnote-backref">\u21a9</a>'},rn.dl_open=function(){return"<dl>\n"},rn.dt_open=function(){return"<dt>"},rn.dd_open=function(){return"<dd>"},rn.dl_close=function(){return"</dl>\n"},rn.dt_close=function(){return"</dt>\n"},rn.dd_close=function(){return"</dd>\n"};var sn=rn.getBreak=function(e,t){return(t=an(e,t))<e.length&&"list_item_close"===e[t].type?"":"\n"};function on(){this.rules=zt({},rn),this.getBreak=rn.getBreak}function ln(){this.__rules__=[],this.__cache__=null}function un(e,t,n,r,i){this.src=e,this.env=r,this.options=n,this.parser=t,this.tokens=i,this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache=[],this.isInLabel=!1,this.linkLevel=0,this.linkContent="",this.labelUnmatchedScopes=0}function cn(e,t){var n,r,i,a=-1,s=e.posMax,o=e.pos,l=e.isInLabel;if(e.isInLabel)return-1;if(e.labelUnmatchedScopes)return e.labelUnmatchedScopes--,-1;for(e.pos=t+1,e.isInLabel=!0,n=1;e.pos<s;){if(91===(i=e.src.charCodeAt(e.pos)))n++;else if(93===i&&0===--n){r=!0;break}e.parser.skipToken(e)}return r?(a=e.pos,e.labelUnmatchedScopes=0):e.labelUnmatchedScopes=n-1,e.pos=o,e.isInLabel=l,a}function dn(e,t,n,r){var i,a,s,o,l,u;if(42!==e.charCodeAt(0)||91!==e.charCodeAt(1)||-1===e.indexOf("]:")||((a=cn(i=new un(e,t,n,r,[]),1))<0||58!==e.charCodeAt(a+1)))return-1;for(o=i.posMax,s=a+2;s<o&&10!==i.src.charCodeAt(s);s++);return l=e.slice(2,a),0===(u=e.slice(a+2,s).trim()).length?-1:(r.abbreviations||(r.abbreviations={}),E(r.abbreviations[":"+l])>"u"&&(r.abbreviations[":"+l]=u),s)}function hn(e){var t=Yt(e);try{t=decodeURI(t)}catch(n){}return encodeURI(t)}function pn(e,t){var n,r,i,a=t,s=e.posMax;if(60===e.src.charCodeAt(t)){for(t++;t<s;){if(10===(n=e.src.charCodeAt(t)))return!1;if(62===n)return i=hn(Wt(e.src.slice(a+1,t))),!!e.parser.validateLink(i)&&(e.pos=t+1,e.linkContent=i,!0);92===n&&t+1<s?t+=2:t++}return!1}for(r=0;t<s&&!(32===(n=e.src.charCodeAt(t))||n<32||127===n);)if(92===n&&t+1<s)t+=2;else{if(40===n&&++r>1||41===n&&--r<0)break;t++}return!(a===t||(i=Wt(e.src.slice(a,t)),!e.parser.validateLink(i)))&&(e.linkContent=i,e.pos=t,!0)}function fn(e,t){var n,r=t,i=e.posMax,a=e.src.charCodeAt(t);if(34!==a&&39!==a&&40!==a)return!1;for(t++,40===a&&(a=41);t<i;){if((n=e.src.charCodeAt(t))===a)return e.pos=t+1,e.linkContent=Wt(e.src.slice(r+1,t)),!0;92===n&&t+1<i?t+=2:t++}return!1}function mn(e){return e.trim().replace(/\s+/g," ").toUpperCase()}function vn(e,t,n,r){var i,a,s,o,l,u,c,d,h;if(91!==e.charCodeAt(0)||-1===e.indexOf("]:")||((a=cn(i=new un(e,t,n,r,[]),0))<0||58!==e.charCodeAt(a+1)))return-1;for(o=i.posMax,s=a+2;s<o&&(32===(l=i.src.charCodeAt(s))||10===l);s++);if(!pn(i,s))return-1;for(c=i.linkContent,u=s=i.pos,s+=1;s<o&&(32===(l=i.src.charCodeAt(s))||10===l);s++);for(s<o&&u!==s&&fn(i,s)?(d=i.linkContent,s=i.pos):(d="",s=u);s<o&&32===i.src.charCodeAt(s);)s++;return s<o&&10!==i.src.charCodeAt(s)?-1:(h=mn(e.slice(1,a)),E(r.references[h])>"u"&&(r.references[h]={title:d,href:c}),s)}on.prototype.renderInline=function(e,t,n){for(var r=this.rules,i=e.length,a=0,s="";i--;)s+=r[e[a].type](e,a++,t,n,this);return s},on.prototype.render=function(e,t,n){for(var r=this.rules,i=e.length,a=-1,s="";++a<i;)"inline"===e[a].type?s+=this.renderInline(e[a].children,t,n):s+=r[e[a].type](e,a,t,n,this);return s},ln.prototype.__find__=function(e){for(var t=this.__rules__.length,n=-1;t--;)if(this.__rules__[++n].name===e)return n;return-1},ln.prototype.__compile__=function(){var e=this,t=[""];e.__rules__.forEach(function(e){e.enabled&&e.alt.forEach(function(e){t.indexOf(e)<0&&t.push(e)})}),e.__cache__={},t.forEach(function(t){e.__cache__[t]=[],e.__rules__.forEach(function(n){n.enabled&&(t&&n.alt.indexOf(t)<0||e.__cache__[t].push(n.fn))})})},ln.prototype.at=function(e,t,n){var r=this.__find__(e),i=n||{};if(-1===r)throw new Error("Parser rule not found: "+e);this.__rules__[r].fn=t,this.__rules__[r].alt=i.alt||[],this.__cache__=null},ln.prototype.before=function(e,t,n,r){var i=this.__find__(e),a=r||{};if(-1===i)throw new Error("Parser rule not found: "+e);this.__rules__.splice(i,0,{name:t,enabled:!0,fn:n,alt:a.alt||[]}),this.__cache__=null},ln.prototype.after=function(e,t,n,r){var i=this.__find__(e),a=r||{};if(-1===i)throw new Error("Parser rule not found: "+e);this.__rules__.splice(i+1,0,{name:t,enabled:!0,fn:n,alt:a.alt||[]}),this.__cache__=null},ln.prototype.push=function(e,t,n){var r=n||{};this.__rules__.push({name:e,enabled:!0,fn:t,alt:r.alt||[]}),this.__cache__=null},ln.prototype.enable=function(e,t){e=Array.isArray(e)?e:[e],t&&this.__rules__.forEach(function(e){e.enabled=!1}),e.forEach(function(e){var t=this.__find__(e);if(t<0)throw new Error("Rules manager: invalid rule name "+e);this.__rules__[t].enabled=!0},this),this.__cache__=null},ln.prototype.disable=function(e){(e=Array.isArray(e)?e:[e]).forEach(function(e){var t=this.__find__(e);if(t<0)throw new Error("Rules manager: invalid rule name "+e);this.__rules__[t].enabled=!1},this),this.__cache__=null},ln.prototype.getRules=function(e){return null===this.__cache__&&this.__compile__(),this.__cache__[e]||[]},un.prototype.pushPending=function(){this.tokens.push({type:"text",content:this.pending,level:this.pendingLevel}),this.pending=""},un.prototype.push=function(e){this.pending&&this.pushPending(),this.tokens.push(e),this.pendingLevel=this.level},un.prototype.cacheSet=function(e,t){for(var n=this.cache.length;n<=e;n++)this.cache.push(0);this.cache[e]=t},un.prototype.cacheGet=function(e){return e<this.cache.length?this.cache[e]:0};var gn=" \n()[]'\".,!?-";function yn(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}var bn=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,kn=/\((c|tm|r|p)\)/gi,_n={c:"\xa9",r:"\xae",p:"\xa7",tm:"\u2122"};function Sn(e){return e.indexOf("(")<0?e:e.replace(kn,function(e,t){return _n[t.toLowerCase()]})}var wn=/['"]/,En=/['"]/g,Cn=/[-\s()\[\]]/;function Tn(e,t){return!(t<0||t>=e.length)&&!Cn.test(e[t])}function xn(e,t,n){return e.substr(0,t)+n+e.substr(t+1)}var An=[["block",function(e){e.inlineMode?e.tokens.push({type:"inline",content:e.src.replace(/\n/g," ").trim(),level:0,lines:[0,1],children:[]}):e.block.parse(e.src,e.options,e.env,e.tokens)}],["abbr",function(e){var t,n,r,i,a=e.tokens;if(!e.inlineMode)for(t=1,n=a.length-1;t<n;t++)if("paragraph_open"===a[t-1].type&&"inline"===a[t].type&&"paragraph_close"===a[t+1].type){for(r=a[t].content;r.length&&!((i=dn(r,e.inline,e.options,e.env))<0);)r=r.slice(i).trim();a[t].content=r,r.length||(a[t-1].tight=!0,a[t+1].tight=!0)}}],["references",function(e){var t,n,r,i,a=e.tokens;if(e.env.references=e.env.references||{},!e.inlineMode)for(t=1,n=a.length-1;t<n;t++)if("inline"===a[t].type&&"paragraph_open"===a[t-1].type&&"paragraph_close"===a[t+1].type){for(r=a[t].content;r.length&&!((i=vn(r,e.inline,e.options,e.env))<0);)r=r.slice(i).trim();a[t].content=r,r.length||(a[t-1].tight=!0,a[t+1].tight=!0)}}],["inline",function(e){var t,n,r,i=e.tokens;for(n=0,r=i.length;n<r;n++)"inline"===(t=i[n]).type&&e.inline.parse(t.content,e.options,e.env,t.children)}],["footnote_tail",function(e){var t,n,r,i,a,s,o,l,u,c=0,d=!1,h={};if(e.env.footnotes&&(e.tokens=e.tokens.filter(function(e){return"footnote_reference_open"===e.type?(d=!0,l=[],u=e.label,!1):"footnote_reference_close"===e.type?(d=!1,h[":"+u]=l,!1):(d&&l.push(e),!d)}),e.env.footnotes.list)){for(s=e.env.footnotes.list,e.tokens.push({type:"footnote_block_open",level:c++}),t=0,n=s.length;t<n;t++){for(e.tokens.push({type:"footnote_open",id:t,level:c++}),s[t].tokens?((o=[]).push({type:"paragraph_open",tight:!1,level:c++}),o.push({type:"inline",content:"",level:c,children:s[t].tokens}),o.push({type:"paragraph_close",tight:!1,level:--c})):s[t].label&&(o=h[":"+s[t].label]),e.tokens=e.tokens.concat(o),a="paragraph_close"===e.tokens[e.tokens.length-1].type?e.tokens.pop():null,i=s[t].count>0?s[t].count:1,r=0;r<i;r++)e.tokens.push({type:"footnote_anchor",id:t,subId:r,level:c});a&&e.tokens.push(a),e.tokens.push({type:"footnote_close",level:--c})}e.tokens.push({type:"footnote_block_close",level:--c})}}],["abbr2",function(e){var t,n,r,i,a,s,o,l,u,c,d,h,p=e.tokens;if(e.env.abbreviations)for(e.env.abbrRegExp||(h="(^|["+gn.split("").map(yn).join("")+"])("+Object.keys(e.env.abbreviations).map(function(e){return e.substr(1)}).sort(function(e,t){return t.length-e.length}).map(yn).join("|")+")($|["+gn.split("").map(yn).join("")+"])",e.env.abbrRegExp=new RegExp(h,"g")),c=e.env.abbrRegExp,n=0,r=p.length;n<r;n++)if("inline"===p[n].type)for(t=(i=p[n].children).length-1;t>=0;t--)if("text"===(a=i[t]).type){for(l=0,s=a.content,c.lastIndex=0,u=a.level,o=[];d=c.exec(s);)c.lastIndex>l&&o.push({type:"text",content:s.slice(l,d.index+d[1].length),level:u}),o.push({type:"abbr_open",title:e.env.abbreviations[":"+d[2]],level:u++}),o.push({type:"text",content:d[2],level:u}),o.push({type:"abbr_close",level:--u}),l=c.lastIndex-d[3].length;o.length&&(l<s.length&&o.push({type:"text",content:s.slice(l),level:u}),p[n].children=i=[].concat(i.slice(0,t),o,i.slice(t+1)))}}],["replacements",function(e){var t,n,r,i,a;if(e.options.typographer)for(a=e.tokens.length-1;a>=0;a--)if("inline"===e.tokens[a].type)for(t=(i=e.tokens[a].children).length-1;t>=0;t--)"text"===(n=i[t]).type&&(r=Sn(r=n.content),bn.test(r)&&(r=r.replace(/\+-/g,"\xb1").replace(/\.{2,}/g,"\u2026").replace(/([?!])\u2026/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---([^-]|$)/gm,"$1\u2014$2").replace(/(^|\s)--(\s|$)/gm,"$1\u2013$2").replace(/(^|[^-\s])--([^-\s]|$)/gm,"$1\u2013$2")),n.content=r)}],["smartquotes",function(e){var t,n,r,i,a,s,o,l,u,c,d,h,p,f,m,v,g;if(e.options.typographer)for(g=[],m=e.tokens.length-1;m>=0;m--)if("inline"===e.tokens[m].type)for(v=e.tokens[m].children,g.length=0,t=0;t<v.length;t++)if("text"===(n=v[t]).type&&!wn.test(n.text)){for(o=v[t].level,p=g.length-1;p>=0&&!(g[p].level<=o);p--);g.length=p+1,a=0,s=(r=n.content).length;e:for(;a<s&&(En.lastIndex=a,i=En.exec(r),i);)if(l=!Tn(r,i.index-1),a=i.index+1,f="'"===i[0],(u=!Tn(r,a))||l){if(d=!u,h=!l)for(p=g.length-1;p>=0&&(c=g[p],!(g[p].level<o));p--)if(c.single===f&&g[p].level===o){c=g[p],f?(v[c.token].content=xn(v[c.token].content,c.pos,e.options.quotes[2]),n.content=xn(n.content,i.index,e.options.quotes[3])):(v[c.token].content=xn(v[c.token].content,c.pos,e.options.quotes[0]),n.content=xn(n.content,i.index,e.options.quotes[1])),g.length=p;continue e}d?g.push({token:t,pos:i.index,single:f,level:o}):h&&f&&(n.content=xn(n.content,i.index,"\u2019"))}else f&&(n.content=xn(n.content,i.index,"\u2019"))}}]];function Mn(){this.options={},this.ruler=new ln;for(var e=0;e<An.length;e++)this.ruler.push(An[e][0],An[e][1])}function In(e,t,n,r,i){var a,s,o,l,u,c,d;for(this.src=e,this.parser=t,this.options=n,this.env=r,this.tokens=i,this.bMarks=[],this.eMarks=[],this.tShift=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.parentType="root",this.ddIndent=-1,this.level=0,this.result="",c=0,d=!1,o=l=c=0,u=(s=this.src).length;l<u;l++){if(a=s.charCodeAt(l),!d){if(32===a){c++;continue}d=!0}(10===a||l===u-1)&&(10!==a&&l++,this.bMarks.push(o),this.eMarks.push(l),this.tShift.push(c),d=!1,c=0,o=l+1)}this.bMarks.push(s.length),this.eMarks.push(s.length),this.tShift.push(0),this.lineMax=this.bMarks.length-1}function Rn(e,t){var n,r,i;return(r=e.bMarks[t]+e.tShift[t])>=(i=e.eMarks[t])||42!==(n=e.src.charCodeAt(r++))&&45!==n&&43!==n||r<i&&32!==e.src.charCodeAt(r)?-1:r}function Pn(e,t){var n,r=e.bMarks[t]+e.tShift[t],i=e.eMarks[t];if(r+1>=i||((n=e.src.charCodeAt(r++))<48||n>57))return-1;for(;;){if(r>=i)return-1;if(!((n=e.src.charCodeAt(r++))>=48&&n<=57)){if(41===n||46===n)break;return-1}}return r<i&&32!==e.src.charCodeAt(r)?-1:r}Mn.prototype.process=function(e){var t,n,r;for(t=0,n=(r=this.ruler.getRules("")).length;t<n;t++)r[t](e)},In.prototype.isEmpty=function(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]},In.prototype.skipEmptyLines=function(e){for(var t=this.lineMax;e<t&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e},In.prototype.skipSpaces=function(e){for(var t=this.src.length;e<t&&32===this.src.charCodeAt(e);e++);return e},In.prototype.skipChars=function(e,t){for(var n=this.src.length;e<n&&this.src.charCodeAt(e)===t;e++);return e},In.prototype.skipCharsBack=function(e,t,n){if(e<=n)return e;for(;e>n;)if(t!==this.src.charCodeAt(--e))return e+1;return e},In.prototype.getLines=function(e,t,n,r){var i,a,s,o,l,u=e;if(e>=t)return"";if(u+1===t)return a=this.bMarks[u]+Math.min(this.tShift[u],n),s=r?this.eMarks[u]+1:this.eMarks[u],this.src.slice(a,s);for(o=new Array(t-e),i=0;u<t;u++,i++)(l=this.tShift[u])>n&&(l=n),l<0&&(l=0),a=this.bMarks[u]+l,s=u+1<t||r?this.eMarks[u]+1:this.eMarks[u],o[i]=this.src.slice(a,s);return o.join("")};var On={};["article","aside","button","blockquote","body","canvas","caption","col","colgroup","dd","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","li","map","object","ol","output","p","pre","progress","script","section","style","table","tbody","td","textarea","tfoot","th","tr","thead","ul","video"].forEach(function(e){On[e]=!0});var Ln=/^<([a-zA-Z]{1,15})[\s\/>]/,Bn=/^<\/([a-zA-Z]{1,15})[\s>]/;function Nn(e,t){var n=e.bMarks[t]+e.blkIndent,r=e.eMarks[t];return e.src.substr(n,r-n)}function Fn(e,t){var n,r,i=e.bMarks[t]+e.tShift[t],a=e.eMarks[t];return i>=a||126!==(r=e.src.charCodeAt(i++))&&58!==r||i===(n=e.skipSpaces(i))||n>=a?-1:n}var Dn=[["code",function(e,t,n){var r,i;if(e.tShift[t]-e.blkIndent<4)return!1;for(i=r=t+1;r<n;)if(e.isEmpty(r))r++;else{if(!(e.tShift[r]-e.blkIndent>=4))break;i=++r}return e.line=r,e.tokens.push({type:"code",content:e.getLines(t,i,4+e.blkIndent,!0),block:!0,lines:[t,e.line],level:e.level}),!0}],["fences",function(e,t,n,r){var i,a,s,o,l,u=!1,c=e.bMarks[t]+e.tShift[t],d=e.eMarks[t];if(c+3>d||126!==(i=e.src.charCodeAt(c))&&96!==i||(l=c,(a=(c=e.skipChars(c,i))-l)<3)||(s=e.src.slice(c,d).trim()).indexOf("`")>=0)return!1;if(r)return!0;for(o=t;!(++o>=n||(c=l=e.bMarks[o]+e.tShift[o],d=e.eMarks[o],c<d&&e.tShift[o]<e.blkIndent));)if(!(e.src.charCodeAt(c)!==i||e.tShift[o]-e.blkIndent>=4||(c=e.skipChars(c,i),c-l<a||(c=e.skipSpaces(c),c<d)))){u=!0;break}return a=e.tShift[t],e.line=o+(u?1:0),e.tokens.push({type:"fence",params:s,content:e.getLines(t+1,o,a,!0),lines:[t,e.line],level:e.level}),!0},["paragraph","blockquote","list"]],["blockquote",function(e,t,n,r){var i,a,s,o,l,u,c,d,h,p,f,m=e.bMarks[t]+e.tShift[t],v=e.eMarks[t];if(m>v||62!==e.src.charCodeAt(m++)||e.level>=e.options.maxNesting)return!1;if(r)return!0;for(32===e.src.charCodeAt(m)&&m++,l=e.blkIndent,e.blkIndent=0,o=[e.bMarks[t]],e.bMarks[t]=m,a=(m=m<v?e.skipSpaces(m):m)>=v,s=[e.tShift[t]],e.tShift[t]=m-e.bMarks[t],d=e.parser.ruler.getRules("blockquote"),i=t+1;i<n&&!((m=e.bMarks[i]+e.tShift[i])>=(v=e.eMarks[i]));i++)if(62!==e.src.charCodeAt(m++)){if(a)break;for(f=!1,h=0,p=d.length;h<p;h++)if(d[h](e,i,n,!0)){f=!0;break}if(f)break;o.push(e.bMarks[i]),s.push(e.tShift[i]),e.tShift[i]=-1337}else 32===e.src.charCodeAt(m)&&m++,o.push(e.bMarks[i]),e.bMarks[i]=m,a=(m=m<v?e.skipSpaces(m):m)>=v,s.push(e.tShift[i]),e.tShift[i]=m-e.bMarks[i];for(u=e.parentType,e.parentType="blockquote",e.tokens.push({type:"blockquote_open",lines:c=[t,0],level:e.level++}),e.parser.tokenize(e,t,i),e.tokens.push({type:"blockquote_close",level:--e.level}),e.parentType=u,c[1]=e.line,h=0;h<s.length;h++)e.bMarks[h+t]=o[h],e.tShift[h+t]=s[h];return e.blkIndent=l,!0},["paragraph","blockquote","list"]],["hr",function(e,t,n,r){var i,a,s,o=e.bMarks[t],l=e.eMarks[t];if((o+=e.tShift[t])>l||42!==(i=e.src.charCodeAt(o++))&&45!==i&&95!==i)return!1;for(a=1;o<l;){if((s=e.src.charCodeAt(o++))!==i&&32!==s)return!1;s===i&&a++}return!(a<3)&&(r||(e.line=t+1,e.tokens.push({type:"hr",lines:[t,e.line],level:e.level})),!0)},["paragraph","blockquote","list"]],["list",function(e,t,n,r){var i,a,s,o,l,u,c,d,h,p,f,m,v,g,y,b,k,_,S,w,E,C=!0;if((d=Pn(e,t))>=0)m=!0;else{if(!((d=Rn(e,t))>=0))return!1;m=!1}if(e.level>=e.options.maxNesting)return!1;if(f=e.src.charCodeAt(d-1),r)return!0;for(g=e.tokens.length,m?(c=e.bMarks[t]+e.tShift[t],p=Number(e.src.substr(c,d-c-1)),e.tokens.push({type:"ordered_list_open",order:p,lines:b=[t,0],level:e.level++})):e.tokens.push({type:"bullet_list_open",lines:b=[t,0],level:e.level++}),i=t,y=!1,_=e.parser.ruler.getRules("list");i<n&&((h=(v=e.skipSpaces(d))>=e.eMarks[i]?1:v-d)>4&&(h=1),h<1&&(h=1),a=d-e.bMarks[i]+h,e.tokens.push({type:"list_item_open",lines:k=[t,0],level:e.level++}),o=e.blkIndent,l=e.tight,s=e.tShift[t],u=e.parentType,e.tShift[t]=v-e.bMarks[t],e.blkIndent=a,e.tight=!0,e.parentType="list",e.parser.tokenize(e,t,n,!0),(!e.tight||y)&&(C=!1),y=e.line-t>1&&e.isEmpty(e.line-1),e.blkIndent=o,e.tShift[t]=s,e.tight=l,e.parentType=u,e.tokens.push({type:"list_item_close",level:--e.level}),i=t=e.line,k[1]=i,v=e.bMarks[t],!(i>=n||e.isEmpty(i)||e.tShift[i]<e.blkIndent));){for(E=!1,S=0,w=_.length;S<w;S++)if(_[S](e,i,n,!0)){E=!0;break}if(E)break;if(m){if((d=Pn(e,i))<0)break}else if((d=Rn(e,i))<0)break;if(f!==e.src.charCodeAt(d-1))break}return e.tokens.push({type:m?"ordered_list_close":"bullet_list_close",level:--e.level}),b[1]=i,e.line=i,C&&function(e,t){var n,r,i=e.level+2;for(n=t+2,r=e.tokens.length-2;n<r;n++)e.tokens[n].level===i&&"paragraph_open"===e.tokens[n].type&&(e.tokens[n+2].tight=!0,e.tokens[n].tight=!0,n+=2)}(e,g),!0},["paragraph","blockquote"]],["footnote",function(e,t,n,r){var i,a,s,o,l,u=e.bMarks[t]+e.tShift[t],c=e.eMarks[t];if(u+4>c||91!==e.src.charCodeAt(u)||94!==e.src.charCodeAt(u+1)||e.level>=e.options.maxNesting)return!1;for(o=u+2;o<c;o++){if(32===e.src.charCodeAt(o))return!1;if(93===e.src.charCodeAt(o))break}return!(o===u+2||o+1>=c||58!==e.src.charCodeAt(++o))&&(r||(o++,e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.refs||(e.env.footnotes.refs={}),l=e.src.slice(u+2,o-2),e.env.footnotes.refs[":"+l]=-1,e.tokens.push({type:"footnote_reference_open",label:l,level:e.level++}),i=e.bMarks[t],a=e.tShift[t],s=e.parentType,e.tShift[t]=e.skipSpaces(o)-o,e.bMarks[t]=o,e.blkIndent+=4,e.parentType="footnote",e.tShift[t]<e.blkIndent&&(e.tShift[t]+=e.blkIndent,e.bMarks[t]-=e.blkIndent),e.parser.tokenize(e,t,n,!0),e.parentType=s,e.blkIndent-=4,e.tShift[t]=a,e.bMarks[t]=i,e.tokens.push({type:"footnote_reference_close",level:--e.level})),!0)},["paragraph"]],["heading",function(e,t,n,r){var i,a,s,o=e.bMarks[t]+e.tShift[t],l=e.eMarks[t];if(o>=l||(35!==(i=e.src.charCodeAt(o))||o>=l))return!1;for(a=1,i=e.src.charCodeAt(++o);35===i&&o<l&&a<=6;)a++,i=e.src.charCodeAt(++o);return!(a>6||o<l&&32!==i)&&(r||(l=e.skipCharsBack(l,32,o),(s=e.skipCharsBack(l,35,o))>o&&32===e.src.charCodeAt(s-1)&&(l=s),e.line=t+1,e.tokens.push({type:"heading_open",hLevel:a,lines:[t,e.line],level:e.level}),o<l&&e.tokens.push({type:"inline",content:e.src.slice(o,l).trim(),level:e.level+1,lines:[t,e.line],children:[]}),e.tokens.push({type:"heading_close",hLevel:a,level:e.level})),!0)},["paragraph","blockquote"]],["lheading",function(e,t,n){var r,i,a,s=t+1;return!(s>=n||e.tShift[s]<e.blkIndent||e.tShift[s]-e.blkIndent>3||(i=e.bMarks[s]+e.tShift[s],a=e.eMarks[s],i>=a)||(r=e.src.charCodeAt(i),45!==r&&61!==r)||(i=e.skipChars(i,r),i=e.skipSpaces(i),i<a))&&(i=e.bMarks[t]+e.tShift[t],e.line=s+1,e.tokens.push({type:"heading_open",hLevel:61===r?1:2,lines:[t,e.line],level:e.level}),e.tokens.push({type:"inline",content:e.src.slice(i,e.eMarks[t]).trim(),level:e.level+1,lines:[t,e.line-1],children:[]}),e.tokens.push({type:"heading_close",hLevel:61===r?1:2,level:e.level}),!0)}],["htmlblock",function(e,t,n,r){var i,a,s,o=e.bMarks[t],l=e.eMarks[t],u=e.tShift[t];if(o+=u,!e.options.html||u>3||o+2>=l||60!==e.src.charCodeAt(o))return!1;if(33===(i=e.src.charCodeAt(o+1))||63===i){if(r)return!0}else{if(47!==i&&!function(e){var t=32|e;return t>=97&&t<=122}(i))return!1;if(47===i){if(!(a=e.src.slice(o,l).match(Bn)))return!1}else if(!(a=e.src.slice(o,l).match(Ln)))return!1;if(!0!==On[a[1].toLowerCase()])return!1;if(r)return!0}for(s=t+1;s<e.lineMax&&!e.isEmpty(s);)s++;return e.line=s,e.tokens.push({type:"htmlblock",level:e.level,lines:[t,e.line],content:e.getLines(t,s,0,!0)}),!0},["paragraph","blockquote"]],["table",function(e,t,n,r){var i,a,s,o,l,u,c,d,h,p,f;if(t+2>n||(l=t+1,e.tShift[l]<e.blkIndent)||(s=e.bMarks[l]+e.tShift[l])>=e.eMarks[l]||124!==(i=e.src.charCodeAt(s))&&45!==i&&58!==i||(a=Nn(e,t+1),!/^[-:| ]+$/.test(a))||(u=a.split("|"))<=2)return!1;for(d=[],o=0;o<u.length;o++){if(!(h=u[o].trim())){if(0===o||o===u.length-1)continue;return!1}if(!/^:?-+:?$/.test(h))return!1;58===h.charCodeAt(h.length-1)?d.push(58===h.charCodeAt(0)?"center":"right"):58===h.charCodeAt(0)?d.push("left"):d.push("")}if(-1===(a=Nn(e,t).trim()).indexOf("|")||(u=a.replace(/^\||\|$/g,"").split("|"),d.length!==u.length))return!1;if(r)return!0;for(e.tokens.push({type:"table_open",lines:p=[t,0],level:e.level++}),e.tokens.push({type:"thead_open",lines:[t,t+1],level:e.level++}),e.tokens.push({type:"tr_open",lines:[t,t+1],level:e.level++}),o=0;o<u.length;o++)e.tokens.push({type:"th_open",align:d[o],lines:[t,t+1],level:e.level++}),e.tokens.push({type:"inline",content:u[o].trim(),lines:[t,t+1],level:e.level,children:[]}),e.tokens.push({type:"th_close",level:--e.level});for(e.tokens.push({type:"tr_close",level:--e.level}),e.tokens.push({type:"thead_close",level:--e.level}),e.tokens.push({type:"tbody_open",lines:f=[t+2,0],level:e.level++}),l=t+2;l<n&&!(e.tShift[l]<e.blkIndent||(a=Nn(e,l).trim(),-1===a.indexOf("|")));l++){for(u=a.replace(/^\||\|$/g,"").split("|"),e.tokens.push({type:"tr_open",level:e.level++}),o=0;o<u.length;o++)e.tokens.push({type:"td_open",align:d[o],level:e.level++}),c=u[o].substring(124===u[o].charCodeAt(0)?1:0,124===u[o].charCodeAt(u[o].length-1)?u[o].length-1:u[o].length).trim(),e.tokens.push({type:"inline",content:c,level:e.level,children:[]}),e.tokens.push({type:"td_close",level:--e.level});e.tokens.push({type:"tr_close",level:--e.level})}return e.tokens.push({type:"tbody_close",level:--e.level}),e.tokens.push({type:"table_close",level:--e.level}),p[1]=f[1]=l,e.line=l,!0},["paragraph"]],["deflist",function(e,t,n,r){var i,a,s,o,l,u,c,d,h,p,f,m,v,g;if(r)return!(e.ddIndent<0)&&Fn(e,t)>=0;if(c=t+1,e.isEmpty(c)&&++c>n||e.tShift[c]<e.blkIndent||(i=Fn(e,c))<0||e.level>=e.options.maxNesting)return!1;u=e.tokens.length,e.tokens.push({type:"dl_open",lines:l=[t,0],level:e.level++}),s=t,a=c;e:for(;;){for(g=!0,v=!1,e.tokens.push({type:"dt_open",lines:[s,s],level:e.level++}),e.tokens.push({type:"inline",content:e.getLines(s,s+1,e.blkIndent,!1).trim(),level:e.level+1,lines:[s,s],children:[]}),e.tokens.push({type:"dt_close",level:--e.level});;){if(e.tokens.push({type:"dd_open",lines:o=[c,0],level:e.level++}),m=e.tight,h=e.ddIndent,d=e.blkIndent,f=e.tShift[a],p=e.parentType,e.blkIndent=e.ddIndent=e.tShift[a]+2,e.tShift[a]=i-e.bMarks[a],e.tight=!0,e.parentType="deflist",e.parser.tokenize(e,a,n,!0),(!e.tight||v)&&(g=!1),v=e.line-a>1&&e.isEmpty(e.line-1),e.tShift[a]=f,e.tight=m,e.parentType=p,e.blkIndent=d,e.ddIndent=h,e.tokens.push({type:"dd_close",level:--e.level}),o[1]=c=e.line,c>=n||e.tShift[c]<e.blkIndent)break e;if((i=Fn(e,c))<0)break;a=c}if(c>=n||(s=c,e.isEmpty(s))||e.tShift[s]<e.blkIndent||(a=s+1)>=n||(e.isEmpty(a)&&a++,a>=n)||e.tShift[a]<e.blkIndent||(i=Fn(e,a))<0)break}return e.tokens.push({type:"dl_close",level:--e.level}),l[1]=c,e.line=c,g&&function(e,t){var n,r,i=e.level+2;for(n=t+2,r=e.tokens.length-2;n<r;n++)e.tokens[n].level===i&&"paragraph_open"===e.tokens[n].type&&(e.tokens[n+2].tight=!0,e.tokens[n].tight=!0,n+=2)}(e,u),!0},["paragraph"]],["paragraph",function(e,t){var n,r,i,a,s,o,l=t+1;if(l<(n=e.lineMax)&&!e.isEmpty(l))for(o=e.parser.ruler.getRules("paragraph");l<n&&!e.isEmpty(l);l++)if(!(e.tShift[l]-e.blkIndent>3)){for(i=!1,a=0,s=o.length;a<s;a++)if(o[a](e,l,n,!0)){i=!0;break}if(i)break}return r=e.getLines(t,l,e.blkIndent,!1).trim(),e.line=l,r.length&&(e.tokens.push({type:"paragraph_open",tight:!1,lines:[t,e.line],level:e.level}),e.tokens.push({type:"inline",content:r,level:e.level+1,lines:[t,e.line],children:[]}),e.tokens.push({type:"paragraph_close",tight:!1,level:e.level})),!0}]];function jn(){this.ruler=new ln;for(var e=0;e<Dn.length;e++)this.ruler.push(Dn[e][0],Dn[e][1],{alt:(Dn[e][2]||[]).slice()})}jn.prototype.tokenize=function(e,t,n){for(var r,i=this.ruler.getRules(""),a=i.length,s=t,o=!1;s<n&&(e.line=s=e.skipEmptyLines(s),!(s>=n||e.tShift[s]<e.blkIndent));){for(r=0;r<a&&!i[r](e,s,n,!1);r++);if(e.tight=!o,e.isEmpty(e.line-1)&&(o=!0),(s=e.line)<n&&e.isEmpty(s)){if(o=!0,++s<n&&"list"===e.parentType&&e.isEmpty(s))break;e.line=s}}};var Un=/[\n\t]/g,Hn=/\r[\n\u0085]|[\u2424\u2028\u0085]/g,qn=/\u00a0/g;function zn(e){switch(e){case 10:case 92:case 96:case 42:case 95:case 94:case 91:case 93:case 33:case 38:case 60:case 62:case 123:case 125:case 36:case 37:case 64:case 126:case 43:case 61:case 58:return!0;default:return!1}}jn.prototype.parse=function(e,t,n,r){var i,a=0,s=0;if(!e)return[];(e=(e=e.replace(qn," ")).replace(Hn,"\n")).indexOf("\t")>=0&&(e=e.replace(Un,function(t,n){var r;return 10===e.charCodeAt(n)?(a=n+1,s=0,t):(r="    ".slice((n-a-s)%4),s=n-a+1,r)})),i=new In(e,this,t,n,r),this.tokenize(i,i.line,i.lineMax)};for(var Gn=[],Wn=0;Wn<256;Wn++)Gn.push(0);function Kn(e){return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122}function Vn(e,t){var n,r,i,a=t,s=!0,o=!0,l=e.posMax,u=e.src.charCodeAt(t);for(n=t>0?e.src.charCodeAt(t-1):-1;a<l&&e.src.charCodeAt(a)===u;)a++;return a>=l&&(s=!1),(i=a-t)>=4?s=o=!1:((32===(r=a<l?e.src.charCodeAt(a):-1)||10===r)&&(s=!1),(32===n||10===n)&&(o=!1),95===u&&(Kn(n)&&(s=!1),Kn(r)&&(o=!1))),{can_open:s,can_close:o,delims:i}}"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(e){Gn[e.charCodeAt(0)]=1});var Xn=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;var Jn=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;var Zn=["coap","doi","javascript","aaa","aaas","about","acap","cap","cid","crid","data","dav","dict","dns","file","ftp","geo","go","gopher","h323","http","https","iax","icap","im","imap","info","ipp","iris","iris.beep","iris.xpc","iris.xpcs","iris.lwz","ldap","mailto","mid","msrp","msrps","mtqp","mupdate","news","nfs","ni","nih","nntp","opaquelocktoken","pop","pres","rtsp","service","session","shttp","sieve","sip","sips","sms","snmp","soap.beep","soap.beeps","tag","tel","telnet","tftp","thismessage","tn3270","tip","tv","urn","vemmi","ws","wss","xcon","xcon-userid","xmlrpc.beep","xmlrpc.beeps","xmpp","z39.50r","z39.50s","adiumxtra","afp","afs","aim","apt","attachment","aw","beshare","bitcoin","bolo","callto","chrome","chrome-extension","com-eventbrite-attendee","content","cvs","dlna-playsingle","dlna-playcontainer","dtn","dvb","ed2k","facetime","feed","finger","fish","gg","git","gizmoproject","gtalk","hcp","icon","ipn","irc","irc6","ircs","itms","jar","jms","keyparc","lastfm","ldaps","magnet","maps","market","message","mms","ms-help","msnim","mumble","mvn","notes","oid","palm","paparazzi","platform","proxy","psyc","query","res","resource","rmi","rsync","rtmp","secondlife","sftp","sgn","skype","smb","soldat","spotify","ssh","steam","svn","teamspeak","things","udp","unreal","ut2004","ventrilo","view-source","webcal","wtai","wyciwyg","xfire","xri","ymsgr"],Yn=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,Qn=/^<([a-zA-Z.\-]{1,25}):([^<>\x00-\x20]*)>/;function $n(e,t){return e=e.source,t=t||"",function n(r,i){return r?(i=i.source||i,e=e.replace(r,i),n):new RegExp(e,t)}}var er=$n(/(?:unquoted|single_quoted|double_quoted)/)("unquoted",/[^"'=<>`\x00-\x20]+/)("single_quoted",/'[^']*'/)("double_quoted",/"[^"]*"/)(),tr=$n(/(?:\s+attr_name(?:\s*=\s*attr_value)?)/)("attr_name",/[a-zA-Z_:][a-zA-Z0-9:._-]*/)("attr_value",er)(),nr=$n(/<[A-Za-z][A-Za-z0-9]*attribute*\s*\/?>/)("attribute",tr)(),rr=$n(/^(?:open_tag|close_tag|comment|processing|declaration|cdata)/)("open_tag",nr)("close_tag",/<\/[A-Za-z][A-Za-z0-9]*\s*>/)("comment",/<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->/)("processing",/<[?].*?[?]>/)("declaration",/<![A-Z]+\s+[^>]*>/)("cdata",/<!\[CDATA\[[\s\S]*?\]\]>/)();var ir=/^&#((?:x[a-f0-9]{1,8}|[0-9]{1,8}));/i,ar=/^&([a-z][a-z0-9]{1,31});/i;var sr=[["text",function(e,t){for(var n=e.pos;n<e.posMax&&!zn(e.src.charCodeAt(n));)n++;return n!==e.pos&&(t||(e.pending+=e.src.slice(e.pos,n)),e.pos=n,!0)}],["newline",function(e,t){var n,r,i=e.pos;if(10!==e.src.charCodeAt(i))return!1;if(n=e.pending.length-1,r=e.posMax,!t)if(n>=0&&32===e.pending.charCodeAt(n))if(n>=1&&32===e.pending.charCodeAt(n-1)){for(var a=n-2;a>=0;a--)if(32!==e.pending.charCodeAt(a)){e.pending=e.pending.substring(0,a+1);break}e.push({type:"hardbreak",level:e.level})}else e.pending=e.pending.slice(0,-1),e.push({type:"softbreak",level:e.level});else e.push({type:"softbreak",level:e.level});for(i++;i<r&&32===e.src.charCodeAt(i);)i++;return e.pos=i,!0}],["escape",function(e,t){var n,r=e.pos,i=e.posMax;if(92!==e.src.charCodeAt(r))return!1;if(++r<i){if((n=e.src.charCodeAt(r))<256&&0!==Gn[n])return t||(e.pending+=e.src[r]),e.pos+=2,!0;if(10===n){for(t||e.push({type:"hardbreak",level:e.level}),r++;r<i&&32===e.src.charCodeAt(r);)r++;return e.pos=r,!0}}return t||(e.pending+="\\"),e.pos++,!0}],["backticks",function(e,t){var n,r,i,a,s,o=e.pos;if(96!==e.src.charCodeAt(o))return!1;for(n=o,o++,r=e.posMax;o<r&&96===e.src.charCodeAt(o);)o++;for(i=e.src.slice(n,o),a=s=o;-1!==(a=e.src.indexOf("`",s));){for(s=a+1;s<r&&96===e.src.charCodeAt(s);)s++;if(s-a===i.length)return t||e.push({type:"code",content:e.src.slice(o,a).replace(/[ \n]+/g," ").trim(),block:!1,level:e.level}),e.pos=s,!0}return t||(e.pending+=i),e.pos+=i.length,!0}],["del",function(e,t){var n,r,i,a,s,o=e.posMax,l=e.pos;if(126!==e.src.charCodeAt(l)||t||l+4>=o||126!==e.src.charCodeAt(l+1)||e.level>=e.options.maxNesting||(a=l>0?e.src.charCodeAt(l-1):-1,s=e.src.charCodeAt(l+2),126===a)||126===s||32===s||10===s)return!1;for(r=l+2;r<o&&126===e.src.charCodeAt(r);)r++;if(r>l+3)return e.pos+=r-l,t||(e.pending+=e.src.slice(l,r)),!0;for(e.pos=l+2,i=1;e.pos+1<o;){if(126===e.src.charCodeAt(e.pos)&&126===e.src.charCodeAt(e.pos+1)&&(a=e.src.charCodeAt(e.pos-1),126!==(s=e.pos+2<o?e.src.charCodeAt(e.pos+2):-1)&&126!==a&&(32!==a&&10!==a?i--:32!==s&&10!==s&&i++,i<=0))){n=!0;break}e.parser.skipToken(e)}return n?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"del_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"del_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=o,!0):(e.pos=l,!1)}],["ins",function(e,t){var n,r,i,a,s,o=e.posMax,l=e.pos;if(43!==e.src.charCodeAt(l)||t||l+4>=o||43!==e.src.charCodeAt(l+1)||e.level>=e.options.maxNesting||(a=l>0?e.src.charCodeAt(l-1):-1,s=e.src.charCodeAt(l+2),43===a)||43===s||32===s||10===s)return!1;for(r=l+2;r<o&&43===e.src.charCodeAt(r);)r++;if(r!==l+2)return e.pos+=r-l,t||(e.pending+=e.src.slice(l,r)),!0;for(e.pos=l+2,i=1;e.pos+1<o;){if(43===e.src.charCodeAt(e.pos)&&43===e.src.charCodeAt(e.pos+1)&&(a=e.src.charCodeAt(e.pos-1),43!==(s=e.pos+2<o?e.src.charCodeAt(e.pos+2):-1)&&43!==a&&(32!==a&&10!==a?i--:32!==s&&10!==s&&i++,i<=0))){n=!0;break}e.parser.skipToken(e)}return n?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"ins_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"ins_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=o,!0):(e.pos=l,!1)}],["mark",function(e,t){var n,r,i,a,s,o=e.posMax,l=e.pos;if(61!==e.src.charCodeAt(l)||t||l+4>=o||61!==e.src.charCodeAt(l+1)||e.level>=e.options.maxNesting||(a=l>0?e.src.charCodeAt(l-1):-1,s=e.src.charCodeAt(l+2),61===a)||61===s||32===s||10===s)return!1;for(r=l+2;r<o&&61===e.src.charCodeAt(r);)r++;if(r!==l+2)return e.pos+=r-l,t||(e.pending+=e.src.slice(l,r)),!0;for(e.pos=l+2,i=1;e.pos+1<o;){if(61===e.src.charCodeAt(e.pos)&&61===e.src.charCodeAt(e.pos+1)&&(a=e.src.charCodeAt(e.pos-1),61!==(s=e.pos+2<o?e.src.charCodeAt(e.pos+2):-1)&&61!==a&&(32!==a&&10!==a?i--:32!==s&&10!==s&&i++,i<=0))){n=!0;break}e.parser.skipToken(e)}return n?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"mark_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"mark_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=o,!0):(e.pos=l,!1)}],["emphasis",function(e,t){var n,r,i,a,s,o,l,u=e.posMax,c=e.pos,d=e.src.charCodeAt(c);if(95!==d&&42!==d||t)return!1;if(n=(l=Vn(e,c)).delims,!l.can_open)return e.pos+=n,t||(e.pending+=e.src.slice(c,e.pos)),!0;if(e.level>=e.options.maxNesting)return!1;for(e.pos=c+n,o=[n];e.pos<u;)if(e.src.charCodeAt(e.pos)!==d)e.parser.skipToken(e);else{if(r=(l=Vn(e,e.pos)).delims,l.can_close){for(a=o.pop(),s=r;a!==s;){if(s<a){o.push(a-s);break}if(s-=a,0===o.length)break;e.pos+=a,a=o.pop()}if(0===o.length){n=a,i=!0;break}e.pos+=r;continue}l.can_open&&o.push(r),e.pos+=r}return i?(e.posMax=e.pos,e.pos=c+n,t||((2===n||3===n)&&e.push({type:"strong_open",level:e.level++}),(1===n||3===n)&&e.push({type:"em_open",level:e.level++}),e.parser.tokenize(e),(1===n||3===n)&&e.push({type:"em_close",level:--e.level}),(2===n||3===n)&&e.push({type:"strong_close",level:--e.level})),e.pos=e.posMax+n,e.posMax=u,!0):(e.pos=c,!1)}],["sub",function(e,t){var n,r,i=e.posMax,a=e.pos;if(126!==e.src.charCodeAt(a)||t||a+2>=i||e.level>=e.options.maxNesting)return!1;for(e.pos=a+1;e.pos<i;){if(126===e.src.charCodeAt(e.pos)){n=!0;break}e.parser.skipToken(e)}return!n||a+1===e.pos||(r=e.src.slice(a+1,e.pos)).match(/(^|[^\\])(\\\\)*\s/)?(e.pos=a,!1):(e.posMax=e.pos,e.pos=a+1,t||e.push({type:"sub",level:e.level,content:r.replace(Xn,"$1")}),e.pos=e.posMax+1,e.posMax=i,!0)}],["sup",function(e,t){var n,r,i=e.posMax,a=e.pos;if(94!==e.src.charCodeAt(a)||t||a+2>=i||e.level>=e.options.maxNesting)return!1;for(e.pos=a+1;e.pos<i;){if(94===e.src.charCodeAt(e.pos)){n=!0;break}e.parser.skipToken(e)}return!n||a+1===e.pos||(r=e.src.slice(a+1,e.pos)).match(/(^|[^\\])(\\\\)*\s/)?(e.pos=a,!1):(e.posMax=e.pos,e.pos=a+1,t||e.push({type:"sup",level:e.level,content:r.replace(Jn,"$1")}),e.pos=e.posMax+1,e.posMax=i,!0)}],["links",function(e,t){var n,r,i,a,s,o,l,u,c=!1,d=e.pos,h=e.posMax,p=e.pos,f=e.src.charCodeAt(p);if(33===f&&(c=!0,f=e.src.charCodeAt(++p)),91!==f||e.level>=e.options.maxNesting||(n=p+1,(r=cn(e,p))<0))return!1;if((o=r+1)<h&&40===e.src.charCodeAt(o)){for(o++;o<h&&(32===(u=e.src.charCodeAt(o))||10===u);o++);if(o>=h)return!1;for(p=o,pn(e,o)?(a=e.linkContent,o=e.pos):a="",p=o;o<h&&(32===(u=e.src.charCodeAt(o))||10===u);o++);if(o<h&&p!==o&&fn(e,o))for(s=e.linkContent,o=e.pos;o<h&&(32===(u=e.src.charCodeAt(o))||10===u);o++);else s="";if(o>=h||41!==e.src.charCodeAt(o))return e.pos=d,!1;o++}else{if(e.linkLevel>0)return!1;for(;o<h&&(32===(u=e.src.charCodeAt(o))||10===u);o++);if(o<h&&91===e.src.charCodeAt(o)&&(p=o+1,(o=cn(e,o))>=0?i=e.src.slice(p,o++):o=p-1),i||(E(i)>"u"&&(o=r+1),i=e.src.slice(n,r)),!(l=e.env.references[mn(i)]))return e.pos=d,!1;a=l.href,s=l.title}return t||(e.pos=n,e.posMax=r,c?e.push({type:"image",src:a,title:s,alt:e.src.substr(n,r-n),level:e.level}):(e.push({type:"link_open",href:a,title:s,level:e.level++}),e.linkLevel++,e.parser.tokenize(e),e.linkLevel--,e.push({type:"link_close",level:--e.level}))),e.pos=o,e.posMax=h,!0}],["footnote_inline",function(e,t){var n,r,i,a,s=e.posMax,o=e.pos;return!(o+2>=s||94!==e.src.charCodeAt(o)||91!==e.src.charCodeAt(o+1)||e.level>=e.options.maxNesting||(n=o+2,r=cn(e,o+1),r<0))&&(t||(e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.list||(e.env.footnotes.list=[]),i=e.env.footnotes.list.length,e.pos=n,e.posMax=r,e.push({type:"footnote_ref",id:i,level:e.level}),e.linkLevel++,a=e.tokens.length,e.parser.tokenize(e),e.env.footnotes.list[i]={tokens:e.tokens.splice(a)},e.linkLevel--),e.pos=r+1,e.posMax=s,!0)}],["footnote_ref",function(e,t){var n,r,i,a,s=e.posMax,o=e.pos;if(o+3>s||!e.env.footnotes||!e.env.footnotes.refs||91!==e.src.charCodeAt(o)||94!==e.src.charCodeAt(o+1)||e.level>=e.options.maxNesting)return!1;for(r=o+2;r<s;r++){if(32===e.src.charCodeAt(r)||10===e.src.charCodeAt(r))return!1;if(93===e.src.charCodeAt(r))break}return!(r===o+2||r>=s||(r++,n=e.src.slice(o+2,r-1),E(e.env.footnotes.refs[":"+n])>"u"))&&(t||(e.env.footnotes.list||(e.env.footnotes.list=[]),e.env.footnotes.refs[":"+n]<0?(i=e.env.footnotes.list.length,e.env.footnotes.list[i]={label:n,count:0},e.env.footnotes.refs[":"+n]=i):i=e.env.footnotes.refs[":"+n],a=e.env.footnotes.list[i].count,e.env.footnotes.list[i].count++,e.push({type:"footnote_ref",id:i,subId:a,level:e.level})),e.pos=r,e.posMax=s,!0)}],["autolink",function(e,t){var n,r,i,a,s,o=e.pos;return!(60!==e.src.charCodeAt(o)||(n=e.src.slice(o),n.indexOf(">")<0))&&((r=n.match(Qn))?!(Zn.indexOf(r[1].toLowerCase())<0||(a=r[0].slice(1,-1),s=hn(a),!e.parser.validateLink(a)))&&(t||(e.push({type:"link_open",href:s,level:e.level}),e.push({type:"text",content:a,level:e.level+1}),e.push({type:"link_close",level:e.level})),e.pos+=r[0].length,!0):!!(i=n.match(Yn))&&(s=hn("mailto:"+(a=i[0].slice(1,-1))),!!e.parser.validateLink(s)&&(t||(e.push({type:"link_open",href:s,level:e.level}),e.push({type:"text",content:a,level:e.level+1}),e.push({type:"link_close",level:e.level})),e.pos+=i[0].length,!0)))}],["htmltag",function(e,t){var n,r,i,a=e.pos;return!(!e.options.html||(i=e.posMax,60!==e.src.charCodeAt(a)||a+2>=i)||(n=e.src.charCodeAt(a+1),33!==n&&63!==n&&47!==n&&!function(e){var t=32|e;return t>=97&&t<=122}(n))||(r=e.src.slice(a).match(rr),!r))&&(t||e.push({type:"htmltag",content:e.src.slice(a,a+r[0].length),level:e.level}),e.pos+=r[0].length,!0)}],["entity",function(e,t){var n,r,i=e.pos,a=e.posMax;if(38!==e.src.charCodeAt(i))return!1;if(i+1<a)if(35===e.src.charCodeAt(i+1)){if(r=e.src.slice(i).match(ir))return t||(n="x"===r[1][0].toLowerCase()?parseInt(r[1].slice(1),16):parseInt(r[1],10),e.pending+=Kt(n)?Vt(n):Vt(65533)),e.pos+=r[0].length,!0}else if(r=e.src.slice(i).match(ar)){var s=Ht(r[1]);if(r[1]!==s)return t||(e.pending+=s),e.pos+=r[0].length,!0}return t||(e.pending+="&"),e.pos++,!0}]];function or(){this.ruler=new ln;for(var e=0;e<sr.length;e++)this.ruler.push(sr[e][0],sr[e][1]);this.validateLink=lr}function lr(e){var t=e.trim().toLowerCase();return!(-1!==(t=Yt(t)).indexOf(":")&&-1!==["vbscript","javascript","file","data"].indexOf(t.split(":")[0]))}or.prototype.skipToken=function(e){var t,n,r=this.ruler.getRules(""),i=r.length,a=e.pos;if((n=e.cacheGet(a))>0)e.pos=n;else{for(t=0;t<i;t++)if(r[t](e,!0))return void e.cacheSet(a,e.pos);e.pos++,e.cacheSet(a,e.pos)}},or.prototype.tokenize=function(e){for(var t,n,r=this.ruler.getRules(""),i=r.length,a=e.posMax;e.pos<a;){for(n=0;n<i&&!(t=r[n](e,!1));n++);if(t){if(e.pos>=a)break}else e.pending+=e.src[e.pos++]}e.pending&&e.pushPending()},or.prototype.parse=function(e,t,n,r){var i=new un(e,this,t,n,r);this.tokenize(i)};var ur={default:{options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201c\u201d\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","replacements","smartquotes","references","abbr2","footnote_tail"]},block:{rules:["blockquote","code","fences","footnote","heading","hr","htmlblock","lheading","list","paragraph","table"]},inline:{rules:["autolink","backticks","del","emphasis","entity","escape","footnote_ref","htmltag","links","newline","text"]}}},full:{options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201c\u201d\u2018\u2019",highlight:null,maxNesting:20},components:{core:{},block:{},inline:{}}},commonmark:{options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201c\u201d\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","abbr2"]},block:{rules:["blockquote","code","fences","heading","hr","htmlblock","lheading","list","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","htmltag","links","newline","text"]}}}};function cr(e,t,n){this.src=t,this.env=n,this.options=e.options,this.tokens=[],this.inlineMode=!1,this.inline=e.inline,this.block=e.block,this.renderer=e.renderer,this.typographer=e.typographer}function dr(e,t){"string"!=typeof e&&(t=e,e="default"),t&&null!=t.linkify&&console.warn("linkify option is removed. Use linkify plugin instead:\n\nimport Remarkable from 'remarkable';\nimport linkify from 'remarkable/linkify';\nnew Remarkable().use(linkify)\n"),this.inline=new or,this.block=new jn,this.core=new Mn,this.renderer=new on,this.ruler=new ln,this.options={},this.configure(ur[e]),this.set(t||{})}dr.prototype.set=function(e){zt(this.options,e)},dr.prototype.configure=function(e){var t=this;if(!e)throw new Error("Wrong `remarkable` preset, check name/content");e.options&&t.set(e.options),e.components&&Object.keys(e.components).forEach(function(n){e.components[n].rules&&t[n].ruler.enable(e.components[n].rules,!0)})},dr.prototype.use=function(e,t){return e(this,t),this},dr.prototype.parse=function(e,t){var n=new cr(this,e,t);return this.core.process(n),n.tokens},dr.prototype.render=function(e,t){return t=t||{},this.renderer.render(this.parse(e,t),this.options,t)},dr.prototype.parseInline=function(e,t){var n=new cr(this,e,t);return n.inlineMode=!0,this.core.process(n),n.tokens},dr.prototype.renderInline=function(e,t){return t=t||{},this.renderer.render(this.parseInline(e,t),this.options,t)};var hr=function(){function e(){C(this,e)}return x(e,null,[{key:"addPlugins",value:function(e,t){var n=window.remarkable_plugins;if(n&&n.forEach(function(t){e.use(t.plugin,t.options)}),null!=t&&t.math){window.katex||(console.warn("window.katex not found, use chatElementRef.refreshMessages to re-render messages"),console.warn("See https://deepchat.dev/examples/externalModules"));var r="object"==E(t.math)?t.math.delimiter:"",i="object"==E(t.math)&&t.math.options?t.math.options:{};e.use(Ut.katex.bind(this,i),{delimiter:r})}}},{key:"instantiate",value:function(t){if(t)return new dr(S(S({},e.DEFAULT_PROPERTIES),t));if(window.hljs){var n=window.hljs;return new dr({highlight:function(e,t){if(t&&n.getLanguage(t))try{return n.highlight(e,{language:t}).value}catch(r){console[F]("failed to setup the highlight dependency")}try{return n.highlightAuto(e).value}catch(i){console[F]("failed to automatically highlight messages")}return""},html:!1,xhtmlOut:!1,breaks:!0,langPrefix:"language-",linkTarget:"_blank",typographer:!0})}return new dr(e.DEFAULT_PROPERTIES)}},{key:"createNew",value:function(t){var n=e.instantiate(t);return e.addPlugins(n,t),n.inline.validateLink=function(){return!0},n}}])}();hr.DEFAULT_PROPERTIES={breaks:!0,linkTarget:"_blank"};var pr=hr,fr=function(){return x(function e(t){C(this,e),this.storageKey="deep-chat-storage",this.maxMessages=1e3,this.trackInputText=!1,this.trackScrollHeight=!1,"object"==E(t)&&(t.key&&(this.storageKey=t.key),t.maxMessages&&(this.maxMessages=t.maxMessages),void 0!==t.inputText&&(this.trackInputText=t.inputText),void 0!==t.scrollHeight&&(this.trackScrollHeight=t.scrollHeight),t.clear=this.clear.bind(this),Ct.processBrowserStorage(this))},[{key:"get",value:function(){var e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):{messages:[]}}},{key:"set",value:function(e,t,n){var r={messages:e,inputText:t,scrollHeight:n};localStorage.setItem(this.storageKey,JSON.stringify(r))}},{key:"addMessages",value:function(e){var t=e.length-this.maxMessages;t<0&&(t=0);var n=e.slice(t,e.length),r=this.trackInputText||this.trackScrollHeight?localStorage.getItem(this.storageKey):void 0,i=r?JSON.parse(r):void 0;this.set(n,this.trackInputText?null==i?void 0:i.inputText:void 0,this.trackScrollHeight?null==i?void 0:i.scrollHeight:void 0)}},{key:"addInputText",value:function(e){if(this.trackInputText){var t=localStorage.getItem(this.storageKey),n=t?JSON.parse(t):void 0;this.set((null==n?void 0:n.messages)||[],e,this.trackScrollHeight?null==n?void 0:n.scrollHeight:void 0)}}},{key:"addScrollHeight",value:function(e){if(this.trackScrollHeight){var t=localStorage.getItem(this.storageKey),n=t?JSON.parse(t):void 0;this.set((null==n?void 0:n.messages)||[],this.trackInputText?null==n?void 0:n.inputText:void 0,e)}}},{key:"clear",value:function(){localStorage.removeItem(this.storageKey)}}])}(),mr=function(){function e(){C(this,e)}return x(e,null,[{key:"applyCustomStylesToElements",value:function(e,t,n){if(n&&(Object.assign(e.outerContainer[I],n.outerContainer),Object.assign(e.innerContainer[I],n.innerContainer),Object.assign(e.bubbleElement[I],n.bubble),t)){var r=e.bubbleElement.children[0],i="a"!==r.tagName.toLocaleLowerCase()?r:r.children[0];Object.assign(i[I],n.media)}}},{key:"applySideStyles",value:function(t,n,r,i){i&&(e.applyCustomStylesToElements(t,r,i.shared),n===U?e.applyCustomStylesToElements(t,r,i.user):(e.applyCustomStylesToElements(t,r,i.ai),e.applyCustomStylesToElements(t,r,i[n])))}},{key:"isElementsStyles",value:function(e){return!!(e.outerContainer||e.innerContainer||e.bubble||e.media)}},{key:"applyCustomStyles",value:function(t,n,r,i,a){var s;a&&t[Oe]!==a?e.isElementsStyles(a)?(e.applyCustomStylesToElements(n,i,null==(s=t[Oe])?void 0:s.shared),e.applyCustomStylesToElements(n,i,a)):(e.applySideStyles(n,r,i,t[Oe]),e.applySideStyles(n,r,i,a)):e.applySideStyles(n,r,i,t[Oe])}},{key:"extractParticularSharedStyles",value:function(e,t){if(null!=t&&t.shared){var n=t.shared,r={outerContainer:{},innerContainer:{},bubble:{},media:{}};return e.forEach(function(e){var t,i,a,s;r.outerContainer[e]=(null==(t=n.outerContainer)?void 0:t[e])||"",r.innerContainer[e]=(null==(i=n.innerContainer)?void 0:i[e])||"",r.bubble[e]=(null==(a=n.bubble)?void 0:a[e])||"",r.media[e]=(null==(s=n.media)?void 0:s[e])||""}),r}}}])}(),vr=function(){function e(){C(this,e)}return x(e,null,[{key:"setElementProps",value:function(e,t,n,r){var i;"loading"!==n&&(e.applyCustomStyles(t,r,!0,null==(i=e.messageStyles)?void 0:i[n]),t.bubbleElement[M].add(se))}},{key:"addMessage",value:function(t,n,r,i,a){e.setElementProps(t,n,r,i),a||t.appendOuterContainerElemet(n.outerContainer)}},{key:"wrapInLink",value:function(e,t,n){var r=R("a");return r.href=t,r.download=n||Z,r.target="_blank",r.appendChild(e),r}},{key:"isNonLinkableDataUrl",value:function(e,t){return!(!t.startsWith("data")||e===Q)&&(e===ae&&t.startsWith("data:text/javascript")||!t.startsWith("data:image")&&!t.startsWith("data:application"))}},{key:"processContent",value:function(t,n,r,i){return!r||e.isNonLinkableDataUrl(t,r)?n:e.wrapInLink(n,r,i)}},{key:"waitToLoadThenScroll",value:function(e){setTimeout(function(){e()},60)}},{key:"scrollDownOnImageLoad",value:function(t,n){if(t.startsWith("data"))e.waitToLoadThenScroll(n);else try{fetch(t,{mode:"no-cors"}).catch(function(){}).finally(function(){e.waitToLoadThenScroll(n)})}catch(r){n()}}},{key:"reAddFileRefToObject",value:function(e,t){var n;null==(n=e[Y])||n.forEach(function(e,n){var r;e.ref&&null!=(r=t[Y])&&r[n]&&(t[Y][n].ref=e.ref)})}},{key:"removeFileRef",value:function(e){var t=S({},e);return delete t.ref,t}},{key:"isAudioFile",value:function(e){var t=e.type,n=e.src;return t===ne||(null==n?void 0:n.startsWith("data:audio"))||n&&/\.(mp3|ogg|wav|aac|webm|4a)$/i.test(n)}},{key:"isImageFile",value:function(t){var n=t.type,r=t.src;return n===Q||(null==r?void 0:r.startsWith("data:image"))||r&&e.isImageFileExtension(r)}},{key:"isImageFileExtension",value:function(e){return/\.(jpg|jpeg|png|gif|bmp)$/i.test(e)}}])}(),gr=function(){return x(function e(){C(this,e)},null,[{key:"onMessage",value:function(e,t,n){var r,i=ce({message:t,isHistory:n,isInitial:n});vr.reAddFileRefToObject(t,i.message),null==(r=e.onMessage)||r.call(e,i),e.dispatchEvent(new CustomEvent("message",{detail:i})),Ct.fireOnNewMessage(e,i)}},{key:"onClearMessages",value:function(e){var t;null==(t=e.onClearMessages)||t.call(e),e.dispatchEvent(new CustomEvent("clear-messages"))}},{key:"onRender",value:function(e){var t;null==(t=e.onComponentRender)||t.call(e,e),e.dispatchEvent(new CustomEvent("render",{detail:e}))}},{key:"onInput",value:function(e,t,n){var r,i,a=ce({content:t,isUser:n});t[Y]&&vr.reAddFileRefToObject(w({},Y,null==(r=t[Y])?void 0:r.map(function(e){return{ref:e}})),a.content),null==(i=e.onInput)||i.call(e,a),e.dispatchEvent(new CustomEvent("input",{detail:a}))}},{key:"onError",value:function(e,t){var n;null==(n=e.onError)||n.call(e,t),e.dispatchEvent(new CustomEvent(F,{detail:t}))}}])}(),yr=function(){function e(){C(this,e)}return x(e,null,[{key:"generateLoadingRingElement",value:function(){var e=R();return e[M].add("loading-history"),e.appendChild(R()),e.appendChild(R()),e.appendChild(R()),e.appendChild(R()),e}},{key:"apply",value:function(e,t,n){Et.setRing(t.bubbleElement,null==n?void 0:n.bubble),null!=n&&n.bubble&&delete(n=ce(n)).bubble,e.applyCustomStyles(t,"history",!1,n)}},{key:"addLoadHistoryMessage",value:function(t,n){var r,i,a,s,o,l,u,c,d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.bubbleElement[M].add(e.CLASS);var h=d?e.FULL_VIEW_CLASS:e.SMALL_CLASS;t.outerContainer[M].add(h);var p=d?null==(s=null==(a=null==(i=null==(r=n.messageStyles)?void 0:r.loading)?void 0:i.history)?void 0:a.full)?void 0:s.styles:null==(c=null==(u=null==(l=null==(o=n.messageStyles)?void 0:o.loading)?void 0:l.history)?void 0:u.small)?void 0:c.styles;e.apply(n,t,p);var f=n.elementRef;d&&n.elementRef.id!==le&&(f=n.elementRef.parentElement),null==f||f.prepend(t.outerContainer)}},{key:"createDefaultElements",value:function(t){var n=t.createMessageElements("",j),r=n.bubbleElement,i=e.generateLoadingRingElement();return r.appendChild(i),n}},{key:"addMessage",value:function(t){var n,r,i,a,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=null==(a=null==(i=null==(r=null==(n=t.messageStyles)?void 0:n.loading)?void 0:r.history)?void 0:i.full)?void 0:a[N],l=o?jt.createElements(t,o,j,!0,!0):e.createDefaultElements(t);return e.addLoadHistoryMessage(l,t,s),Ir.softRemRoleElements(l.innerContainer,t.avatar,t.name),l}},{key:"tryChangeViewToSmall",value:function(t,n){var r,i,a,s,o,l,u,c;if(null!=n&&n.outerContainer[M].contains(e.FULL_VIEW_CLASS)){n.outerContainer[M].replace(e.FULL_VIEW_CLASS,e.SMALL_CLASS);var d=null==(s=null==(a=null==(i=null==(r=t.messageStyles)?void 0:r.loading)?void 0:i.history)?void 0:a.small)?void 0:s.styles;d&&e.apply(t,n,d);var h=null==(c=null==(u=null==(l=null==(o=t.messageStyles)?void 0:o.loading)?void 0:l.history)?void 0:u.small)?void 0:c[N];return h&&(n.bubbleElement.innerHTML=h),!0}return!1}},{key:"changeFullViewToSmall",value:function(t){var n=t.messageElementRefs[t.messageElementRefs.length-1];e.tryChangeViewToSmall(t,n)||e.tryChangeViewToSmall(t,t.messageElementRefs[0])}}])}();yr.CLASS="loading-history-message",yr.FULL_VIEW_CLASS="loading-history-message-full-view",yr.SMALL_CLASS="loading-history-message-small";var br=yr,kr=function(){function e(){C(this,e)}return x(e,null,[{key:"setFade",value:function(t,n){t[I].transitionDuration="".concat("number"==typeof n?n:e.DEFAULT_FADE_MS,"ms")}},{key:"fadeAnimation",value:(t=k(g().m(function t(n,r){var i;return g().w(function(t){for(;;)switch(t.n){case 0:return n[I].opacity="0",i="number"==typeof r?r:e.DEFAULT_FADE_MS,t.n=1,new Promise(function(e){setTimeout(function(){return e()},i)});case 1:n[I].opacity="1";case 2:return t.a(2)}},t)})),function(e,n){return t.apply(this,arguments)})}]);var t}();kr.DEFAULT_FADE_MS=500;var _r=kr,Sr=function(){function e(t,n,r){if(C(this,e),this.hiddenElements=new Set,this.isScrollButton=!1,this.isScrollingToBottom=!1,this._messages=t,n){var i,a={};"object"==E(n)&&((a=ce(n)).onUpdate=n.onUpdate),null!==(i=a.styles)&&void 0!==i||(a.styles={});var s="fit-content";a.styles.default=S({borderRadius:"10px",width:s,height:s},a.styles.default),this.hiddenMessagesConfig=a,this.io=this.initIntersectionObserver(this._messages.elementRef)}if(r){var o,l="object"==E(r)?ce(r):{};null!==(o=l.styles)&&void 0!==o||(l.styles={}),l.styles.default=S({borderRadius:"50%",width:"1.4rem",height:"1.4rem"},l.styles.default),this.scrollButtonConfig=l}this.element=this.createElement(),this._messages.elementRef.appendChild(this.element)}return x(e,[{key:"initIntersectionObserver",value:function(e){var t=this;return new IntersectionObserver(function(e){e.forEach(function(e){var n;e.isIntersecting&&t.hiddenElements.has(e.target)&&(t.hiddenElements.delete(e.target),null==(n=t.io)||n.unobserve(e.target),t.updateHiddenElement())})},{root:e,threshold:.1})}},{key:"createElement",value:function(){var t=this,n=R();return n.id="scroll-button",kt.assignButtonEvents(n,function(){var n,r,i,a=t.isScrollButton?null==(n=t.scrollButtonConfig)?void 0:n.smoothScroll:null==(r=t.hiddenMessagesConfig)?void 0:r.smoothScroll,s="boolean"!=typeof a||a;if(t.isScrollButton||"last"===(null==(i=t.hiddenMessagesConfig)?void 0:i.clickScroll))kt.scrollToBottom(t._messages,s),s&&t.element&&(e.hideElement(t.element),t.isScrollingToBottom=!0,kt.waitForScrollEnd(t._messages.elementRef,function(){t.isScrollingToBottom=!1}));else{var o=t.hiddenElements.values().next().value;o&&t._messages.elementRef.scrollTo({left:0,top:o.offsetTop,behavior:s?"smooth":"auto"})}}),Nt.apply(this._messages,n),n}},{key:"assignStyles",value:function(e){if(this.element){Object.assign(this.element[I],e[Oe]);var t=De.processStateful(e);Pt.add(this.element,t)}}},{key:"updateHiddenElement",value:function(){var t,n;if(this.element){this.isScrollButton=!1;var r=this.hiddenElements.size;if(0===r)return void e.hideElement(this.element);var i="".concat(r," new message").concat(1===r?"":"s");if(null!=(t=this.hiddenMessagesConfig)&&t.onUpdate){var a=this.hiddenMessagesConfig.onUpdate(i,r);this.element.innerHTML=a,Nt.apply(this._messages,this.element)}else this.element.innerHTML=i;null!=(n=this.hiddenMessagesConfig)&&n.styles&&this.assignStyles(this.hiddenMessagesConfig.styles),e.displayElement(this.element)}}},{key:"updateHidden",value:function(){var e,t;if(!this.isScrollingToBottom)if(this.hiddenMessagesConfig){var n=null==(e=this._messages.getFirstMessageContentEl())?void 0:e.outerContainer;n&&!kt.isVisibleInParent(n,this._messages.elementRef)&&(this.hiddenElements.add(n),null==(t=this.io)||t.observe(n),this.updateHiddenElement())}else this.updateScroll()}},{key:"clearHidden",value:function(){var e=this;this.hiddenElements.forEach(function(t){var n;return null==(n=e.io)?void 0:n.unobserve(t)}),this.hiddenElements.clear(),this.updateHiddenElement()}},{key:"displayScroll",value:function(){var t,n;this.element&&"1"!==this.element[I].opacity&&(e.displayElement(this.element),this.element.innerHTML=(null==(t=this.scrollButtonConfig)?void 0:t.content)||'<span style="font-size: 1.2rem; user-select: none;">&darr;</span>',null!=(n=this.scrollButtonConfig)&&n.styles&&this.assignStyles(this.scrollButtonConfig.styles))}},{key:"updateScroll",value:function(){var t;this.isScrollingToBottom||!this.scrollButtonConfig||(kt.isScrollbarAtBottomOfElement(this._messages.elementRef,(null==(t=this.scrollButtonConfig)?void 0:t.scrollDelta)||80)?this.element&&"0"!==this.element[I].opacity&&e.hideElement(this.element):(this.displayScroll(),this.isScrollButton=!0))}}],[{key:"displayElement",value:function(e){e[I].opacity="1",e[I].pointerEvents="auto"}},{key:"hideElement",value:function(e){e[I].opacity="0",e[I].pointerEvents="none"}}])}(),wr="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='iso-8859-1'?%3e%3csvg%20fill='%23000000'%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%2032%2032'%20xml:space='preserve'%3e%3cpath%20d='M23,30.36H9c-2.404,0-4.36-1.956-4.36-4.36V15c0-2.404,1.956-4.36,4.36-4.36h3.659%20c0.167-1.566,1.415-2.813,2.981-2.981V5.333c-1.131-0.174-2-1.154-2-2.333c0-1.301,1.059-2.36,2.36-2.36%20c1.302,0,2.36,1.059,2.36,2.36c0,1.179-0.869,2.159-2,2.333V7.66c1.566,0.167,2.814,1.415,2.981,2.981H23%20c2.404,0,4.36,1.956,4.36,4.36v11C27.36,28.404,25.404,30.36,23,30.36z%20M9,11.36c-2.007,0-3.64,1.633-3.64,3.64v11%20c0,2.007,1.633,3.64,3.64,3.64h14c2.007,0,3.64-1.633,3.64-3.64V15c0-2.007-1.633-3.64-3.64-3.64H9z%20M13.384,10.64h5.231%20C18.439,9.354,17.334,8.36,16,8.36C14.667,8.36,13.561,9.354,13.384,10.64z%20M16,1.36c-0.904,0-1.64,0.736-1.64,1.64%20S15.096,4.64,16,4.64c0.904,0,1.64-0.736,1.64-1.64S16.904,1.36,16,1.36z%20M20,27.36h-8c-1.301,0-2.36-1.059-2.36-2.36%20s1.059-2.36,2.36-2.36h8c1.302,0,2.36,1.059,2.36,2.36S21.302,27.36,20,27.36z%20M12,23.36c-0.904,0-1.64,0.735-1.64,1.64%20s0.736,1.64,1.64,1.64h8c0.904,0,1.64-0.735,1.64-1.64s-0.735-1.64-1.64-1.64H12z%20M31,23.86h-2c-0.199,0-0.36-0.161-0.36-0.36V15%20c0-0.199,0.161-0.36,0.36-0.36h2c0.199,0,0.36,0.161,0.36,0.36v8.5C31.36,23.699,31.199,23.86,31,23.86z%20M29.36,23.14h1.279v-7.78%20H29.36V23.14z%20M3,23.86H1c-0.199,0-0.36-0.161-0.36-0.36V15c0-0.199,0.161-0.36,0.36-0.36h2c0.199,0,0.36,0.161,0.36,0.36v8.5%20C3.36,23.699,3.199,23.86,3,23.86z%20M1.36,23.14h1.28v-7.78H1.36V23.14z%20M20,20.36c-1.302,0-2.36-1.059-2.36-2.36%20s1.059-2.36,2.36-2.36s2.36,1.059,2.36,2.36C22.36,19.302,21.302,20.36,20,20.36z%20M20,16.36c-0.904,0-1.64,0.736-1.64,1.64%20s0.735,1.64,1.64,1.64s1.64-0.735,1.64-1.64S20.904,16.36,20,16.36z%20M12,20.36c-1.301,0-2.36-1.059-2.36-2.36s1.059-2.36,2.36-2.36%20s2.36,1.059,2.36,2.36C14.36,19.302,13.301,20.36,12,20.36z%20M12,16.36c-0.904,0-1.64,0.736-1.64,1.64s0.736,1.64,1.64,1.64%20s1.64-0.735,1.64-1.64S12.904,16.36,12,16.36z'/%3e%3crect%20style='fill:none;'%20width='32'%20height='32'/%3e%3c/svg%3e",Er="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD6CAMAAAC/MqoPAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAADNQTFRF////9vX18vLy/Pz86enp4+Li2tnZ1tbWzczM+fn57Ozs4N/f09LS0M/P5uXl7+/v3dzcwtncCAAAAAFiS0dEAIgFHUgAAAAJcEhZcwAAAEgAAABIAEbJaz4AAAZNSURBVHja7d3bdtsqEABQYABZSLH9/3+ZpnUsIcF5iOM6PfElNoMHMfPQdq3GmL0GkLhEUqLaUExnOtOZznSmM53pTGc605nOdKYznelMZzrTmV4LXSqllKyJDkob26xWq8Zae/iH0QoWTm9d1xur4WuypQJtTd+5dqn0VjcxzNO5/57mEBvdLo8Oron6aseWOjYOFkVvjQs3DmgyONMuht52EfztP+4hdu0i6LCO808/M8c1lE/fuPGej41uUzgdtoO/75N+2ELJ9I3b3//hPXbiMenm3pR/Jt4USgcLBIp4Bh10gqKVhvLo0klCxeSky96nKcj3siw6pJIL4XsoiQ7apyvMY/V3HHrSRioLopvEhSpTCn2TPEuwKYMOIX0tAxRBf/Hpa+lfSqBv9gi1FPsNfTrMAiVmIE/vJhz61FGnQxRIEYE4vfNYdN8Rp6MlHaHotHTn8ejekaZPAjEmyvQWdZFTtYTpXqCGJ0zvcek9Yfoel76nS0ffv1NMp1ca+pkgyfRCGind4L7OWWc605l+cxjsyhqy9AGbPpClc1/nvl5VX0c/3Alk6RU3+Am7shNZ+h6bvidLr7jBB+zKBrL0irOOudmIUDzTmf5gIP+iEuXtRuTVaEmY/oZLfyNMrzjryPc0gerMTdpVg0tvjJUU6bLPcGOoUv46SLL6Wi8yhLf06C7TUyekI0efRaaYqdFltkeNpPumRPSMDxgBYvSM035FrKAmH72hRW99PrpvSdEHkTEGUvSsK3yKVDkuJ92RohcZaehzzirPpOg+J92Tolfc4Cumx5xVXpGiZ34+ICX6W84qv5GiR5NPbiIpOv6BCoSvSkTX+eiaGP092zINvBOj4x8mSf9FqejvNo/cvpOji19ZbmviL0GPLsYMFzgzCor0+Bv/ePDvSJKOb9dJ5UlnbnEHiHgzv6cdTpJOWuc/u3FEucLDOL75xGtBiefrcwgoC9NDSH/jkH6pAuXmBqPQ9HSUPVdZBH1GGOrMXAQdYxcKZfxAoK+KKBKFLosoEoX+u4giUehz8jlcnAuhp78I46yDYNAd+QLR6K+pr+yvxdBTHyVDubQh0UfSxaHSd0lbvNkVRE87JGOtc+PQd2QLQ6fHhJkKsSh6yg13tO08JPprsgrrXWH0dJd2vH1MLPprot4eXoujpzrdhngiD40ek2y92lggPcnWa8qN1Yz0BFuvZhRl0uOfR0v4Ewuli/Bg4Qr3lArqGdndQ3UPO1EunXYwnelMZzrTmc50pjOd6UxnOtOZznSmM53pTGf6kuj6oedFKV0s3fX6sX1S3bsi6a4PD7+/YAqYeBw6pIB/4qEgOqxdSPbGiim4NRRCbzs3Jj0L4UfXtQXQVRfn5IdA/Bw7RZzurEV6EtdsLeGXkIPuA+K1UoVeA0l62zmN/LqfSSft9KkepmoRuvi3nd5uKNFB9zbbXEANqdr941XO0NJx2v2jdJenpf+/3bvn0ts16ph+sd6hX7dPo2+2cZzE02Ia43bzDHqr+2Evnhz74ZHU30ffbKOeng1/NPV30Ns1gYQnSP2P6e65Pfxc6h02XZqXQCjhJ6kPL6bFo4NrGvAU4UII4SE2P1vQuZkuOxckVfehisF1MjUddN/MZBN+kvq5uf0O/xa66gyNS9ktMWlz44rO1Z8C19i5FPdHzPamXn+F3hryPfxMr78+4F+kq22kO6Rf6fUQt+puuustyWv4rbG3l/duztFB96GYoe1cTBdXMr+nw9qVM6ZfxOvzezff0nXi/ZOndvrR6Zvpm0c3h6nhdb+5iS7tsIim/qXZD9+97/Jf+rpZ5BET1ayv0GUzLhEuhBBjIy/RdVPgndutIRt9nt7p5cKFEEJ3Z+jQFDZL+XnMDXxHB73gxn5s9Kc3d3/pFciFkN/QTSXHJpX5l66gDrkQoP6hL3xsPw39la4qOiV8tH78XeSbue6N9mvWa6J/ybpc1CT1Wnh5Qq9meP8IOKH3ddH7E/ri1iYux/SXDrXR4UiPdck/wUpU+FtPf6/orja6O9KL3l56LOvVxe5Ib2qjN0d6Vbex4ghWlU3bPqI90If66MNng680FNpbJijH6kCvaF3uMzQ3+IrpFerV4Y9dffQdN3im10ivbuImhD3Qq5u4HdZkua8znelMZ/pS4z9CPVKkxowNxgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0wMy0yN1QxNTo0NToxNSswMDowMN1xSg4AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMDMtMjdUMTU6NDU6MTUrMDA6MDCsLPKyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==",Cr=function(){return x(function e(t){C(this,e),this.className=t},[{key:"getAvatarContainer",value:function(e){return e.getElementsByClassName(this.className)[0]}},{key:"tryHide",value:function(e){var t;(t=this.getAvatarContainer(e)[I]).visibility||(t.visibility="hidden")}},{key:"tryReveal",value:function(e){this.getAvatarContainer(e)[I].visibility=""}},{key:"trySoftRem",value:function(e){this.getAvatarContainer(e)[M].add("role-hidden")}}])}(),Tr=function(e){function t(e){var n;return C(this,t),(n=d(this,t,["avatar-container"]))._avatars=e,n}return m(t,e),x(t,[{key:"addBesideBubble",value:function(e,t){var n="boolean"==typeof this._avatars?void 0:this._avatars,r=this.createAvatar(t,n),i=this.getPosition(t,n);r[M].add(i===oe?"start-item-position":"end-item-position"),e.insertAdjacentElement(i===oe?"beforebegin":"afterend",r)}},{key:"createAvatar",value:function(e,n){var r,i,a,s,o,l=R("img");e===U?(l[X]=(null==(r=null==n?void 0:n[U])?void 0:r[X])||(null==(i=null==n?void 0:n[Oe])?void 0:i[X])||Er,l.onerror=t.errorFallback.bind(this,Er)):(l[X]=(null==(a=null==n?void 0:n[e])?void 0:a[X])||(null==(s=null==n?void 0:n[j])?void 0:s[X])||(null==(o=null==n?void 0:n[Oe])?void 0:o[X])||wr,l.onerror=t.errorFallback.bind(this,wr)),l[M].add("avatar"),l.alt="".concat(e," avatar");var u=R();return u[M].add(this.className),u.appendChild(l),n&&t.applyCustomStyles(u,l,n,e),u}},{key:"getPosition",value:function(e,t){var n,r,i,a,s,o,l=Ct.processPosition(null==(r=null==(n=null==t?void 0:t[e])?void 0:n.styles)?void 0:r.position);return e!==U&&(null!=l||(l=null==(a=null==(i=null==t?void 0:t.ai)?void 0:i.styles)?void 0:a.position)),null!=l||(l=null==(o=null==(s=null==t?void 0:t[Oe])?void 0:s.styles)?void 0:o.position),null!=l||(l=e===U?"end":oe),l}}],[{key:"errorFallback",value:function(e,t){var n=t.target;n.onerror=null,n[X]=e}},{key:"applyCustomStylesToElements",value:function(e,t,n){Object.assign(e[I],n.container),Object.assign(t[I],n.avatar)}},{key:"applyCustomStyles",value:function(e,n,r,i){var a,s,o,l;if(null!=(a=r[Oe])&&a.styles&&t.applyCustomStylesToElements(e,n,r[Oe].styles),i===U)null!=(s=r.user)&&s.styles&&t.applyCustomStylesToElements(e,n,r.user.styles);else{null!=(o=r.ai)&&o.styles&&t.applyCustomStylesToElements(e,n,r.ai.styles);var u=null==(l=r[i])?void 0:l.styles;u&&t.applyCustomStylesToElements(e,n,u)}}}])}(Cr),xr=function(e){function t(e){var n;return C(this,t),(n=d(this,t,["name"]))._names=e,n}return m(t,e),x(t,[{key:"addBesideBubble",value:function(e,n){var r="boolean"==typeof this._names?{}:this._names,i=this.createName(n,r),a=t.getPosition(n,r);i[M].add(a===oe?"start-item-position":"end-item-position"),e.insertAdjacentElement(a===oe?"beforebegin":"afterend",i)}},{key:"createName",value:function(e,n){var r=R();return r[M].add(this.className),r.textContent=t.getNameText(e,n),t.applyStyle(r,e,n),r}}],[{key:"getPosition",value:function(e,t){var n,r,i,a=Ct.processPosition(null==(n=null==t?void 0:t[e])?void 0:n.position);return e!==U&&(null!=a||(a=null==(r=null==t?void 0:t[j])?void 0:r.position)),null!=a||(a=null==(i=null==t?void 0:t[Oe])?void 0:i.position),null!=a||(a=e===U?"end":oe),a}},{key:"applyStyle",value:function(e,t,n){var r,i,a,s;Object.assign(e[I],null==(r=n[Oe])?void 0:r[I]),t===U?Object.assign(e[I],null==(i=n[U])?void 0:i[I]):(Object.assign(e[I],null==(a=n[j])?void 0:a[I]),Object.assign(e[I],null==(s=n[t])?void 0:s[I]))}},{key:"getNameText",value:function(e,t){var n,r,i,a,s,o;return e===U?(null==(n=t[U])?void 0:n[B])||(null==(r=t[Oe])?void 0:r[B])||"User":e===j?(null==(i=t[j])?void 0:i[B])||(null==(a=t[Oe])?void 0:a[B])||"AI":(null==(s=t[e])?void 0:s[B])||(null==(o=t[Oe])?void 0:o[B])||e}}])}(Cr),Ar=function(){function e(t){var n,r,i,a,s=this;C(this,e),this.messageElementRefs=[],this.htmlClassUtilities={},this.messageToElements=[],this.maxVisibleMessages=4e3,this.autoScrollAllowed=!0,this.elementRef=e.createContainerElement(),this.messageStyles=Ct.processMessageStyles(t.messageStyles),this._remarkable=pr.createNew(t.remarkable),this._applyHTMLToRemarkable=null==(n=t.remarkable)?void 0:n.applyHTML,t.avatars&&(this.avatar=new Tr(t.avatars)),t.names&&(this.name=new xr(t.names)),t.browserStorage&&(this.browserStorage=new fr(t.browserStorage)),this._onMessage=gr.onMessage.bind(this,t),t.htmlClassUtilities&&(this.htmlClassUtilities=t.htmlClassUtilities),(t.hiddenMessages||t.scrollButton)&&(this.scrollButton=new Sr(this,t.hiddenMessages,t.scrollButton)),this.focusMode=Ct.processFocusMode(t.focusMode),this.focusMode||(this._lastGroupMessagesElement=R(),this.elementRef.appendChild(this._lastGroupMessagesElement),t.upwardsMode&&(this.elementRef=this._lastGroupMessagesElement)),"boolean"!=typeof this.focusMode&&null!=(r=this.focusMode)&&r.fade&&_r.setFade(this.elementRef,this.focusMode.fade),this._customWrappers=t.htmlWrappers||Ct.processStreamHTMLWrappers(null==(i=t.connect)?void 0:i.stream),"boolean"!=typeof this.focusMode&&!1===(null==(a=this.focusMode)?void 0:a.streamAutoScroll)&&(this.autoScrollAllowed=!1),t.maxVisibleMessages&&(this.maxVisibleMessages=t.maxVisibleMessages),setTimeout(function(){s.submitUserMessage=t.submitUserMessage})}return x(e,[{key:"addNewTextMessage",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(null!=r&&r.status){var a=this.overwriteText(n,t,this.messageElementRefs);if(a)return a;r.status=!1}var s=i?this.createAndPrependNewMessageElement(t,n,i):this.createAndAppendNewMessageElement(t,n);return s.bubbleElement[M].add(e.TEXT_BUBBLE_CLASS),this.applyCustomStyles(s,n,!1),Ir.fillEmptyMessageElement(s.bubbleElement,t),s}},{key:"overwriteText",value:function(t,n,r){var i=Ir.overwriteMessage(this.messageToElements,r,n,t,"text",e.TEXT_BUBBLE_CLASS);return i&&this.renderText(i.bubbleElement,n,t),i}},{key:"createAndAppendNewMessageElement",value:function(e,t){var n=this.createNewMessageElement(e,t);return this.appendOuterContainerElemet(n.outerContainer,this.focusMode?t:void 0),n}},{key:"createNewGroupElementFocusMode",value:function(){var t;null==(t=this._lastGroupMessagesElement)||t[M].remove(e.LAST_GROUP_MESSAGES_ACTIVE);var n=R();(this.messageToElements.length>1||1===this.messageToElements.length&&this.messageToElements[0][0][ue]!==U)&&n[M].add(e.LAST_GROUP_MESSAGES_ACTIVE),this._lastGroupMessagesElement=n}},{key:"appendOuterContainerElemet",value:function(e,t){var n;this.focusMode&&(t===U||!this._lastGroupMessagesElement)&&this.createNewGroupElementFocusMode(),null==(n=this._lastGroupMessagesElement)||n.appendChild(e),this._lastGroupMessagesElement&&(this.focusMode||!this.elementRef.contains(this._lastGroupMessagesElement))&&this.elementRef.appendChild(this._lastGroupMessagesElement)}},{key:"createAndPrependNewMessageElement",value:function(t,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this.createNewMessageElement(t,n,r,a);if(r&&null!=(i=this.elementRef.firstChild)&&i[M].contains(e.INTRO_CLASS)){this.elementRef.firstChild.insertAdjacentElement("afterend",s.outerContainer);var o=this.messageElementRefs[0];this.messageElementRefs[0]=this.messageElementRefs[1],this.messageElementRefs[1]=o}else this.elementRef.insertBefore(s.outerContainer,this.elementRef.firstChild);return s}},{key:"createMessageElementsOnOrientation",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return n?this.createAndPrependNewMessageElement(e,t,n,r):this.createNewMessageElement(e,t,n,r)}},{key:"getNumberOfContentMessages",value:function(){var e,t,n=this.messageElementRefs.length;return null!=(t=null==(e=this.messageElementRefs[n-1])?void 0:e.bubbleElement)&&t[M].contains(Et.BUBBLE_CLASS)?n-1:n}},{key:"createNewMessageElement",value:function(t,n){var r,i=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!s&&this.getNumberOfContentMessages()>=this.maxVisibleMessages&&setTimeout(function(){return i.removeFirstMessage()}),s||null==(r=this._introPanel)||r.hide();var o=this.messageElementRefs[this.messageElementRefs.length-1];return br.changeFullViewToSmall(this),!a&&e.isTemporaryElement(o)&&(this.revealRoleElementsIfTempRemoved(o,n),this.removeLastMessage()),this.createMessageElements(t,n,a)}},{key:"revealRoleElementsIfTempRemoved",value:function(e,t){if((this.avatar||this.name)&&Bt.isElementTemporary(e)){var n=this.messageElementRefs[this.messageElementRefs.length-2];n&&this.messageToElements.length>0&&!e.bubbleElement[M].contains(Ir.getRoleClass(t))&&Ir.revealRoleElements(n.innerContainer,this.avatar,this.name)}}},{key:"createElements",value:function(t,n){var r=e.createBaseElements(n),i=r.outerContainer,a=r.innerContainer,s=r.bubbleElement;return i.appendChild(a),this.addInnerContainerElements(s,t,n),r}},{key:"createMessageElements",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.createElements(e,t);return Ir.updateRefArr(this.messageElementRefs,r,n),Ir.classifyRoleMessages(this.messageElementRefs,t),r}},{key:"addInnerContainerElements",value:function(e,t,n){var r=this.messageElementRefs[this.messageElementRefs.length-1];return Ir.areOuterContainerClassRolesSame(n,r)&&!this.isLastMessageError()&&Ir.hideRoleElements(r.innerContainer,this.avatar,this.name),e[M].add("message-bubble",Ir.getRoleClass(n),n===U?"user-message-text":"ai-message-text"),this.renderText(e,t,n),Ir.addRoleElements(e,n,this.avatar,this.name),{bubbleElement:e}}},{key:"applyCustomStyles",value:function(e,t,n,r){e&&this.messageStyles&&mr.applyCustomStyles(this.messageStyles,e,t,n,r)}},{key:"removeMessage",value:function(e){e.outerContainer.remove();var t=this.messageElementRefs.findIndex(function(t){return t===e});this.messageElementRefs.splice(t,1)}},{key:"removeFirstMessage",value:function(){this.messageElementRefs[0].outerContainer.remove(),this.messageElementRefs.shift()}},{key:"removeLastMessage",value:function(){this.messageElementRefs[this.messageElementRefs.length-1].outerContainer.remove(),this.messageElementRefs.pop()}},{key:"isLastMessageError",value:function(){var e;return null==(e=Ir.getLastMessageBubbleElement(this.elementRef))?void 0:e[M].contains(q)}},{key:"sendClientUpdate",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null==(t=this._onMessage)||t.call(this,e,n)}},{key:"renderText",value:function(e,t,n){var r=Nt.tryAddWrapper(e,t,this._customWrappers,n),i=r.contentEl;r.wrapper&&Nt.apply(this,e),i.innerHTML=this._remarkable.render(t),this._applyHTMLToRemarkable&&Nt.apply(this,i),0===i.innerText.trim().length&&i.children.length>0&&"P"!==i.children[0].tagName&&(i.innerText=t)}},{key:"refreshTextMessages",value:function(e){var t=this;this._remarkable=pr.createNew(e),this.messageToElements.forEach(function(e){e[1][B]&&e[0][B]&&t.renderText(e[1][B].bubbleElement,e[0][B],e[0][ue])})}},{key:"getFirstMessageContentEl",value:function(){var e=this.messageToElements[this.messageToElements.length-1][1],t=e.text,n=e.html,r=e.files;return t||n||(null==r?void 0:r[0])}},{key:"scrollToFirstElement",value:function(e,t){var n;if(e===U){var r="boolean"!=typeof this.focusMode&&(null==(n=this.focusMode)?void 0:n.smoothScroll);kt.scrollToBottom(this,r)}else if(t&&this.autoScrollAllowed){var i=this.getFirstMessageContentEl();kt.scrollToBottom(this,!1,null==i?void 0:i.outerContainer)}}}],[{key:"createContainerElement",value:function(){var e=R();return e.id=le,e}},{key:"isTemporaryElement",value:function(t){return e.isLoadingMessage(t)||Bt.isElementTemporary(t)}},{key:"createBaseElements",value:function(e){var t=R(),n=R();n[M].add("inner-message-container"),t.appendChild(n),t[M].add("outer-message-container"),t[M].add(Ir.buildRoleOuterContainerClass(e));var r=R();return r[M].add("message-bubble"),n.appendChild(r),{outerContainer:t,innerContainer:n,bubbleElement:r}}},{key:"createMessageContent",value:function(e){var t=e.text,n=e.files,r=e.html,i=e.custom,a=e._sessionId,s=e.role,o=w({},ue,s||j);return t&&(o[B]=t),n&&(o[Y]=n),r&&(o[N]=r),!t&&!n&&!r&&(o[B]=""),i&&(o.custom=i),a&&(o._sessionId=a),o}},{key:"isLoadingMessage",value:function(e){return null==e?void 0:e.bubbleElement[M].contains(Et.BUBBLE_CLASS)}}])}();Ar.TEXT_BUBBLE_CLASS="text-message",Ar.INTRO_CLASS="deep-chat-intro",Ar.LAST_GROUP_MESSAGES_ACTIVE="deep-chat-last-group-messages-active";var Mr=Ar,Ir=function(){function e(){C(this,e)}return x(e,null,[{key:"getLastElementsByClass",value:function(e,t,n){for(var r,i=function(){var r=e[a];if(r.bubbleElement[M].contains(t[0])&&!t.slice(1).find(function(e){return!r.bubbleElement[M].contains(e)})){if(!n)return{v:r};if(!n.find(function(e){return r.bubbleElement[M].contains(e)}))return{v:r}}},a=e.length-1;a>=0;a-=1)if(r=i())return r.v}},{key:"getLastMessage",value:function(e,t,n){for(var r=e.length-1;r>=0;r-=1)if(e[r][0][ue]===t){if(!n)return e[r][0];if(e[r][0][n])return e[r][0]}}},{key:"getLastTextToElement",value:function(e,t){for(var n=e.length-1;n>=0;n-=1)if(e[n][0]===t)return e[n]}},{key:"overwriteMessage",value:function(t,n,r,i,a,s){var o=e.getLastElementsByClass(n,[e.getRoleClass(i),s],[Et.BUBBLE_CLASS]),l=e.getLastMessage(t,i,a);return l&&(l[a]=r),o}},{key:"getRoleClass",value:function(e){return"".concat(e,"-message")}},{key:"fillEmptyMessageElement",value:function(e,t){0===t.trim().length&&(e[M].add(G),e.innerHTML='<div style="color:#00000000">.</div>')}},{key:"unfillEmptyMessageElement",value:function(e,t){e[M].contains(G)&&t.trim().length>0&&e.replaceChildren()}},{key:"getLastMessageBubbleElement",value:function(t){var n,r,i;return Array.from((null==(i=null==(r=null==(n=e.getLastMessageElement(t))?void 0:n.children)?void 0:r[0])?void 0:i.children)||[]).find(function(e){return e[M].contains("message-bubble")})}},{key:"getLastMessageElement",value:function(e){var t,n=null==(t=e.children[e.children.length-1])?void 0:t.children;return null==n?void 0:n[n.length-1]}},{key:"addRoleElements",value:function(e,t,n,r){null==n||n.addBesideBubble(e,t),null==r||r.addBesideBubble(e,t)}},{key:"hideRoleElements",value:function(e,t,n){null==t||t.tryHide(e),null==n||n.tryHide(e)}},{key:"revealRoleElements",value:function(e,t,n){null==t||t.tryReveal(e),null==n||n.tryReveal(e)}},{key:"softRemRoleElements",value:function(e,t,n){null==t||t.trySoftRem(e),null==n||n.trySoftRem(e)}},{key:"updateRefArr",value:function(e,t,n){n?e.unshift(t):e.push(t)}},{key:"buildRoleOuterContainerClass",value:function(e){return"".concat(z).concat(e)}},{key:"addNewPositionClasses",value:function(e,t){var n;e.outerContainer[M].remove(W,K,V),(n=e.outerContainer[M]).add.apply(n,l(t))}},{key:"getNumberOfElements",value:function(e){var t=0;return void 0!==e[B]&&(t+=1),void 0!==e[N]&&(t+=1),e[Y]&&(t+=e[Y].length),t}},{key:"filterdMessageElements",value:function(e,t){return e.filter(function(e){return e.bubbleElement[M].contains(t)})}},{key:"findMessageElements",value:function(e,t){return e.find(function(e){return e.bubbleElement[M].contains(t)})}},{key:"generateMessageBodyElements",value:function(t,n){var r={};return t[B]&&(r[B]=e.findMessageElements(n,Mr.TEXT_BUBBLE_CLASS)),t[N]&&(r[N]=e.findMessageElements(n,jt.HTML_BUBBLE_CLASS)),t[Y]&&(r[Y]=e.filterdMessageElements(n,se)),r}},{key:"generateMessageBody",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.getNumberOfElements(t),a=r?n.slice(0,i):n.slice(n.length-i);return e.generateMessageBodyElements(t,a)}},{key:"classifyRoleMessages",value:function(t,n){for(var r=n?e.buildRoleOuterContainerClass(n):void 0,i=t.length-1;i>=0;i-=1)if(n||(r=Array.from(t[i].outerContainer[M]).find(function(e){return e.startsWith(z)})),r){var a=t[i],s=a.outerContainer[M].contains(r),o=t[i-1],l=t[i+1],u=null==o?void 0:o.outerContainer[M].contains(r),c=null==l?void 0:l.outerContainer[M].contains(r);if(s)!u&&c?e.addNewPositionClasses(a,[W]):u&&c?e.addNewPositionClasses(a,[K]):u&&!c?e.addNewPositionClasses(a,[V]):!u&&!c&&e.addNewPositionClasses(a,[W,V]);else if(n)break}}},{key:"areOuterContainerClassRolesSame",value:function(t,n){return!!n&&Array.from(n.outerContainer[M]).find(function(e){return e.startsWith(z)})===e.buildRoleOuterContainerClass(t)}},{key:"resetAllRoleElements",value:function(t,n,r){if(n||r){var i="";t.forEach(function(a,s){a.bubbleElement[M].contains(q)||e.revealRoleElements(a.innerContainer,n,r);var o=Array.from(a.outerContainer[M]).find(function(e){return e.startsWith(z)});i===o&&e.hideRoleElements(t[s-1].innerContainer,n,r),i=o})}}},{key:"deepCloneMessagesWithReferences",value:function(t){return t.map(function(t){return e.processMessageContent(t)})}},{key:"processMessageContent",value:function(t){if(null==t||E(t)!==ct)return t;if(Array.isArray(t))return t.map(function(t){return e.processMessageContent(t)});var n={};return Object.entries(t).forEach(function(t){var r=o(t,2),i=r[0],a=r[1];"ref"===i&&a instanceof File||"custom"===i?n[i]=a:null!==a&&E(a)===ct?n[i]=e.processMessageContent(a):n[i]=a}),n}}])}(),Rr=function(){function e(t,n){C(this,e),this._fileAdded=!1,this._streamType="",this._hasStreamEnded=!1,this._partialContent="",this._messages=t,"object"==E(n)&&(this._partialRender=n.partialRender)}return x(e,[{key:"upsertStreamedMessage",value:function(e){if(!this._hasStreamEnded){if(void 0===(null==e?void 0:e[B])&&void 0===(null==e?void 0:e[N]))return console[F](we);var t=(null==e?void 0:e[B])||(null==e?void 0:e[N])||"",n=kt.isScrollbarAtBottomOfElement(this._messages.elementRef),r=void 0!==(null==e?void 0:e[B])?B:N;if(this._elements||this._message){if(this._streamType!==r)return console[F]("Cannot mix {text: string} and {html: string} responses.");null!=e&&e[ue]&&(null==e?void 0:e[ue])!==this._activeMessageRole?(this.finaliseStreamedMessage(!1),this.setInitialState(r,t,null==e?void 0:e[ue])):this.updateBasedOnType(t,r,null==e?void 0:e.overwrite)}else this.setInitialState(r,t,null==e?void 0:e[ue]);null!=e&&e._sessionId&&(this._sessionId=null==e?void 0:e._sessionId),null!=e&&e.custom&&this._message&&(this._message.custom=e.custom),n&&kt.scrollToBottom(this._messages)}}},{key:"setInitialState",value:function(t,n,r){var i,a,s;this._streamType=t,this._targetWrapper=void 0,this._fileAdded=!1,this._partialContent="",this._partialBubble=void 0,null!=r||(r=j);var o=(null==(i=this._messages._customWrappers)?void 0:i[r])||(null==(a=this._messages._customWrappers)?void 0:a[Oe]),l=o?"":n;this._elements=t===B?this._messages.addNewTextMessage(l,r):jt.add(this._messages,l,r),this._elements&&(this._elements.bubbleElement[M].add(e.MESSAGE_CLASS),this._activeMessageRole=r,this._message=w(w({},ue,this._activeMessageRole),t,l),this._messages.messageToElements.push([this._message,w({},t,this._elements)]),o&&this.setTargetWrapperIfNeeded(this._elements,n,this._streamType,o),null==(s=this._messages.scrollButton)||s.updateHidden())}},{key:"setTargetWrapperIfNeeded",value:function(e,t,n,r){e.bubbleElement.innerHTML=r,this._targetWrapper=Nt.getTargetWrapper(e.bubbleElement),this._elements&&Nt.apply(this._messages,this._elements.bubbleElement),this.updateBasedOnType(t,n)}},{key:"updateBasedOnType",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._targetWrapper||(null==(n=this._elements)?void 0:n.bubbleElement);this._partialRender||Ir.unfillEmptyMessageElement(i,e),(t===B?this.updateText:this.updateHTML).bind(this)(e,i,r)}},{key:"updateText",value:function(e,t,n){this._message&&(this._message[B]=n?e:this._message[B]+e,this._partialRender&&this.isNewPartialRenderParagraph(t,n)&&this.partialRenderNewParagraph(t),this._partialBubble?this.updatePartialRenderBubble(e):this._messages.renderText(t,this._message[B]))}},{key:"containsPartialRenderMark",value:function(t){var n=t.indexOf(e.PARTIAL_RENDER_MARK);return-1!==n&&!t.substring(n+e.PARTIAL_RENDER_MARK.length).startsWith("---")}},{key:"isNewPartialRenderParagraph",value:function(e,t){var n;if(t)return e.innerHTML="",!0;var r=this._streamType;if(!this._partialBubble){var i=null==(n=this._message)?void 0:n[r];return!!i&&this.containsPartialRenderMark(i)}return!!this._partialContent&&this.containsPartialRenderMark(this._partialContent)}},{key:"partialRenderNewParagraph",value:function(e){this._partialContent="",this._partialBubble=R(),this._partialBubble[M].add("partial-render-message"),e.appendChild(this._partialBubble)}},{key:"updatePartialRenderBubble",value:function(e){this._partialContent+=e,this._streamType===B?this._messages.renderText(this._partialBubble,this._partialContent):this._partialBubble.innerHTML=this._partialContent}},{key:"updateHTML",value:function(e,t,n){if(this._message)if(this._message[N]=n?e:(this._message[N]||"")+e,this._partialRender&&this.isNewPartialRenderParagraph(t,n)&&this.partialRenderNewParagraph(t),this._partialBubble)this.updatePartialRenderBubble(e);else if(n)t.innerHTML=e;else{var r=R("span");r.innerHTML=e,t.appendChild(r)}}},{key:"finaliseStreamedMessage",value:function(){var t,n,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this._endStreamAfterOperation&&(!this._fileAdded||this._elements)){if(!this._elements)throw Error(Ee);this._message&&null!=(t=this._elements.bubbleElement)&&t[M].contains(e.MESSAGE_CLASS)&&(this._streamType===B?this._messages.textToSpeech&&St.speak(this._message[B]||"",this._messages.textToSpeech):this._streamType===N&&this._elements&&Nt.apply(this._messages,this._elements.outerContainer),this._elements.bubbleElement[M].remove(e.MESSAGE_CLASS),this._message&&(this._sessionId&&(this._message._sessionId=this._sessionId),this._messages.sendClientUpdate(Mr.createMessageContent(this._message),!1),null==(n=this._messages.browserStorage)||n.addMessages(this._messages.messageToElements.map(function(e){return o(e,1)[0]}))),this._hasStreamEnded=r)}}},{key:"markFileAdded",value:function(){this._fileAdded=!0}},{key:"endStreamAfterFileDownloaded",value:(t=k(g().m(function e(t,n){var r,i,a;return g().w(function(e){for(;;)switch(e.n){case 0:return this._endStreamAfterOperation=!0,e.n=1,n();case 1:r=e.v,i=r.text,a=r.files,i&&this.updateBasedOnType(i,B,!0),this._endStreamAfterOperation=!1,this.finaliseStreamedMessage(),a&&t.addNewMessage(w({},Y,a));case 2:return e.a(2)}},e,this)})),function(e,n){return t.apply(this,arguments)})}]);var t}();Rr.MESSAGE_CLASS="streamed-message",Rr.PARTIAL_RENDER_MARK="\n\n";var Pr=Rr,Or=function(){function e(){C(this,e)}return x(e,null,[{key:"tempRemoveContentHeader",value:(r=k(g().m(function e(t,n,r){var i,a,s;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!=t&&t.headers){e.n=1;break}throw new Error(be);case 1:return i=t.headers[lt],delete t.headers[lt],e.p=2,e.n=3,n(r);case 3:a=e.v,e.n=5;break;case 4:throw e.p=4,s=e.v,t.headers[lt]=i,s;case 5:return e.a(2,(t.headers[lt]=i,a))}},e,null,[[2,4]])})),function(e,t,n){return r.apply(this,arguments)})},{key:"displayError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Service error, please try again.";if(console[F](t),E(t)===ct)return t instanceof Error?e.addNewErrorMessage(L,t.message):Array.isArray(t)||"string"==typeof t[F]?e.addNewErrorMessage(L,t):0===Object.keys(t).length?e.addNewErrorMessage(L,n):e.addNewErrorMessage(L,JSON.stringify(t));e.addNewErrorMessage(L,t)}},{key:"fetch",value:function(e){function t(t,n,r,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,n,r){var i,a,s={method:(null==(i=e.connectSettings)?void 0:i.method)||ft,headers:t};return s.method!==pt&&(s.body=n?JSON.stringify(r):r),e.connectSettings.credentials&&(s.credentials=e.connectSettings.credentials),fetch((null==(a=e.connectSettings)?void 0:a.url)||e.url||"",s)})},{key:"processResponseByType",value:function(e){var t=e.headers.get("content-type");return null!=t&&t.includes(ut)?e.json():null!=t&&t.includes("text/plain")||!t?e:e.blob()}},{key:"processRequestInterceptor",value:(n=k(g().m(function e(t,n){var r,i,a,s,o;return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,null==(r=t.requestInterceptor)?void 0:r.call(t,n);case 1:if(o=e.v){e.n=2;break}o=n;case 2:return a=i=o,s=i,e.a(2,{body:a.body,headers:a.headers,error:s[F]})}},e)})),function(e,t){return n.apply(this,arguments)})},{key:"validateResponseFormat",value:function(e,t){if(!e)return!1;var n=Array.isArray(e)?e:[e];return t&&n.length>1?(console[F](Se),!1):!n.find(function(e){return"object"!=E(e)||!("string"==typeof e[F]||"string"==typeof e[B]||"string"==typeof e[N]||Array.isArray(e[Y]))})}},{key:"onInterceptorError",value:function(e,t,n){e.addNewErrorMessage(L,t),null==n||n()}},{key:"basicResponseProcessing",value:(t=k(g().m(function t(n,r){var i,a,s,o,l,u,c,d,h,p,f,m=arguments;return g().w(function(t){for(;;)switch(t.n){case 0:if(a=(i=m.length>2&&void 0!==m[2]?m[2]:{}).io,s=i.displayError,o=void 0===s||s,l=i.useRI,u=void 0===l||l,null!=a&&a.extractResultData){t.n=1;break}return t.a(2,r);case 1:return c=u?a.deepChat.responseInterceptor:void 0,t.n=2,null==c?void 0:c(r);case 2:if(f=t.v){t.n=3;break}f=r;case 3:return d=f,t.n=4,a.extractResultData(d);case 4:if((h=t.v)&&("object"==E(h)||Array.isArray(h))){t.n=5;break}return o&&(p=pe(r,"response",!!c,d),e.displayError(n,p)),t.a(2);case 5:return t.a(2,h)}},t)})),function(e,n){return t.apply(this,arguments)})}]);var t,n,r}();function Lr(e,t){return Br.apply(this,arguments)}function Br(){return(Br=k(g().m(function e(t,n){var r,i;return g().w(function(e){for(;;)switch(e.n){case 0:r=t.getReader();case 1:return e.n=2,r.read();case 2:if((i=e.v).done){e.n=4;break}n(i.value);case 3:e.n=1;break;case 4:return e.a(2)}},e)}))).apply(this,arguments)}function Nr(e){var t,n,r,i=!1;return function(a){void 0===t?(t=a,n=0,r=-1):t=function(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}(t,a);for(var s=t.length,o=0;n<s;){i&&(10===t[n]&&(o=++n),i=!1);for(var l=-1;n<s&&-1===l;++n)switch(t[n]){case 58:-1===r&&(r=n-o);break;case 13:i=!0;case 10:l=n}if(-1===l)break;e(t.subarray(o,l),r),o=n,r=-1}o===s?t=void 0:0!==o&&(t=t.subarray(o),n-=o)}}function Fr(e,t,n){var r={data:"",event:"",id:"",retry:void 0},i=new TextDecoder;return function(a,s){if(0===a.length)null==n||n(r),r={data:"",event:"",id:"",retry:void 0};else if(s>0){var o=i.decode(a.subarray(0,s)),l=s+(32===a[s+1]?2:1),u=i.decode(a.subarray(l));switch(o){case"data":r.data=r.data?r.data+"\n"+u:u;break;case"event":r.event=u;break;case"id":e(r.id=u);break;case"retry":var c=parseInt(u,10);isNaN(c)||t(r.retry=c)}}}}var Dr="text/event-stream",jr="last-event-id";function Ur(e,t){var n=t.signal,r=t.headers,i=t.onopen,a=t.onmessage,s=t.onclose,o=t.onerror,l=t.openWhenHidden,u=t.fetch,c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise(function(t,d){var h,p=Object.assign({},r);function f(){h.abort(),document.hidden||S()}p.accept||(p.accept=Dr),l||document.addEventListener("visibilitychange",f);var m=1e3,v=0;function y(){document.removeEventListener("visibilitychange",f),window.clearTimeout(v),h.abort()}null==n||n.addEventListener("abort",function(){y(),t()});var b=null!=u?u:window.fetch,_=null!=i?i:Hr;function S(){return w.apply(this,arguments)}function w(){return(w=k(g().m(function n(){var r,i,l,u;return g().w(function(n){for(;;)switch(n.p=n.n){case 0:return h=new AbortController,n.p=1,n.n=2,b(e,Object.assign(Object.assign({},c),{headers:p,signal:h.signal}));case 2:return i=n.v,n.n=3,_(i);case 3:return n.n=4,Lr(i.body,Nr(Fr(function(e){e?p[jr]=e:delete p[jr]},function(e){m=e},a)));case 4:null==s||s(),y(),t(),n.n=6;break;case 5:if(n.p=5,u=n.v,!h.signal.aborted)try{l=null!==(r=null==o?void 0:o(u))&&void 0!==r?r:m,window.clearTimeout(v),v=window.setTimeout(S,l)}catch(l){y(),d(l)}case 6:return n.a(2)}},n,null,[[1,5]])}))).apply(this,arguments)}S()})}function Hr(e){var t=e.headers.get("content-type");if(null==t||!t.startsWith(Dr))throw new Error("Expected content-type to be ".concat(Dr,", Actual: ").concat(t))}var qr=function(){function e(){C(this,e)}return x(e,null,[{key:"request",value:(r=k(g().m(function t(n,r,i){var a,s,o,l,u,c,d,h,p,f,m,v,y,b,k=arguments;return g().w(function(t){for(;;)switch(t.n){case 0:return a=!(k.length>3&&void 0!==k[3])||k[3],s=k.length>4&&void 0!==k[4]&&k[4],h={body:r,headers:null==(o=n.connectSettings)?void 0:o.headers},t.n=1,Or.processRequestInterceptor(n.deepChat,h);case 1:if(p=t.v,f=p.body,m=p.headers,!(v=p.error)){t.n=2;break}return t.a(2,Or.onInterceptorError(i,v,n.streamHandlers.onClose));case 2:if(null==(l=n.connectSettings)||!l.handler){t.n=3;break}return t.a(2,Kr.stream(n,f,i));case 3:if((null==(u=n.connectSettings)?void 0:u.url)!==Gr.URL){t.n=4;break}return t.a(2,Gr.requestStream(i,n));case 4:return y=new Pr(i,n.stream),b={method:(null==(c=n.connectSettings)?void 0:c.method)||ft,headers:m,credentials:null==(d=n.connectSettings)?void 0:d.credentials,body:a?JSON.stringify(f):f},t.a(2,("object"==E(n.stream)&&n.stream.readable?e.handleReadableStream(n,i,y,b,s,f):e.handleEventStream(n,i,y,b,s,f),y))}},t)})),function(e,t,n){return r.apply(this,arguments)})},{key:"handleReadableStream",value:function(t,n,r,i,a,s){var o,l=t.streamHandlers,u=l.onOpen,c=l.onClose,d=!1;fetch((null==(o=t.connectSettings)?void 0:o.url)||t.url||"",i).then(function(){var i=k(g().m(function i(o){var l,h,p,f,m,v,y,b,k,_,S,C;return g().w(function(i){for(;;)switch(i.n){case 0:if(o.body){i.n=1;break}throw new Error("Readable Stream connection error.");case 1:p=o.body.getReader(),f=new TextDecoder,u(),m=!1;case 2:if(m||d){i.n=8;break}return i.n=3,p.read();case 3:if(v=i.v,y=v.value,b=v.done,!(m=b)){i.n=4;break}e.handleClose(t,r,c,a),i.n=7;break;case 4:return k=f.decode(y,{stream:!0}),i.n=5,null==(h=(l=t.deepChat).responseInterceptor)?void 0:h.call(l,k);case 5:if(C=i.v){i.n=6;break}C=k;case 6:S="object"==E(_=C)?_:w({},B,k),e.handleMessage(t,n,r,S,s);case 7:i.n=2;break;case 8:return i.a(2)}},i)}));return function(e){return i.apply(this,arguments)}}()).catch(function(r){e.handleError(t,n,r)}),t.streamHandlers.onAbort=function(){r.finaliseStreamedMessage(),t.streamHandlers.onClose(),d=!0}}},{key:"handleEventStream",value:function(t,n,r,i,a,s){var o,l=t.streamHandlers,u=l.onOpen,c=l.onClose,d=new AbortController;t.streamHandlers.onAbort=function(){r.finaliseStreamedMessage(),t.streamHandlers.onClose(),d.abort()},Ur((null==(o=t.connectSettings)?void 0:o.url)||t.url||"",S(S({},i),{},{openWhenHidden:!0,onopen:function(e){return k(g().m(function t(){return g().w(function(t){for(;;)switch(t.n){case 0:if(!e.ok){t.n=1;break}return t.a(2,u());case 1:return t.n=2,Or.processResponseByType(e);case 2:throw t.v;case 3:return t.a(2)}},t)}))()},onmessage:function(i){return k(g().m(function a(){var o,l,u,c,d;return g().w(function(a){for(;;)switch(a.n){case 0:if(JSON.stringify(i.data)===JSON.stringify("[DONE]")){a.n=3;break}try{u=JSON.parse(i.data)}catch(h){u={}}return a.n=1,null==(l=(o=t.deepChat).responseInterceptor)?void 0:l.call(o,u);case 1:if(d=a.v){a.n=2;break}d=u;case 2:c=d,e.handleMessage(t,n,r,c,s);case 3:return a.a(2)}},a)}))()},onerror:function(e){throw c(),e},onclose:function(){e.handleClose(t,r,c,a)},signal:d.signal})).catch(function(r){e.handleError(t,n,r)})}},{key:"handleMessage",value:function(t,n,r,i,a){var s;null==(s=t.extractResultData)||s.call(t,i,a).then(function(t){e.upsertContent(n,r.upsertStreamedMessage.bind(r),r,t),n.removeError()}).catch(function(e){n.isLastMessageError()||Or.displayError(n,e)})}},{key:"handleError",value:function(e,t,n){var r;t.isLastMessageError()||null==(r=e.extractResultData)||r.call(e,n).then(function(){Or.displayError(t,n)}).catch(function(e){Or.displayError(t,e)})}},{key:"handleClose",value:function(e,t,n,r){if(e.asyncCallInProgress)e.asyncCallInProgress=!1;else try{t.finaliseStreamedMessage(),n()}catch(i){if(!r)throw i}}},{key:"simulate",value:(n=k(g().m(function t(n,r,i,a){var s,o,l,u,c;return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Or.basicResponseProcessing(n,i,{io:a,useRI:!1});case 1:if(t.v){t.n=2;break}return t.a(2,r.onClose());case 2:if(Array.isArray(i)&&(i=i[0]),i[N]&&(r.onOpen(),0===(s=Nt.splitHTML(i[N])).length&&(s=i[N].split("")),o=new Pr(n,null==a?void 0:a.stream),e.populateMessages(n,s,o,r,N,0,a)),!i[Y]){t.n=4;break}return t.n=3,Or.basicResponseProcessing(n,w({},Y,i[Y]),{io:a});case 3:l=t.v,n.addNewMessage(S({sendUpdate:!1},l)),!i[N]&&!i[B]&&(new Pr(n,null==a?void 0:a.stream).finaliseStreamedMessage(),r.onClose());case 4:i[B]&&(r.onOpen(),u=i[B].split(""),c=new Pr(n,null==a?void 0:a.stream),e.populateMessages(n,u,c,r,B,0,a)),i[F]&&(Or.displayError(n,i[F]),r.onClose()),r.onAbort=function(){r.onClose()};case 5:return t.a(2)}},t)})),function(e,t,r,i){return n.apply(this,arguments)})},{key:"populateMessages",value:(t=k(g().m(function t(n,r,i,a,s,o,l){var u,c,d,h;return g().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!(u=r[o])){t.n=5;break}return t.p=1,t.n=2,Or.basicResponseProcessing(n,w({},s,u),{io:l});case 2:c=t.v,e.upsertContent(n,i.upsertStreamedMessage.bind(i),i,c),n.removeError(),t.n=4;break;case 3:t.p=3,h=t.v,n.isLastMessageError()||Or.displayError(n,h);case 4:d=setTimeout(function(){e.populateMessages(n,r,i,a,s,o+1,l)},a.simulationInterim||6),a.onAbort=function(){e.abort(d,i,a.onClose)},t.n=6;break;case 5:i.finaliseStreamedMessage(),a.onClose();case 6:return t.a(2)}},t,null,[[1,3]])})),function(e,n,r,i,a,s,o){return t.apply(this,arguments)})},{key:"isSimulation",value:function(e){return"object"==E(e)&&!!e.simulation}},{key:"isSimulatable",value:function(t,n){return e.isSimulation(t)&&n&&(n[B]||n[N])}},{key:"abort",value:function(e,t,n){clearTimeout(e),t.finaliseStreamedMessage(),n()}},{key:"upsertContent",value:function(e,t,n,r){if(r&&Array.isArray(r)&&(r=r[0]),null!=r&&r[B]||null!=r&&r[N]){var i=t(r);null!=n||(n=i||void 0)}if(null!=r&&r[Y]&&(e.addNewMessage(w({},Y,r[Y])),null==n||n.markFileAdded()),null!=r&&r[F])throw r[F]}}]);var t,n,r}(),zr=function(){function e(){C(this,e)}return x(e,null,[{key:"generateResponse",value:function(e){var t=e[e.length-1][0];if(t[Y]&&t[Y].length>0){if(t[Y].length>1)return"These are interesting files!";var n=t[Y][0];return n[X]&&n[X].startsWith("data:image/gif")?"That is a nice gif!":n.type===Q?"That is a nice image!":n.type===ne?"I like the sound of that!":"That is an interesting file!"}if(t[B]){if("?"===t[B].charAt(t[B].length-1))return"I'm sorry but I can't answer that question...";if(t[B].includes("updog"))return"What's updog?"}return"Hi there! This is a demo response!"}},{key:"getCustomResponse",value:function(e,t){return"function"==typeof e?e(t):e}},{key:"getResponse",value:function(t){var n=t.customDemoResponse,r=t.messageToElements;return n?e.getCustomResponse(n,r[r.length-1][0]):w({},B,e.generateResponse(r))}},{key:"request",value:function(t,n){var r=e.getResponse(n);setTimeout(k(g().m(function e(){var i,a,s;return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Or.basicResponseProcessing(n,r,{io:t});case 1:if(i=e.v){e.n=2;break}return e.a(2,t.completionsHandlers.onFinish());case 2:a=Array.isArray(i)?i:[i],(s=a.find(function(e){return"string"==typeof e[F]}))?(n.addNewErrorMessage(L,s[F]),t.completionsHandlers.onFinish()):qr.isSimulatable(t.stream,i)?qr.simulate(n,t.streamHandlers,i):(a.forEach(function(e){return n.addNewMessage(e)}),t.completionsHandlers.onFinish());case 3:return e.a(2)}},e)})),400)}},{key:"requestStream",value:function(t,n){setTimeout(function(){var r=e.getResponse(t);qr.simulate(t,n.streamHandlers,r,n)},400)}}])}();zr.URL="deep-chat-demo";var Gr=zr,Wr=function(){function e(){C(this,e)}return x(e,null,[{key:"setup",value:function(e){e.permittedErrorPrefixes=["Connection error","Error in server message"],e.websocket="pending"}},{key:"isElementPresentInDOM",value:function(e){return e.getRootNode({composed:!0})instanceof Document}},{key:"createConnection",value:function(t,n){if(e.isElementPresentInDOM(t.deepChat)){var r=t.connectSettings.websocket;if(r){if(t.connectSettings.handler)return Kr.websocket(t,n);try{var i="boolean"!=typeof r?r:void 0,a=new WebSocket(t.connectSettings.url||"",i);t.websocket=a,t.websocket.onopen=function(){var r,i;n.removeError(),t.websocket&&E(t.websocket)===ct&&e.assignListeners(t,a,n),null==(i=(r=t.deepChat)._validationHandler)||i.call(r)},t.websocket.onerror=function(r){console[F](r),e.retryConnection(t,n)}}catch(i){console[F](i),e.retryConnection(t,n)}}}}},{key:"retryConnection",value:function(t,n){var r,i;null==(i=(r=t.deepChat)._validationHandler)||i.call(r),e.isElementPresentInDOM(t.deepChat)&&(t.websocket="pending",n.isLastMessageError()||n.addNewErrorMessage(L,"Connection error"),setTimeout(function(){e.createConnection(t,n)},5e3))}},{key:"assignListeners",value:function(t,n,r){var i=this,a={};n.onmessage=function(){var n=k(g().m(function n(s){var o,l,u,c,d,h,p;return g().w(function(n){for(;;)switch(n.p=n.n){case 0:if(!t.extractResultData){n.n=8;break}return n.p=1,o=JSON.parse(s.data),n.n=2,Or.basicResponseProcessing(r,o,{io:t,displayError:!1});case 2:if(l=n.v){n.n=3;break}throw Error(pe(o,"server",!!t.deepChat.responseInterceptor,l));case 3:if(!qr.isSimulation(t.stream)){n.n=4;break}u=e.stream.bind(i,t,r,a),c=a[o[ue]||j],qr.upsertContent(r,u,c,l),n.n=6;break;case 4:if(d=Array.isArray(l)?l:[l],!(h=d.find(function(e){return"string"==typeof e[F]}))){n.n=5;break}throw h[F];case 5:d.forEach(function(e){return r.addNewMessage(e)});case 6:n.n=8;break;case 7:n.p=7,p=n.v,Or.displayError(r,p,"Error in server message");case 8:return n.a(2)}},n,null,[[1,7]])}));return function(e){return n.apply(this,arguments)}}(),n.onclose=function(){var n,i;console[F]("Connection closed"),r.isLastMessageError()||r.addNewErrorMessage(L,"Connection error"),t.stream&&(null==(i=(n=t.streamHandlers).onAbort)||i.call(n)),e.createConnection(t,r)}}},{key:"sendWebsocket",value:(t=k(g().m(function t(n,r,i){var a,s,o,l,u,c,d,h,p,f=arguments;return g().w(function(t){for(;;)switch(t.n){case 0:if(a=!(f.length>3&&void 0!==f[3])||f[3],(null==(s=n.connectSettings)?void 0:s.url)!==Gr.URL){t.n=1;break}return t.a(2,Gr.request(n,i));case 1:if((l=n.websocket)&&"pending"!==l){t.n=2;break}return t.a(2);case 2:return u={body:r,headers:null==(o=n.connectSettings)?void 0:o.headers},t.n=3,Or.processRequestInterceptor(n.deepChat,u);case 3:if(c=t.v,d=c.body,!(h=c.error)){t.n=4;break}return t.a(2,i.addNewErrorMessage(L,h));case 4:if(e.isWebSocket(l)){t.n=5;break}return t.a(2,l.newUserMessage.listener(d));case 5:p=a?JSON.stringify(d):d,void 0===l.readyState||l.readyState!==l.OPEN?(console[F]("Connection is not open"),i.isLastMessageError()||i.addNewErrorMessage(L,"Connection error")):(l.send(JSON.stringify(p)),n.completionsHandlers.onFinish());case 6:return t.a(2)}},t)})),function(e,n,r){return t.apply(this,arguments)})},{key:"canSendMessage",value:function(t){return!t||"pending"!==t&&(e.isWebSocket(t)?void 0!==t.readyState&&t.readyState===t.OPEN:t.isOpen)}},{key:"isWebSocket",value:function(e){return void 0!==e.send}},{key:"stream",value:function(e,t,n,r){if(r){var i=e.stream.simulation;if("string"==typeof i){var a,s=r[ue]||j,o=n[s];r[B]===i||r[N]===i?(null==o||o.finaliseStreamedMessage(),delete n[s]):(null!==(a=n[s])&&void 0!==a||(n[s]=new Pr(t,e.stream)),n[s].upsertStreamedMessage(r))}else qr.simulate(t,e.streamHandlers,r)}}}]);var t}(),Kr=function(){function e(){C(this,e)}return x(e,null,[{key:"request",value:(t=k(g().m(function t(n,r,i){var a,s,o,l,u;return g().w(function(t){for(;;)switch(t.n){case 0:o=!0,l=function(){var e=k(g().m(function e(t){var r,a,s;return g().w(function(e){for(;;)switch(e.n){case 0:if(o){e.n=1;break}return e.a(2);case 1:return o=!1,e.n=2,Or.basicResponseProcessing(i,t,{io:n,displayError:!1});case 2:(r=e.v)?(a=Array.isArray(r)?r:[r],(s=a.find(function(e){return"string"==typeof e[F]}))?(console[F](s[F]),i.addNewErrorMessage(L,s[F]),n.completionsHandlers.onFinish()):qr.isSimulatable(n.stream,r)?qr.simulate(i,n.streamHandlers,r):(a.forEach(function(e){return i.addNewMessage(e)}),n.completionsHandlers.onFinish())):(console[F](pe(t,"server",!!n.deepChat.responseInterceptor,r)),i.addNewErrorMessage(L,"Error in server message"),n.completionsHandlers.onFinish());case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),u=e.generateOptionalSignals(),null==(s=(a=n.connectSettings).handler)||s.call(a,r,S(S({},u),{},{onResponse:l}));case 1:return t.a(2)}},t)})),function(e,n,r){return t.apply(this,arguments)})},{key:"attemptToFinaliseStream",value:function(e,t){try{var n=t.messageElementRefs[t.messageElementRefs.length-1];Mr.isLoadingMessage(n)?t.removeLastMessage():e.finaliseStreamedMessage()}catch(n){console[F](n),t.addNewErrorMessage(L,n)}}},{key:"stream",value:function(t,n,r){var i,a,s=!0,o=!1,l=new Pr(r,t.stream),u=function(){var n=k(g().m(function n(i){var a,o;return g().w(function(n){for(;;)switch(n.n){case 0:if(s){n.n=1;break}return n.a(2);case 1:return n.n=2,Or.basicResponseProcessing(r,i,{io:t,displayError:!1});case 2:(a=n.v)?a[F]?(e.streamError(a[F],l,t,r),s=!1):qr.upsertContent(r,l.upsertStreamedMessage.bind(l),l,a):(o=pe(i,"server",!!t.deepChat.responseInterceptor,a),e.streamError(o,l,t,r),s=!1);case 3:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}();t.streamHandlers.onAbort=function(){e.attemptToFinaliseStream(l,r),t.streamHandlers.onClose(),s=!1};var c=e.generateOptionalSignals();null==(a=(i=t.connectSettings).handler)||a.call(i,n,S(S({},c),{},{onOpen:function(){o||!s||(t.streamHandlers.onOpen(),o=!0)},onResponse:u,onClose:function(){s&&(e.attemptToFinaliseStream(l,r),t.streamHandlers.onClose(),s=!1)},stopClicked:t.streamHandlers.stopClicked}))}},{key:"streamError",value:function(e,t,n,r){console[F](e),t.finaliseStreamedMessage(),r.addNewErrorMessage(L,e),n.streamHandlers.onClose()}},{key:"websocket",value:function(t,n){var r,i,a=this,s={isOpen:!1,newUserMessage:{listener:function(){}},roleToStream:{}};t.websocket=s;var o=function(){var e=k(g().m(function e(r){var i,o,l,u,c,d;return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Or.basicResponseProcessing(n,r,{io:t,displayError:!1});case 1:(i=e.v)?(o=Array.isArray(i)?i:[i],l=o.find(function(e){return"string"==typeof e[F]}),l?(console[F](l[F]),n.isLastMessageError()||n.addNewErrorMessage(L,l[F])):qr.isSimulation(t.stream)?(u=i,c=Wr.stream.bind(a,t,n,s.roleToStream),d=s.roleToStream[u[ue]||j],qr.upsertContent(n,c,d,u)):o.forEach(function(e){return n.addNewMessage(e)})):(console[F](pe(r,"server",!!t.deepChat.responseInterceptor,i)),n.addNewErrorMessage(L,"Error in server message"));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),l=e.generateOptionalSignals();null==(i=(r=t.connectSettings).handler)||i.call(r,void 0,S(S({},l),{},{onOpen:function(){n.removeError(),s.isOpen=!0},onResponse:o,onClose:function(){s.isOpen=!1},newUserMessage:s.newUserMessage}))}},{key:"generateOptionalSignals",value:function(){return{onClose:function(){},onOpen:function(){},stopClicked:{listener:function(){}},newUserMessage:{listener:function(){}}}}}]);var t}(),Vr=function(){function e(){C(this,e)}return x(e,null,[{key:"request",value:(n=k(g().m(function e(t,n,r){var i,a,s,o,l,u,c,d,h,p,f,m=arguments;return g().w(function(e){for(;;)switch(e.n){case 0:return i=!(m.length>3&&void 0!==m[3])||m[3],l={body:n,headers:null==(a=t.connectSettings)?void 0:a.headers},e.n=1,Or.processRequestInterceptor(t.deepChat,l);case 1:if(u=e.v,c=u.body,d=u.headers,h=u.error,p=t.completionsHandlers.onFinish,!h){e.n=2;break}return e.a(2,Or.onInterceptorError(r,h,p));case 2:if(null==(s=t.connectSettings)||!s.handler){e.n=3;break}return e.a(2,Kr.request(t,c,r));case 3:if((null==(o=t.connectSettings)?void 0:o.url)!==Gr.URL){e.n=4;break}return e.a(2,Gr.request(t,r));case 4:f=!0,Or.fetch(t,d,i,c).then(function(e){return f=!!e.ok,e}).then(function(e){return Or.processResponseByType(e)}).then(function(){var e=k(g().m(function e(n){var i,a,s,o,l;return g().w(function(e){for(;;)switch(e.n){case 0:if(t.extractResultData){e.n=1;break}return e.a(2);case 1:return e.n=2,null==(a=(i=t.deepChat).responseInterceptor)?void 0:a.call(i,n);case 2:if(l=e.v){e.n=3;break}l=n;case 3:return s=l,e.n=4,t.extractResultData(s,c);case 4:if(o=e.v,f){e.n=5;break}throw n;case 5:if(o&&(E(o)===ct||Array.isArray(o))){e.n=6;break}throw Error(pe(n,"response",!!t.deepChat.responseInterceptor,s));case 6:if(!o[F]){e.n=7;break}throw o[F];case 7:if(!t.asyncCallInProgress){e.n=8;break}return t.asyncCallInProgress=!1,e.a(2);case 8:qr.isSimulatable(t.stream,o)?qr.simulate(r,t.streamHandlers,o):((Array.isArray(o)?o:[o]).forEach(function(e){return r.addNewMessage(e)}),p());case 9:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){Or.displayError(r,e),p()});case 5:return e.a(2)}},e)})),function(e,t,r){return n.apply(this,arguments)})},{key:"executePollRequest",value:function(t,n,r,i){var a=t.completionsHandlers.onFinish;fetch(n,r).then(function(e){return e.json()}).then(function(){var s=k(g().m(function s(o){var l,u,c,d,h;return g().w(function(s){for(;;)switch(s.n){case 0:if(t.extractPollResultData){s.n=1;break}return s.a(2);case 1:return d=t,s.n=2,null==(u=(l=t.deepChat).responseInterceptor)?void 0:u.call(l,o);case 2:if(h=s.v){s.n=3;break}h=o;case 3:return s.n=4,d.extractPollResultData.call(d,h);case 4:(c=s.v).timeoutMS?setTimeout(function(){e.executePollRequest(t,n,r,i)},c.timeoutMS):qr.isSimulatable(t.stream,c)?qr.simulate(i,t.streamHandlers,c):(i.addNewMessage(c),a());case 5:return s.a(2)}},s)}));return function(e){return s.apply(this,arguments)}}()).catch(function(e){Or.displayError(i,e),a()})}},{key:"poll",value:(t=k(g().m(function t(n,r,i){var a,s,o,l,u,c,d,h,p,f,m,v,y,b=arguments;return g().w(function(t){for(;;)switch(t.n){case 0:return a=!(b.length>3&&void 0!==b[3])||b[3],u={body:r,headers:null==(s=n.connectSettings)?void 0:s.headers},t.n=1,Or.processRequestInterceptor(n.deepChat,u);case 1:if(c=t.v,d=c.body,h=c.headers,!(p=c.error)){t.n=2;break}return t.a(2,Or.onInterceptorError(i,p));case 2:f=(null==(o=n.connectSettings)?void 0:o.url)||n.url||"",m=(null==(l=n.connectSettings)?void 0:l.method)||ft,v=a?JSON.stringify(d):d,y={method:m,body:v,headers:h},n.connectSettings.credentials&&(y.credentials=n.connectSettings.credentials),e.executePollRequest(n,f,y,i);case 3:return t.a(2)}},t)})),function(e,n,r){return t.apply(this,arguments)})},{key:"verifyKey",value:function(e,t,n,r,i,a,s,o,l){if(""===e)return a(ge);s(),fetch(t,{method:r,headers:n,body:l||null}).then(function(e){return Or.processResponseByType(e)}).then(function(t){o(t,e,i,a)}).catch(function(e){a(ye),console[F](e)})}}]);var t,n}(),Xr=function(){function e(){C(this,e)}return x(e,null,[{key:"getCharacterLimitMessages",value:function(e,t){var n;if(-1===t)return e;for(var r=0,i=e.length-1;i>=0;i-=1){var a=null==(n=e[i])?void 0:n[B];if(void 0!==a&&(r+=a.length)>t){e[i][B]=a.substring(0,a.length-(r-t));break}}return e.slice(Math.max(i,0))}},{key:"getMaxMessages",value:function(e,t){return e.slice(Math.max(e.length-t,0))}},{key:"processMessages",value:function(t,n,r){return void 0!==n?n>0&&(t=e.getMaxMessages(t,n)):t=[t[t.length-1]],t=ce(t),void 0===r?t:e.getCharacterLimitMessages(t,r)}}])}(),Jr=function(){function e(t,n,r){C(this,e),this._isLoading=!1,this._isPaginationComplete=!1,this._index=0,this._messages=n,r.fetchHistory&&this.fetchHistory(r.fetchHistory),this.setupInitialHistory(t)}return x(e,[{key:"fetchHistory",value:(i=k(g().m(function t(n){var r,i,a=this;return g().w(function(t){for(;;)switch(t.n){case 0:return r=br.addMessage(this._messages),t.n=1,n();case 1:i=t.v,this._messages.removeMessage(r),e.displayIntroMessages(this._messages.messageElementRefs),i.forEach(function(e){return a._messages.addAnyMessage(e,!0)}),setTimeout(function(){return kt.scrollToBottom(a._messages)},0);case 2:return t.a(2)}},t,this)})),function(e){return i.apply(this,arguments)})},{key:"scrollToPreloadFirstEl",value:function(e,t){this._messages.elementRef.scrollTop=t+e.offsetTop-40}},{key:"processLoadedHistory",value:function(e){var t,n=this,r=this._messages,i=r.messageElementRefs,a=r.messageToElements,s=r.elementRef,o=null==(t=i.find(function(e){return!e.outerContainer[M].contains(Mr.INTRO_CLASS)}))?void 0:t.outerContainer,l=s.scrollTop;null==e||e.reverse().map(function(e){var t=n._messages.addAnyMessage(S(S({},e),{},{sendUpdate:!0}),!0,!0);if(t){var r=Ir.generateMessageBody(t,i,!0);a.unshift([t,r])}return t}).filter(function(e){return!!e}).reverse().forEach(function(e){return n._messages.sendClientUpdate(e,!0)}),o&&(this._messages.messageElementRefs.length>=this._messages.maxVisibleMessages?setTimeout(function(){return n.scrollToPreloadFirstEl(o,l)}):this.scrollToPreloadFirstEl(o,l))}},{key:"populateMessages",value:function(e,t){this._messages.removeMessage(e),this._isPaginationComplete=t.findIndex(function(e){return!e})<0;var n=t.filter(function(e){return!!e});this.processLoadedHistory(n);var r=this._messages,i=r.messageElementRefs,a=r.avatar,s=r.name;Ir.resetAllRoleElements(i,a,s)}},{key:"loadHistoryOnScroll",value:(r=k(g().m(function t(n){var r=this;return g().w(function(t){for(;;)switch(t.n){case 0:this._messages.elementRef.onscroll=k(g().m(function t(){var i,a,s;return g().w(function(t){for(;;)switch(t.p=t.n){case 0:if(r._isLoading||r._isPaginationComplete||0!==r._messages.elementRef.scrollTop){t.n=4;break}return r._isLoading=!0,i=br.addMessage(r._messages,!1),t.p=1,t.n=2,n(r._index++);case 2:a=t.v,r.populateMessages(i,a),r._isLoading=!1,t.n=4;break;case 3:t.p=3,s=t.v,r._messages.removeMessage(i),r._isPaginationComplete=!0,r._messages.addNewErrorMessage(L,e.FAILED_ERROR_MESSAGE,!0),console[F](s);case 4:return t.a(2)}},t,null,[[1,3]])}));case 1:return t.a(2)}},t,this)})),function(e){return r.apply(this,arguments)})},{key:"populateInitialHistory",value:function(e){var t=this;e.forEach(function(e){Ct.processHistoryFile(e),t._messages.addAnyMessage(e,!0)})}},{key:"loadInitialHistory",value:(n=k(g().m(function t(n){var r,i,a,s;return g().w(function(t){for(;;)switch(t.p=t.n){case 0:return this._isLoading=!0,r=br.addMessage(this._messages),t.p=1,t.n=2,n(this._index++);case 2:i=t.v,a=this._messages.elementRef.scrollTop,this.populateMessages(r,i),this.restoreScrollOrScrollToBottom(0===a),t.n=4;break;case 3:t.p=3,s=t.v,this._messages.removeMessage(r),this._isPaginationComplete=!0,this._messages.addNewErrorMessage(L,e.FAILED_ERROR_MESSAGE,!0),console[F](s);case 4:e.displayIntroMessages(this._messages.messageElementRefs),this._isLoading=!1;case 5:return t.a(2)}},t,this,[[1,3]])})),function(e){return n.apply(this,arguments)})},{key:"setupInitialHistory",value:(t=k(g().m(function e(t){var n,r,i;return g().w(function(e){for(;;)switch(e.n){case 0:t.loadHistory&&this.loadInitialHistory(t.loadHistory),r=null==(n=this._messages.browserStorage)?void 0:n.get(),(i=t.history||Ct.processHistory(t)||(null==r?void 0:r.messages))&&(this.populateInitialHistory(i),this.restoreScrollOrScrollToBottom(!0),this._index+=1);case 1:return e.a(2)}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"restoreScrollOrScrollToBottom",value:function(e){var t,n,r,i=this,a=null==(n=null==(t=this._messages.browserStorage)?void 0:t.get())?void 0:n.scrollHeight;void 0!==a&&null!=(r=this._messages.browserStorage)&&r.trackScrollHeight?setTimeout(function(){i._messages.elementRef.scrollTop=a},0):e&&setTimeout(function(){return kt.scrollToBottom(i._messages)},0)}}],[{key:"addErrorPrefix",value:function(t){var n;null!==(n=t.permittedErrorPrefixes)&&void 0!==n||(t.permittedErrorPrefixes=[]),t.permittedErrorPrefixes.push(e.FAILED_ERROR_MESSAGE)}},{key:"displayIntroMessages",value:function(e){for(var t=0;t<e.length;t+=1){var n=e[0];if(!n.outerContainer[M].contains(Mr.INTRO_CLASS))break;n.outerContainer[I].display=""}}}]);var t,n,r,i}();Jr.FAILED_ERROR_MESSAGE="Failed to load history";var Zr=Jr,Yr=function(){function e(){C(this,e)}return x(e,null,[{key:"parseConfig",value:function(e,t,n){var r,i={files:e};if("object"==E(n)){Ct.processFileConfigConnect(n);var a=n.files,s=n.connect,o=n.button;a&&(a.infoModal&&(i[Y].infoModal=a.infoModal,null!=(r=a.infoModal)&&r.textMarkDown&&(i.infoModalTextMarkUp=t.render(a.infoModal.textMarkDown))),a.acceptedFormats&&(i[Y].acceptedFormats=a.acceptedFormats),a.maxNumberOfFiles&&(i[Y].maxNumberOfFiles=a.maxNumberOfFiles)),i.button=o,s&&Object.keys(s).length>0&&(i.connect=s)}return i}},{key:"processMixedFiles",value:function(t,n,r){if(r){t.fileTypes.mixedFiles=e.parseConfig({acceptedFormats:""},n,r)}}},{key:"processMicrophone",value:function(t,n,r,i){var a,s,o,l,u,c,d,h,p=S({acceptedFormats:"audio/*"},(null==(o=t.fileTypes[ne])?void 0:o[Y])||{});r&&(void 0!==navigator.mediaDevices.getUserMedia?(t.recordAudio=e.parseConfig(p,n,r),"object"==E(r)&&r[Y]&&(null!==(a=(l=t.recordAudio)[Y])&&void 0!==a||(l[Y]={}),t.recordAudio[Y].format=null==(u=r[Y])?void 0:u.format,t.recordAudio[Y].maxDurationSeconds=null==(c=r[Y])?void 0:c.maxDurationSeconds,null!=(d=t.fileTypes[ne])&&d[Y]&&(null!==(s=(h=t.fileTypes[ne][Y]).maxNumberOfFiles)&&void 0!==s||(h.maxNumberOfFiles=r[Y].maxNumberOfFiles)))):i||(t.fileTypes[ne]=e.parseConfig(p,n,r)))}},{key:"processAudioConfig",value:function(t,n,r,i){if(r||i){var a=S({acceptedFormats:"audio/*"},(null==i?void 0:i[Y])||{});t.fileTypes[ne]=e.parseConfig(a,n,r)}}},{key:"processGifConfig",value:function(t,n,r,i){if(r||i){var a=S({acceptedFormats:"image/gif"},(null==i?void 0:i[Y])||{});t.fileTypes[te]=e.parseConfig(a,n,r)}}},{key:"processCamera",value:function(t,n,r,i){var a,s,o,l,u,c=S({acceptedFormats:"image/*"},(null==(s=t.fileTypes[$])?void 0:s[Y])||{});r&&(void 0!==navigator.mediaDevices.getUserMedia?(t[ee]=e.parseConfig(c,n,r),"object"==E(r)&&(t[ee].modalContainerStyle=r.modalContainerStyle,r[Y]&&(null!==(a=(o=t[ee])[Y])&&void 0!==a||(o[Y]={}),t[ee][Y].format=null==(l=r[Y])?void 0:l.format,t[ee][Y].dimensions=null==(u=r[Y])?void 0:u.dimensions))):i||(t.fileTypes[$]=e.parseConfig(c,n,r)))}},{key:"processImagesConfig",value:function(t,n,r,i){if(r||i){var a=S({acceptedFormats:"image/*"},(null==i?void 0:i[Y])||{});t.fileTypes[$]=e.parseConfig(a,n,r)}}},{key:"populateDefaultFileIO",value:function(e,t){var n,r,i,a,s;e&&(null!==(n=e[Y])&&void 0!==n||(e[Y]={}),null!==(r=(a=e[Y]).acceptedFormats)&&void 0!==r||(a.acceptedFormats=t),null!==(i=(s=e[Y]).maxNumberOfFiles)&&void 0!==i||(s.maxNumberOfFiles=1))}},{key:"set",value:function(t,n,r){e.populateDefaultFileIO(null==r?void 0:r[ne],".4a,.mp3,.webm,.mp4,.mpga,.wav,.mpeg,.m4a"),e.populateDefaultFileIO(null==r?void 0:r[$],".png,.jpg");var i=pr.createNew(t.remarkable);e.processImagesConfig(n,i,t[$],null==r?void 0:r[$]),e.processCamera(n,i,t[ee],t[$]),e.processGifConfig(n,i,t[te],null==r?void 0:r[te]),e.processAudioConfig(n,i,t[ne],null==r?void 0:r[ne]),e.processMicrophone(n,i,t[re],t[ne]),e.processMixedFiles(n,i,t[ie])}}])}(),Qr=function(){function e(t,n,r){var i,a,s,o,l,u;C(this,e),this.rawBody={},this.validateKeyProperty=!1,this.canSendMessage=e.canSendMessage,this.connectSettings={},this.fileTypes={},this.completionsHandlers={},this.streamHandlers={},this.deepChat=t,this.demo=r,Object.assign(this.rawBody,null==(a=t.connect)?void 0:a.additionalBodyProps),this.totalMessagesMaxCharLength=null==(s=null==t?void 0:t.requestBodyLimits)?void 0:s.totalMessagesMaxCharLength,this.maxMessages=null==(o=null==t?void 0:t.requestBodyLimits)?void 0:o.maxMessages,Yr.set(t,this,n),t.connect&&(this.connectSettings=t.connect),this.demo&&(null!==(i=(l=this.connectSettings).url)&&void 0!==i||(l.url=Gr.URL)),this.connectSettings.websocket&&Wr.setup(this),this.stream=(null==(u=this.deepChat.connect)?void 0:u.stream)||Ct.checkForStream(this.deepChat),t.loadHistory&&Zr.addErrorPrefix(this)}return x(e,[{key:"verifyKey",value:function(e,t){}},{key:"getServiceIOByType",value:function(e){if(e.type.startsWith(ne)&&this.fileTypes[ne])return this.fileTypes[ne];if(e.type.startsWith(Q)){if(this.fileTypes[te]&&e.type.endsWith("/gif"))return this.fileTypes[te];if(this.fileTypes[$])return this.fileTypes[$];if(this[ee])return this[ee]}return this.fileTypes[ie]}},{key:"request",value:(s=k(g().m(function e(t,n){var r,i=arguments;return g().w(function(e){for(;;)if(0===e.n)return r=!(i.length>2&&void 0!==i[2])||i[2],e.a(2,this.stream&&!qr.isSimulation(this.stream)?qr.request(this,t,n,r):Vr.request(this,t,n,r))},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"callAPIWithText",value:(a=k(g().m(function e(t,n){var r,i,a,s,o,l,u,c;return g().w(function(e){for(;;)switch(e.n){case 0:return u=S({messages:n},this.rawBody),c=!1,null!=(a=this.connectSettings.headers)&&a[lt]||(null!==(r=(s=this.connectSettings).headers)&&void 0!==r||(s.headers={}),null!==(i=(o=this.connectSettings.headers)[lt])&&void 0!==i||(o[lt]=ut),c=!0),e.n=1,this.request(u,t);case 1:c&&(null==(l=this.connectSettings.headers)||delete l[lt]);case 2:return e.a(2)}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"callApiWithFiles",value:(i=k(g().m(function t(n,r,i){var a,s,o;return g().w(function(t){for(;;)switch(t.n){case 0:return a=e.createCustomFormDataBody(this.rawBody,r,i),s=this.connectSettings,o=this.getServiceIOByType(i[0]),this.connectSettings=(null==o?void 0:o.connect)||this.connectSettings,t.n=1,this.request(a,n,!1);case 1:this.connectSettings=s;case 2:return t.a(2)}},t,this)})),function(e,t,n){return i.apply(this,arguments)})},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n,r){return g().w(function(e){for(;;)switch(e.n){case 0:r?this.callApiWithFiles(t,n,r):this.callAPIWithText(t,n);case 1:return e.a(2)}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"callAPI",value:(n=k(g().m(function e(t,n){var r,i,a;return g().w(function(e){for(;;)switch(e.n){case 0:if(this.connectSettings){e.n=1;break}throw new Error(be);case 1:i=Xr.processMessages(n.messageToElements.map(function(e){return o(e,1)[0]}),this.maxMessages,this.totalMessagesMaxCharLength),!this.connectSettings.websocket||this.connectSettings.handler&&this.connectSettings.url===Gr.URL?this.callServiceAPI(n,i,t[Y]):(a=S({messages:i},this.rawBody),t[Y]&&null!=(r=this.getServiceIOByType(t[Y][0]))&&r.connect?this.callApiWithFiles(n,i,t[Y]):Wr.sendWebsocket(this,a,n,!1));case 2:return e.a(2)}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"extractResultData",value:(t=k(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:if(!t.result){e.n=1;break}return e.a(2,Ct.handleResponseProperty(t));case 1:if(!Or.validateResponseFormat(t,!!this.stream)){e.n=2;break}return e.a(2,t);case 2:return e.a(2)}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"isDirectConnection",value:function(){return!1}},{key:"isWebModel",value:function(){return!1}},{key:"isCustomView",value:function(){return!1}}],[{key:"canSendMessage",value:function(e,t,n){return!!n||(!(!e||""===e.trim())||!!(t&&t.length>0))}},{key:"createCustomFormDataBody",value:function(e,t,n){var r=new FormData;n.forEach(function(e){return r.append("files",e)}),Object.keys(e).forEach(function(t){return r.append(t,String(e[t]))});var i=0;t.slice(0,t.length-1).forEach(function(e){r.append("message".concat(i+=1),JSON.stringify(e))});var a=t[t.length-1];return a[B]&&(delete a[Y],r.append("message".concat(i+=1),JSON.stringify(a))),r}}]);var t,n,r,i,a,s}(),$r=function(e){function t(e,n,r,i,a){var s,o;return C(this,t),(s=d(this,t,[e,a])).insertKeyPlaceholderText="API Key",s.keyHelpUrl="",s.asyncCallInProgress=!1,s.systemMessage="",Object.assign(s.rawBody,null==(o=e.connect)?void 0:o.additionalBodyProps),s._keyVerificationDetails=n,s._buildHeadersFunc=r,i&&s.setApiKeyProperties(i),s.connectSettings=s.buildConnectSettings(s.key||"",e.connect),s}return m(t,e),x(t,[{key:"setApiKeyProperties",value:function(e){this.key=e.key,e.validateKeyProperty&&(this.validateKeyProperty=e.validateKeyProperty)}},{key:"buildConnectSettings",value:function(e,t){var n,r=null!=t?t:{};return null!==(n=r.headers)&&void 0!==n||(r.headers={}),Object.assign(r.headers,this._buildHeadersFunc(e)),r}},{key:"completeConfig",value:function(e,t){e.system_prompt&&(this.systemMessage=e.system_prompt),t&&(this.functionHandler=t),delete e.system_prompt,delete e.key,delete e.function_handler,Object.assign(this.rawBody,e)}},{key:"keyAuthenticated",value:function(e,t){this.connectSettings=this.buildConnectSettings(t,this.connectSettings),this.key=t,e()}},{key:"verifyKey",value:function(e,t){var n=this._keyVerificationDetails,r=n.url,i=n.method,a=n.handleVerificationResult,s=n.createHeaders,o=n.body,l=n.augmentUrl,u=(null==s?void 0:s(e))||this._buildHeadersFunc(e),c=(null==l?void 0:l(e))||r;Vr.verifyKey(e,c,u,i,this.keyAuthenticated.bind(this,t.onSuccess),t.onFail,t.onLoad,a,o)}},{key:"isDirectConnection",value:function(){return!0}},{key:"processMessages",value:function(e){return Xr.getCharacterLimitMessages(e,this.totalMessagesMaxCharLength?this.totalMessagesMaxCharLength-this.systemMessage.length:-1)}},{key:"addSystemMessage",value:function(e){this.systemMessage&&e.unshift(w(w({},ue,"system"),"content",this.systemMessage))}},{key:"callDirectServiceServiceAPI",value:(a=k(g().m(function e(t,n,r,i,a){var s,o;return g().w(function(e){for(;;)switch(e.n){case 0:if(this.connectSettings){e.n=1;break}throw new Error(be);case 1:if(s=r(this.rawBody,n),(!(o=!!i&&this.stream)||E(o)===ct&&o.simulation)&&!s.stream){e.n=2;break}s.stream=!0,null!=i&&i.readable&&(this.stream={readable:!0}),qr.request(this,s,t),e.n=4;break;case 2:return e.n=3,Vr.request(this,s,t,a);case 3:return e.a(2,e.v);case 4:return e.a(2)}},e,this)})),function(e,t,n,r,i){return a.apply(this,arguments)})},{key:"callToolFunction",value:(i=k(g().m(function e(t,n){var r,i,a,s,o,l,u;return g().w(function(e){for(;;)switch(e.n){case 0:return this.asyncCallInProgress=!0,e.n=1,t(n);case 1:if(a=e.v,Array.isArray(a)){e.n=6;break}if(!a[B]){e.n=5;break}return s=w({},B,a[B]),e.n=2,null==(i=(r=this.deepChat).responseInterceptor)?void 0:i.call(r,s);case 2:if(l=e.v){e.n=3;break}l=s;case 3:if(o=l,!Array.isArray(o)){e.n=4;break}throw Error("Function tool response interceptor cannot return an array");case 4:return e.a(2,{processedResponse:o});case 5:throw Error(Te);case 6:return e.n=7,Promise.all(a);case 7:return u=e.v,e.a(2,{responses:u})}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"makeAnotherRequest",value:function(e,t,n){try{return t&&(this.stream?qr.request(this,e,t):Vr.request(this,e,t)),w({},B,n||"")}catch(r){throw this.asyncCallInProgress=!1,r}}},{key:"genereteAPIKeyName",value:function(e){return"".concat(e," API Key")}},{key:"extractStreamResultWToolsGeneric",value:(r=k(g().m(function e(t,n,r,i,a){var s,o;return g().w(function(e){for(;;)switch(e.n){case 0:if(s=n.delta,"tool_calls"!==n.finish_reason){e.n=1;break}return o={tool_calls:t._streamToolCalls},e.a(2,(t._streamToolCalls=void 0,this.handleToolsGeneric(o,r,t.messages,i,a)));case 1:null!=s&&s.tool_calls&&(t._streamToolCalls?s.tool_calls.forEach(function(e,n){t._streamToolCalls&&(t._streamToolCalls[n].function.arguments+=e.function.arguments)}):t._streamToolCalls=s.tool_calls);case 2:return e.a(2,w({},B,(null==s?void 0:s.content)||""))}},e,this)})),function(e,t,n,i,a){return r.apply(this,arguments)})},{key:"handleToolsGeneric",value:(n=k(g().m(function e(t,n,r,i,a){var s,o,l,u,c;return g().w(function(e){for(;;)switch(e.n){case 0:if(t.tool_calls&&i&&n){e.n=1;break}throw Error(Ce);case 1:return s=ce(i),o=t.tool_calls.map(function(e){return{name:e.function.name,arguments:e.function.arguments}}),e.n=2,this.callToolFunction(n,o);case 2:if(l=e.v,u=l.responses,!(c=l.processedResponse)){e.n=3;break}return e.a(2,c);case 3:if(a&&(s.messages=s.messages.slice(s.messages.length-1),a.message&&s.messages.unshift(w(w({},ue,"system"),"content",a.message))),s.messages.push(w(w({tool_calls:t.tool_calls},ue,H),"content",null)),u.find(function(e){return"string"!=typeof e.response})||o.length!==u.length){e.n=4;break}return e.a(2,(u.forEach(function(e,n){var r,i=null==(r=t.tool_calls)?void 0:r[n];null==s||s.messages.push(w(w(w(w({},ue,"tool"),"tool_call_id",null==i?void 0:i.id),"name",null==i?void 0:i.function.name),"content",e.response))}),this.makeAnotherRequest(s,r)));case 4:throw Error(Te);case 5:return e.a(2)}},e,this)})),function(e,t,r,i,a){return n.apply(this,arguments)})},{key:"updateSessionId",value:function(e){this.messages&&this.messages.messageToElements.length>0&&(this.messages.messageToElements[this.messages.messageToElements.length-1][0]._sessionId=e)}}],[{key:"getRoleViaUser",value:function(e){return e===U?U:H}},{key:"getRoleViaAI",value:function(e){return e===j?H:U}},{key:"getImageContent",value:function(e){return e.filter(function(e){return e.type===Q}).map(function(e){return w(w({},J,yt),yt,{url:e[X]||""})}).filter(function(e){return e[yt].url.length>0})}},{key:"getTextWImagesContent",value:function(e){if(e[Y]&&e[Y].length>0){var t=this.getImageContent(e[Y]);return e[B]&&e[B].trim().length>0&&t.unshift(w(w({},J,B),B,e[B])),t.length>0?t:e[B]||""}return e[B]||""}},{key:"getTextWFilesContent",value:function(e,t){if(e[Y]&&e[Y].length>0){var n=t(e[Y]);return e[B]&&e[B].trim().length>0&&n.unshift(w(w({},J,B),B,e[B])),n}return e[B]||""}}]);var n,r,i,a}(Qr),ei=function(){function e(){C(this,e)}return x(e,null,[{key:"waitForPropertiesToBeUpdatedBeforeRender",value:function(t){t._propUpdated_=!1,setTimeout(function(){t._propUpdated_?e.waitForPropertiesToBeUpdatedBeforeRender(t):(t._waitingToRender_=!1,t.onRender())})}},{key:"attemptRender",value:function(t){t._propUpdated_=!0,t._waitingToRender_||(t._waitingToRender_=!0,e.waitForPropertiesToBeUpdatedBeforeRender(t))}}])}(),ti=function(e){function t(){var e;return C(this,t),(e=d(this,t))._waitingToRender_=!1,e._propUpdated_=!1,Object.keys(t._attributeToProperty_).forEach(function(n){var r=t._attributeToProperty_[n];e.constructPropertyAccessors(r),e.hasOwnProperty(n)||e.constructPropertyAccessors(r,n)}),e}return m(t,e),x(t,[{key:"constructPropertyAccessors",value:function(e,t){var n;Object.defineProperty(this,t||e,{get:function(){return n},set:function(r){n=r,t?this[e]=r:ei.attemptRender(this)}})}},{key:"attributeChangedCallback",value:function(e,n,r){if(n!==r){var i=t._attributes_[e](r);this[t._attributeToProperty_[e]]=i}}},{key:"onRender",value:function(){}}],[{key:"observedAttributes",get:function(){return Object.keys(t._attributes_)||[]}}])}(s(HTMLElement));ti._attributes_={},ti._attributeToProperty_={};var ni=ti,ri=function(){return x(function e(){C(this,e)},null,[{key:"createSVGElement",value:function(e){return(new DOMParser).parseFromString(e,"image/svg+xml").documentElement}}])}(),ii=function(){function e(){C(this,e)}return x(e,null,[{key:"changeVisibility",value:function(t,n,r,i){i.target.id===e.VISIBLE_ICON_ID?(n[I].display="none",r[I].display="block",t.type="password"):(n[I].display="block",r[I].display="none",t.type=B)}},{key:"createIconElement",value:function(e,t){var n=ri.createSVGElement(e);return n.id=t,n[M].add("visibility-icon"),n}},{key:"create",value:function(t){var n=R();n.id="visibility-icon-container";var r=e.createIconElement('<?xml version="1.0" standalone="no"?>\n<svg version="1.1"\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n\txmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0.9em" height="0.9em"\n\tviewBox="0 0 1200 1200" enable-background="new 0 0 1200 1200">\n\t\t<path id="path6686" inkscape:connector-curvature="0" d="M779.843,599.925c0,95.331-80.664,172.612-180.169,172.612\n\t\t\tc-99.504,0-180.168-77.281-180.168-172.612c0-95.332,80.664-172.612,180.168-172.612\n\t\t\tC699.179,427.312,779.843,504.594,779.843,599.925z M600,240.521c-103.025,0.457-209.814,25.538-310.904,73.557\n\t\t\tc-75.058,37.122-148.206,89.496-211.702,154.141C46.208,501.218,6.431,549,0,599.981c0.76,44.161,48.13,98.669,77.394,131.763\n\t\t\tc59.543,62.106,130.786,113.018,211.702,154.179c94.271,45.751,198.616,72.092,310.904,73.557\n\t\t\tc103.123-0.464,209.888-25.834,310.866-73.557c75.058-37.122,148.243-89.534,211.74-154.179\n\t\t\tc31.185-32.999,70.962-80.782,77.394-131.763c-0.76-44.161-48.13-98.671-77.394-131.764\n\t\t\tc-59.543-62.106-130.824-112.979-211.74-154.141C816.644,268.36,712.042,242.2,600,240.521z M599.924,329.769\n\t\t\tc156.119,0,282.675,120.994,282.675,270.251c0,149.256-126.556,270.25-282.675,270.25S317.249,749.275,317.249,600.02\n\t\t\tC317.249,450.763,443.805,329.769,599.924,329.769L599.924,329.769z"/>\n</svg>\n',e.VISIBLE_ICON_ID);r[I].display="none",n.appendChild(r);var i=e.createIconElement('<?xml version="1.0" standalone="no"?>\n<svg version="1.1"\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n\txmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0.9em" height="0.9em"\n\tviewBox="0 0 1200 1200" enable-background="new 0 0 1200 1200">\n\t\t<path d="\n\t\t\tM669.727,273.516c-22.891-2.476-46.15-3.895-69.727-4.248c-103.025,0.457-209.823,25.517-310.913,73.536\n\t\t\tc-75.058,37.122-148.173,89.529-211.67,154.174C46.232,529.978,6.431,577.76,0,628.74c0.76,44.162,48.153,98.67,77.417,131.764\n\t\t\tc59.543,62.106,130.754,113.013,211.67,154.174c2.75,1.335,5.51,2.654,8.276,3.955l-75.072,131.102l102.005,60.286l551.416-960.033\n\t\t\tl-98.186-60.008L669.727,273.516z M902.563,338.995l-74.927,129.857c34.47,44.782,54.932,100.006,54.932,159.888\n\t\t\tc0,149.257-126.522,270.264-282.642,270.264c-6.749,0-13.29-0.728-19.922-1.172l-49.585,85.84c22.868,2.449,45.99,4.233,69.58,4.541\n\t\t\tc103.123-0.463,209.861-25.812,310.84-73.535c75.058-37.122,148.246-89.529,211.743-154.174\n\t\t\tc31.186-32.999,70.985-80.782,77.417-131.764c-0.76-44.161-48.153-98.669-77.417-131.763\n\t\t\tc-59.543-62.106-130.827-113.013-211.743-154.175C908.108,341.478,905.312,340.287,902.563,338.995L902.563,338.995z\n\t\t\tM599.927,358.478c6.846,0,13.638,0.274,20.361,0.732l-58.081,100.561c-81.514,16.526-142.676,85.88-142.676,168.897\n\t\t\tc0,20.854,3.841,40.819,10.913,59.325c0.008,0.021-0.008,0.053,0,0.074l-58.228,100.854\n\t\t\tc-34.551-44.823-54.932-100.229-54.932-160.182C317.285,479.484,443.808,358.477,599.927,358.478L599.927,358.478z M768.896,570.513\n\t\t\tL638.013,797.271c81.076-16.837,141.797-85.875,141.797-168.603C779.81,608.194,775.724,588.729,768.896,570.513L768.896,570.513z"\n\t\t\t/>\n</svg>\n',"not-visible-icon");return n.appendChild(i),n.onclick=e.changeVisibility.bind(this,t,r,i),n}}])}();ii.VISIBLE_ICON_ID="visible-icon";var ai=ii,si=function(){function e(){C(this,e)}return x(e,null,[{key:"createCautionText",value:function(){var e=R("a");return e[M].add("insert-key-input-help-text"),e.innerText="Please exercise CAUTION when inserting your API key outside of deepchat.dev or localhost!!",e}},{key:"createHelpLink",value:function(e){var t=R("a");return t[M].add("insert-key-input-help-text"),t.href=e,t.innerText="Find more info here",t.target="_blank",t}},{key:"createFailText",value:function(){var e=R();return e.id="insert-key-input-invalid-text",e[I].display="none",e}},{key:"createHelpTextContainer",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=R();r.id="insert-key-help-text-container";var i=R();i.id="insert-key-help-text-contents";var a=e.createFailText();if(i.appendChild(a),t){var s=e.createHelpLink(t);i.appendChild(s)}if(!0===n){var o=e.createCautionText();i.appendChild(o)}return r.appendChild(i),{helpTextContainerElement:r,failTextElement:a}}},{key:"onFail",value:function(e,t,n,r){e[M].replace("insert-key-input-valid","insert-key-input-invalid"),n.innerText=r,n[I].display="block",t.innerText="Start",e[M].remove("loading")}},{key:"onLoad",value:function(e,t){e[M].add("loading"),t.innerHTML='<div id="loading-key"></div>'}},{key:"verifyKey",value:function(e,t,n){var r=e.value.trim();n.verifyKey(r,t)}},{key:"addVerificationEvents",value:function(t,n,r,i,a){var s={onSuccess:i,onFail:e.onFail.bind(this,t,n,r),onLoad:e.onLoad.bind(this,t,n)},o=e.verifyKey.bind(this,t,s,a);n.onclick=o,t.onkeydown=function(e){!t[M].contains("loading")&&e.key===Ve.ENTER&&o()}}},{key:"createStartButton",value:function(){var e=R();return e.id="start-button",e.innerText="Start",e}},{key:"onInputFocus",value:function(e){e.target[M].replace("insert-key-input-invalid","insert-key-input-valid")}},{key:"createInput",value:function(t){var n=R();n.id="insert-key-input-container";var r=R("input");return r.id="insert-key-input",r.placeholder=t||"API Key",r.type="password",r[M].add("insert-key-input-valid"),r.onfocus=e.onInputFocus,n.appendChild(r),n}},{key:"createContents",value:function(t,n){var r,i=R();i.id="insert-key-contents";var a=e.createInput(n.insertKeyPlaceholderText),s=a.children[0],o=ai.create(s);a.appendChild(o),i.appendChild(a);var l=e.createStartButton(),u=e.createHelpTextContainer(n.keyHelpUrl,null==(r=n.deepChat._insertKeyViewStyles)?void 0:r.displayCautionText),c=u.helpTextContainerElement,d=u.failTextElement;return i.appendChild(l),i.appendChild(c),e.addVerificationEvents(s,l,d,t,n),i}},{key:"createElements",value:function(t,n){var r=R();r.id="insert-key-view";var i=e.createContents(t,n);return r.appendChild(i),r}},{key:"render",value:function(t,n,r){var i=e.createElements(n,r);t.replaceChildren(i)}}])}(),oi=function(){function e(){C(this,e)}return x(e,null,[{key:"enableButtons",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;window.webLLM?(t&&(t[Fe]=!1),n&&(n[Fe]=!1)):r<4*di.MODULE_SEARCH_LIMIT_S&&setTimeout(function(){return e.enableButtons(t,n,r+1)},250)}},{key:"setUpInitial",value:function(t,n,r,i){var a=(null==n?void 0:n.downloadClass)||e.DOWNLOAD_BUTTON_CLASS,s=(null==n?void 0:n.uploadClass)||e.UPLOAD_BUTTON_CLASS,o=(null==n?void 0:n.fileInputClass)||e.FILE_INPUT_CLASS;return setTimeout(function(){var n=null==r?void 0:r.getElementsByClassName(a)[0],i=null==r?void 0:r.getElementsByClassName(o)[0],l=null==r?void 0:r.getElementsByClassName(s)[0];n&&(n.onclick=function(){return t()}),i&&(i.onchange=function(){i[Y]&&i[Y].length>0&&t(i[Y])}),l&&(l.onclick=function(){return i[Be]()}),(n||l)&&e.enableButtons(n,l)}),(null==n?void 0:n.initialHtml)||'<div>\n        Download or upload a web model that will run entirely on your browser: <br/> \n        <button disabled class="'.concat(a,' deep-chat-button deep-chat-web-model-button">Download</button>\n        ').concat(i?"":'<input type="file" class="'.concat(o,'" hidden multiple />\n          <button disabled class="').concat(s,' deep-chat-button deep-chat-web-model-button">Upload</button>'),"\n      </div>")}},{key:"exportFile",value:function(e){for(var t=R("a"),n=function(n){setTimeout(function(){for(var r=4*n,i=r;i<Math.min(r+4,e.length);i+=1){var a=URL.createObjectURL(e[i]);t.href=a,t.download=e[i].name,document.body.appendChild(t),t[Be](),URL.revokeObjectURL(a)}},500*n)},r=0;r<e.length/4;r+=1)n(r)}},{key:"setUpAfterLoad",value:function(t,n,r,i){var a=(null==n?void 0:n.exportFilesClass)||e.EXPORT_BUTTON_CLASS;return setTimeout(function(){var n=null==r?void 0:r.getElementsByClassName(a)[0];n&&(n.onclick=function(){return e.exportFile(t)})}),(null==n?void 0:n.afterLoadHtml)||"<div>\n        Model loaded successfully and has been cached for future requests.\n        ".concat(i?"":'<br/> <button style="margin-top: 5px" class="'.concat(a,' deep-chat-button">Export</button>'),"\n      </div>")}}])}();oi.DOWNLOAD_BUTTON_CLASS="deep-chat-download-button",oi.UPLOAD_BUTTON_CLASS="deep-chat-upload-button",oi.FILE_INPUT_CLASS="deep-chat-file-input",oi.EXPORT_BUTTON_CLASS="deep-chat-export-button";var li=oi,ui={model_list:[{model_url:"https://huggingface.co/mlc-ai/Llama-2-7b-chat-hf-q4f32_1-MLC/resolve/main/",local_id:"Llama-2-7b-chat-hf-q4f32_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-7b-chat-hf/Llama-2-7b-chat-hf-q4f32_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:9109.03,low_resource_required:!1},{model_url:"https://huggingface.co/mlc-ai/Llama-2-7b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-7b-chat-hf-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-7b-chat-hf/Llama-2-7b-chat-hf-q4f16_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:6749.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Llama-2-7b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-7b-chat-hf-q4f16_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-7b-chat-hf/Llama-2-7b-chat-hf-q4f16_1-ctx1k-webgpu.wasm",vram_required_MB:4618.52,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Llama-2-13b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-13b-chat-hf-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-13b-chat-hf/Llama-2-13b-chat-hf-q4f16_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:11814.09,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Llama-2-70b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-70b-chat-hf-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-70b-chat-hf/Llama-2-70b-chat-hf-q4f16_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:43729.05,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f16_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f16_1-ctx2k-webgpu.wasm",vram_required_MB:2972.09,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f32_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f32_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f32_1-ctx2k-webgpu.wasm",vram_required_MB:3928.09,low_resource_required:!1},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f16_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f16_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f16_1-ctx1k-webgpu.wasm",vram_required_MB:2041.09,low_resource_required:!0,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f32_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f32_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f32_1-ctx1k-webgpu.wasm",vram_required_MB:2558.09,low_resource_required:!0},{model_url:"https://huggingface.co/mlc-ai/WizardMath-7B-V1.1-q4f16_1-MLC/resolve/main/",local_id:"WizardMath-7B-V1.1-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Mistral-7B-Instruct-v0.2-q4f16_1-MLC/resolve/main/",local_id:"Mistral-7B-Instruct-v0.2-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/OpenHermes-2.5-Mistral-7B-q4f16_1-MLC/resolve/main/",local_id:"OpenHermes-2.5-Mistral-7B-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/NeuralHermes-2.5-Mistral-7B-q4f16_1-MLC/resolve/main/",local_id:"NeuralHermes-2.5-Mistral-7B-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q0f16-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q0f16",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q0f16-ctx2k-webgpu.wasm",vram_required_MB:5063.52,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q0f32-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q0f32",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q0f32-ctx2k-webgpu.wasm",vram_required_MB:5394.53,low_resource_required:!1},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q4f16_1-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q4f16_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q4f16_1-ctx1k-webgpu.wasm",vram_required_MB:899.11,low_resource_required:!0,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q4f32_1-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q4f32_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q4f32_1-ctx1k-webgpu.wasm",vram_required_MB:992.11,low_resource_required:!0}],use_web_worker:!0},ci=function(e){function t(e){var n,r,i;return C(this,t),(n=d(this,t,[e]))._isModelLoaded=!1,n._isModelLoading=!1,n._loadOnFirstMessage=!1,n._webModel={},n.permittedErrorPrefixes=[t.MULTIPLE_MODELS_ERROR,t.WEB_LLM_NOT_FOUND_ERROR,t.GENERIC_ERROR],n._conversationHistory=[],"object"==E(e.webModel)&&(n._webModel=e.webModel),null!=(r=n._webModel.load)&&r.clearCache&&t.clearAllCache(),n.findModelInWindow(e),n.canSendMessage=n.canSubmit.bind(h(n)),n._chatEl=null==(i=e.shadowRoot)?void 0:i.children[0],e.history&&t.setUpHistory(n._conversationHistory,e.history),n}return m(t,e),x(t,[{key:"setUpMessages",value:function(e){var t=this;this._messages=e,this._removeIntro=function(){e.removeIntroductoryMessage(),t._removeIntro=void 0}}},{key:"findModelInWindow",value:function(e){var n,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;window.webLLM?this.configureInit(this.shouldAddIntroMessage(e.introMessage)):i>t.MODULE_SEARCH_LIMIT_S?(null==(n=this._messages)||n.addNewErrorMessage(L,t.WEB_LLM_NOT_FOUND_ERROR),console[F]("The deep-chat-web-llm module has not been attached to the window object. Please see the following guide:"),console[F]("https://deepchat.dev/examples/externalModules")):setTimeout(function(){return r.findModelInWindow(e,i+1)},1e3)}},{key:"shouldAddIntroMessage",value:function(e){var t;return!e&&this._webModel&&!1!==(null==(t=this._webModel.introMessage)?void 0:t.displayed)}},{key:"scrollToTop",value:function(e){var t,n=this;!1!==(null==(t=this._webModel.introMessage)?void 0:t.autoScroll)&&setTimeout(function(){var e,t;null!=(e=n._messages)&&e.elementRef&&kt.scrollToTop(null==(t=n._messages)?void 0:t.elementRef)},e)}},{key:"getIntroMessage",value:function(e){if(this.shouldAddIntroMessage(e)&&this._chatEl){var t=li.setUpInitial(this.init.bind(this),this._webModel.introMessage,this._chatEl,!!this._webModel.worker);return this.scrollToTop(1),w(w(w({},ue,j),"html",t),"sendUpdate",!1)}}},{key:"configureInit",value:(p=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!(n=this._webModel.load)){e.n=2;break}if(!n.onInit){e.n=1;break}return this.init(),e.a(2);case 1:if(!n.onMessage){e.n=2;break}return this._loadOnFirstMessage=!0,e.a(2);case 2:t||this.init();case 3:return e.a(2)}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"init",value:(c=k(g().m(function e(t){var n,r;return g().w(function(e){for(;;)switch(e.n){case 0:if(null==(n=this._messages)||n.removeError(),!(r=this.attemptToCreateChat())){e.n=1;break}return e.n=1,this.loadModel(r,t);case 1:return e.a(2)}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"attemptToCreateChat",value:function(){var e;if(t.chat)return null==(e=this._messages)||e.addNewErrorMessage(L,t.MULTIPLE_MODELS_ERROR),void console[F](t.MULTIPLE_MODELS_ERROR);if(!this._isModelLoaded&&!this._isModelLoading){var n=this._webModel.worker;return ui.use_web_worker&&n?new window.webLLM.ChatWorkerClient(n):new window.webLLM.ChatModule}}},{key:"getConfig",value:function(){var e,n=t.DEFAULT_MODEL;this._webModel.model&&(n=this._webModel.model);var r=ce(ui);if(this._webModel.urls){var i=r.model_list.find(function(e){return e.local_id=n});i&&(this._webModel.urls.model&&(i.model_url=this._webModel.urls.model),this._webModel.urls.wasm&&(i.model_lib_url=this._webModel.urls.wasm))}return null!=(e=this._webModel.load)&&e.skipCache&&(r.use_cache=!1),{model:n,appConfig:r}}},{key:"loadModel",value:(u=k(g().m(function e(n,r){var i,a,s,o,l,u,c,d,h,p,f,m,v,y,b,k,_=this;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:return this.scrollToTop(),t.chat=n,this._isModelLoading=!0,d=!1===(null==(i=this._webModel.introMessage)?void 0:i.displayed),h=function(e){var t;null==(t=_._messages)||t.addNewMessage({html:"<div>".concat(e[B],"</div>"),overwrite:!0,sendUpdate:!1}),d&&(setTimeout(function(){return kt.scrollToBottom(_._messages)}),d=!1)},t.chat.setInitProgressCallback(h),e.p=1,f=this.getConfig(),m=f.model,v=f.appConfig,y={},this._webModel.instruction&&(y.conv_config={system:this._webModel.instruction}),this._conversationHistory.length>0&&(y.conversation_history=this._conversationHistory),e.n=2,t.chat.reload(m,y,v,r);case 2:p=e.v,e.n=4;break;case 3:return e.p=3,k=e.v,e.a(2,this.unloadChat(k));case 4:null==(s=(a=this.deepChat)._validationHandler)||s.call(a),null!=(o=this._webModel.introMessage)&&o.removeAfterLoad?!1===this._webModel.introMessage.displayed?null==(u=this._messages)||u.removeLastMessage():null==(c=this._removeIntro)||c.call(this):(b=li.setUpAfterLoad(p,this._webModel.introMessage,this._chatEl,!!this._webModel.worker),null==(l=this._messages)||l.addNewMessage({html:b,overwrite:!0,sendUpdate:!1})),this._isModelLoaded=!0,this._isModelLoading=!1;case 5:return e.a(2)}},e,this,[[1,3]])})),function(e,t){return u.apply(this,arguments)})},{key:"unloadChat",value:(l=k(g().m(function e(n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:if(null==(r=this._messages)||r.addNewErrorMessage(L,t.GENERIC_ERROR),console[F](n),this._isModelLoaded=!1,this._isModelLoading=!1,!t.chat){e.n=2;break}return e.n=1,t.chat.unload();case 1:t.chat=void 0;case 2:return e.a(2)}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"immediateResp",value:(o=k(g().m(function e(n,r,i){var a,s,o,l,u;return g().w(function(e){for(;;)switch(e.n){case 0:return o=w,l={},u=B,e.n=1,i.generate(r,void 0,0);case 1:return a=o(l,u,e.v),e.n=2,t.processResponse(this.deepChat,n,a);case 2:(s=e.v)&&s.forEach(function(e){return n.addNewMessage(e)}),this.completionsHandlers.onFinish();case 3:return e.a(2)}},e,this)})),function(e,t,n){return o.apply(this,arguments)})},{key:"streamResp",value:(s=k(g().m(function e(n,r,i){var a,s=this;return g().w(function(e){for(;;)switch(e.n){case 0:return this.streamHandlers.onAbort=function(){i.interruptGenerate()},this.streamHandlers.onOpen(),a=new Pr(n),e.n=1,i.generate(r,function(){var e=k(g().m(function e(r,i){var o;return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.processResponse(s.deepChat,n,w({},B,i));case 1:(o=e.v)&&a.upsertStreamedMessage(w(w({},B,o[0][B]),"overwrite",!0));case 2:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}());case 1:a.finaliseStreamedMessage(),this.streamHandlers.onClose();case 2:return e.a(2)}},e,this)})),function(e,t,n){return s.apply(this,arguments)})},{key:"generateRespByType",value:(a=k(g().m(function e(t,n,r,i){var a,s;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!r){e.n=2;break}return e.n=1,this.streamResp(t,n,i);case 1:e.n=3;break;case 2:return e.n=3,this.immediateResp(t,n,i);case 3:e.n=5;break;case 4:e.p=4,s=e.v,null==(a=this._messages)||a.addNewErrorMessage(L),console.log(s);case 5:return e.a(2)}},e,this,[[0,4]])})),function(e,t,n,r){return a.apply(this,arguments)})},{key:"generateResp",value:(i=k(g().m(function e(t,n,r){var i,a,s,o,l,u,c;return g().w(function(e){for(;;)switch(e.n){case 0:return i=n[n.length-1][B],e.n=1,Or.processRequestInterceptor(this.deepChat,{body:w({},B,i)});case 1:a=e.v,s=a.body,o=a.error,l=!!this.stream;try{o?(Or.displayError(t,new Error(o)),(l?this.streamHandlers.onClose:this.completionsHandlers.onFinish)()):s&&s[B]?this.generateRespByType(t,s[B],!!this.stream,r):(u=fe({body:s},!1),console[F](u),c=l?this.streamHandlers.onClose:this.completionsHandlers.onFinish,Or.onInterceptorError(t,u,c))}catch(u){this.unloadChat(u)}case 2:return e.a(2)}},e,this)})),function(e,t,n){return i.apply(this,arguments)})},{key:"callServiceAPI",value:(r=k(g().m(function e(n,r){var i,a;return g().w(function(e){for(;;)switch(e.n){case 0:if(this._isModelLoaded){e.n=3;break}if(!this._loadOnFirstMessage){e.n=2;break}return e.n=1,this.init();case 1:e.n=3;break;case 2:return e.a(2);case 3:!t.chat||this._isModelLoading||(null!=(i=this._webModel.introMessage)&&i.removeAfterMessage&&(null==(a=this._removeIntro)||a.call(this)),n.addLoadingMessage(),this.generateResp(n,r,t.chat));case 4:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"canSubmit",value:function(e){return!(null==e||!e.trim()||this._isModelLoading)&&(!!this._loadOnFirstMessage||!!this._isModelLoaded)}},{key:"isWebModel",value:function(){return!0}}],[{key:"setUpHistory",value:function(e,t){t.forEach(function(n,r){if(n[ue]===U&&n[B]){var i=t[r+1];null!=i&&i[B]&&i[ue]!==U&&e.push([n[B],i[B]])}})}},{key:"processResponse",value:(n=k(g().m(function e(t,n,r){var i,a,s,o,l,u,c;return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,null==(i=t.responseInterceptor)?void 0:i.call(t,r);case 1:if(c=e.v){e.n=2;break}c=r;case 2:if(s=c,!(null!=(a=t.connect)&&a.stream&&Array.isArray(s)&&s.length>1)){e.n=3;break}return console[F](Se),e.a(2);case 3:if(o=Array.isArray(s)?s:[s],!(l=o.find(function(e){return"string"==typeof e[F]}))){e.n=4;break}return Or.displayError(n,new Error(l[F])),e.a(2);case 4:if(!o.find(function(e){return!e||!e[B]})){e.n=5;break}return u=me(r,!!t.responseInterceptor,s),Or.displayError(n,new Error(u)),e.a(2);case 5:return e.a(2,o)}},e)})),function(e,t,r){return n.apply(this,arguments)})},{key:"clearAllCache",value:function(){t.clearCache("webllm/model"),t.clearCache("webllm/wasm")}},{key:"clearCache",value:function(e){caches.open(e).then(function(e){e.keys().then(function(t){t.forEach(function(t){e.delete(t)})})})}}]);var n,r,i,a,s,o,l,u,c,p}(Qr);ci.GENERIC_ERROR="Error, please check the [troubleshooting](".concat(D,"webModel#troubleshooting) section of documentation for help."),ci.MULTIPLE_MODELS_ERROR="Cannot run multiple web models",ci.WEB_LLM_NOT_FOUND_ERROR="WebLLM module not found",ci.DEFAULT_MODEL="Llama-2-7b-chat-hf-q4f32_1",ci.MODULE_SEARCH_LIMIT_S=5;var di=ci,hi=function(e,t,n,r){return{url:e,method:t,handleVerificationResult:n,augmentUrl:r}},pi=function(e){return w(w({},tt,"".concat(ht).concat(e)),lt,ut)},fi=function(e,t,n,r){var i=e;Array.isArray(i[F])&&"Error in `parameters`: field required"===i[F][0]?n(t):r(ge)},mi=function(e){function t(e,n,r,i,a,s){var o;return C(this,t),(o=d(this,t,[e,hi("https://api-inference.huggingface.co/models/gpt2",ft,fi),pi,a,s])).insertKeyPlaceholderText="Hugging Face Token",o.keyHelpUrl="https://huggingface.co/settings/tokens",o.permittedErrorPrefixes=[rt],o.url="".concat(t.URL_PREFIX).concat(r),o.textInputPlaceholderText=n,"object"==E(i)&&(i.model&&(o.url="".concat(t.URL_PREFIX).concat(i.model)),i.options&&(o.rawBody.options=i.options),i.parameters&&(o.rawBody.parameters=i.parameters)),o}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t,n){var r,i=ce(e),a=t[t.length-1][B];if(a)return null!==(r=i.options)&&void 0!==r||(i.options={}),i.options.wait_for_model=!0,S({inputs:a},i)}},{key:"callServiceAPI",value:(n=k(g().m(function e(t,n,r){var i;return g().w(function(e){for(;;)switch(e.n){case 0:if(this.connectSettings){e.n=1;break}throw new Error(be);case 1:i=this.preprocessBody(this.rawBody,n,r),Vr.request(this,i,t);case 2:return e.a(2)}},e,this)})),function(e,t,r){return n.apply(this,arguments)})}]);var n}($r);mi.URL_PREFIX="https://api-inference.huggingface.co/models/";var vi=mi,gi=function(e){function t(e,n,r,i,a,s){var o;return C(this,t),(o=d(this,t,[e,n,r,i,a,s])).isTextInputDisabled=!0,o.canSendMessage=t.canSendFile,o}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t,n){return n[0]}},{key:"callServiceAPI",value:(n=k(g().m(function e(t,n,r){return g().w(function(e){for(;;)switch(e.n){case 0:if(this.connectSettings){e.n=1;break}throw new Error(be);case 1:if(null!=r&&r[0]){e.n=2;break}throw new Error(ke);case 2:Vr.poll(this,r[0],t,!1);case 3:return e.a(2)}},e,this)})),function(e,t,r){return n.apply(this,arguments)})}],[{key:"canSendFile",value:function(e,t){return!(null==t||!t[0])}}]);var n}(vi),yi=function(e){function t(e){var n,r,i;C(this,t);var a=null==(r=null==(n=e.directConnection)?void 0:n.huggingFace)?void 0:r.audioClassification,s=null==(i=e.directConnection)?void 0:i.huggingFace;return d(this,t,[e,"Attach an audio ".concat(Z),"ehcalabres/wav2vec2-lg-xlsr-en-speech-emotion-recognition",a,s,{audio:{}}])}return m(t,e),x(t,[{key:"extractPollResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t.estimated_time){e.n=1;break}return e.a(2,{timeoutMS:1e3*(t.estimated_time+1)});case 1:if(!t[F]){e.n=2;break}throw t[F];case 2:return e.a(2,w({},B,(null==(n=t[0])?void 0:n.label)||""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n}(gi),bi=function(e){function t(e){var n,r,i;C(this,t);var a=null==(r=null==(n=e.directConnection)?void 0:n.huggingFace)?void 0:r.imageClassification,s=null==(i=e.directConnection)?void 0:i.huggingFace;return d(this,t,[e,"Attach an image ".concat(Z),"google/vit-base-patch16-224",a,s,{images:{}}])}return m(t,e),x(t,[{key:"extractPollResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t.estimated_time){e.n=1;break}return e.a(2,{timeoutMS:1e3*(t.estimated_time+1)});case 1:if(!t[F]){e.n=2;break}throw t[F];case 2:return e.a(2,w({},B,(null==(n=t[0])?void 0:n.label)||""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n}(gi),ki=function(e){return w(w({},tt,"".concat(ht).concat(e)),lt,ut)},_i=function(e,t,n,r){e.message?r(ge):n(t)},Si=function(){return hi("https://api.stability.ai/v1/engines/list",pt,_i)},wi="data:image/png;base64,",Ei=function(e){function t(e,n,r,i,a){var s;return C(this,t),(s=d(this,t,[e,n,r,i,a])).insertKeyPlaceholderText=s.genereteAPIKeyName("Stability AI"),s.keyHelpUrl="https://platform.stability.ai/docs/getting-started/authentication",s.permittedErrorPrefixes=[at,"invalid_"],s}return m(t,e),x(t)}($r),Ci=function(e){function t(e){var n,r;C(this,t);var i=ce(e.directConnection),a=null==i?void 0:i.stabilityAI;(n=d(this,t,[e,Si(),ki,a,{images:{files:{acceptedFormats:".png",maxNumberOfFiles:1}}}])).url="https://api.stability.ai/v1/generation/esrgan-v1-x2plus/image-to-image/upscale",n.textInputPlaceholderText="Describe image changes";var s=null==(r=null==i?void 0:i.stabilityAI)?void 0:r.imageToImageUpscale;return"object"==E(s)&&(s.engine_id&&(n.url="https://api.stability.ai/v1/generation/".concat(s.engine_id,"/image-to-image/upscale")),t.cleanConfig(s),Object.assign(n.rawBody,s)),n.canSendMessage=t.canSendFileMessage,n}return m(t,e),x(t,[{key:"createFormDataBody",value:function(e,t){var n=new FormData;return n.append(Q,t),Object.keys(e).forEach(function(t){n.append(t,String(e[t]))}),n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n,r){var i;return g().w(function(e){for(;;)switch(e.n){case 0:if(this.connectSettings){e.n=1;break}throw new Error(be);case 1:if(r){e.n=2;break}throw new Error(_e);case 2:i=this.createFormDataBody(this.rawBody,r[0]),Or.tempRemoveContentHeader(this.connectSettings,Vr.request.bind(this,this,i,t),!1);case 3:return e.a(2)}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t.message){e.n=1;break}throw t.message;case 1:return n=t.artifacts.map(function(e){return w(w({},X,"".concat(wi).concat(e.base64)),J,Q)}),e.a(2,w({},Y,n))}},e)})),function(e){return n.apply(this,arguments)})}],[{key:"cleanConfig",value:function(e){delete e.engine_id}},{key:"canSendFileMessage",value:function(e,t){return!(null==t||!t[0])}}]);var n,r}(Ei),Ti=function(e){function t(e){var n,r;C(this,t);var i=ce(e.directConnection),a=null==i?void 0:i.stabilityAI,s=w({},$,w({},Y,{acceptedFormats:".png",maxNumberOfFiles:2}));(n=d(this,t,[e,Si(),ki,a,s])).url="https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/image-to-image/masking",n._maskSource="MASK_IMAGE_WHITE",n.textInputPlaceholderText="Describe image changes";var o=null==(r=null==i?void 0:i.stabilityAI)?void 0:r.imageToImageMasking;return"object"==E(o)&&(o.engine_id&&(n.url="https://api.stability.ai/v1/generation/".concat(o.engine_id,"/image-to-image/masking")),void 0!==o.weight&&null!==o.weight&&(n._imageWeight=o.weight),void 0!==o.mask_source&&null!==o.mask_source&&(n._maskSource=o.mask_source),t.cleanConfig(o),Object.assign(n.rawBody,o)),n.canSendMessage=t.canSendFileTextMessage,n}return m(t,e),x(t,[{key:"createFormDataBody",value:function(e,t,n,r){var i=new FormData;return i.append("init_image",t),i.append("mask_source",String(this._maskSource)),i.append("mask_image",n),r&&""!==r&&i.append("text_prompts[0][text]",r),void 0!==this._imageWeight&&null!==this._imageWeight&&i.append("text_prompts[0][weight]",String(this._imageWeight)),Object.keys(e).forEach(function(t){i.append(t,String(e[t]))}),void 0===i.get("weight")&&i.append("weight",String(1)),i}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n,r){var i,a,s,o;return g().w(function(e){for(;;)switch(e.n){case 0:if(this.connectSettings){e.n=1;break}throw new Error(be);case 1:if(r&&r[0]&&r[1]){e.n=2;break}throw new Error(_e);case 2:s=null==(a=null==(i=n[n.length-1])?void 0:i[B])?void 0:a.trim(),o=this.createFormDataBody(this.rawBody,r[0],r[1],s),Or.tempRemoveContentHeader(this.connectSettings,Vr.request.bind(this,this,o,t),!1);case 3:return e.a(2)}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t.message){e.n=1;break}throw t.message;case 1:return n=t.artifacts.map(function(e){return w(w({},X,"".concat(wi).concat(e.base64)),J,Q)}),e.a(2,w({},Y,n))}},e)})),function(e){return n.apply(this,arguments)})}],[{key:"cleanConfig",value:function(e){delete e.engine_id,delete e.weight}},{key:"canSendFileTextMessage",value:function(e,t){return!(null==t||!t[0]||!e||""===e.trim())}}]);var n,r}(Ei),xi=function(e){function t(e){var n,r,i;C(this,t);var a=null==(r=null==(n=e.directConnection)?void 0:n.huggingFace)?void 0:r.audioSpeechRecognition,s=null==(i=e.directConnection)?void 0:i.huggingFace;return d(this,t,[e,"Attach an audio ".concat(Z),"facebook/wav2vec2-large-960h-lv60-self",a,s,{audio:{}}])}return m(t,e),x(t,[{key:"extractPollResultData",value:(n=k(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:if(!t.estimated_time){e.n=1;break}return e.a(2,{timeoutMS:1e3*(t.estimated_time+1)});case 1:if(!t[F]){e.n=2;break}throw t[F];case 2:return e.a(2,w({},B,t[B]||""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n}(gi),Ai=function(e){function t(e){var n,r,i;return C(this,t),d(this,t,[e,"Once upon a time","gpt2",null==(r=null==(n=e.directConnection)?void 0:n.huggingFace)?void 0:r.textGeneration,null==(i=e.directConnection)?void 0:i.huggingFace])}return m(t,e),x(t,[{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F];case 1:return e.a(2,w({},B,(null==(n=t[0])?void 0:n.generated_text)||""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n}(vi),Mi=function(e){function t(e){var n,r,i,a;C(this,t);var s=null==(i=null==(r=e.directConnection)?void 0:r.huggingFace)?void 0:i.questionAnswer;return(n=d(this,t,[e,"Ask a question","bert-large-uncased-whole-word-masking-finetuned-squad",s,null==(a=e.directConnection)?void 0:a.huggingFace])).permittedErrorPrefixes=[rt,"Error in"],n._context=s.context,n}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=t[t.length-1][B];if(n)return{inputs:{question:n,context:this._context,options:{wait_for_model:!0}}}}},{key:"extractResultData",value:(n=k(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F];case 1:return e.a(2,w({},B,t.answer||""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n}(vi),Ii=function(e){function t(e){var n,r,i;return C(this,t),d(this,t,[e,"Insert text to summarize","facebook/bart-large-cnn",null==(r=null==(n=e.directConnection)?void 0:n.huggingFace)?void 0:r.summarization,null==(i=e.directConnection)?void 0:i.huggingFace])}return m(t,e),x(t,[{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F];case 1:return e.a(2,w({},B,(null==(n=t[0])?void 0:n.summary_text)||""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n}(vi),Ri=function(e){function t(e){var n,r,i,a,s;return C(this,t),null!==(n=(r=d(this,t,[e,"Ask me anything!","facebook/blenderbot-400M-distill",null==(a=null==(i=e.directConnection)?void 0:i.huggingFace)?void 0:a.conversation,null==(s=e.directConnection)?void 0:s.huggingFace])).maxMessages)&&void 0!==n||(r.maxMessages=-1),r}return m(t,e),x(t,[{key:"processMessagesI",value:function(e){var t=e.filter(function(e){return e[B]}),n=t[t.length-1][B],r=t.slice(0,t.length-1);if(n)return{past_user_inputs:r.filter(function(e){return e[ue]===U}).map(function(e){return e[B]}),generated_responses:r.filter(function(e){return e[ue]===j}).map(function(e){return e[B]}),mostRecentMessageText:n}}},{key:"preprocessBody",value:function(e,t){var n,r=ce(e),i=this.processMessagesI(t);if(i)return null!==(n=r.options)&&void 0!==n||(r.options={}),r.options.wait_for_model=!0,S({inputs:w({past_user_inputs:i.past_user_inputs,generated_responses:i.generated_responses},B,i.mostRecentMessageText)},r)}},{key:"extractResultData",value:(n=k(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F];case 1:return e.a(2,w({},B,t.generated_text||""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n}(vi),Pi=function(e){function t(e){var n,r;C(this,t);var i=ce(e.directConnection),a=i.stabilityAI,s=w({},$,w({},Y,{acceptedFormats:".png",maxNumberOfFiles:1}));(n=d(this,t,[e,Si(),ki,a,s])).url="https://api.stability.ai/v1/generation/stable-diffusion-v1-6/image-to-image",n.textInputPlaceholderText="Describe image changes";var o=null==(r=i.stabilityAI)?void 0:r.imageToImage;return"object"==E(o)&&(o.engine_id&&(n.url="https://api.stability.ai/v1/generation/".concat(o.engine_id,"/text-to-image")),void 0!==o.weight&&null!==o.weight&&(n._imageWeight=o.weight),t.cleanConfig(o),Object.assign(n.rawBody,o)),n.canSendMessage=t.canSendFileTextMessage,n}return m(t,e),x(t,[{key:"createFormDataBody",value:function(e,t,n){var r=new FormData;return r.append("init_image",t),n&&""!==n&&r.append("text_prompts[0][text]",n),void 0!==this._imageWeight&&null!==this._imageWeight&&r.append("text_prompts[0][weight]",String(this._imageWeight)),Object.keys(e).forEach(function(t){r.append(t,String(e[t]))}),void 0===r.get("weight")&&r.append("weight",String(1)),r}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n,r){var i,a,s,o;return g().w(function(e){for(;;)switch(e.n){case 0:if(this.connectSettings){e.n=1;break}throw new Error(be);case 1:if(r){e.n=2;break}throw new Error(_e);case 2:s=null==(a=null==(i=n[n.length-1])?void 0:i[B])?void 0:a.trim(),o=this.createFormDataBody(this.rawBody,r[0],s),Or.tempRemoveContentHeader(this.connectSettings,Vr.request.bind(this,this,o,t),!1);case 3:return e.a(2)}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t.message){e.n=1;break}throw t.message;case 1:return n=t.artifacts.map(function(e){return w(w({},X,"".concat(wi).concat(e.base64)),J,Q)}),e.a(2,w({},Y,n))}},e)})),function(e){return n.apply(this,arguments)})}],[{key:"cleanConfig",value:function(e){delete e.engine_id,delete e.weight}},{key:"canSendFileTextMessage",value:function(e,t){return!(null==t||!t[0]||!e||""===e.trim())}}]);var n,r}(Ei),Oi=function(e){function t(e){var n,r,i;return C(this,t),d(this,t,[e,"Insert text to translate","Helsinki-NLP/opus-tatoeba-en-ja",null==(r=null==(n=e.directConnection)?void 0:n.huggingFace)?void 0:r.translation,null==(i=e.directConnection)?void 0:i.huggingFace])}return m(t,e),x(t,[{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F];case 1:return e.a(2,w({},B,(null==(n=t[0])?void 0:n.translation_text)||""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n}(vi),Li=function(e){function t(e){var n,r;C(this,t);var i=ce(e.directConnection),a=i.stabilityAI;(n=d(this,t,[e,Si(),ki,a])).url="https://api.stability.ai/v1/generation/stable-diffusion-v1-6/text-to-image",n.textInputPlaceholderText="Describe an image";var s=null==(r=i.stabilityAI)?void 0:r.textToImage;return"object"==E(s)&&(s.engine_id&&(n.url="https://api.stability.ai/v1/generation/".concat(s.engine_id,"/text-to-image")),void 0!==s.weight&&null!==s.weight&&(n._imageWeight=s.weight),t.cleanConfig(s),Object.assign(n.rawBody,s)),n.canSendMessage=t.canSendTextMessage,n}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=t[t.length-1][B],r=ce(e),i=w({},B,n);return this._imageWeight&&(i.weight=this._imageWeight),r.text_prompts=[i],r}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this));case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t.message){e.n=1;break}throw t.message;case 1:return n=t.artifacts.map(function(e){return w(w({},X,"".concat(wi).concat(e.base64)),J,Q)}),e.a(2,w({},Y,n))}},e)})),function(e){return n.apply(this,arguments)})}],[{key:"cleanConfig",value:function(e){delete e.engine_id,delete e.weight}},{key:"canSendTextMessage",value:function(e){return!(!e||""===e.trim())}}]);var n,r}(Ei),Bi=function(e){function t(e){var n,r,i,a;return C(this,t),(n=d(this,t,[e,"The goal of life is [MASK].","bert-base-uncased",null==(i=null==(r=e.directConnection)?void 0:r.huggingFace)?void 0:i.fillMask,null==(a=e.directConnection)?void 0:a.huggingFace])).permittedErrorPrefixes=[rt,"No mask_token"],n}return m(t,e),x(t,[{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F];case 1:return e.a(2,w({},B,(null==(n=t[0])?void 0:n.sequence)||""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n}(vi),Ni=function(e){return w(w({},lt,ut),tt,"".concat(ht).concat(e))},Fi=function(e,t,n,r){var i=e;i[F]?i[F].message===nt?r(ge):r(ye):n(t)},Di=function(){return hi("https://open.bigmodel.cn/api/paas/v4/models",pt,Fi)},ji=function(e){function t(e){var n,r,i,a,s,o;C(this,t);var l=ce(e.directConnection),u=l.bigModel;(i=d(this,t,[e,Di(),Ni,u])).insertKeyPlaceholderText=i.genereteAPIKeyName("BigModel"),i.keyHelpUrl="https://open.bigmodel.cn/usercenter/apikeys",i.url="https://open.bigmodel.cn/api/paas/v4/audio/speech",i.permittedErrorPrefixes=[tt,st];var c=null==(a=l.bigModel)?void 0:a.textToSpeech;return E(c)===ct&&(i.cleanConfig(c),Object.assign(i.rawBody,c)),null!==(n=(s=i.rawBody).model)&&void 0!==n||(s.model="cogtts"),null!==(r=(o=i.rawBody).voice)&&void 0!==r||(o.voice="tongtong"),i}return m(t,e),x(t,[{key:"cleanConfig",value:function(e){delete e.key}},{key:"preprocessBody",value:function(e,t){var n=ce(e),r=t[t.length-1];return n.input=(null==r?void 0:r[B])||"",n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this)))},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n,r;return g().w(function(e){for(;;)if(0===e.n)return n=new Blob([t],w({},J,"audio/mpeg")),r=URL.createObjectURL(n),e.a(2,w({},Y,[w(w({},X,r),J,ne)]))},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),Ui=function(e){return w(w({},lt,ut),tt,"".concat(ht).concat(e))},Hi=function(e,t,n,r){var i=e;i[F]?i[F].message===nt?r(ge):r(ye):n(t)},qi=function(){return hi("https://api.together.xyz/v1/models",pt,Hi)},zi=function(e){function t(e){var n,r,i,a,s,o;C(this,t);var l=ce(e.directConnection),u=l.together;(i=d(this,t,[e,qi(),Ui,u])).insertKeyPlaceholderText=i.genereteAPIKeyName("Together AI"),i.keyHelpUrl="https://api.together.xyz/settings/api-keys",i.url="https://api.together.xyz/v1/audio/speech",i.permittedErrorPrefixes=[ot,st];var c=null==(a=l.together)?void 0:a.textToSpeech;return E(c)===ct&&i.completeConfig(c),null!==(n=(s=i.rawBody).model)&&void 0!==n||(s.model="cartesia/sonic"),null!==(r=(o=i.rawBody).voice)&&void 0!==r||(o.voice="laidback woman"),i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=ce(e),r=t[t.length-1];return n.input=(null==r?void 0:r[B])||"",n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this)))},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n,r;return g().w(function(e){for(;;)if(0===e.n)return n=new Blob([t],w({},J,"audio/mpeg")),r=URL.createObjectURL(n),e.a(2,w({},Y,[w(w({},X,r),J,ne)]))},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),Gi="https://api.openai.com/v1/",Wi="https://platform.openai.com/account/api-keys",Ki="input_text",Vi="input_image",Xi="output_text",Ji="image_generation_call",Zi="function_call_output",Yi="response",Qi=function(e){return w(w({},tt,"".concat(ht).concat(e)),lt,ut)},$i=function(e,t,n,r){var i=e;i[F]?"invalid_api_key"===i[F].code?r(ge):r(ye):n(t)},ea=function(){return hi("".concat(Gi,"models"),pt,$i)},ta=function(){var e=k(g().m(function e(t,n,r){var i,a,s,o,l,u,c,d,h,p,f,m,v=arguments;return g().w(function(e){for(;;)switch(e.n){case 0:return i=!(v.length>3&&void 0!==v[3])||v[3],a=t.connectSettings,s=t.deepChat,o=t.completionsHandlers,l=t.messages,a.method=r,u={body:n,headers:a.headers},e.n=1,Or.processRequestInterceptor(s,u);case 1:if(c=e.v,d=c.body,h=c.headers,p=c.error,f=o.onFinish,!p||!l){e.n=2;break}return e.a(2,Or.onInterceptorError(l,p,f));case 2:return e.n=3,Or.fetch(t,h,i,d).then(function(e){return Or.processResponseByType(e)});case 3:if(!(m=e.v)[F]){e.n=4;break}throw m[F].message;case 4:return e.a(2,m)}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),na=function(){function e(){C(this,e)}return x(e,null,[{key:"storeFiles",value:(s=k(g().m(function e(t,n,r,i){var a,s,o,l,u;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if(a=t.connectSettings.headers){e.n=1;break}return e.a(2);case 1:return t.url=i,s=a[lt],delete a[lt],o=r.map(function(){var e=k(g().m(function e(n){var r;return g().w(function(e){for(;;)if(0===e.n)return r=new FormData,e.a(2,(r.append("purpose","assistants"),r.append("file",n),new Promise(function(e){e(ta(t,r,ft,!1))})))},e)}));return function(t){return e.apply(this,arguments)}}()),e.p=2,e.n=3,Promise.all(o);case 3:return l=e.v.map(function(e){return{id:e.id,name:e.filename}}),e.a(2,(a[lt]=s,l));case 4:throw e.p=4,u=e.v,a[lt]=s,Or.displayError(n,u),t.completionsHandlers.onFinish(),u;case 5:return e.a(2)}},e,null,[[2,4]])})),function(e,t,n,r){return s.apply(this,arguments)})},{key:"getType",value:function(e,t){var n=e[t].path;return!n||n.endsWith("png")?Q:ae}},{key:"getFiles",value:(a=k(g().m(function t(n,r,i,a){var s,o;return g().w(function(t){for(;;)switch(t.n){case 0:return s=r.map(function(e){var t=e.fileId;return n.url="".concat(i).concat(t).concat(a),new Promise(function(e){e(ta(n,void 0,"GET",!1))})}),t.n=1,Promise.all(s);case 1:return o=t.v.map(function(t,n){return new Promise(function(i){var a=new FileReader;a.readAsDataURL(t),a.onload=function(t){i(w(w(w({},X,t.target.result),"name",r[n].name),J,e.getType(r,n)))}})}),t.n=2,Promise.all(o);case 2:return t.a(2,t.v)}},t)})),function(e,t,n,r){return a.apply(this,arguments)})},{key:"getFileName",value:function(e){var t=e.split("/");return t[t.length-1]}},{key:"getFilesAndNewText",value:(i=k(g().m(function t(n,r,i,a,s){var o,l,u,c,d;return g().w(function(t){for(;;)switch(t.n){case 0:if(c=i.getFilesPrefix,d=i.getFilesPostfix,!(r.length>0)){t.n=2;break}return t.n=1,e.getFiles(n,r,c,d);case 1:u=t.v,null!=(o=null==s?void 0:s[B])&&o.value&&u.forEach(function(e,t){var n;if(e[X]){var i=r[t].path;null!=(n=null==s?void 0:s[B])&&n.value&&i&&(s[B].value=s[B].value.replace(i,e[X]))}});case 2:return t.a(2,null!=(l=null==s?void 0:s[B])&&l.value?w(w({},B,s[B].value),ue,a):w(w({},Y,u),ue,a))}},t)})),function(e,t,n,r,a){return i.apply(this,arguments)})},{key:"getFileDetails",value:function(t,n){var r,i=[];return null!=(r=null==n?void 0:n[B])&&r.value&&t.content.forEach(function(t){var n,r;null==(r=null==(n=t[B])?void 0:n.annotations)||r.forEach(function(t){var n;t[B]&&t[B].startsWith("sandbox:")&&null!=(n=t.file_path)&&n.file_id&&i.push({path:t[B],fileId:t.file_path.file_id,name:e.getFileName(t[B])})})}),null!=n&&n.image_file&&i.push({fileId:n.image_file.file_id}),i}},{key:"getFilesAndText",value:(r=k(g().m(function t(n,r,i,a){var s;return g().w(function(t){for(;;)switch(t.n){case 0:return s=e.getFileDetails(r,a),t.n=1,e.getFilesAndNewText(n,s,i,r.role,a);case 1:return t.a(2,t.v)}},t)})),function(e,t,n,i){return r.apply(this,arguments)})},{key:"parseResult",value:function(e,t){var n=[];if(t)n=e.data;else for(var r=0;r<e.data.length;r+=1){var i=e.data[r];if(i.role!==H)break;n.push(i)}return n.reverse()}},{key:"parseMessages",value:function(t,n,r){var i=[];return n.forEach(function(){var n=k(g().m(function n(a){return g().w(function(n){for(;;)switch(n.n){case 0:a.content.filter(function(e){return!!e[B]||!!e.image_file}).sort(function(e){return e[B]?-1:e.image_file?1:0}).forEach(function(){var n=k(g().m(function n(s){return g().w(function(n){for(;;)switch(n.n){case 0:i.push(e.getFilesAndText(t,a,r,s));case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}());case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}()),Promise.all(i)}},{key:"processStreamMessages",value:(n=k(g().m(function t(n,r,i){return g().w(function(t){for(;;)if(0===t.n)return t.a(2,e.parseMessages(n,[{content:r,role:H}],i))},t)})),function(e,t,r){return n.apply(this,arguments)})},{key:"processAPIMessages",value:(t=k(g().m(function t(n,r,i,a){var s;return g().w(function(t){for(;;)if(0===t.n)return s=e.parseResult(r,i),t.a(2,e.parseMessages(n,s,a))},t)})),function(e,n,r,i){return t.apply(this,arguments)})}]);var t,n,r,i,a,s}();na.FILES_WITH_TEXT_ERROR="content with type `text` must have `text` values",na.FUNCTION_TOOL_RESP_ERROR="Response must contain an array of strings for each individual function/tool_call, see ".concat(D,"directConnection/OpenAI/#assistant-functions.");var ra=na,ia=function(e){function t(e,n,r,i,a,s){var o;if(C(this,t),(o=d(this,t,[e,i,a,s])).insertKeyPlaceholderText=o.genereteAPIKeyName("OpenAI"),o.keyHelpUrl=Wi,o.url="",o.permittedErrorPrefixes=[at,"Please send text",Zr.FAILED_ERROR_MESSAGE],o.shouldFetchHistory=!1,o._searchedForThreadId=!1,o._config={},o._newAssistantDetails={model:"gpt-4"},o._waitingForStreamResponse=!1,o._isSSEStream=!1,o.urlSegments=r,"object"==E(n)){o._config=n;var l=o._config,u=l.new_assistant,c=l.thread_id,h=l.load_thread_history;Object.assign(o._newAssistantDetails,u),c&&(o.sessionId=c),h&&(o.shouldFetchHistory=!0)}return o.maxMessages=1,o._isSSEStream=!(!o.stream||"object"==E(o.stream)&&o.stream.simulation),o}return m(t,e),x(t,[{key:"fetchHistoryFunc",value:(f=k(g().m(function e(){var t,n=this;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:return setTimeout(function(){return n.deepChat.disableSubmitButton()},2),e.p=1,e.n=2,this.getThreadMessages(this.sessionId,!0);case 2:return t=e.v,e.a(2,(this.deepChat.disableSubmitButton(!1),t));case 3:return e.p=3,e.v,e.a(2,[w({},F,xe)])}},e,this,[[1,3]])})),function(){return f.apply(this,arguments)})},{key:"processMessage",value:function(e,n){var r=this.totalMessagesMaxCharLength||-1,i=Xr.getCharacterLimitMessages(e,r)[0];if(n&&n.length>0){var a=this.filesToolType;if("function"==typeof this.filesToolType){var s=this.filesToolType(n.map(function(e){return e.name}));"code_interpreter"===s||"file_search"===s||s===$?a=s:(console[F]('Tool type "'.concat(s,'" is not valid')),console[F]('Expected "code_interpreter" or "file_search" or "images". Going to default to "images"'))}if("file_search"===a)return t.processAttachmentsMessage(i,n,"file_search");if("code_interpreter"===a)return t.processAttachmentsMessage(i,n,"code_interpreter");if(n.find(function(e){var t=e.name;return!vr.isImageFileExtension(t)}))console[F]("The uploaded files contained a non-image file"),console[F]('Make sure only images can be uploaded or define a "code_interpreter" or "file_search" value in the "files_tool_type" property'),console.warn('Make sure your existing assistant supports these "tools" or specify them in the "new_assistant" property');else{var o=t.processImageMessage(i,n);if(o)return o}}return w({content:i[B]||""},ue,U)}},{key:"createNewThreadMessages",value:function(e,t,n){var r=ce(e),i=this.processMessage(t,n);return r.thread={messages:[i]},r}},{key:"callService",value:function(e,t,n){if(this.messages=e,this.sessionId){this.url="".concat(this.urlSegments.threadsPrefix,"/").concat(this.sessionId,"/messages").concat(this.urlSegments.createMessagePostfix);var r=this.processMessage(t,n);Vr.request(this,r,e)}else{this.url="".concat(this.urlSegments.threadsPrefix,"/runs").concat(this.urlSegments.threadsPosfix);var i=this.createNewThreadMessages(this.rawBody,t,n);this._isSSEStream?this.createStreamRun(i):Vr.request(this,i,e)}}},{key:"callServiceAPI",value:(p=k(g().m(function e(t,n,r){var i,a,s,o,l;return g().w(function(e){for(;;)switch(e.n){case 0:if(this._waitingForStreamResponse=!1,this.connectSettings){e.n=1;break}throw new Error(be);case 1:if(null===(i=(a=this.rawBody).assistant_id)||void 0===i){e.n=2;break}e.n=5;break;case 2:if(o=this._config.assistant_id){e.n=4;break}return e.n=3,this.createNewAssistant();case 3:o=e.v;case 4:a.assistant_id=o;case 5:if(this._searchedForThreadId||this.searchPreviousMessagesForThreadId(t.messageToElements),!r){e.n=7;break}return e.n=6,ra.storeFiles(this,t,r,this.urlSegments.storeFiles);case 6:l=e.v,e.n=8;break;case 7:l=void 0;case 8:s=l,this.connectSettings.method=ft,this.callService(t,n,s);case 9:return e.a(2)}},e,this)})),function(e,t,n){return p.apply(this,arguments)})},{key:"createNewAssistant",value:(h=k(g().m(function e(){var t,n;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,this.url=this.urlSegments.newAssistantUrl,e.n=1,ta(this,ce(this._newAssistantDetails),ft);case 1:return t=e.v,e.a(2,(this._config.assistant_id=t.id,this._config.assistant_id));case 2:e.p=2,n=e.v,console[F](n),console[F]("Failed to create a new assistant");case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return h.apply(this,arguments)})},{key:"searchPreviousMessagesForThreadId",value:function(e){var t=e.find(function(e){return o(e,1)[0]._sessionId});t&&(this.sessionId=t[0]._sessionId),this._searchedForThreadId=!0}},{key:"extractResultData",value:(c=k(g().m(function e(t){var n,r,i;return g().w(function(e){for(;;)switch(e.n){case 0:if(!(this._waitingForStreamResponse||this._isSSEStream&&this.sessionId)){e.n=2;break}return e.n=1,this.handleStream(t);case 1:return e.a(2,e.v);case 2:if(!t[F]){e.n=3;break}throw t[F].message.startsWith(ra.FILES_WITH_TEXT_ERROR)?Error("Please send text with your file(s)"):t[F].message;case 3:return this.asyncCallInProgress=!0,e.n=4,this.assignThreadAndRun(t);case 4:return r="".concat(this.urlSegments.threadsPrefix,"/").concat(this.sessionId,"/runs/").concat(this.run_id).concat(this.urlSegments.threadsPosfix),i={method:pt,headers:null==(n=this.connectSettings)?void 0:n.headers},e.a(2,(Vr.executePollRequest(this,r,i,this.messages),w({},B,"")))}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"assignThreadAndRun",value:(u=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!this.sessionId){e.n=2;break}return this.url="".concat(this.urlSegments.threadsPrefix,"/").concat(this.sessionId,"/runs").concat(this.urlSegments.threadsPosfix),e.n=1,ta(this,ce(this.rawBody),ft);case 1:n=e.v,this.run_id=n.id,e.n=3;break;case 2:this.sessionId=t.thread_id,this.run_id=t.id,this.updateSessionId(this.sessionId);case 3:return e.a(2)}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"getThreadMessages",value:(l=k(g().m(function e(t){var n,r,i,a,s=arguments;return g().w(function(e){for(;;)switch(e.n){case 0:return n=s.length>1&&void 0!==s[1]&&s[1],this.url="".concat(this.urlSegments.threadsPrefix,"/").concat(t,"/messages?").concat(this.urlSegments.listMessagesPostfix),e.n=1,ta(this,{},pt);case 1:if(a=e.v,n||!this.deepChat.responseInterceptor){e.n=3;break}return e.n=2,null==(i=(r=this.deepChat).responseInterceptor)?void 0:i.call(r,a);case 2:a=e.v;case 3:return e.a(2,ra.processAPIMessages(this,a,n,this.urlSegments))}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"extractPollResultData",value:(s=k(g().m(function e(n){var r,i,a,s,o,l,u,c,d=this;return g().w(function(e){for(;;)switch(e.n){case 0:if(i=n.status,a=n.required_action,"queued"!==i&&"in_progress"!==i){e.n=1;break}return e.a(2,{timeoutMS:t.POLLING_TIMEOUT_MS});case 1:if(i!==dt||!this.messages){e.n=3;break}return e.n=2,this.getThreadMessages(n.thread_id);case 2:return s=e.v,o=s.shift(),l=o.text,u=o.files,e.a(2,(setTimeout(function(){s.forEach(function(e){return d.deepChat.addMessage(e)})}),w({text:l,_sessionId:this.sessionId},Y,u)));case 3:if(c=null==(r=null==a?void 0:a.submit_tool_outputs)?void 0:r.tool_calls,"requires_action"!==i||!c){e.n=5;break}return e.n=4,this.handleTools(c);case 4:return e.a(2,e.v);case 5:throw Error("Thread run status: ".concat(i));case 6:return e.a(2)}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"handleTools",value:(a=k(g().m(function e(n){var r,i,a,s,o,l;return g().w(function(e){for(;;)switch(e.n){case 0:if(this._functionHandlerI){e.n=1;break}throw Error(Ce);case 1:return r=n.map(function(e){return{name:e.function.name,arguments:e.function.arguments}}),e.n=2,this._functionHandlerI(r);case 2:if(i=e.v,Array.isArray(i)&&n.length===i.length){e.n=3;break}throw Error(ra.FUNCTION_TOOL_RESP_ERROR);case 3:return e.n=4,Promise.all(i);case 4:if(!(a=e.v).find(function(e){return"string"!=typeof e})){e.n=5;break}throw Error(ra.FUNCTION_TOOL_RESP_ERROR);case 5:if(s=a.map(function(e,t){return{tool_call_id:n[t].id,output:e}}),o="".concat(this.urlSegments.threadsPrefix,"/").concat(this.sessionId),l="/runs/".concat(this.run_id,"/submit_tool_outputs").concat(this.urlSegments.threadsPosfix),this.url="".concat(o).concat(l),!this._isSSEStream){e.n=7;break}return e.n=6,this.createStreamRun({tool_outputs:s});case 6:e.n=8;break;case 7:return e.n=8,ta(this,{tool_outputs:s},ft);case 8:return e.a(2,{timeoutMS:t.POLLING_TIMEOUT_MS})}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"handleStream",value:(i=k(g().m(function e(t){var n,r,i,a;return g().w(function(e){for(;;)switch(e.n){case 0:if(i=null==(r=null==(n=t.required_action)?void 0:n.submit_tool_outputs)?void 0:r.tool_calls,"requires_action"!==t.status||!i){e.n=2;break}return this.run_id=t.id,e.n=1,this.handleTools(i);case 1:return e.a(2,e.v);case 2:if(!this._waitingForStreamResponse){e.n=3;break}return e.a(2,this.parseStreamResult(t));case 3:return this._isSSEStream&&this.sessionId&&(this.asyncCallInProgress=!0,this.url="".concat(this.urlSegments.threadsPrefix,"/").concat(this.sessionId,"/runs").concat(this.urlSegments.threadsPosfix),a=ce(this.rawBody),this.createStreamRun(a)),e.a(2,w({},B,""))}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"parseStreamResult",value:(r=k(g().m(function e(t){var n,r,i,a,s,o,l,u,c,d;return g().w(function(e){for(;;)switch(e.n){case 0:if(!(t.content&&t.content.length>0&&this.messages)){e.n=1;break}if(o=t.content.find(function(e){return e[B]}),!(null!=(n=null==o?void 0:o[B])&&n.annotations&&o[B].annotations.length>0)){e.n=1;break}return l=t.content.find(function(e){return!!e[B]})||t.content[0],u=ra.getFilesAndText.bind(this,this,w(w({},ue,H),"content",t.content),this.urlSegments,l),e.a(2,(null==(r=this._messageStream)||r.endStreamAfterFileDownloaded(this.messages,u),w({},B,"")));case 1:if(null==(i=t.delta)||!i.content){e.n=4;break}if(!(t.delta.content.length>1)){e.n=3;break}if(c=t.delta.content.find(function(e){return e[B]}),null==(a=null==c?void 0:c[B])||!a.annotations||0!==c[B].annotations.length){e.n=3;break}return e.n=2,ra.processStreamMessages(this,t.delta.content,this.urlSegments);case 2:return d=e.v,e.a(2,w(w({},B,d[0][B]),Y,d[1][Y]));case 3:return e.a(2,w({},B,null==(s=t.delta.content[0][B])?void 0:s.value));case 4:return e.a(2,(!this.sessionId&&t.thread_id&&(this.sessionId=t.thread_id),w({},B,"")))}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"createStreamRun",value:(n=k(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:return t.stream=!0,this._waitingForStreamResponse=!0,e.n=1,qr.request(this,t,this.messages,!0,!0);case 1:this._messageStream=e.v;case 2:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})}],[{key:"processImageMessage",value:function(e,t){var n=null==t?void 0:t.filter(function(e){return vr.isImageFileExtension(e.name)}).map(function(e){return w(w({},J,"image_file"),"image_file",{file_id:e.id})});if(n&&n.length>0)return e[B]&&e[B].length>0&&n.push(w(w({},J,B),B,e[B])),w({content:n},ue,U)}},{key:"processAttachmentsMessage",value:function(e,t,n){return w({attachments:t.map(function(e){return{tools:[w({},J,n)],file_id:e.id}}),content:[w(w({},J,B),B,e[B])]},ue,U)}}]);var n,r,i,a,s,l,u,c,h,p,f}($r);ia.POLLING_TIMEOUT_MS=500;var aa=ia,sa=function(e){function t(e){var n,r,i,a,s,o,l,u;C(this,t);var c=ce(e.directConnection),p=c.openAI,f=null==(a=c.openAI)?void 0:a.assistant,m=t.buildUrlSegments(f);if(null!==(n=(s=(i=d(this,t,[e,f,m,ea(),Qi,p])).connectSettings).headers)&&void 0!==n||(s.headers={}),null!==(r=(o=i.connectSettings.headers)["OpenAI-Beta"])&&void 0!==r||(o["OpenAI-Beta"]="assistants=v2"),i.shouldFetchHistory&&i.sessionId&&(i.fetchHistory=i.fetchHistoryFunc.bind(h(i))),E(f)===ct){var v=null==(u=null==(l=e.directConnection)?void 0:l.openAI)?void 0:u.assistant,g=v.function_handler,y=v.files_tool_type;g&&(i._functionHandlerI=g),y&&(i.filesToolType=y)}return i}return m(t,e),x(t,null,[{key:"buildUrlSegments",value:function(e){var t="object"==E(e)&&e.custom_base_url||Gi;return{threadsPrefix:"".concat(t,"/threads"),threadsPosfix:"",newAssistantUrl:"".concat(t,"/assistants"),createMessagePostfix:"",listMessagesPostfix:"order=desc",storeFiles:"".concat(t,"/").concat(Y),getFilesPrefix:"".concat(t,"/").concat(Y,"/"),getFilesPostfix:"/content"}}}])}(aa),oa="Please define the Azure URL Details. [More Information](".concat(D,"directConnection/Azure)"),la=function(e){return w({"api-key":e},lt,ut)},ua=function(e){return hi("".concat(e.endpoint,"/openai/models?api-version=").concat(e.version),pt,$i)},ca=function(e){var t=e.endpoint,n=e.version,r=e.deploymentId;return t&&n&&r},da=function(e){function t(e){var n,r,i,a,s,o,l,u,c,h;C(this,t);var p=ce(e.directConnection),f=p.azure,m=null==(i=p.azure)?void 0:i.openAI,v=(null==m?void 0:m.urlDetails)||{},g="".concat(null==(a=null==m?void 0:m.urlDetails)?void 0:a.endpoint,"/openai/"),y="?api-version=".concat(null==(s=null==m?void 0:m.urlDetails)?void 0:s.version),b={threadsPrefix:"".concat(g).concat(t.THREAD_RESOURCE),threadsPosfix:y,newAssistantUrl:"".concat(g).concat(t.NEW_ASSISTANT_RESOURCE).concat(y),createMessagePostfix:y,listMessagesPostfix:"order=desc&api-version=".concat(null==(o=null==m?void 0:m.urlDetails)?void 0:o.version),storeFiles:"".concat(g).concat(Y).concat(y),getFilesPrefix:"".concat(g).concat(Y,"/"),getFilesPostfix:"/content".concat(y)};if((r=d(this,t,[e,null==m?void 0:m.assistant,b,ua(v),la,f])).permittedErrorPrefixes=[oa],r.insertKeyPlaceholderText=r.genereteAPIKeyName("Azure OpenAI"),r.keyHelpUrl="https://learn.microsoft.com/en-us/answers/questions/1193991/how-to-get-the-value-of-openai-api-key",r.isTextInputDisabled=!1,E(null==m?void 0:m.assistant)===ct){var k=null==(c=null==(u=null==(l=e.directConnection)?void 0:l.azure)?void 0:u.openAI)?void 0:c.assistant,_=k.function_handler,S=k.files_tool_type;_&&(r._functionHandlerI=_),S&&(r.filesToolType=S)}return ca(v)?null!==(n=(h=r.connectSettings).headers)&&void 0!==n||(h.headers={}):(r.isTextInputDisabled=!0,r.canSendMessage=function(){return!1},setTimeout(function(){e.addMessage(w({},F,oa))})),r}return m(t,e),x(t)}(aa);da.THREAD_RESOURCE="threads",da.NEW_ASSISTANT_RESOURCE="assistants";var ha=da,pa=function(){function e(){C(this,e)}return x(e,null,[{key:"addAttributes",value:function(e){e[ue]="button",e.setAttribute("tabindex","0")}},{key:"addAriaBusy",value:function(e){e.setAttribute("aria-busy","true")}},{key:"removeAriaBusy",value:function(e){e.removeAttribute("aria-busy")}},{key:"addAriaDisabled",value:function(e){e.setAttribute("aria-".concat(Fe),"true")}},{key:"removeAriaDisabled",value:function(e){e.removeAttribute("aria-".concat(Fe))}},{key:"removeAriaAttributes",value:function(t){e.removeAriaBusy(t),e.removeAriaDisabled(t)}}])}(),fa='<?xml version="1.0" encoding="iso-8859-1"?>\n<svg height="1.4em" width="1.4em" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t viewBox="0 0 490.9 490.9" xml:space="preserve">\n\t<g>\n\t\t<g>\n\t\t\t<path d="M245.5,322.9c53,0,96.2-43.2,96.2-96.2V96.2c0-53-43.2-96.2-96.2-96.2s-96.2,43.2-96.2,96.2v130.5\n\t\t\t\tC149.3,279.8,192.5,322.9,245.5,322.9z M173.8,96.2c0-39.5,32.2-71.7,71.7-71.7s71.7,32.2,71.7,71.7v130.5\n\t\t\t\tc0,39.5-32.2,71.7-71.7,71.7s-71.7-32.2-71.7-71.7V96.2z"/>\n\t\t\t<path d="M94.4,214.5c-6.8,0-12.3,5.5-12.3,12.3c0,85.9,66.7,156.6,151.1,162.8v76.7h-63.9c-6.8,0-12.3,5.5-12.3,12.3\n\t\t\t\ts5.5,12.3,12.3,12.3h152.3c6.8,0,12.3-5.5,12.3-12.3s-5.5-12.3-12.3-12.3h-63.9v-76.7c84.4-6.3,151.1-76.9,151.1-162.8\n\t\t\t\tc0-6.8-5.5-12.3-12.3-12.3s-12.3,5.5-12.3,12.3c0,76.6-62.3,138.9-138.9,138.9s-138.9-62.3-138.9-138.9\n\t\t\t\tC106.6,220,101.2,214.5,94.4,214.5z"/>\n\t\t</g>\n\t</g>\n</svg>\n',ma=function(){function e(){C(this,e)}return x(e,null,[{key:"createTextElement",value:function(t){var n=R();return n[M].add(e.INPUT_BUTTON_INNER_TEXT_CLASS),n.innerText=t,n}},{key:"tryAddSVGElement",value:function(e,t,n,r){n?e.push(ri.createSVGElement(n)):""!==n&&r&&e.push(t)}},{key:"createCustomElements",value:function(t,n,r){var i,a,s=null==r?void 0:r[t],o=null==(i=null==s?void 0:s[B])?void 0:i.content,l=null==(a=null==s?void 0:s.svg)?void 0:a.content,u=[];return e.tryAddSVGElement(u,n,l,o),o&&u.push(e.createTextElement(o)),u.length>0?u:void 0}},{key:"reassignClassBasedOnChildren",value:function(t,n){t[M].remove(e.INPUT_BUTTON_SVG_CLASS,e.INPUT_BUTTON_SVG_TEXT_CLASS),n.find(function(t){return t[M].contains(e.INPUT_BUTTON_INNER_TEXT_CLASS)})?n.length>1&&t[M].add(e.INPUT_BUTTON_SVG_TEXT_CLASS):t[M].add(e.INPUT_BUTTON_SVG_CLASS)}}])}();ma.INPUT_BUTTON_SVG_TEXT_CLASS="input-button-svg-text",ma.INPUT_BUTTON_INNER_TEXT_CLASS="text-button",ma.INPUT_BUTTON_SVG_CLASS="input-button-svg";var va=ma,ga=function(){return x(function e(){C(this,e)},null,[{key:"parseSVGTextElements",value:function(e){return w({svg:e.find(function(e){return"svg"===e.tagName.toLowerCase()})},B,e.find(function(e){return"div"===e.tagName.toLowerCase()}))}}])}(),ya=function(){function e(){C(this,e)}return x(e,null,[{key:"unsetAllCSS",value:function(e,t){var n,r;t.container&&De.unsetAllCSSMouseStates(e,t.container);var i=ga.parseSVGTextElements(Array.from(e.children)),a=i.svg,s=i.text;null!=(n=t.svg)&&n.styles&&a&&De.unsetAllCSSMouseStates(a,t.svg.styles),null!=(r=t[B])&&r.styles&&s&&De.unsetAllCSSMouseStates(s,t[B].styles)}},{key:"unsetActionCSS",value:function(e,t){var n,r;t.container&&De.unsetActivityCSSMouseStates(e,t.container);var i=ga.parseSVGTextElements(Array.from(e.children)),a=i.svg,s=i.text;null!=(n=t.svg)&&n.styles&&a&&De.unsetActivityCSSMouseStates(a,t.svg.styles),null!=(r=t[B])&&r.styles&&s&&De.unsetActivityCSSMouseStates(s,t[B].styles)}},{key:"setElementsCSS",value:function(e,t,n){var r,i,a,s,o;Object.assign(e[I],null==(r=t.container)?void 0:r[n]);var l=ga.parseSVGTextElements(Array.from(e.children)),u=l.svg,c=l.text;u&&Object.assign(u[I],null==(a=null==(i=t.svg)?void 0:i.styles)?void 0:a[n]),c&&Object.assign(c[I],null==(o=null==(s=t[B])?void 0:s.styles)?void 0:o[n])}},{key:"setElementCssUpToState",value:function(t,n,r){e.setElementsCSS(t,n,Oe),r!==Oe&&(e.setElementsCSS(t,n,Le),r!==Le&&e.setElementsCSS(t,n,Be))}}])}(),ba=function(){return x(function e(t,n,r,i,a,s){C(this,e),this._mouseState={state:"default"},this.isCustom=!1,pa.addAttributes(t),this.elementRef=t,this.svg=ri.createSVGElement(n),this.customStyles=a,this.position=Ct.processPosition(r),this._tooltipSettings=i,this.dropupText=s},[{key:"buttonMouseLeave",value:function(e){var t;this._mouseState.state=Oe,"visible"===(null==(t=this._activeTooltip)?void 0:t.element[I].visibility)&&this._tooltipSettings&&Ge.hide(this._activeTooltip,this._tooltipSettings),e&&(ya.unsetAllCSS(this.elementRef,e),ya.setElementsCSS(this.elementRef,e,Oe))}},{key:"buttonMouseEnter",value:function(e){var t;this._mouseState.state=Le,this._tooltipSettings&&(this._activeTooltip=Ge.display(this.elementRef,this._tooltipSettings,null==(t=this._activeTooltip)?void 0:t.element)),e&&ya.setElementsCSS(this.elementRef,e,Le)}},{key:"buttonMouseUp",value:function(e){e&&ya.unsetActionCSS(this.elementRef,e),this.buttonMouseEnter(e)}},{key:"buttonMouseDown",value:function(e){this._mouseState.state=Be,e&&ya.setElementsCSS(this.elementRef,e,Be)}},{key:"setEvents",value:function(e){this.elementRef.onmousedown=this.buttonMouseDown.bind(this,e),this.elementRef.onmouseup=this.buttonMouseUp.bind(this,e),this.elementRef.onmouseenter=this.buttonMouseEnter.bind(this,e),this.elementRef.onmouseleave=this.buttonMouseLeave.bind(this,e)}},{key:"unsetCustomStateStyles",value:function(e){if(this.customStyles)for(var t=0;t<e.length;t+=1){var n=e[t],r=n&&this.customStyles[n];r&&ya.unsetActionCSS(this.elementRef,r)}}},{key:"reapplyStateStyle",value:function(e,t){if(this.customStyles){t&&this.unsetCustomStateStyles(t);var n=this.customStyles[e];n&&ya.setElementCssUpToState(this.elementRef,n,this._mouseState.state),this.setEvents(n)}}},{key:"changeElementsByState",value:function(e){var t;(t=this.elementRef).replaceChildren.apply(t,l(e)),va.reassignClassBasedOnChildren(this.elementRef,e)}},{key:"buildDefaultIconElement",value:function(e){var t=this.svg.cloneNode(!0);return t.id=e,[t]}},{key:"createInnerElements",value:function(e,t,n){var r=va.createCustomElements(t,this.svg,n);if(r&&r.length>0){if(this.position===Pe){var i=this.svg.cloneNode(!0);i.id=r[0]===this.svg?e:"dropup-menu-item-icon-element-custom",r[0]=i}return r}return this.buildDefaultIconElement(e)}}])}(),ka=function(e){function t(e){var n,r,i;C(this,t);var a=(null==(i=null==(r=null==e?void 0:e[Oe])?void 0:r.svg)?void 0:i.content)||t.EMPTY_SVG;return(n=d(this,t,[R(),a,void 0,void 0,e])).isActive=!1,n._innerElements=n.createInnerElementsForStates(n.customStyles),n.changeToDefault(),n}return m(t,e),x(t,[{key:"createInnerElementsForStates",value:function(e){return w(w(w({},Oe,this.createInnerButtonElements(Oe,e)),Ne,this.createInnerButtonElements(Ne,e)),"unavailable",this.createInnerButtonElements("unavailable",e))}},{key:"createInnerButtonElements",value:function(e,t){return va.createCustomElements(e,this.svg,t)||[this.svg]}},{key:"changeState",value:function(e){this.changeElementsByState(e),this.elementRef[M].replace(va.INPUT_BUTTON_SVG_CLASS,"deep-chat-openai-realtime-button")}},{key:"changeToActive",value:function(){this.changeState(this._innerElements[Ne]),this.reapplyStateStyle(Ne,["unavailable",Oe]),this.isActive=!0}},{key:"changeToDefault",value:function(){var e,t,n,r;this.changeState(this._innerElements[Oe]),null!=(e=this.customStyles)&&e[Ne]&&ya.unsetAllCSS(this.elementRef,null==(t=this.customStyles)?void 0:t[Ne]),null!=(n=this.customStyles)&&n.unavailable&&ya.unsetAllCSS(this.elementRef,null==(r=this.customStyles)?void 0:r.unavailable),this.reapplyStateStyle(Oe,[Ne,"unavailable"]),this.isActive=!1}},{key:"changeToUnavailable",value:function(){var e,t,n,r;this.changeState(this._innerElements.unavailable),null!=(e=this.customStyles)&&e[Ne]&&ya.unsetAllCSS(this.elementRef,null==(t=this.customStyles)?void 0:t[Ne]),null!=(n=this.customStyles)&&n[Oe]&&ya.unsetAllCSS(this.elementRef,null==(r=this.customStyles)?void 0:r[Oe]),this.reapplyStateStyle("unavailable",[Oe,Ne]),this.isActive=!1}}])}(ba);ka.EMPTY_SVG='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"></svg>';var _a=ka,Sa=function(){function e(){C(this,e)}return x(e,null,[{key:"setPropertyValueIfDoesNotExist",value:function(t,n,r){var i,a,s=n[0];1===n.length?null!==(i=t[s])&&void 0!==i||(t[s]=r):(null!==(a=t[s])&&void 0!==a||(t[s]={}),n.shift(),e.setPropertyValueIfDoesNotExist(t[s],n,r))}},{key:"setPropertyValue",value:function(t,n,r){var i,a=n[0];1===n.length?t[a]=r:(null!==(i=t[a])&&void 0!==i||(t[a]={}),n.shift(),e.setPropertyValue(t[a],n,r))}},{key:"getObjectValue",value:function(t,n){var r=t[n[0]];return void 0===r||1===n.length?r:e.getObjectValue(r,n.slice(1))}},{key:"overwritePropertyObjectFromAnother",value:function(t,n,r){var i=e.getObjectValue(n,r);if(i){var a=S(S({},i),e.getObjectValue(t,r)||{});e.setPropertyValue(t,r,a)}}},{key:"isJson",value:function(e){try{return JSON.stringify(e),!0}catch(t){return!1}}},{key:"assignPropertyFromOneToAnother",value:function(e,t,n){var r;null!==(r=t[e])&&void 0!==r||(t[e]={}),Object.assign(t[e],null==n?void 0:n[e])}}])}(),wa='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5.92 24.096q0 1.088 0.928 1.728 0.512 0.288 1.088 0.288 0.448 0 0.896-0.224l16.16-8.064q0.48-0.256 0.8-0.736t0.288-1.088-0.288-1.056-0.8-0.736l-16.16-8.064q-0.448-0.224-0.896-0.224-0.544 0-1.088 0.288-0.928 0.608-0.928 1.728v16.16z"></path>\n</svg>',Ea='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n<path d="M5.92 24.096q0 0.832 0.576 1.408t1.44 0.608h16.128q0.832 0 1.44-0.608t0.576-1.408v-16.16q0-0.832-0.576-1.44t-1.44-0.576h-16.128q-0.832 0-1.44 0.576t-0.576 1.44v16.16z"></path>\n</svg>',Ca=function(e){function t(e){var n,r,i,a,s,o,l;C(this,t);var u=ce(e.directConnection),c=t.getKey(e);(r=d(this,t,[e,ea(),Qi,{key:c}])).insertKeyPlaceholderText=r.genereteAPIKeyName("OpenAI"),r.keyHelpUrl=Wi,r._microphoneButton=null,r._toggleButton=null,r._errorElement=null,r._loadingElement=null,r._pc=null,r._mediaStream=null,r._isMuted=!1;var h=null==(i=u.openAI)?void 0:i.realtime;if(E(h)===ct){r._avatarConfig=h.avatar,r._ephemeralKey=h.ephemeralKey,r._errorConfig=h[F],r._loadingConfig=h.loading,Object.assign(r.rawBody,h.config);var p=null==(s=null==(a=e.directConnection)?void 0:a.openAI)?void 0:s.realtime,f=(p.config||{}).function_handler;f&&(r._functionHandlerI=f),r._events=h.events,p.methods=r.generateMethods(),r.setInputAudioTranscribe(e,null==(o=p.config)?void 0:o.input_audio_transcription)}return null!==(n=(l=r.rawBody).model)&&void 0!==n||(l.model="gpt-4o-realtime-preview-2025-06-03"),r._avatarConfig=t.buildAvatarConfig(h),r._buttonsConfig=t.buildButtonsConfig(h),r._avatarEl=t.createAvatar(r._avatarConfig),r._containerEl=r.createContainer(),r._deepChat=e,r}return m(t,e),x(t,[{key:"setInputAudioTranscribe",value:function(e,t){if(t){var n="whisper-1";"object"==E(t)?this.rawBody.input_audio_transcription={model:t.model||n,language:t.language,prompt:t.prompt}:this.rawBody.input_audio_transcription={model:n}}else e.onMessage&&(console.warn("To get user audio transcription, set `input_audio_transcription` in the `realtime` config."),console.warn("See: ".concat(D,"directConnection/OpenAI/OpenAIRealtime#OpenAIRealtimeConfig")))}},{key:"setUpView",value:function(e,t){e[I].display="none",t.appendChild(this._containerEl),this.setup()}},{key:"setup",value:(s=k(g().m(function e(){var t,n,r,i;return g().w(function(e){for(;;)switch(e.n){case 0:if(n=null==(t=this._deepChat.directConnection)?void 0:t.openAI){e.n=1;break}return e.a(2);case 1:if("object"==E(r=null==n?void 0:n.realtime)&&(r.autoStart||r.autoFetchEphemeralKey)){e.n=2;break}return e.a(2);case 2:i=this.key||n.key,(r.fetchEphemeralKey||i)&&r.autoStart&&(this.changeToUnavailable(),this.displayLoading()),this.fetchEphemeralKey(r.autoStart);case 3:return e.a(2)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"fetchEphemeralKey",value:(a=k(g().m(function e(t){var n,r,i,a,s,o,l,u;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=null==(n=this._deepChat.directConnection)?void 0:n.openAI,i="object"==E(null==r?void 0:r.realtime)?null==r?void 0:r.realtime.fetchEphemeralKey:void 0,a=null==r?void 0:r.realtime,s=this.key||r.key,"object"!=E(a)){e.n=8;break}if(this._ephemeralKey){e.n=7;break}if(e.p=1,!i){e.n=3;break}return(o=i()).then&&(this._retrievingEphemeralKey=o),e.n=2,o;case 2:this._ephemeralKey=e.v,e.n=5;break;case 3:if(!s){e.n=5;break}return this._retrievingEphemeralKey=this.getEphemeralKey(s),e.n=4,this._retrievingEphemeralKey;case 4:this._ephemeralKey=e.v;case 5:e.n=7;break;case 6:e.p=6,l=e.v,this.displayFailedToRetrieveEphemeralKey(l);case 7:this._ephemeralKey&&(t?this.init(this._ephemeralKey):this.changeToAvailable()),e.n=12;break;case 8:if(!s){e.n=12;break}return e.p=9,this._retrievingEphemeralKey=this.getEphemeralKey(s),e.n=10,this._retrievingEphemeralKey;case 10:this._ephemeralKey=e.v,t&&this.init(this._ephemeralKey),e.n=12;break;case 11:e.p=11,u=e.v,this.displayFailedToRetrieveEphemeralKey(u);case 12:return e.a(2)}},e,this,[[9,11],[1,6]])})),function(e){return a.apply(this,arguments)})},{key:"getEphemeralKey",value:(i=k(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("".concat(Gi,"realtime/sessions"),{method:ft,body:JSON.stringify(this.rawBody),headers:w(w({},lt,ut),tt,"".concat(ht).concat(t))});case 1:return e.n=2,e.v.json();case 2:return e.a(2,e.v.client_secret.value)}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"generateMethods",value:function(){var e=this;return{updateConfig:function(t){var n;null==(n=e._dc)||n.send(JSON.stringify(w(w({},J,"session.update"),"session",t)))},sendMessage:function(t,n){var r=n||"system",i=[w(w({},J,"system"===r||r===U?Ki:B),"text",t)],a=w(w(w({},ue,r),J,"message"),"content",i);e.sendMessage(a)}}}},{key:"createContainer",value:function(){var e=R();return e.id="deep-chat-openai-realtime-container",e.appendChild(this.createAvatarContainer()),e.appendChild(this.createButtonsContainer()),e.appendChild(this.createError()),e}},{key:"createAvatarContainer",value:function(){var e,t,n=R();return n.id="deep-chat-openai-realtime-avatar-container",Object.assign(n[I],null==(t=null==(e=this._avatarConfig)?void 0:e.styles)?void 0:t.container),n.appendChild(this._avatarEl),n}},{key:"createButtonsContainer",value:function(){var e,n=R();n.id="deep-chat-openai-realtime-buttons-container",Object.assign(n[I],null==(e=this._buttonsConfig)?void 0:e.container),this._microphoneButton=this.createMicophoneButton();var r=t.createButtonContainer(this._microphoneButton.elementRef);this._toggleButton=this.createToggleButton();var i=t.createButtonContainer(this._toggleButton.elementRef);return n.appendChild(r),n.appendChild(i),n.appendChild(this.createLoading()),n}},{key:"createMicophoneButton",value:function(){var e,n=this,r=new _a(null==(e=this._buttonsConfig)?void 0:e[re]);return r.elementRef[M].add(t.BUTTON_DEFAULT,"deep-chat-openai-realtime-microphone"),kt.assignButtonEvents(r.elementRef,function(){r.isActive?(n.toggleMicorphone(!0),r.elementRef[M].replace(t.MICROPHONE_ACTIVE,t.BUTTON_DEFAULT),r.changeToDefault(),n._isMuted=!1):(n.toggleMicorphone(!1),r.elementRef[M].replace(t.BUTTON_DEFAULT,t.MICROPHONE_ACTIVE),pa.removeAriaAttributes(r.elementRef),r.changeToActive(),n._isMuted=!0)}),r}},{key:"toggleMicorphone",value:function(e){var t;null==(t=this._mediaStream)||t.getAudioTracks().forEach(function(t){return t.enabled=e})}},{key:"createToggleButton",value:function(){var e,n=this,r=new _a(null==(e=this._buttonsConfig)?void 0:e.toggle);return r.elementRef[M].add(t.BUTTON_DEFAULT,"deep-chat-openai-realtime-toggle"),kt.assignButtonEvents(r.elementRef,k(g().m(function e(){var t,i,a;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!r.isActive){e.n=1;break}r.changeToDefault(),n.stop(),e.n=9;break;case 1:if(e.p=1,!n._ephemeralKey){e.n=3;break}return n.displayLoading(),e.n=2,n.init(n._ephemeralKey);case 2:e.n=7;break;case 3:if(!n._retrievingEphemeralKey){e.n=6;break}return n.displayLoading(),e.n=4,n._retrievingEphemeralKey;case 4:if(i=e.v,!(null!=(t=n._toggleButton)&&t.isActive)){e.n=5;break}return e.n=5,n.init(i);case 5:e.n=7;break;case 6:return n.displayLoading(),e.n=7,n.fetchEphemeralKey(!0);case 7:e.n=9;break;case 8:e.p=8,a=e.v,console[F]("Failed to start conversation:",a),n.displayError(),n.hideLoading();case 9:return e.a(2)}},e,null,[[1,8]])}))),r}},{key:"init",value:(r=k(g().m(function e(t){var n,r,i,a,s,o,l,u,c,d,h,p,f,m=this;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=new RTCPeerConnection,this._pc=n,(r=R(ne)).autoplay=!0,i=new AudioContext,(a=i.createAnalyser()).fftSize=256,s=new Uint8Array(a.frequencyBinCount),this._pc.ontrack=function(){var e=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t.streams[0]){e.n=2;break}if(r.srcObject=t.streams[0],n=i.createMediaStreamSource(t.streams[0]),"suspended"!==i.state){e.n=1;break}return e.n=1,i.resume();case 1:n.connect(a),m.monitorFrequencies(a,s),e.n=3;break;case 2:console[F]("No streams found in the ontrack event."),m.displayError();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),e.n=1,navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){var t;n===m._pc&&(m._mediaStream=e,null==(t=m._pc)||t.addTrack(m._mediaStream.getTracks()[0]),m._isMuted&&m.toggleMicorphone(!1))}).catch(function(e){console[F]("Error accessing microphone:",e),m.displayError()});case 1:return this._dc=this._pc.createDataChannel("oai-events"),this._dc.addEventListener("message",function(){var e=k(g().m(function e(t){var n,r,i,a,s,o,l,u;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if("session.created"!==(a=JSON.parse(t.data)).type){e.n=1;break}m.removeUnavailable(),m._toggleButton&&(pa.removeAriaAttributes(m._toggleButton.elementRef),m._toggleButton.changeToActive()),null==(r=null==(n=m._events)?void 0:n.started)||r.call(n),m._deepChat.dispatchEvent(new CustomEvent("sts-session-started")),m.hideLoading(),e.n=7;break;case 1:if("response.done"!==a.type){e.n=6;break}if((null==(s=null==(i=JSON.parse(t.data).response.output)?void 0:i[0])?void 0:s.type)!==vt){e.n=5;break}return o=s.name,l=s.call_id,e.p=2,e.n=3,m.handleTool(o,s.arguments,l);case 3:e.n=5;break;case 4:e.p=4,u=e.v,m.stopOnError(u);case 5:e.n=7;break;case 6:a.type===F?m.stopOnError(a[F].message):a.type===ot?m.stopOnError(a.message):"response.audio_transcript.delta"===a.type||("response.audio_transcript.done"===a.type?a.transcript&&gr.onMessage(m._deepChat,w(w({},ue,j),B,a.transcript),!1):"conversation.item.input_audio_transcription.completed"===a.type&&a.transcript&&gr.onMessage(m._deepChat,w(w({},ue,U),B,a.transcript),!1));case 7:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}()),e.p=2,e.n=3,this._pc.createOffer();case 3:if(o=e.v,c=n!==this._pc){e.n=5;break}return e.n=4,this._pc.setLocalDescription(o);case 4:c=n!==this._pc;case 5:if(!c){e.n=6;break}return e.a(2);case 6:return e.n=7,fetch("".concat(Gi,"realtime"),{method:ft,body:o.sdp,headers:w(w({},tt,"".concat(ht).concat(t)),lt,"application/sdp")});case 7:if(l=e.v,n===this._pc){e.n=8;break}return e.a(2);case 8:return d=w,h=w({},J,"answer"),e.n=9,l[B]();case 9:if(u=d(h,"sdp",e.v),p=n!==this._pc){e.n=11;break}return e.n=10,this._pc.setRemoteDescription(u);case 10:p=n!==this._pc;case 11:if(!p){e.n=12;break}return e.a(2);case 12:e.n=14;break;case 13:e.p=13,f=e.v,console[F](f),this.displayError();case 14:return e.a(2)}},e,this,[[2,13]])})),function(e){return r.apply(this,arguments)})},{key:"monitorFrequencies",value:function(e,t){var n=this,r=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var i;e.getByteFrequencyData(t);var a=1+t.reduce(function(e,t){return e+t},0)/(255*t.length)*100/100*((null==(i=n._avatarConfig)?void 0:i.maxScale)-1);n._avatarEl[I].transform="scale(".concat(a,")"),requestAnimationFrame(r)});r()}},{key:"stopOnError",value:function(e){this.stop(),console[F](e),this.displayError()}},{key:"stop",value:function(){var e,t,n;null==(e=this._mediaStream)||e.getTracks().forEach(function(e){return e.stop()}),this._mediaStream=null,this._pc&&(this._pc.close(),this._pc=null,null==(n=null==(t=this._events)?void 0:t.stopped)||n.call(t),this._deepChat.dispatchEvent(new CustomEvent("sts-session-stopped")),this._dc=void 0)}},{key:"changeToUnavailable",value:function(){this._microphoneButton&&t.changeButtonToUnavailable(this._microphoneButton),this._toggleButton&&t.changeButtonToUnavailable(this._toggleButton)}},{key:"changeToAvailable",value:function(){this._microphoneButton&&t.changeButtonToAvailable(this._microphoneButton),this._toggleButton&&t.changeButtonToAvailable(this._toggleButton)}},{key:"removeUnavailable",value:function(){this._microphoneButton&&t.removeButtonUnavailable(this._microphoneButton),this._toggleButton&&t.removeButtonUnavailable(this._toggleButton)}},{key:"createError",value:function(){var e,t=R();return t.id="deep-chat-openai-realtime-error",Object.assign(t[I],null==(e=this._errorConfig)?void 0:e[I]),this._errorElement=t,t}},{key:"displayFailedToRetrieveEphemeralKey",value:function(e){console[F]("Failed to retrieve ephemeral key"),console[F](e),this.displayError()}},{key:"displayError",value:function(){var e;this._errorElement&&(this._errorElement[I].display="block",this._errorElement.textContent=(null==(e=this._errorConfig)?void 0:e[B])||"Error",this.changeToUnavailable()),this.hideLoading()}},{key:"createLoading",value:function(){var e,t,n=R();return n.id="deep-chat-openai-realtime-loading",this._loadingElement=n,null!=(e=this._loadingConfig)&&e[N]&&(this._loadingElement.innerHTML=this._loadingConfig[N]),Object.assign(n[I],null==(t=this._loadingConfig)?void 0:t[I]),n[I].display="none",n}},{key:"displayLoading",value:function(){var e,n,r;this._toggleButton&&(this._toggleButton.changeToActive(),this._toggleButton.elementRef[M].add(t.BUTTON_LOADING),pa.removeAriaDisabled(this._toggleButton.elementRef),pa.addAriaBusy(this._toggleButton.elementRef)),("boolean"!=typeof(null==(e=this._loadingConfig)?void 0:e.display)||this._loadingConfig.display)&&this._loadingElement&&(this._loadingElement[I].display="block",null!=(n=this._loadingConfig)&&n[N]||(this._loadingElement.textContent=(null==(r=this._loadingConfig)?void 0:r[B])||"Loading"))}},{key:"hideLoading",value:function(){this._toggleButton&&(this._toggleButton.elementRef[M].remove(t.BUTTON_LOADING),pa.removeAriaBusy(this._toggleButton.elementRef)),this._loadingElement&&(this._loadingElement[I].display="none")}},{key:"handleTool",value:(n=k(g().m(function e(t,n,r){var i,a;return g().w(function(e){for(;;)switch(e.n){case 0:if(this._functionHandlerI){e.n=1;break}throw Error(Ce);case 1:return e.n=2,this._functionHandlerI({name:t,arguments:n});case 2:if("object"==E(i=e.v)&&Sa.isJson(i)){e.n=3;break}throw Error('The `function_handler` response must be a JSON object, e.g. {response: "My response"}');case 3:a=w(w(w({},J,Zi),"call_id",r),"output",JSON.stringify(i)),this.sendMessage(a);case 4:return e.a(2)}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"sendMessage",value:function(e){if(this._dc){var t=JSON.stringify(w(w({},J,"conversation.item.create"),"item",e));this._dc.send(t);var n=w({},J,"response.create");this._dc.send(JSON.stringify(n))}}},{key:"isCustomView",value:function(){return!0}}],[{key:"getKey",value:function(e){var t=e.directConnection.openAI;if(null!=t&&t.key)return t.key;var n=null==t?void 0:t.realtime;return"object"==E(n)&&(n.ephemeralKey||n.fetchEphemeralKey)?"placeholder":void 0}},{key:"buildAvatarConfig",value:function(e){var t="object"==E(e)&&e.avatar?ce(e.avatar):{};return t.maxScale=t.maxScale&&t.maxScale>=1?t.maxScale:2.5,t}},{key:"buildButtonsConfig",value:function(e){var t,n,r,i,a,s,o,l,u,c,d,h,p,f,m,v,g,y,b,k,_,S,w,C,T,x,A="object"==E(e)&&e.buttons?ce(e.buttons):{};return null!=(f=null==(p=null==(h=A[re])?void 0:h[Oe])?void 0:p[B])&&f.content||(null!==(t=A[re])&&void 0!==t||(A[re]={}),null!==(n=(m=A[re])[Oe])&&void 0!==n||(m[Oe]={}),null!==(r=(v=A[re][Oe]).svg)&&void 0!==r||(v.svg={}),null!==(i=(g=A[re][Oe].svg).content)&&void 0!==i||(g.content=fa)),null!=(k=null==(b=null==(y=A.toggle)?void 0:y[Oe])?void 0:b[B])&&k.content||(null!==(a=A.toggle)&&void 0!==a||(A.toggle={}),null!==(s=(_=A.toggle)[Oe])&&void 0!==s||(_[Oe]={}),null!==(o=(S=A.toggle[Oe]).svg)&&void 0!==o||(S.svg={}),null!==(l=(w=A.toggle[Oe].svg).content)&&void 0!==l||(w.content=wa),null!==(u=(C=A.toggle)[Ne])&&void 0!==u||(C[Ne]={}),null!==(c=(T=A.toggle[Ne]).svg)&&void 0!==c||(T.svg={}),null!==(d=(x=A.toggle[Ne].svg).content)&&void 0!==d||(x.content=Ea)),A}},{key:"createAvatar",value:function(e){var t,n=R("img");return n.id="deep-chat-openai-realtime-avatar",Object.assign(n[I],null==(t=null==e?void 0:e.styles)?void 0:t[Q]),n[X]=(null==e?void 0:e[X])||Er,n}},{key:"createButtonContainer",value:function(e){var t=R();return t[M].add("deep-chat-openai-realtime-button-container"),t.appendChild(e),t}},{key:"changeButtonToUnavailable",value:function(e){e.elementRef[M].add(t.UNAVAILABLE),pa.removeAriaBusy(e.elementRef),pa.addAriaDisabled(e.elementRef),e.changeToUnavailable()}},{key:"changeButtonToAvailable",value:function(e){t.removeButtonUnavailable(e),e.changeToDefault()}},{key:"removeButtonUnavailable",value:function(e){pa.removeAriaDisabled(e.elementRef),e.elementRef[M].remove(t.UNAVAILABLE)}}]);var n,r,i,a,s}($r);Ca.BUTTON_DEFAULT="deep-chat-openai-realtime-button-default",Ca.BUTTON_LOADING="deep-chat-openai-realtime-button-loading",Ca.MICROPHONE_ACTIVE="deep-chat-openai-realtime-microphone-active",Ca.UNAVAILABLE="deep-chat-openai-realtime-button-unavailable";var Ta=Ca,xa=function(e){function t(e){var n,r,i,a,s,o;C(this,t);var l=ce(e.directConnection),u=null==l?void 0:l.openAI;(i=d(this,t,[e,ea(),Qi,u])).insertKeyPlaceholderText=i.genereteAPIKeyName("OpenAI"),i.keyHelpUrl=Wi,i.url="".concat(Gi,"audio/speech"),i.permittedErrorPrefixes=[it];var c=null==(a=null==l?void 0:l.openAI)?void 0:a.textToSpeech;return E(c)===ct&&Object.assign(i.rawBody,c),null!==(n=(s=i.rawBody).model)&&void 0!==n||(s.model=t.DEFAULT_MODEL),null!==(r=(o=i.rawBody).voice)&&void 0!==r||(o.voice=t.DEFAULT_VOIDE),i.textInputPlaceholderText="Insert text to generate audio",i.rawBody.response_format="mp3",i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n,r,i=ce(e),a=null==(r=null==(n=t[t.length-1])?void 0:n[B])?void 0:r.trim();return a&&""!==a&&(i.input=a),i}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.url=this.connectSettings.url||this.url,this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this));case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:if(!(t instanceof Blob)){e.n=1;break}return e.a(2,new Promise(function(e){var n=new FileReader;n.readAsDataURL(t),n.onload=function(t){e(w({},Y,[w(w({},X,t.target.result),J,ne)]))}}));case 1:if(!t[F]){e.n=2;break}throw t[F].message;case 2:return e.a(2,w({},F,F))}},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r);xa.DEFAULT_MODEL="tts-1",xa.DEFAULT_VOIDE="alloy";var Aa=xa,Ma=function(e){function t(e){var n,r,i,a;C(this,t);var s=ce(e.directConnection),o=null==s?void 0:s.openAI;(r=d(this,t,[e,ea(),Qi,o,{audio:{}}])).insertKeyPlaceholderText=r.genereteAPIKeyName("OpenAI"),r.keyHelpUrl=Wi,r.url="",r.permittedErrorPrefixes=[it],r.textInputPlaceholderText=mt,r._service_url=t.AUDIO_TRANSCRIPTIONS_URL;var l=null==(i=null==s?void 0:s.openAI)?void 0:i[ne];return"object"==E(l)&&(r.processConfig(l),t.cleanConfig(l),Object.assign(r.rawBody,l)),null!==(n=(a=r.rawBody).model)&&void 0!==n||(a.model=t.DEFAULT_MODEL),r.rawBody.response_format="json",r.canSendMessage=t.canSendFileMessage,r}return m(t,e),x(t,[{key:"processConfig",value:function(e){null!=e&&e.type&&"translation"===e.type&&(this._service_url=t.AUDIO_TRANSLATIONS_URL,delete e.language)}},{key:"preprocessBody",value:function(e,t){var n,r,i=ce(e),a=null==(r=null==(n=t[t.length-1])?void 0:n[B])?void 0:r.trim();return a&&""!==a&&(i.prompt=a),i}},{key:"callServiceAPI",value:(r=k(g().m(function e(n,r,i){var a,s,o;return g().w(function(e){for(;;)switch(e.n){case 0:if(null!=(a=this.connectSettings)&&a.headers){e.n=1;break}throw new Error(be);case 1:if(null!=i&&i[0]){e.n=2;break}throw new Error(ke);case 2:this.url=this.connectSettings.url||this._service_url,s=this.preprocessBody(this.rawBody,r),o=t.createFormDataBody(s,i[0]),Or.tempRemoveContentHeader(this.connectSettings,Vr.request.bind(this,this,o,n),!1);case 3:return e.a(2)}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:return e.a(2,w({},B,t[B]))}},e)})),function(e){return n.apply(this,arguments)})}],[{key:"canSendFileMessage",value:function(e,t){return!(null==t||!t[0])}},{key:"cleanConfig",value:function(e){delete e.type}},{key:"createFormDataBody",value:function(e,t){var n=new FormData;return n.append(Z,t),Object.keys(e).forEach(function(t){n.append(t,String(e[t]))}),n}}]);var n,r}($r);Ma.AUDIO_TRANSCRIPTIONS_URL="".concat(Gi,"audio/transcriptions"),Ma.AUDIO_TRANSLATIONS_URL="".concat(Gi,"audio/translations"),Ma.DEFAULT_MODEL="whisper-1";var Ia=Ma,Ra="Ocp-Apim-Subscription-Key",Pa="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",Oa=function(e,t){return w(w(w({},Ra,t),lt,"application/ssml+xml"),"X-Microsoft-OutputFormat",e)},La=function(e){return w(w({},Ra,e),"Accept",ut)},Ba=function(e,t,n,r){e[F]?r(ge):n(t)},Na=function(e){return w(w({},Ra,e),lt,ut)},Fa=function(e,t,n,r){var i;"401"===(null==(i=e[F])?void 0:i.code)?r(ge):n(t)},Da=function(e,t,n,r){e.json().then(function(e){Array.isArray(e)||401e3!==e[F].code?n(t):r(ge)})},ja=function(e,t){var n=w(w({},Ra,t),lt,ut);return e&&(n["Ocp-Apim-Subscription-Region"]=e),n},Ua=function(e){function t(e){var n,r,i,a,s,o;C(this,t);var l=null==(a=null==(i=e.directConnection)?void 0:i.azure)?void 0:a.summarization,u=null==(s=e.directConnection)?void 0:s.azure;return(r=d(this,t,[e,Na,l.endpoint,u])).permittedErrorPrefixes=[t.ENDPOINT_ERROR_MESSAGE],r.url="",r.textInputPlaceholderText="Insert text to summarize",r.isTextInputDisabled=!1,l.endpoint?(null!==(n=(o=r.rawBody).language)&&void 0!==n||(o.language="en"),Object.assign(r.rawBody,l),r.url="".concat(l.endpoint,"/language/analyze-text/jobs?api-version=2022-10-01-preview")):(r.isTextInputDisabled=!0,r.canSendMessage=function(){return!1},setTimeout(function(){e.addMessage(w({},F,t.ENDPOINT_ERROR_MESSAGE))})),r}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=t[t.length-1][B];if(n)return{analysisInput:{documents:[w({id:"1",language:e.language},B,n)]},tasks:[{kind:"ExtractiveSummarization"}]}}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this)),this.messages=t;case 1:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t){var n,r,i;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:return this.messages&&this.completionsHandlers&&(this.asyncCallInProgress=!0,r=t.headers.get("operation-location"),i={method:pt,headers:null==(n=this.connectSettings)?void 0:n.headers},Vr.executePollRequest(this,r,i,this.messages)),e.a(2,w({},B,""))}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"extractPollResultData",value:(n=k(g().m(function e(t){var n,r,i,s;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F];case 1:if("running"!==t.status&&"notStarted"!==t.status){e.n=2;break}return e.a(2,{timeoutMS:2e3});case 2:if(!(t.errors.length>0)){e.n=3;break}throw t.errors[0];case 3:if(!(t.tasks.items[0].results.errors.length>0)){e.n=4;break}throw t.tasks.items[0].results.errors[0];case 4:n="",r=a(t.tasks.items[0].results.documents[0].sentences);try{for(r.s();!(i=r.n()).done;)s=i.value,n+=s[B]}catch(o){r.e(o)}finally{r.f()}return e.a(2,w({},B,n||""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n,r,i}(function(e){function t(e,n,r,i,a){var s,o;return C(this,t),s=d(this,t,[e,(o=r,{url:"".concat(o,"/language/analyze-text/jobs?api-version=2022-10-01-preview"),method:ft,createHeaders:function(e){return w({},Ra,"".concat(e))},handleVerificationResult:Fa}),n,i,a]),s.insertKeyPlaceholderText="Azure Language Subscription Key",s.keyHelpUrl=Pa,s.permittedErrorPrefixes=["Access"],s}return m(t,e),x(t)}($r));Ua.ENDPOINT_ERROR_MESSAGE="Please define the azure endpoint. [More Information](".concat(D,"directConnection/Azure#Summarization)");var Ha=Ua,qa=function(){var e=k(g().m(function e(t,n){var r,i,a,s,o;return g().w(function(e){for(;;)switch(e.n){case 0:return r=w(w({},"authorization",t),"content-type",ut),o="https://api.assemblyai.com/v2/transcript/",e.n=1,fetch("https://api.assemblyai.com/v2/transcript",{method:ft,body:JSON.stringify({audio_url:n}),headers:r});case 1:return e.n=2,e.v.json();case 2:i=o.concat.call(o,e.v.id);case 3:if(a){e.n=9;break}return e.n=4,fetch(i,{headers:r});case 4:return e.n=5,e.v.json();case 5:if((s=e.v).status!==dt){e.n=6;break}a=s,e.n=8;break;case 6:if(s.status!==F){e.n=7;break}throw new Error("Transcription failed: ".concat(s[F]));case 7:return e.n=8,new Promise(function(e){return setTimeout(e,3e3)});case 8:e.n=3;break;case 9:return e.a(2,a)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),za=function(e){return w(w({},tt,e),lt,"application/octet-stream")},Ga=function(e,t,n,r){var i=e;i[F]?"invalid_api_key"===i[F].code?r(ge):r(ye):n(t)},Wa=function(e){function t(e){var n,r;C(this,t);var i=null==(r=e.directConnection)?void 0:r.assemblyAI;return(n=d(this,t,[e,hi("https://api.assemblyai.com/v2/upload",ft,Ga),za,i,{audio:{}}])).insertKeyPlaceholderText=n.genereteAPIKeyName("AssemblyAI"),n.keyHelpUrl="https://www.assemblyai.com/app/account",n.url="https://api.assemblyai.com/v2/upload",n.isTextInputDisabled=!0,n.textInputPlaceholderText=mt,n.permittedErrorPrefixes=[et,it],n.canSendMessage=t.canFileSendMessage,n}return m(t,e),x(t,[{key:"callServiceAPI",value:(r=k(g().m(function e(t,n,r){var i;return g().w(function(e){for(;;)switch(e.n){case 0:if(null!=(i=this.connectSettings)&&i.headers){e.n=1;break}throw new Error(be);case 1:if(null!=r&&r[0]){e.n=2;break}throw new Error(ke);case 2:Vr.request(this,r[0],t,!1);case 3:return e.a(2)}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n,r,i,a;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F];case 1:return i=null==(r=null==(n=this.connectSettings)?void 0:n.headers)?void 0:r[tt],e.n=2,qa(i,t.upload_url);case 2:return a=e.v,e.a(2,w({},B,a[B]))}},e,this)})),function(e){return n.apply(this,arguments)})}],[{key:"canFileSendMessage",value:function(e,t){return!(null==t||!t[0])}}]);var n,r}($r),Ka=function(e){function t(e,n,r,i,a){var s,o,l,u,c;C(this,t);var h=ce(e.directConnection);(l=d(this,t,[e,n||ea(),r||Qi,i||h.openAI])).insertKeyPlaceholderText=l.genereteAPIKeyName("OpenAI"),l.keyHelpUrl="https://platform.openai.com/account/api-keys",l.permittedErrorPrefixes=[at,"Invalid value"];var p=a||(null==(u=h.openAI)?void 0:u.chat);return E(p)===ct&&l.processConfig(p,e),null!==(s=l.maxMessages)&&void 0!==s||(l.maxMessages=-1),null!==(o=(c=l.rawBody).model)&&void 0!==o||(c.model="gpt-4o"),l}return m(t,e),x(t,[{key:"processConfig",value:function(e,t){var n,r,i;this.completeConfig(e,null==(i=null==(r=null==(n=t.directConnection)?void 0:n.openAI)?void 0:r.chat)?void 0:i.function_handler)}}],[{key:"getBaseFileContent",value:function(e){return e.map(function(e){var t,n,r;if(e.type===ne){var i=null==(t=e[X])?void 0:t.split(",")[1],a=(null==(r=null==(n=e.name)?void 0:n.split(".").pop())?void 0:r.toLowerCase())||"wav";return w(w({},J,gt),gt,{data:i,format:a})}return e})}},{key:"getBaseContent",value:function(e){if((!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&e[Y]&&e[Y].length>0){var t=this.getBaseFileContent(e[Y]);return e[B]&&e[B].trim().length>0&&t.unshift(w(w({},J,B),B,e[B])),t}return e[B]}}])}($r),Va=function(e){function t(){var e;return C(this,t),(e=d(this,t,arguments)).url="".concat(Gi,"chat/completions"),e}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,n){var r=ce(e),i=this.processMessages(n).map(function(e){return w({content:t.getContent(e)},ue,$r.getRoleViaUser(e[ue]))});return this.addSystemMessage(i),r.messages=i,r}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:null!==(r=this.messages)&&void 0!==r||(this.messages=t),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t,n){var r,i,a,s,o,l,u,c;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(null==(i=null==(r=t.choices)?void 0:r[0])||!i.delta){e.n=2;break}return e.a(2,this.extractStreamResult(t.choices[0],n));case 2:if(null==(s=null==(a=t.choices)?void 0:a[0])||!s.message){e.n=5;break}if(!t.choices[0].message.tool_calls){e.n=3;break}return e.a(2,this.handleToolsGeneric(t.choices[0].message,this.functionHandler,this.messages,n));case 3:if(null==(o=t.choices[0].message)||!o[ne]){e.n=4;break}return u=this.deepChat.textToSpeech,c="object"==E(u)&&"boolean"==typeof(null==(l=null==u?void 0:u[ne])?void 0:l.displayText),e.a(2,w(w({},Y,[w(w({},X,"data:audio/wav;base64,".concat(t.choices[0].message[ne].data)),J,ne)]),B,c?t.choices[0].message[ne].transcript:void 0));case 4:return e.a(2,w({},B,t.choices[0].message.content));case 5:return e.a(2,w({},B,""))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractStreamResult",value:(n=k(g().m(function e(t,n){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,this.extractStreamResultWToolsGeneric(this,t,this.functionHandler,n))},e,this)})),function(e,t){return n.apply(this,arguments)})}],[{key:"getFileContent",value:function(e){return Ka.getBaseFileContent(e).map(function(e){return e.type===gt?e:w(w({},J,yt),yt,{url:e[X]})})}},{key:"getContent",value:function(e){if(e[Y]&&e[Y].length>0){var n=t.getFileContent(e[Y]);return e[B]&&e[B].trim().length>0&&n.unshift(w(w({},J,B),B,e[B])),n}return e[B]}}]);var n,r,i}(Ka),Xa=function(e){function t(e,n,r,i,a){var s,o;return C(this,t),s=d(this,t,[e,(o=r,{url:"https://".concat(o,".api.cognitive.microsoft.com/sts/v1.0/issuetoken"),method:ft,createHeaders:function(e){return w({},Ra,"".concat(e))},handleVerificationResult:Ba}),n,i,a]),s.insertKeyPlaceholderText="Azure Speech Subscription Key",s.keyHelpUrl=Pa,s}return m(t,e),x(t)}($r);Xa.REGION_ERROR_PREFIX="Please define a region config property. [More Information](".concat(D,"directConnection/Azure#");var Ja=Xa,Za=function(e){function t(e){var n,r,i,a,s,o,l,u,c,h;C(this,t);var p=null==(o=null==(s=e.directConnection)?void 0:s.azure)?void 0:o.textToSpeech,f=null==(l=e.directConnection)?void 0:l.azure;return(a=d(this,t,[e,Oa.bind({},(null==p?void 0:p.outputFormat)||"audio-16khz-128kbitrate-mono-mp3"),p.region,f])).permittedErrorPrefixes=[t.REGION_ERROR_MESSAGE],a.isTextInputDisabled=!1,a.url="",p.region?(Object.assign(a.rawBody,p),null!==(n=(u=a.rawBody).lang)&&void 0!==n||(u.lang="en-US"),null!==(r=(c=a.rawBody).name)&&void 0!==r||(c.name="en-US-JennyNeural"),null!==(i=(h=a.rawBody).gender)&&void 0!==i||(h.gender="Female"),a.url="https://".concat(p.region,".tts.speech.microsoft.com/cognitiveservices/v1")):(a.isTextInputDisabled=!0,a.canSendMessage=function(){return!1},setTimeout(function(){e.addMessage(w({},F,t.REGION_ERROR_MESSAGE))})),a}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=t[t.length-1][B];if(n)return"<speak version='1.0' xml:lang='".concat(e.lang,"'>\n      <voice xml:lang='").concat(e.lang,"' xml:gender='").concat(e.gender,"' name='").concat(e.name,"'>\n        ").concat(n,"\n      </voice>\n    </speak>")}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),void 0,!1);case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e){var n=new FileReader;n.readAsDataURL(t),n.onload=function(t){e(w({},Y,[w(w({},X,t.target.result),J,ne)]))}}))},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}(Ja);Za.REGION_ERROR_MESSAGE="".concat(Ja.REGION_ERROR_PREFIX,"TextToSpeech)");var Ya=Za,Qa=function(e){function t(e){var n,r,i,a;C(this,t);var s=null==(i=null==(r=e.directConnection)?void 0:r.azure)?void 0:i.speechToText,o=null==(a=e.directConnection)?void 0:a.azure,l={audio:w({},Y,{acceptedFormats:".wav,.ogg"})};if((n=d(this,t,[e,La,s.region,o,l])).permittedErrorPrefixes=[t.REGION_ERROR_MESSAGE],n.url="",n.isTextInputDisabled=!0,n.textInputPlaceholderText=mt,s.region){n.canSendMessage=t.canFileSendMessage;var u=s.lang||"en-US";n.url="https://".concat(s.region,".stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=").concat(u,"&format=detailed"),n.recordAudio=void 0}else n.isTextInputDisabled=!0,n.canSendMessage=function(){return!1},setTimeout(function(){e.addMessage(w({},F,t.REGION_ERROR_MESSAGE))});return n}return m(t,e),x(t,[{key:"callServiceAPI",value:(r=k(g().m(function e(t,n,r){var i,a;return g().w(function(e){for(;;)switch(e.n){case 0:if(null!=(i=this.connectSettings)&&i.headers){e.n=1;break}throw new Error(be);case 1:if(null!=r&&r[0]){e.n=2;break}throw new Error(ke);case 2:null!=(a=this.connectSettings)&&a.headers&&(this.connectSettings.headers[lt]=r[0].name.toLocaleLowerCase().endsWith(".wav")?"audio/wav; codecs=audio/pcm; samplerate=16000":"audio/ogg; codecs=opus"),Vr.request(this,r[0],t,!1);case 3:return e.a(2)}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F];case 1:return e.a(2,w({},B,t.DisplayText||""))}},e)})),function(e){return n.apply(this,arguments)})}],[{key:"canFileSendMessage",value:function(e,t){return!(null==t||!t[0])}}]);var n,r}(Ja);Qa.REGION_ERROR_MESSAGE="".concat(Ja.REGION_ERROR_PREFIX,"SpeechToText)");var $a=Qa,es=function(e){function t(e){var n,r,i,a;C(this,t);var s,o=null==(i=null==(r=e.directConnection)?void 0:r.azure)?void 0:i.translation,l=null==(a=e.directConnection)?void 0:a.azure;return n=d(this,t,[e,(s=o.region,{url:"https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=es",method:ft,createHeaders:function(e){return ja(s,e)},handleVerificationResult:Da}),ja.bind({},null==o?void 0:o.region),l]),n.insertKeyPlaceholderText="Azure Translate Subscription Key",n.keyHelpUrl="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",n.url="",n.url="https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=".concat(o.language||"es"),n}return m(t,e),x(t,[{key:"preprocessBody",value:function(e){var t=e[e.length-1][B];if(t)return[{Text:t}]}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this));case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!Array.isArray(t)){e.n=1;break}return e.a(2,w({},B,(null==(n=t[0].translations)?void 0:n[0][B])||""));case 1:throw t[F];case 2:return e.a(2)}},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),ts=function(e){function t(e){var n,r,i,a;C(this,t);var s=ce(e.directConnection),o=s.bigModel;(r=d(this,t,[e,Di(),Ni,o])).insertKeyPlaceholderText=r.genereteAPIKeyName("BigModel"),r.keyHelpUrl="https://open.bigmodel.cn/usercenter/apikeys",r.url="https://open.bigmodel.cn/api/paas/v4/images/generations",r.permittedErrorPrefixes=[tt,st];var l=null==(i=s.bigModel)?void 0:i[$];return E(l)===ct&&(r.cleanConfig(l),Object.assign(r.rawBody,l)),null!==(n=(a=r.rawBody).model)&&void 0!==n||(a.model="cogview-4-250304"),r}return m(t,e),x(t,[{key:"cleanConfig",value:function(e){delete e.key}},{key:"preprocessBody",value:function(e,t){var n=ce(e),r=t[t.length-1];return n.prompt=(null==r?void 0:r[B])||"",n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this)))},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)if(0===e.n)return n=t.data.map(function(e){return null!=e&&e.url?w(w({},X,e.url),J,Q):w(w({},X,""),J,Q)}),e.a(2,w({},Y,n))},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),ns=function(e){return w(w({},lt,ut),tt,"".concat(ht).concat(e))},rs=function(e,t,n,r){var i=e;i[F]?i[F].message===nt?r(ge):r(ye):n(t)},is=function(){return hi("https://api.groq.com/openai/v1/models",pt,rs)},as=function(e){function t(e){var n,r,i,a,s,o,l,u;C(this,t);var c=ce(e.directConnection),h=c.groq;(a=d(this,t,[e,is(),ns,h])).insertKeyPlaceholderText=a.genereteAPIKeyName("Groq"),a.keyHelpUrl="https://console.groq.com/keys",a.url="https://api.groq.com/openai/v1/audio/speech",a.permittedErrorPrefixes=[it,"property"];var p=null==(s=c.groq)?void 0:s.textToSpeech;return E(p)===ct&&a.completeConfig(p),null!==(n=(o=a.rawBody).model)&&void 0!==n||(o.model="playai-tts"),null!==(r=(l=a.rawBody).voice)&&void 0!==r||(l.voice="Fritz-PlayAI"),null!==(i=(u=a.rawBody).response_format)&&void 0!==i||(u.response_format="mp3"),a}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=ce(e),r=t[t.length-1];return n.input=(null==r?void 0:r[B])||"",n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this)))},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n,r,i;return g().w(function(e){for(;;)if(0===e.n)return n=this.rawBody.response_format||"mp3",r=new Blob([t],w({},J,"audio/".concat(n))),i=URL.createObjectURL(r),e.a(2,w({},Y,[w(w({},X,i),J,ne)]))},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),ss=function(e){function t(e){var n,r,i,a;C(this,t);var s=ce(e.directConnection),o=s.together;(r=d(this,t,[e,qi(),Ui,o])).insertKeyPlaceholderText=r.genereteAPIKeyName("Together AI"),r.keyHelpUrl="https://api.together.xyz/settings/api-keys",r.url="https://api.together.xyz/v1/images/generations",r.permittedErrorPrefixes=[ot,st];var l=null==(i=s.together)?void 0:i[$];return E(l)===ct&&r.completeConfig(l),null!==(n=(a=r.rawBody).model)&&void 0!==n||(a.model="black-forest-labs/FLUX.1-schnell-Free"),r}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=ce(e),r=t[t.length-1];return n.prompt=(null==r?void 0:r[B])||"",n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this)))},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)if(0===e.n)return n=t.data.map(function(e){return null!=e&&e.url?w(w({},X,e.url),J,Q):null!=e&&e.b64_json?w(w({},X,"data:image/png;base64,".concat(e.b64_json)),J,Q):w(w({},X,""),J,Q)}),e.a(2,w({},Y,n))},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),os=function(e){function t(e,n,r,i,a){var s,o,l;C(this,t),(s=d(this,t,[e,n,r,i,a])).keyHelpUrl=Wi,s.url="".concat(Gi,"responses"),s._functionStreamInProgress=!1,s._useConversation=!1,s._conversationLoadLimit=50;var u=a||(null==(l=null==(o=e.directConnection)?void 0:o.openAI)?void 0:l.chat);return E(u)===ct&&!0!==u&&u&&(u.conversation&&(s._useConversation=!0,"string"==typeof u.conversation&&(s._conversationId=u.conversation)),"number"==typeof u.conversationLoadLimit&&(s._conversationLoadLimit=u.conversationLoadLimit),s.cleanConfig(u)),s._conversationId&&(s.fetchHistory=s.fetchHistoryFunc.bind(s)),s}return m(t,e),x(t,[{key:"processConfig",value:function(e,n){!function(e,t,n,r){var a=i(f(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof a?function(e){return a.apply(n,e)}:a}(t,"processConfig",this,3)([e,n])}},{key:"cleanConfig",value:function(e){delete e.conversation,delete e.conversationLoadLimit}},{key:"fetchHistoryFunc",value:(c=k(g().m(function e(){var t,n,r=this;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:return setTimeout(function(){return r.deepChat.disableSubmitButton()},2),e.p=1,t=this.url,this.url="".concat(Gi,"conversations/").concat(this._conversationId,"/items?limit=").concat(this._conversationLoadLimit),e.n=2,ta(this,{},pt);case 2:return n=e.v,e.a(2,(this.connectSettings.method=ft,this.url=t,this.deepChat.disableSubmitButton(!1),this.processConversationHistory(n)));case 3:return e.p=3,e.v,e.a(2,(this.deepChat.disableSubmitButton(!1),[w({},F,xe)]))}},e,this,[[1,3]])})),function(){return c.apply(this,arguments)})},{key:"processConversationHistory",value:function(e){if(!e.data||!Array.isArray(e.data))return[];var n,r=[],i=a(t.filterCompleted(e.data.reverse()));try{for(i.s();!(n=i.n()).done;){var s=n.value;if("message"===s.type&&s.content&&Array.isArray(s.content)){var o,l=a(s.content);try{for(l.s();!(o=l.n()).done;){var u=o.value;u.type!==Ki&&u.type!==Xi||!u[B]?u.type===Vi&&r.push(w(w({},ue,s[ue]),Y,t.generateImageFile(u[yt]||""))):r.push(w(w({},ue,s[ue]),B,u[B]))}}catch(c){l.e(c)}finally{l.f()}}else s.type===Ji&&r.push(w(w({},ue,j),Y,t.generateImageFile(s.result)))}}catch(c){i.e(c)}finally{i.f()}return r}},{key:"preprocessBody",value:function(e,n){var r=ce(e);n=this.processMessages(n);var i=(n=this._useConversation?[n[n.length-1]]:n).map(function(e){return w({content:t.getContent(e)},ue,$r.getRoleViaUser(e[ue]))});return r.input=i,this._conversationId&&(r.conversation=this._conversationId),r}},{key:"createConversation",value:(u=k(g().m(function e(){var t,n,r;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=this.url,this.url="".concat(Gi,"conversations"),e.n=1,ta(this,{},ft);case 1:return n=e.v,e.a(2,(this.url=t,n.id));case 2:throw e.p=2,r=e.v,console[F]("Failed to create conversation:",r),r;case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return u.apply(this,arguments)})},{key:"callServiceAPI",value:(l=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:if(null!==(r=this.messages)&&void 0!==r||(this.messages=t),!this._useConversation||this._conversationId){e.n=2;break}return e.n=1,this.createConversation();case 1:this._conversationId=e.v;case 2:this._conversationId&&this.updateSessionId(this._conversationId),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 3:return e.a(2)}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"extractResultData",value:(o=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.extractResult(t,n);case 1:return r=e.v,e.a(2,(this._conversationId&&(r._sessionId=this._conversationId),r))}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"extractResult",value:(s=k(g().m(function e(n,r){var i,a,s,o,l,u,c,d;return g().w(function(e){for(;;)switch(e.n){case 0:if(!n[F]){e.n=1;break}throw n[F].message;case 1:if(!n.status){e.n=5;break}if(!((l=t.filterCompleted(n.output)).length>0)){e.n=4;break}return u=null==(s=null==(a=null==(i=l.find(function(e){var t,n;return"string"==typeof(null==(n=null==(t=e.content)?void 0:t[0])?void 0:n[B])}))?void 0:i.content)?void 0:a[0])?void 0:s[B],e.n=2,this.handleResponsesFunctionCalls(l,r,u);case 2:if(!(c=e.v)){e.n=3;break}return e.a(2,c);case 3:return d=this.handleFileGenerationResponse(l,u),e.a(2,d||w({},B,u));case 4:return e.a(2,w({},B,""));case 5:return e.a(2,(null==(o=n.item)?void 0:o.type)===vt&&n.type?this.handleStreamedResponsesFunctionCall(n,r):n.type==="".concat(Yi,".").concat(Ji,".partial_image")&&n.partial_image_b64?w({},Y,[w(w({},X,"".concat(t.IMAGE_BASE64_PREFIX).concat(n.partial_image_b64)),J,Q)]):n.delta&&!this._functionStreamInProgress&&n.type==="".concat(Yi,".").concat(Xi,".delta")?w({},B,n.delta):w({},B,""))}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"handleStreamedResponsesFunctionCall",value:(r=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:if(t.type!=="".concat(Yi,".output_item.done")){e.n=2;break}if(this._functionStreamInProgress=!1,(null==(r=t.item)?void 0:r.type)!==vt){e.n=1;break}return e.a(2,this.handleResponsesFunctionCalls([t.item],n));case 1:e.n=3;break;case 2:t.type==="".concat(Yi,".output_item.added")&&(this._functionStreamInProgress=!0);case 3:return e.a(2,w({},B,""))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"handleFileGenerationResponse",value:function(e,n){var r=e.find(function(e){return e.type===Ji});return r?w(w({},Y,t.generateImageFile(r.result)),B,n):null}},{key:"handleResponsesFunctionCalls",value:(n=k(g().m(function e(t,n,r){var i,a,s,o,l,u;return g().w(function(e){for(;;)switch(e.n){case 0:if(0!==(i=t.filter(function(e){return e.type===vt})).length){e.n=1;break}return e.a(2,null);case 1:if(n&&this.functionHandler){e.n=2;break}throw Error(Ce);case 2:return a=i.map(function(e){return{name:e.name,arguments:e.arguments}}),e.n=3,this.callToolFunction(this.functionHandler,a);case 3:if(s=e.v,o=s.responses,!(l=s.processedResponse)){e.n=4;break}return e.a(2,l);case 4:if(!(u=ce(n)).input||(i.forEach(function(e){return u.input.push(e)}),o.find(function(e){return"string"!=typeof e.response})||a.length!==o.length)){e.n=5;break}return e.a(2,(o.forEach(function(e,t){var n=i[t];u.input.push({type:Zi,call_id:n.call_id,output:e[Yi]})}),this.makeAnotherRequest(u,this.messages,r)));case 5:throw Error(Te);case 6:return e.a(2)}},e,this)})),function(e,t,r){return n.apply(this,arguments)})}],[{key:"getFileContent",value:function(e){return Ka.getBaseFileContent(e).map(function(e){return e.type===gt?e:w(w({detail:"auto"},J,Vi),yt,e[X])})}},{key:"getContent",value:function(e){if(e[ue]===U&&e[Y]&&e[Y].length>0){var n=t.getFileContent(e[Y]);return e[B]&&e[B].trim().length>0&&n.unshift(w(w({},J,Ki),B,e[B])),n}return e[B]}},{key:"filterCompleted",value:function(e){return(null==e?void 0:e.filter(function(e){return e.status===dt}))||[]}},{key:"generateImageFile",value:function(e){return[w(w({},X,"".concat(t.IMAGE_BASE64_PREFIX).concat(e)),J,Q)]}}]);var n,r,s,o,l,u,c}(Ka);os.IMAGE_BASE64_PREFIX="data:image/png;base64,";var ls=os,us=function(e){function t(e){var n,r,i,a,s,o,l,u;C(this,t);var c=ce(e.directConnection),h=c.azure,p=(null==(i=null==(r=c.azure)?void 0:r.openAI)?void 0:i.urlDetails)||{},f=null==(s=null==(a=c.azure)?void 0:a.openAI)?void 0:s.chat;if((n=d(this,t,[e,ua(p),la,h,f])).permittedErrorPrefixes=[oa],n.isTextInputDisabled=!1,E(f)===ct){var m=(null==(u=null==(l=null==(o=e.directConnection)?void 0:o.azure)?void 0:l.openAI)?void 0:u.chat).function_handler;m&&(n.functionHandler=m)}return ca(p)?n.url=t.buildURL(p):(n.isTextInputDisabled=!0,n.canSendMessage=function(){return!1},setTimeout(function(){e.addMessage(w({},F,oa))})),n}return m(t,e),x(t,null,[{key:"buildURL",value:function(e){var t=e.endpoint,n=e.deploymentId,r=e.version;return"".concat(t,"/openai/deployments/").concat(n,"/chat/completions?api-version=").concat(r)}}])}(ls),cs=function(e){function t(e){var n,r,i,a,s,o,l,u;C(this,t);var c=ce(e.directConnection),h=c.bigModel;(i=d(this,t,[e,Di(),Ni,h])).insertKeyPlaceholderText=i.genereteAPIKeyName("BigModel"),i.keyHelpUrl="https://open.bigmodel.cn/usercenter/apikeys",i.url="https://open.bigmodel.cn/api/paas/v4/chat/completions",i.permittedErrorPrefixes=[tt,st];var p=null==(a=c.bigModel)?void 0:a.chat;return E(p)===ct&&i.completeConfig(p,null==(l=null==(o=null==(s=e.directConnection)?void 0:s.bigModel)?void 0:o.chat)?void 0:l.function_handler),null!==(n=i.maxMessages)&&void 0!==n||(i.maxMessages=-1),null!==(r=(u=i.rawBody).model)&&void 0!==r||(u.model="glm-4.5"),i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,n){var r=ce(e),i=this.processMessages(n).map(function(e){return w({content:t.getTextWFilesContent(e,t.getFileContent)},ue,$r.getRoleViaAI(e[ue]))});return this.addSystemMessage(i),r.messages=i,r}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:null!==(r=this.messages)&&void 0!==r||(this.messages=t),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(!(t.choices.length>0)){e.n=3;break}if(void 0===t.choices[0].delta){e.n=2;break}return e.a(2,this.extractStreamResult(t.choices[0],n));case 2:if(void 0===t.choices[0].message){e.n=3;break}return r=t.choices[0].message,e.a(2,r.tool_calls?this.handleToolsGeneric({tool_calls:r.tool_calls},this.functionHandler,this.messages,n):w({},B,r.content));case 3:return e.a(2,w({},B,""))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractStreamResult",value:(n=k(g().m(function e(t,n){var r,i,a,s,o,l,u,c;return g().w(function(e){for(;;)switch(e.n){case 0:if(o=t.delta,l=t.finish_reason,(null==(u=null==(r=this.messages)?void 0:r.messageToElements[this.messages.messageToElements.length-2])?void 0:u[0][ue])===j&&0===(null==(i=null==u?void 0:u[0][B])?void 0:i.replace(/\n/g,"").trim().length)&&(null==(a=this.messages)||a.removeMessage(u[1][B]),null==(s=this.messages)||s.messageToElements.splice(this.messages.messageToElements.length-2,1)),"tool_calls"!==l){e.n=2;break}if(!o.tool_calls){e.n=1;break}return c={tool_calls:o.tool_calls},e.a(2,this.handleToolsGeneric(c,this.functionHandler,this.messages,n));case 1:case 2:return e.a(2,w({},B,(null==o?void 0:o.content)||""))}},e,this)})),function(e,t){return n.apply(this,arguments)})}],[{key:"getFileContent",value:function(e){return e.map(function(e){return e.type===Q?w(w({},J,yt),yt,{url:e[X]||""}):w(w({},J,Z),"file_url",{url:e[X]||""})})}}]);var n,r,i}($r),ds=function(e){function t(e){var n,r,i,a,s;C(this,t);var o=ce(e.directConnection),l=o.together;(i=d(this,t,[e,qi(),Ui,l])).insertKeyPlaceholderText=i.genereteAPIKeyName("Together AI"),i.keyHelpUrl="https://api.together.xyz/settings/api-keys",i.url="https://api.together.xyz/v1/chat/completions",i.permittedErrorPrefixes=[ot,st];var u=null==(a=o.together)?void 0:a.chat;return E(u)===ct&&i.completeConfig(u),null!==(n=i.maxMessages)&&void 0!==n||(i.maxMessages=-1),null!==(r=(s=i.rawBody).model)&&void 0!==r||(s.model="meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo"),i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=ce(e),r=this.processMessages(t).map(function(e){return w({content:e[B]||""},ue,e[ue]===j?H:e[ue])});return this.addSystemMessage(r),n.messages=r,n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(!(t.choices.length>0)){e.n=3;break}if(void 0===t.choices[0].message){e.n=2;break}return e.a(2,w({},B,t.choices[0].message.content));case 2:if(void 0===t.choices[0].delta){e.n=3;break}return e.a(2,w({},B,t.choices[0].delta.content));case 3:return e.a(2,w({},B,""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),hs=function(e){function t(e){var n,r;C(this,t);var i=e.directConnection,a=null==i?void 0:i.openAI,s={images:w({},Y,{acceptedFormats:".png",maxNumberOfFiles:2})};(n=d(this,t,[e,ea(),Qi,a,s])).insertKeyPlaceholderText=n.genereteAPIKeyName("OpenAI"),n.keyHelpUrl=Wi,n.url="",n.permittedErrorPrefixes=[at,"Invalid input image"];var o=null==(r=null==i?void 0:i.openAI)?void 0:r[$];if(n[ee]){var l="object"==E(o)&&o.size?Number.parseInt(o.size):1024;n[ee][Y]={dimensions:{width:l,height:l}}}return E(o)===ct&&Object.assign(n.rawBody,o),n.canSendMessage=t.canFileSendMessage,n}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=ce(e);return t&&""!==t&&(n.prompt=t),n}},{key:"callApiWithImage",value:function(e,n,r){var i,a,s,o=null==(a=null==(i=n[n.length-1])?void 0:i[B])?void 0:a.trim();if(r[1]||o&&""!==o){this.url=t.IMAGE_EDIT_URL;var l=this.preprocessBody(this.rawBody,o);s=t.createFormDataBody(l,r[0],r[1])}else this.url=t.IMAGE_VARIATIONS_URL,s=t.createFormDataBody(this.rawBody,r[0]);Or.tempRemoveContentHeader(this.connectSettings,Vr.request.bind(this,this,s,e),!1)}},{key:"callServiceAPI",value:(r=k(g().m(function e(n,r,i){var a,s;return g().w(function(e){for(;;)switch(e.n){case 0:if(null!=(a=this.connectSettings)&&a.headers){e.n=1;break}throw new Error(be);case 1:if(null==i||!i[0]){e.n=2;break}this.callApiWithImage(n,r,i),e.n=4;break;case 2:if(this.connectSettings){e.n=3;break}throw new Error(be);case 3:this.url=t.IMAGE_GENERATION_URL,s=this.preprocessBody(this.rawBody,r[r.length-1][B]),Vr.request(this,s,n);case 4:return e.a(2)}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:return n=t.data.map(function(e){return e.url?w(w({},X,e.url),J,Q):w(w({},X,"".concat(wi).concat(e.b64_json)),J,Q)}),e.a(2,w({},Y,n))}},e)})),function(e){return n.apply(this,arguments)})}],[{key:"canFileSendMessage",value:function(e,t){return!(null==t||!t[0])||!(!e||""===e.trim())}},{key:"createFormDataBody",value:function(e,t,n){var r=new FormData;return r.append(Q,t),n&&r.append("mask",n),Object.keys(e).forEach(function(t){r.append(t,String(e[t]))}),r}}]);var n,r}($r);hs.IMAGE_GENERATION_URL="".concat(Gi,"images/generations"),hs.IMAGE_VARIATIONS_URL="".concat(Gi,"images/variations"),hs.IMAGE_EDIT_URL="".concat(Gi,"images/edits");var ps=hs,fs=function(e){return w(w({},tt,"".concat(ht).concat(e)),lt,ut)},ms=function(e,t,n,r){var i=e;i[F]?i[F].type===st?r(ge):r(ye):n(t)},vs=function(e){function t(e){var n,r,i,a,s,o,l,u;C(this,t);var c=ce(e.directConnection).openRouter;return(a=d(this,t,[e,hi("https://openrouter.ai/api/v1/key",pt,ms),fs,c])).insertKeyPlaceholderText=a.genereteAPIKeyName("OpenRouter"),a.keyHelpUrl="https://openrouter.ai/keys",a.url="https://openrouter.ai/api/v1/chat/completions",a.permittedErrorPrefixes=[ot,st],E(c)===ct&&a.completeConfig(c,null==(o=null==(s=e.directConnection)?void 0:s.openRouter)?void 0:o.function_handler),null!==(n=a.maxMessages)&&void 0!==n||(a.maxMessages=-1),null!==(r=(l=a.rawBody).model)&&void 0!==r||(l.model="openai/gpt-4o"),null!==(i=(u=a.rawBody).max_tokens)&&void 0!==i||(u.max_tokens=1e3),a}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,n){var r=ce(e),i=this.processMessages(n).map(function(e){return w({content:t.getContent(e)},ue,$r.getRoleViaUser(e[ue]))}),a=[];return this.systemMessage&&a.push(w(w({},ue,"system"),"content",this.systemMessage)),a.push.apply(a,l(i)),r.messages=a,r}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:null!==(r=this.messages)&&void 0!==r||(this.messages=t),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t,n){var r,i,a,s,o,l,u,c;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if("chat.completion.chunk"!==t.object){e.n=4;break}if(null==(o=null==(r=t.choices)?void 0:r[0])||!o.delta){e.n=2;break}return e.a(2,this.extractStreamResult(o,n));case 2:if(null==(i=t.message)||!i[$]){e.n=3;break}return l=t.message[$].map(function(e){return w({},X,e[yt].url)}),e.a(2,w(w({},B,t.message.content||""),Y,l));case 3:case 6:return e.a(2,w({},B,""));case 4:if("chat.completion"!==t.object){e.n=6;break}if(null==(u=null==(a=t.choices)?void 0:a[0])||!u.message){e.n=6;break}if(!u.message.tool_calls){e.n=5;break}return e.a(2,this.handleToolsGeneric({tool_calls:u.message.tool_calls},this.functionHandler,this.messages,n));case 5:return c=(null==(s=u.message[$])?void 0:s.map(function(e){return w({},X,e[yt].url)}))||[],e.a(2,w(w({},B,u.message.content||""),"files",c))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractStreamResult",value:(n=k(g().m(function e(t,n){var r,i;return g().w(function(e){for(;;)switch(e.n){case 0:if(null==(r=t.delta)||!r[$]){e.n=1;break}return i=r[$].map(function(e){return w({},X,e[yt].url)}),e.a(2,w(w({},B,r.content||""),Y,i));case 1:return e.a(2,this.extractStreamResultWToolsGeneric(this,t,this.functionHandler,n))}},e,this)})),function(e,t){return n.apply(this,arguments)})}],[{key:"getAudioContent",value:function(e){return e.filter(function(e){return e.type===ne}).map(function(e){var t,n,r,i=null==(t=e[X])?void 0:t.split(",")[1],a=null==(r=null==(n=e[X])?void 0:n.match(/data:audio\/([^;]+)/))?void 0:r[1];return w(w({},J,gt),gt,{data:i||"",format:"wav"===a||"mp3"===a?a:"mp3"})}).filter(function(e){return e[gt].data.length>0})}},{key:"getContent",value:function(e){if(e[Y]&&e[Y].length>0){var n=[].concat(l(t.getImageContent(e[Y])),l(t.getAudioContent(e[Y])));return e[B]&&e[B].trim().length>0&&n.unshift(w(w({},J,B),B,e[B])),n.length>0?n:e[B]||""}return e[B]||""}}]);var n,r,i}($r),gs=function(e){return w(w({},tt,"".concat(ht).concat(e)),lt,ut)},ys=function(e,t,n,r){e[F]?r(ge):n(t)},bs=function(e){function t(e){var n,r,i,a;C(this,t);var s=ce(e.directConnection).perplexity;return(i=d(this,t,[e,hi("https://api.perplexity.ai/chat/completions",ft,ys),gs,s])).insertKeyPlaceholderText=i.genereteAPIKeyName("Perplexity"),i.keyHelpUrl="https://www.perplexity.ai/settings/api",i.url="https://api.perplexity.ai/chat/completions",i.permittedErrorPrefixes=[it,et,"Permission denied"],E(s)===ct&&i.completeConfig(s),null!==(n=i.maxMessages)&&void 0!==n||(i.maxMessages=-1),null!==(r=(a=i.rawBody).model)&&void 0!==r||(a.model="sonar"),i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=ce(e),r=this.processMessages(t).map(function(e){return w({content:e[B]||""},ue,$r.getRoleViaUser(e[ue]))});return this.addSystemMessage(r),n.messages=r,n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(!(t.choices&&t.choices.length>0)){e.n=3;break}if(!(n=t.choices[0]).delta||!n.delta.content){e.n=2;break}return e.a(2,w({},B,n.delta.content));case 2:if(!n.message||!n.message.content){e.n=3;break}return e.a(2,w({},B,n.message.content));case 3:return e.a(2,w({},B,""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),ks=function(e){return w(w({},tt,"Bearer ".concat(e)),lt,ut)},_s=function(e,t,n,r){var i=e;i.detail?r(i.detail):n(t)},Ss=function(e){function t(e){var n,r,i,a,s,o,l,u;C(this,t);var c=ce(e.directConnection).openWebUI;return(a=d(this,t,[e,hi("http://localhost:3000/api/v1/models",pt,_s),ks,c])).insertKeyPlaceholderText="Open WebUI API Key",a.keyHelpUrl="https://docs.openwebui.com/getting-started/api-endpoints/",a.url="http://localhost:3000/api/chat/completions",a.permittedErrorPrefixes=["Error"],E(c)===ct&&(a.completeConfig(c,null==(o=null==(s=e.directConnection)?void 0:s.openWebUI)?void 0:o.function_handler),c[Y]&&c[Y].length>0&&(a.rawBody[Y]=c[Y])),null!==(n=a.maxMessages)&&void 0!==n||(a.maxMessages=-1),null!==(r=(l=a.rawBody).model)&&void 0!==r||(l.model="llama3.2"),null!==(i=(u=a.rawBody).stream)&&void 0!==i||(u.stream=!1),a}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=ce(e),r=this.processMessages(t).map(function(e){return w({content:$r.getTextWImagesContent(e)},ue,$r.getRoleViaUser(e[ue]))});return this.addSystemMessage(r),n.messages=r,n}},{key:"callServiceAPI",value:(s=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:null!==(r=this.messages)&&void 0!==r||(this.messages=t),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{readable:!0});case 1:return e.a(2)}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"extractResultData",value:(i=k(g().m(function e(t,n){var r,i,a;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(!t[B]){e.n=2;break}return i=t[B].trim(),e.a(2,this.processStreamingResponse(i,n));case 2:if(!t.choices||null==(r=t.choices[0])||!r.message){e.n=3;break}return a=t.choices[0].message,e.a(2,a.tool_calls?this.handleTools({tool_calls:a.tool_calls},n):w({},B,a.content||""));case 3:return e.a(2,w({},B,""))}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"processStreamingResponse",value:(r=k(g().m(function e(t,n){var r,i,s,o,l,u,c,d,h,p;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:i=t.split("\n").filter(function(e){return""!==e.trim()}),s="",o=a(i),e.p=1,o.s();case 2:if((l=o.n()).done){e.n=8;break}if(u=l.value,(c=u.trim()).startsWith("data: ")&&(c=c.substring(6)),"[DONE]"===c){e.n=7;break}if(e.p=3,!(d=JSON.parse(c)).choices||null==(r=d.choices[0])||!r.delta){e.n=5;break}if(!(h=d.choices[0].delta).tool_calls){e.n=4;break}return e.a(2,this.handleTools({tool_calls:h.tool_calls},n));case 4:h.content&&(s+=h.content);case 5:e.n=7;break;case 6:return e.p=6,e.v,e.a(3,7);case 7:e.n=2;break;case 8:e.n=10;break;case 9:e.p=9,p=e.v,o.e(p);case 10:return e.p=10,o.f(),e.f(10);case 11:return e.a(2,w({},B,s))}},e,this,[[3,6],[1,9,10,11]])})),function(e,t){return r.apply(this,arguments)})},{key:"handleTools",value:(n=k(g().m(function e(t,n){var r,i,a,s,o;return g().w(function(e){for(;;)switch(e.n){case 0:if(t.tool_calls&&n&&this.functionHandler){e.n=1;break}throw Error(Ce);case 1:return r=ce(n),i=t.tool_calls.map(function(e){return{name:e.function.name,arguments:e.function.arguments}}),e.n=2,this.callToolFunction(this.functionHandler,i);case 2:if(a=e.v,s=a.responses,!(o=a.processedResponse)){e.n=3;break}return e.a(2,o);case 3:if(r.messages.push(w(w({tool_calls:t.tool_calls},ue,H),"content","")),s.find(function(e){return"string"!=typeof e.response})||i.length!==s.length){e.n=4;break}return e.a(2,(s.forEach(function(e,n){var i,a=null==(i=t.tool_calls)?void 0:i[n];null==r||r.messages.push(w(w(w({},ue,"tool"),"tool_name",null==a?void 0:a.function.name),"content",e.response))}),this.makeAnotherRequest(r,this.messages)));case 4:throw Error(Te);case 5:return e.a(2)}},e,this)})),function(e,t){return n.apply(this,arguments)})}]);var n,r,i,s}($r),ws=function(e){return w(w({},tt,"".concat(ht).concat(e)),lt,ut)},Es=function(e,t,n,r){var i=e;i[F]?i[F].type===st?r(ge):r(ye):n(t)},Cs=function(e){function t(e){var n,r,i,a,s,o,l,u;C(this,t);var c=ce(e.directConnection).deepSeek;return(s=d(this,t,[e,hi("https://api.deepseek.com/models",pt,Es),ws,c])).insertKeyPlaceholderText=s.genereteAPIKeyName("DeepSeek"),s.keyHelpUrl="https://platform.deepseek.com/api_keys",s.url="https://api.deepseek.com/v1/chat/completions",s.permittedErrorPrefixes=[ot,st],E(c)===ct&&s.completeConfig(c),null!==(n=s.maxMessages)&&void 0!==n||(s.maxMessages=-1),null!==(r=(o=s.rawBody).model)&&void 0!==r||(o.model="deepseek-chat"),null!==(i=(l=s.rawBody).temperature)&&void 0!==i||(l.temperature=1),null!==(a=(u=s.rawBody).max_tokens)&&void 0!==a||(u.max_tokens=4096),s}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=ce(e),r=this.processMessages(t).map(function(e){return w({content:e[B]||""},ue,$r.getRoleViaUser(e[ue]))});return this.addSystemMessage(r),n.messages=r,n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(!(t.choices&&t.choices.length>0)){e.n=3;break}if(!(n=t.choices[0]).delta||!n.delta.content){e.n=2;break}return e.a(2,w({},B,n.delta.content));case 2:if(!n.message||!n.message.content){e.n=3;break}return e.a(2,w({},B,n.message.content));case 3:return e.a(2,w({},B,""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),Ts=function(e){return w(w({},tt,"".concat(ht).concat(e)),lt,ut)},xs=function(e,t,n,r){var i;1004===(null==(i=e.base_resp)?void 0:i.status_code)?r(ge):n(t)},As=function(e){function t(e){var n,r,i,a;C(this,t);var s=ce(e.directConnection).miniMax;return(i=d(this,t,[e,hi("https://api.minimax.io/v1/files/delete",ft,xs),Ts,s])).insertKeyPlaceholderText=i.genereteAPIKeyName("MiniMax"),i.keyHelpUrl="https://www.minimaxi.com",i.url="https://api.minimax.io/v1/text/chatcompletion_v2",i.permittedErrorPrefixes=[ot,st,"insufficient balance"],E(s)===ct&&i.completeConfig(s),null!==(n=i.maxMessages)&&void 0!==n||(i.maxMessages=-1),null!==(r=(a=i.rawBody).model)&&void 0!==r||(a.model="MiniMax-M1"),i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=ce(e),r=this.processMessages(t).map(function(e){return w({content:e[B]||""},ue,$r.getRoleViaUser(e[ue]))});return this.addSystemMessage(r),n.messages=r,n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n,r;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(!(t.choices&&t.choices.length>0)){e.n=3;break}if(!(r=t.choices[0]).delta||!r.delta.content){e.n=2;break}return e.a(2,w({},B,r.delta.content));case 2:if(!r.message||!r.message.content){e.n=3;break}return e.a(2,w({},B,r.message.content));case 3:if(!("number"==typeof(null==(n=t.base_resp)?void 0:n.status_code)&&t.base_resp.status_code>0)){e.n=4;break}throw t.base_resp.status_msg;case 4:return e.a(2,w({},B,""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),Ms=function(e){return w(w(w({},tt,"".concat(ht).concat(e)),lt,ut),"accept",ut)},Is=function(e,t,n,r){e.detail?r(ge):n(t)},Rs=function(e){function t(e){var n,r,i,a,s,o;C(this,t);var l=ce(e.directConnection).mistral;return(i=d(this,t,[e,hi("https://api.mistral.ai/v1/models",pt,Is),Ms,l])).insertKeyPlaceholderText=i.genereteAPIKeyName("Mistral"),i.keyHelpUrl="https://console.mistral.ai/api-keys/",i.url="https://api.mistral.ai/v1/chat/completions",i.permittedErrorPrefixes=[it],E(l)===ct&&i.completeConfig(l,null==(s=null==(a=e.directConnection)?void 0:a.mistral)?void 0:s.function_handler),null!==(n=i.maxMessages)&&void 0!==n||(i.maxMessages=-1),null!==(r=(o=i.rawBody).model)&&void 0!==r||(o.model="mistral-small-latest"),i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,n){var r=ce(e),i=this.processMessages(n).map(function(e){return w(w({},ue,$r.getRoleViaAI(e[ue])),"content",$r.getTextWFilesContent(e,t.getFileContent))});return this.addSystemMessage(i),r.messages=i,r}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:null!==(r=this.messages)&&void 0!==r||(this.messages=t),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t.message){e.n=1;break}throw t.message;case 1:if(!t[F]){e.n=2;break}throw t[F].message;case 2:if(!(t.choices&&t.choices.length>0)){e.n=4;break}if(!(r=t.choices[0]).delta){e.n=3;break}return e.a(2,this.extractStreamResult(r,n));case 3:if(!r.message){e.n=4;break}return e.a(2,r.message.tool_calls?this.handleToolsGeneric({tool_calls:r.message.tool_calls},this.functionHandler,this.messages,n):w({},B,r.message.content||""));case 4:return e.a(2,w({},B,""))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractStreamResult",value:(n=k(g().m(function e(t,n){var r,i;return g().w(function(e){for(;;)switch(e.n){case 0:if(r=t.delta,"tool_calls"!==t.finish_reason||null==r||!r.tool_calls){e.n=1;break}return i={tool_calls:r.tool_calls},e.a(2,this.handleToolsGeneric(i,this.functionHandler,this.messages,n));case 1:return e.a(2,w({},B,(null==r?void 0:r.content)||""))}},e,this)})),function(e,t){return n.apply(this,arguments)})}],[{key:"getFileContent",value:function(e){return e.map(function(e){return e.type===Q?w(w({},J,yt),yt,e[X]||""):w(w({},J,B),B,"[Unsupported ".concat(Z," type: ").concat(e.type,"]"))})}}]);var n,r,i}($r),Ps=function(e){function t(e){var n,r,i,a,s,o,l,u;C(this,t);var c=ce(e.directConnection),h=c.groq;(i=d(this,t,[e,is(),ns,h])).insertKeyPlaceholderText=i.genereteAPIKeyName("Groq"),i.keyHelpUrl="https://console.groq.com/keys",i.url="https://api.groq.com/openai/v1/chat/completions",i.permittedErrorPrefixes=[it,"property"];var p=null==(a=c.groq)?void 0:a.chat;return E(p)===ct&&i.completeConfig(p,null==(l=null==(o=null==(s=e.directConnection)?void 0:s.groq)?void 0:o.chat)?void 0:l.function_handler),null!==(n=i.maxMessages)&&void 0!==n||(i.maxMessages=-1),null!==(r=(u=i.rawBody).model)&&void 0!==r||(u.model="llama-3.3-70b-versatile"),i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,n){var r=ce(e),i=this.processMessages(n).map(function(e){return w({content:t.getTextWImagesContent(e)},ue,e[ue]===j?H:e[ue])});return this.addSystemMessage(i),r.messages=i,r}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:null!==(r=this.messages)&&void 0!==r||(this.messages=t),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t,n){var r,i,a,s;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:return e.a(2,null!=(i=null==(r=t.choices)?void 0:r[0])&&i.delta?this.extractStreamResult(t.choices[0],n):null!=(s=null==(a=t.choices)?void 0:a[0])&&s.message?t.choices[0].message.tool_calls?this.handleToolsGeneric(t.choices[0].message,this.functionHandler,this.messages,n,{message:this.systemMessage}):w({},B,t.choices[0].message.content||""):w({},B,""))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractStreamResult",value:(n=k(g().m(function e(t,n){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,this.extractStreamResultWToolsGeneric(this,t,this.functionHandler,n))},e,this)})),function(e,t){return n.apply(this,arguments)})}]);var n,r,i}($r),Os=function(e){return w(w(w({},tt,"".concat(ht).concat(e)),lt,ut),"accept",ut)},Ls=function(e,t,n,r){"string"==typeof e.message?r(ge):n(t)},Bs=function(e){function t(e){var n,r,i,a;C(this,t);var s=ce(e.directConnection).cohere;if((i=d(this,t,[e,hi("https://api.cohere.ai/v1/models",pt,Ls),Os,s])).insertKeyPlaceholderText=i.genereteAPIKeyName("Cohere"),i.keyHelpUrl="https://dashboard.cohere.ai/api-keys",i.permittedErrorPrefixes=["invalid"],i.url="https://api.cohere.com/v2/chat",E(s)===ct){var o=Ct.processCohere(s);i.canSendMessage=function(){return o},i.cleanConfig(s),Object.assign(i.rawBody,s)}return null!==(n=i.maxMessages)&&void 0!==n||(i.maxMessages=-1),null!==(r=(a=i.rawBody).model)&&void 0!==r||(a.model="command-a-03-2025"),i}return m(t,e),x(t,[{key:"cleanConfig",value:function(e){delete e.key}},{key:"preprocessBody",value:function(e,t){var n=ce(e),r=t.filter(function(e){return e[B]});return n.messages=r.map(function(e){return w(w({},ue,$r.getRoleViaAI(e[ue])),"content",e[B])}),n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{readable:!0});case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(n){var r,i,a,s;return g().w(function(e){for(;;)switch(e.n){case 0:if("string"!=typeof n.message){e.n=1;break}throw n.message;case 1:if(!this.stream||!n[B]){e.n=2;break}return s=t.parseBundledEvents(n[B]),e.a(2,{text:t.aggregateBundledEventsText(s)});case 2:if(!("message"in n)||null==(a=null==(i=null==(r=n.message)?void 0:r.content)?void 0:i[0])||!a[B]){e.n=3;break}return e.a(2,w({},B,n.message.content[0][B]));case 3:throw new Error("Invalid response format from Cohere API");case 4:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})}],[{key:"parseBundledEvents",value:function(e){var t,n=[],r=a(e.trim().split("\n"));try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.trim())try{var s=JSON.parse(i);n.push(s)}catch(s){console[F]("Failed to parse line:",i,s)}}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"aggregateBundledEventsText",value:function(e){return e.filter(function(e){var t,n,r;return"content-delta"===e.type&&(null==(r=null==(n=null==(t=e.delta)?void 0:t.message)?void 0:n.content)?void 0:r[B])}).map(function(e){var t,n,r;return null==(r=null==(n=null==(t=e.delta)?void 0:t.message)?void 0:n.content)?void 0:r[B]}).join("")}}]);var n,r}($r),Ns=function(){return w({},lt,ut)},Fs=function(e,t,n,r){var i,a=e;a[F]?403===a[F].code||null!=(i=a[F].message)&&i.includes("API key")?r(ge):r(ye):n(t)},Ds=function(e){function t(e){var n,r,i,a;C(this,t);var s,o=ce(e.directConnection).gemini;if(r=d(this,t,[e,(s="https://generativelanguage.googleapis.com/v1beta/models?key=",hi(s,pt,Fs,function(e){return"".concat(s).concat(e)})),Ns,o]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("Gemini"),r.keyHelpUrl="https://aistudio.google.com/app/apikey",r.urlPrefix="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent",r.url="",r.permittedErrorPrefixes=["API_KEY_INVALID"],E(o)===ct){var l=o;l.model&&(r.urlPrefix="https://generativelanguage.googleapis.com/v1beta/models/".concat(l.model,":generateContent")),r.cleanConfig(l),r.completeConfig(l,null==(a=null==(i=e.directConnection)?void 0:i.gemini)?void 0:a.function_handler)}return null!==(n=r.maxMessages)&&void 0!==n||(r.maxMessages=-1),r}return m(t,e),x(t,[{key:"cleanConfig",value:function(e){delete e.model}},{key:"preprocessBody",value:function(e,n){var r=ce(e),i=this.processMessages(n).map(function(e){return t.getContent(e)});return r.contents=i,this.systemMessage&&(r.systemInstruction={parts:[w({},B,this.systemMessage)]}),r}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){var r,i,a;return g().w(function(e){for(;;)switch(e.n){case 0:if(this.connectSettings){e.n=1;break}throw new Error(be);case 1:null!==(r=this.messages)&&void 0!==r||(this.messages=t),i=this.preprocessBody(this.rawBody,n),(a=this.stream)&&(E(a)!==ct||!a.simulation)||i.stream?(this.url="".concat(this.urlPrefix.replace(":generateContent",":streamGenerateContent"),"?alt=sse&key=").concat(this.key),qr.request(this,i,t)):(this.url="".concat(this.urlPrefix,"?key=").concat(this.key),Vr.request(this,i,t));case 2:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t,n){var r,i,a,s,o,l,u,c;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message||"Gemini API Error";case 1:if(null==(a=null==(i=null==(r=t.candidates)?void 0:r[0])?void 0:i.content)||!a.parts){e.n=3;break}if(o=t.candidates[0].content.parts,null==(l=o.find(function(e){return e.functionCall}))||!l.functionCall){e.n=2;break}return e.a(2,this.handleTools([l.functionCall],n));case 2:return u=o.find(function(e){return e[B]}),c=o.find(function(e){var t;return"image/png"===(null==(t=e.inlineData)?void 0:t.mimeType)}),e.a(2,w(w({},B,(null==u?void 0:u[B])||""),Y,null!=(s=null==c?void 0:c.inlineData)&&s.data?[w({},X,"data:image/png;base64,".concat(c.inlineData.data))]:[]));case 3:return e.a(2,w({},B,""))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"handleTools",value:(n=k(g().m(function e(t,n){var r,i,a,s,o,l,u;return g().w(function(e){for(;;)switch(e.n){case 0:if(t&&n&&this.functionHandler){e.n=1;break}throw Error(Ce);case 1:return r=ce(n),i=t.map(function(e){return{name:e.name,arguments:JSON.stringify(e.args)}}),e.n=2,this.callToolFunction(this.functionHandler,i);case 2:if(a=e.v,s=a.responses,!(o=a.processedResponse)){e.n=3;break}return e.a(2,o);case 3:if(l=w({parts:t.map(function(e){return{functionCall:{name:e.name,args:e.args}}})},ue,"model"),r.contents.push(l),s.find(function(e){return"string"!=typeof e.response})||i.length!==s.length){e.n=4;break}return u=w({parts:s.map(function(e,n){return{functionResponse:{name:t[n].name,response:{result:e.response}}}})},ue,U),e.a(2,(r.contents.push(u),this.makeAnotherRequest(r,this.messages)));case 4:throw Error(Te);case 5:return e.a(2)}},e,this)})),function(e,t){return n.apply(this,arguments)})}],[{key:"getContent",value:function(e){var t=[];return e[B]&&e[B].trim().length>0&&t.push(w({},B,e[B])),e[Y]&&e[Y].length>0&&e[Y].forEach(function(e){if(e[X]&&e[X].includes("data:")){var n=o(e[X].split(","),2),r=n[0],i=n[1];t.push({inlineData:{mimeType:r.replace("data:","").replace(";base64",""),data:i}})}}),w({parts:t},ue,e[ue]===U?U:"model")}}]);var n,r,i}($r),js=function(e){return w(w(w({"x-api-key":e},lt,ut),"anthropic-version","2023-06-01"),"anthropic-dangerous-direct-browser-access","true")},Us=function(e,t,n,r){var i=e;i[F]?i[F].type===st?r(ge):r(ye):n(t)},Hs=function(e){function t(e){var n,r,i,a,s,o,l,u;C(this,t);var c=ce(e.directConnection).claude;return(a=d(this,t,[e,hi("https://api.anthropic.com/v1/models",pt,Us),js,c])).insertKeyPlaceholderText=a.genereteAPIKeyName("Claude"),a.keyHelpUrl="https://console.anthropic.com/settings/keys",a.url="https://api.anthropic.com/v1/messages",a.permittedErrorPrefixes=[st,ot],a._streamToolCalls=w(w(w(w({},J,"tool_use"),"id",""),"name",""),"input",""),E(c)===ct&&a.completeConfig(c,null==(o=null==(s=e.directConnection)?void 0:s.claude)?void 0:o.function_handler),null!==(n=a.maxMessages)&&void 0!==n||(a.maxMessages=-1),null!==(r=(l=a.rawBody).model)&&void 0!==r||(l.model="claude-sonnet-4-5-20250929"),null!==(i=(u=a.rawBody).max_tokens)&&void 0!==i||(u.max_tokens=4096),a}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,n){var r=ce(e),i=this.processMessages(n).map(function(e){return w({content:t.getTextWFilesContent(e,t.getFileContent)},ue,$r.getRoleViaUser(e[ue]))});return r.messages=i,this.systemMessage&&(r.system=this.systemMessage),r}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:null!==(r=this.messages)&&void 0!==r||(this.messages=t),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t,n){var r,i,a,s,o;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(!(t.content&&t.content.length>0)){e.n=3;break}if(!(s=t.content.find(function(e){return"tool_use"===e.type}))){e.n=2;break}return e.a(2,this.handleTools([s],n));case 2:if(!(o=t.content.find(function(e){return e.type===B}))){e.n=3;break}return e.a(2,w({},B,o[B]));case 3:if("content_block_delta"!==t.type||!t.delta||"text_delta"!==t.delta.type){e.n=4;break}return e.a(2,w({},B,t.delta[B]||""));case 4:if("content_block_start"!==t.type||"tool_use"!==(null==(r=t.content_block)?void 0:r.type)){e.n=5;break}this._streamToolCalls=t.content_block,this._streamToolCalls.input="",e.n=7;break;case 5:if("content_block_delta"!==t.type||"input_json_delta"!==(null==(i=t.delta)?void 0:i.type)){e.n=6;break}this._streamToolCalls.input+=t.delta.partial_json||"",e.n=7;break;case 6:if("message_delta"!==t.type||"tool_use"!==(null==(a=t.delta)?void 0:a.stop_reason)){e.n=7;break}return e.a(2,(this._streamToolCalls.input=JSON.parse(this._streamToolCalls.input),this.handleTools([this._streamToolCalls],n)));case 7:return e.a(2,w({},B,""))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"handleTools",value:(n=k(g().m(function e(t,n){var r,i,a,s,o,l,u;return g().w(function(e){for(;;)switch(e.n){case 0:if(t&&n&&this.functionHandler){e.n=1;break}throw Error(Ce);case 1:return r=ce(n),i=t.map(function(e){return{name:e.name,arguments:JSON.stringify(e.input)}}),e.n=2,this.callToolFunction(this.functionHandler,i);case 2:if(a=e.v,s=a.responses,!(o=a.processedResponse)){e.n=3;break}return e.a(2,o);case 3:if(l=t.map(function(e){return w(w(w(w({},J,"tool_use"),"id",e.id),"name",e.name),"input",e.input)}),r.messages.push(w(w({},ue,"assistant"),"content",l)),s.find(function(e){return"string"!=typeof e.response})||i.length!==s.length){e.n=4;break}return u=s.map(function(e,n){return w(w(w({},J,"tool_result"),"tool_use_id",t[n].id),"content",e.response)}),e.a(2,(r.messages.push(w(w({},ue,U),"content",u)),this.makeAnotherRequest(r,this.messages)));case 4:throw Error(Te);case 5:return e.a(2)}},e,this)})),function(e,t){return n.apply(this,arguments)})}],[{key:"getFileContent",value:function(e){return e.map(function(e){var t,n,r;if(e.type===Q){var i=null==(t=e[X])?void 0:t.split(",")[1],a=(null==(r=null==(n=e[X])?void 0:n.match(/data:([^;]+)/))?void 0:r[1])||"image/jpeg";return w(w({},J,Q),"source",w(w(w({},J,"base64"),"media_type",a),"data",i||""))}return w(w({},J,B),B,"[Unsupported ".concat(Z," type: ").concat(e.type,"]"))})}}]);var n,r,i}($r),qs=function(){return{}},zs=function(){},Gs=function(e){function t(e){var n,r,i,a,s,o,l,u;C(this,t);var c=ce(e.directConnection);(a=d(this,t,[e,hi("",pt,zs),qs,{key:"placeholder"}])).insertKeyPlaceholderText="",a.keyHelpUrl="",a.validateKeyProperty=!1,a.url="http://localhost:11434/api/chat",a.permittedErrorPrefixes=["Error"];var h=c.ollama;return E(h)===ct&&a.completeConfig(h,null==(o=null==(s=e.directConnection)?void 0:s.ollama)?void 0:o.function_handler),null!==(n=a.maxMessages)&&void 0!==n||(a.maxMessages=-1),null!==(r=(l=a.rawBody).model)&&void 0!==r||(l.model="llama3.2"),null!==(i=(u=a.rawBody).stream)&&void 0!==i||(u.stream=!1),a}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,n){var r=ce(e),i=this.processMessages(n).map(function(e){var n=w({content:e[B]||""},ue,$r.getRoleViaUser(e[ue]));if(e[Y]&&e[Y].length>0){var r=t.getImageData(e[Y]);r.length>0&&(n[$]=r)}return n});return this.addSystemMessage(i),r.messages=i,r}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:null!==(r=this.messages)&&void 0!==r||(this.messages=t),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{readable:!0});case 1:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t,n){var r,i,a;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(!t[B]){e.n=2;break}return a=JSON.parse(t[B]),e.a(2,null!=(r=a.message)&&r.tool_calls?this.handleTools({tool_calls:a.message.tool_calls},n):w({},B,(null==(i=a.message)?void 0:i.content)||""));case 2:return e.a(2,t.message?t.message.tool_calls?this.handleTools({tool_calls:t.message.tool_calls},n):w({},B,t.message.content||""):w({},B,""))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"handleTools",value:(n=k(g().m(function e(t,n){var r,i,a,s,o;return g().w(function(e){for(;;)switch(e.n){case 0:if(t.tool_calls&&n&&this.functionHandler){e.n=1;break}throw Error(Ce);case 1:return r=ce(n),i=t.tool_calls.map(function(e){return{name:e.function.name,arguments:JSON.stringify(e.function.arguments)}}),e.n=2,this.callToolFunction(this.functionHandler,i);case 2:if(a=e.v,s=a.responses,!(o=a.processedResponse)){e.n=3;break}return e.a(2,o);case 3:if(r.messages.push(w(w({tool_calls:t.tool_calls},ue,H),"content","")),s.find(function(e){return"string"!=typeof e.response})||i.length!==s.length){e.n=4;break}return e.a(2,(s.forEach(function(e,n){var i,a=null==(i=t.tool_calls)?void 0:i[n];null==r||r.messages.push(w(w(w({},ue,"tool"),"tool_name",null==a?void 0:a.function.name),"content",e.response))}),this.makeAnotherRequest(r,this.messages)));case 4:throw Error(Te);case 5:return e.a(2)}},e,this)})),function(e,t){return n.apply(this,arguments)})}],[{key:"getImageData",value:function(e){return e.filter(function(e){return e.type===Q}).map(function(e){var t;return(null==(t=e[X])?void 0:t.split(",")[1])||""}).filter(function(e){return e.length>0})}}]);var n,r,i}($r),Ws=function(e){return w({Authorization:"".concat(ht).concat(e)},lt,ut)},Ks=function(e,t,n,r){var i=e;i[F]?i[F].type===st||i[F].type===ot?r(ge):r(ye):n(t)},Vs=function(){return hi("https://api.x.ai/v1/models",pt,Ks)},Xs=function(e){function t(e){var n,r,i,a;C(this,t);var s=e.directConnection,o=null==s?void 0:s.x;(r=d(this,t,[e,Vs(),Ws,o])).insertKeyPlaceholderText=r.genereteAPIKeyName("X"),r.keyHelpUrl="https://console.x.ai/team/default/api-keys",r.url=t.IMAGE_GENERATION_URL,r.permittedErrorPrefixes=[ot,st];var l=null==(i=null==s?void 0:s.x)?void 0:i[$];return E(l)===ct&&Object.assign(r.rawBody,l),null!==(n=(a=r.rawBody).model)&&void 0!==n||(a.model="grok-2-image"),r}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=t[t.length-1][B],r=ce(e);return n&&""!==n&&(r.prompt=n),r}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this));case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:return n=t.data.map(function(e){return e.url?w(w({},X,e.url),J,Q):w(w({},X,"".concat(wi).concat(e.b64_json)),J,Q)}),e.a(2,w({},Y,n))}},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r);Xs.IMAGE_GENERATION_URL="https://api.x.ai/v1/images/generations";var Js=Xs,Zs=function(e){return w(w({},tt,"".concat(ht).concat(e)),lt,ut)},Ys=function(e,t,n,r){var i=e;i[F]?i[F].type===ot?r(ge):r(ye):n(t)},Qs=function(e){function t(e){var n,r,i,a,s,o;C(this,t);var l=ce(e.directConnection).qwen;return(i=d(this,t,[e,hi("https://dashscope-intl.aliyuncs.com/compatible-mode/v1/models",pt,Ys),Zs,l])).insertKeyPlaceholderText=i.genereteAPIKeyName("Qwen"),i.keyHelpUrl="https://www.alibabacloud.com/help/en/model-studio/get-api-key",i.url="https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions",i.permittedErrorPrefixes=["No static","The model",at],E(l)===ct&&i.completeConfig(l,null==(s=null==(a=e.directConnection)?void 0:a.qwen)?void 0:s.function_handler),null!==(n=i.maxMessages)&&void 0!==n||(i.maxMessages=-1),null!==(r=(o=i.rawBody).model)&&void 0!==r||(o.model="qwen-plus"),i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,n){var r=ce(e),i=this.processMessages(n).map(function(e){return w({content:t.getTextWImagesContent(e)},ue,$r.getRoleViaUser(e[ue]))});return this.addSystemMessage(i),r.messages=i,r}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:null!==(r=this.messages)&&void 0!==r||(this.messages=t),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(!(t.choices&&t.choices.length>0)){e.n=3;break}if(!(r=t.choices[0]).delta){e.n=2;break}return e.a(2,this.extractStreamResult(r,n));case 2:if(!r.message){e.n=3;break}return e.a(2,r.message.tool_calls?this.handleToolsGeneric({tool_calls:r.message.tool_calls},this.functionHandler,this.messages,n):w({},B,r.message.content||""));case 3:return e.a(2,w({},B,""))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractStreamResult",value:(n=k(g().m(function e(t,n){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,this.extractStreamResultWToolsGeneric(this,t,this.functionHandler,n))},e,this)})),function(e,t){return n.apply(this,arguments)})}]);var n,r,i}($r),$s=function(e){return w(w({},tt,"".concat(ht).concat(e)),lt,ut)},eo=function(e,t,n,r){var i=e;i[F]?i[F].type===st?r(ge):r(ye):n(t)},to=function(e){function t(e){var n,r,i,a,s,o;C(this,t);var l=ce(e.directConnection).kimi;return(i=d(this,t,[e,hi("https://api.moonshot.ai/v1/models",pt,eo),$s,l])).insertKeyPlaceholderText=i.genereteAPIKeyName("Kimi"),i.keyHelpUrl="https://platform.moonshot.ai/console/api-keys",i.url="https://api.moonshot.ai/v1/chat/completions",i.permittedErrorPrefixes=[it,"Not found"],E(l)===ct&&i.completeConfig(l,null==(s=null==(a=e.directConnection)?void 0:a.kimi)?void 0:s.function_handler),null!==(n=i.maxMessages)&&void 0!==n||(i.maxMessages=-1),null!==(r=(o=i.rawBody).model)&&void 0!==r||(o.model="moonshot-v1-8k"),i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,n){var r=ce(e),i=this.processMessages(n).map(function(e){return w({content:t.getTextWImagesContent(e)},ue,$r.getRoleViaUser(e[ue]))});return this.addSystemMessage(i),r.messages=i,r}},{key:"callServiceAPI",value:(i=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:null!==(r=this.messages)&&void 0!==r||(this.messages=t),this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"extractResultData",value:(r=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if(!(t.choices&&t.choices.length>0)){e.n=3;break}if(!(r=t.choices[0]).delta){e.n=2;break}return e.a(2,this.extractStreamResult(r,n));case 2:if(!r.message){e.n=3;break}return e.a(2,r.message.tool_calls?this.handleToolsGeneric({tool_calls:r.message.tool_calls},this.functionHandler,this.messages,n):w({},B,r.message.content||""));case 3:return e.a(2,w({},B,""))}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractStreamResult",value:(n=k(g().m(function e(t,n){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,this.extractStreamResultWToolsGeneric(this,t,this.functionHandler,n))},e,this)})),function(e,t){return n.apply(this,arguments)})}]);var n,r,i}($r),no=function(e){function t(e){var n,r,i,a,s;C(this,t);var o=ce(e.directConnection),l=o.x;(i=d(this,t,[e,Vs(),Ws,l])).insertKeyPlaceholderText=i.genereteAPIKeyName("X"),i.keyHelpUrl="https://console.x.ai/team/default/api-keys",i.url="https://api.x.ai/v1/chat/completions",i.permittedErrorPrefixes=[ot,st];var u=null==(a=o.x)?void 0:a.chat;return E(u)===ct&&i.completeConfig(u),null!==(n=i.maxMessages)&&void 0!==n||(i.maxMessages=-1),null!==(r=(s=i.rawBody).model)&&void 0!==r||(s.model="grok-3-latest"),i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t){var n=ce(e),r=this.processMessages(t).map(function(e){return w({content:e[B]||""},ue,$r.getRoleViaUser(e[ue]))});return this.addSystemMessage(r),n.messages=r,n}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:this.callDirectServiceServiceAPI(t,n,this.preprocessBody.bind(this),{});case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n,r,i,a,s;return g().w(function(e){for(;;)switch(e.n){case 0:if(!t[F]){e.n=1;break}throw t[F].message;case 1:if("chat.completion.chunk"!==t.object){e.n=2;break}return s=null==(n=t.choices)?void 0:n[0],e.a(2,null!=(r=null==s?void 0:s.delta)&&r.content?w({},B,s.delta.content):w({},B,""));case 2:return e.a(2,"chat.completion"===t.object&&null!=(a=null==(i=t.choices)?void 0:i[0])&&a.message?w({},B,t.choices[0].message.content||""):w({},B,""))}},e)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),ro=function(e){return e.BLOCKING="blocking",e.STREAMING="streaming",e}(ro||{}),io=function(e){return e.MESSAGE="message",e.AGENT_MESSAGE="agent_message",e.WORKFLOW_FINISHED="workflow_finished",e.ERROR="error",e}(io||{}),ao=function(e,t){return{type:t,transfer_method:"local_file",upload_file_id:e}},so=function(e){var t=e.trim();if(!t.startsWith("data:"))return null;var n=t.replace(/^data:\s*/,"").trim();return n?JSON.parse(n):null};function oo(e,t){return lo.apply(this,arguments)}function lo(){return(lo=k(g().m(function e(t,n){var i,a,s,o,l,u;return g().w(function(e){for(;;)switch(e.n){case 0:return(i=new FormData).append(Z,t),i.append(U,n[U]),a=n.headers,a[lt],s=r(a,[lt].map(A)),e.n=1,fetch(n.url,{method:ft,headers:s,body:i});case 1:if((o=e.v).ok){e.n=3;break}return e.n=2,o.text();case 2:throw l=e.v,new Error(l);case 3:return e.n=4,o.json();case 4:if((u=e.v).id){e.n=5;break}throw new Error("Upload response missing file ID");case 5:return e.a(2,u.id)}},e)}))).apply(this,arguments)}function uo(e,t){return co.apply(this,arguments)}function co(){return co=k(g().m(function e(t,n){var r;return g().w(function(e){for(;;)switch(e.n){case 0:if(0!==t.length){e.n=1;break}return e.a(2,[]);case 1:return r=t.map(function(){var e=k(g().m(function e(t){var r,i;return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,oo(t,n);case 1:return r=e.v,i=t.type.startsWith("image/")?Q:Z,e.a(2,ao(r,i))}},e)}));return function(t){return e.apply(this,arguments)}}()),e.n=2,Promise.all(r);case 2:return e.a(2,e.v.filter(function(e){return null!==e}))}},e)})),co.apply(this,arguments)}function ho(e,t){return e.conversation_id&&t(e.conversation_id),e.code&&e.message&&!e.answer?w({},F,e.message):w({},B,e.answer||"")}var po=function(e,t,n){var r,i;switch(!t.conversationIdSet&&e.conversation_id&&(n(e.conversation_id),t.conversationIdSet=!0),e.event){case io.MESSAGE:case io.AGENT_MESSAGE:t.fullAnswer+=e.answer||"";break;case io.WORKFLOW_FINISHED:!t.fullAnswer&&null!=(i=null==(r=e.data)?void 0:r.outputs)&&i.answer&&(t.fullAnswer=e.data.outputs.answer);break;case io.ERROR:t.errorMessage=e.message||io.ERROR}};function fo(e,t){return mo.apply(this,arguments)}function mo(){return(mo=k(g().m(function e(t,n){var r,i,s,o,l,u;return g().w(function(e){for(;;)switch(e.n){case 0:return r={fullAnswer:"",conversationIdSet:!1,errorMessage:""},e.n=1,t.text();case 1:i=e.v.split(/\r?\n\r?\n/),s=a(i);try{for(s.s();!(o=s.n()).done;)l=o.value,(u=so(l))&&po(u,r,n)}catch(c){s.e(c)}finally{s.f()}return e.a(2,r.errorMessage?w({},F,r.errorMessage):w({},B,r.fullAnswer))}},e)}))).apply(this,arguments)}var vo=function(e){return w(w({},lt,ut),tt,"".concat(ht).concat(e))},go=function(e,t,n,r){var i=e;i[F]?i[F].message===nt?r(ge):r(ye):"user_input_form"in e||"opening_statement"in e||"file_upload"in e?n(t):r(ye)},yo=function(e){function t(e){var n,r,i,a;C(this,t);var s,o=ce(e.directConnection),l=null==o?void 0:o.dify,u=null!==(n=null==(a=e.connect)?void 0:a.url)&&void 0!==n?n:"https://api.dify.ai/v1";return(i=d(this,t,[e,(s=u,hi("".concat(s,"/parameters"),pt,go)),vo,l])).insertKeyPlaceholderText=i.genereteAPIKeyName("Dify"),i.keyHelpUrl="https://docs.dify.ai/en/use-dify/publish/developing-with-apis",i.permittedErrorPrefixes=[st],i._conversationId="",i._user=U,i._inputs={},i.url="".concat(u,"/chat-messages"),i._uploadUrl="".concat(u,"/").concat(Y,"/upload"),E(l)===ct&&(l[U]&&(i._user=l[U]),l.inputs&&(i._inputs=l.inputs),i.completeConfig(l)),null!==(r=i.maxMessages)&&void 0!==r||(i.maxMessages=-1),i._mode=i.stream?ro.STREAMING:ro.BLOCKING,i}return m(t,e),x(t,[{key:"preprocessBody",value:function(e,t,n){var r=this.processMessages(t),i=r[r.length-1],a=(null==i?void 0:i[B])||" ",s=w({inputs:this._inputs,query:a,response_mode:this._mode},U,this._user);return this._conversationId&&(s.conversation_id=this._conversationId),n&&n.length>0&&(s[Y]=n),s}},{key:"callServiceAPI",value:(r=k(g().m(function e(t,n,r){var i,a,s=this;return g().w(function(e){for(;;)switch(e.n){case 0:if(null!==(i=this.messages)&&void 0!==i||(this.messages=t),a=[],!(r&&r.length>0)){e.n=2;break}return e.n=1,uo(r,w(w({url:this._uploadUrl},U,this._user),"headers",this.connectSettings.headers));case 1:a=e.v;case 2:this.callDirectServiceServiceAPI(t,n,function(e,t){return s.preprocessBody(e,t,a)});case 3:return e.a(2)}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"extractResultData",value:(n=k(g().m(function e(t){var n,r=this;return g().w(function(e){for(;;)if(0===e.n)return n=function(e){r._conversationId=e},e.a(2,this._mode!==ro.BLOCKING||this.stream?fo(t,n):ho(t,n))},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r}($r),bo=function(){return x(function e(){C(this,e)},null,[{key:"create",value:function(e){var t=e.directConnection,n=e.connect,r=e.demo;if(e.webModel)return new di(e);if(t){if(t.openAI)return t.openAI[$]?new ps(e):t.openAI.speechToText?new Ia(e):t.openAI.textToSpeech?new Aa(e):t.openAI.assistant?new sa(e):t.openAI.realtime?new Ta(e):t.openAI.completions?new Va(e):new ls(e);if(t.assemblyAI)return new Wa(e);if(t.cohere)return new Bs(e);if(t.huggingFace)return t.huggingFace.textGeneration?new Ai(e):t.huggingFace.summarization?new Ii(e):t.huggingFace.translation?new Oi(e):t.huggingFace.fillMask?new Bi(e):t.huggingFace.questionAnswer?new Mi(e):t.huggingFace.audioSpeechRecognition?new xi(e):t.huggingFace.audioClassification?new yi(e):t.huggingFace.imageClassification?new bi(e):new Ri(e);if(t.azure){if(t.azure.openAI){if(t.azure.openAI.chat)return new us(e);if(t.azure.openAI.assistant)return new ha(e)}if(t.azure.speechToText)return new $a(e);if(t.azure.textToSpeech)return new Ya(e);if(t.azure.summarization)return new Ha(e);if(t.azure.translation)return new es(e)}if(t.stabilityAI)return t.stabilityAI.imageToImage?new Pi(e):t.stabilityAI.imageToImageUpscale?new Ci(e):t.stabilityAI.imageToImageMasking?new Ti(e):new Li(e);if(t.mistral)return new Rs(e);if(t.gemini)return new Ds(e);if(t.claude)return new Hs(e);if(t.deepSeek)return new Cs(e);if(t.miniMax)return new As(e);if(t.openRouter)return new vs(e);if(t.kimi)return new to(e);if(t.x)return t.x[$]?new Js(e):new no(e);if(t.qwen)return new Qs(e);if(t.together)return t.together[$]?new ss(e):t.together.textToSpeech?new zi(e):new ds(e);if(t.bigModel)return t.bigModel[$]?new ts(e):t.bigModel.textToSpeech?new ji(e):new cs(e);if(t.groq)return t.groq.textToSpeech?new as(e):new Ps(e);if(t.perplexity)return new bs(e);if(t.ollama)return new Gs(e);if(t.openWebUI)return new Ss(e);if(t.dify)return new yo(e)}return n&&Object.keys(n).length>0&&!r?new Qr(e):new Qr(e,void 0,r||!0)}}])}(),ko=x(function e(){C(this,e)});ko.attibutes={string:function(e){return e},number:function(e){return parseFloat(e)},boolean:function(e){return"true"===e},object:function(e){return JSON.parse(e)},array:function(e){return JSON.parse(e)},function:function(e){return new Function("return ".concat(e))()}};var _o=ko;function So(e){return function(t,n){Object.defineProperty(t,n,{});var r=t.constructor,i=n.toLocaleLowerCase();r._attributes_[i]=_o.attibutes[e],r._attributeToProperty_[i]=n}}var wo="submit-button",Eo="loading-button",Co="disabled-button",To="text-input-container-start-adjustment",xo="text-input-container-end-adjustment",Ao="text-input-container-start-small-adjustment",Mo="text-input-container-end-small-adjustment",Io=function(){function e(t){C(this,e),this._isDisplayed=!1,this._elementRef=this.createIntroPanelWithChild(t),this._isDisplayed=!0}return x(e,[{key:"createIntroPanelWithChild",value:function(t){var n=e.createIntroPanel();return"none"===t[I].display&&(t[I].display="block"),n.appendChild(t),n}},{key:"hide",value:function(){this._isDisplayed&&(this._elementRef[I].display="none",this._isDisplayed=!1)}},{key:"display",value:function(){this._isDisplayed||(this._elementRef[I].display="",this._isDisplayed=!0)}}],[{key:"createIntroPanel",value:function(){var e=R();return e[M].add("intro-panel"),Object.assign(e[I]),e}}])}(),Ro=function(){function e(){C(this,e)}return x(e,null,[{key:"createImage",value:function(e,t){var n=new Image;return n[X]=e[X],t&&vr.scrollDownOnImageLoad(n[X],t),vr.processContent(Q,n,n[X],e.name)}},{key:"createImageMessage",value:function(t,n,r,i){var a=t.createNewMessageElement("",r),s=i?t.scrollToFirstElement.bind(t,r,i):void 0,o=e.createImage(n,s);return a.bubbleElement.appendChild(o),a.bubbleElement[M].add(e.IMAGE_BUBBLE_CLASS),{type:Q,elements:a}}},{key:"createAudioElement",value:function(e,t){var n=R(ne);return n[X]=e[X],n[M].add("audio-player"),n.controls=!0,Ke.IS_SAFARI&&(n[M].add("audio-player-safari"),n[M].add(t===U?"audio-player-safari-end":"audio-player-safari-start")),n}},{key:"autoPlayAudio",value:function(e){e.addEventListener("loadeddata",function(){e.play().catch(function(e){console.warn("Auto-play failed:",e)})})}},{key:"createNewAudioMessage",value:function(t,n,r,i){var a=e.createAudioElement(n,r),s=t.createMessageElementsOnOrientation("",r,i);return s.bubbleElement.appendChild(a),s.bubbleElement[M].add(e.AUDIO_BUBBLE_CLASS),{type:ne,elements:s,audioElement:a}}},{key:"createAnyFile",value:function(e){var t=R();t[M].add("any-file-message-contents");var n=R();n[M].add("any-file-message-icon-container");var r=ri.createSVGElement('<?xml version="1.0" encoding="iso-8859-1"?>\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" \n\t viewBox="50 30 420 450" xml:space="preserve">\n<g filter="brightness(0) saturate(100%) invert(16%) sepia(0%) saturate(1942%) hue-rotate(215deg) brightness(99%) contrast(93%)">\n\t<g>\n\t\t<path d="M447.933,103.629c-0.034-3.076-1.224-6.09-3.485-8.352L352.683,3.511c-0.004-0.004-0.007-0.005-0.011-0.008\n\t\t\tC350.505,1.338,347.511,0,344.206,0H89.278C75.361,0,64.04,11.32,64.04,25.237v461.525c0,13.916,11.32,25.237,25.237,25.237\n\t\t\th333.444c13.916,0,25.237-11.32,25.237-25.237V103.753C447.96,103.709,447.937,103.672,447.933,103.629z M356.194,40.931\n\t\t\tl50.834,50.834h-49.572c-0.695,0-1.262-0.567-1.262-1.262V40.931z M423.983,486.763c0,0.695-0.566,1.261-1.261,1.261H89.278\n\t\t\tc-0.695,0-1.261-0.566-1.261-1.261V25.237c0-0.695,0.566-1.261,1.261-1.261h242.94v66.527c0,13.916,11.322,25.239,25.239,25.239\n\t\t\th66.527V486.763z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,164.014H149.912c-6.62,0-11.988,5.367-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.368,11.988-11.988C374.076,169.381,368.707,164.014,362.088,164.014z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,236.353H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.368,11.988-11.988C374.076,241.721,368.707,236.353,362.088,236.353z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,308.691H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.367,11.988-11.988C374.076,314.06,368.707,308.691,362.088,308.691z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M256,381.031H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988H256\n\t\t\tc6.62,0,11.988-5.367,11.988-11.988C267.988,386.398,262.62,381.031,256,381.031z"/>\n\t</g>\n</g>\n</svg>');r[M].add("any-file-message-icon"),n.appendChild(r);var i=R();return i[M].add("any-file-message-text"),i.textContent=e.name||Z,t.appendChild(n),t.appendChild(i),vr.processContent(ae,t,e[X],i.textContent)}},{key:"createNewAnyFileMessage",value:function(t,n,r,i){var a=t.createMessageElementsOnOrientation("",r,i),s=e.createAnyFile(n);return a.bubbleElement[M].add(e.ANY_FILE_BUBBLE_CLASS),a.bubbleElement.appendChild(s),{type:Z,elements:a}}},{key:"createMessages",value:function(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n.map(function(n,s){var o;if(n.ref&&(n=vr.removeFileRef(n)),vr.isAudioFile(n)){var l=e.createNewAudioMessage(t,n,r,a),u=null==(o=t.textToSpeech)?void 0:o.audio;return u&&(u.autoPlay&&e.autoPlayAudio(l.audioElement),"boolean"==typeof u.displayAudio&&!u.displayAudio)?void 0:l}return vr.isImageFile(n)?e.createImageMessage(t,n,r,!a&&i&&0===s):e.createNewAnyFileMessage(t,n,r,a)}).filter(function(e){return void 0!==e})}},{key:"addMessages",value:function(t,n,r,i,a){e.createMessages(t,n,r,i,a).filter(function(e){return void 0!==e}).forEach(function(e){var n=e.type,i=e.elements;vr.addMessage(t,i,n,r,a)})}}])}();Ro.IMAGE_BUBBLE_CLASS="image-message",Ro.AUDIO_BUBBLE_CLASS="audio-message",Ro.ANY_FILE_BUBBLE_CLASS="any-file-message";var Po=Ro,Oo=function(){function e(){C(this,e)}return x(e,null,[{key:"removeElements",value:function(e,t){if(t){var n=e.findIndex(function(e){return e===t});e.splice(n,1),null==t||t.outerContainer.remove()}}},{key:"removeFilesMessages",value:function(t,n){var r;null==(r=n[1][Y])||r.forEach(function(n){e.removeElements(t.messageElementRefs,n)}),delete n[0][Y],delete n[1][Y]}},{key:"removeTextHTMLMessage",value:function(t,n,r){var i=n[1][r];e.removeElements(t.messageElementRefs,i),delete n[0][r],delete n[1][r]}},{key:"updateHTMLMessage",value:function(e,t,n){var r,i,a;if(t[1][N])jt.overwriteElements(e,n,t[1][N]);else{var s=jt.create(e,n,t[0][ue]),o=(null==(i=t[1][Y])?void 0:i[(null==(r=t[1][Y])?void 0:r.length)-1])||t[1][B],l=o.outerContainer.nextSibling;null==(a=null==l?void 0:l.parentElement)||a.insertBefore(s.outerContainer,l),e.messageElementRefs.splice(e.messageElementRefs.length-1,1);var u=e.messageElementRefs.findIndex(function(e){return e===o});e.messageElementRefs.splice(u+1,0,s),t[1][N]=s}t[0][N]=n}},{key:"updateFileMessages",value:function(t,n,r){var i,a,s=n[0][ue],o=Po.createMessages(t,r,s,!1),l=n[1][N],u=(null==(a=n[1][Y])?void 0:a[(null==(i=n[1][Y])?void 0:i.length)-1])||n[1][B],c=l||u,d=t.messageElementRefs.findIndex(function(e){return e===c});u&&(d+=1);var h=(null==l?void 0:l.outerContainer)||(null==u?void 0:u.outerContainer.nextSibling);o.forEach(function(e,n){var r,i=e.type,a=e.elements;vr.setElementProps(t,a,i,s),null==(r=h.parentElement)||r.insertBefore(a.outerContainer,h),t.messageElementRefs.splice(t.messageElementRefs.length-1,1),t.messageElementRefs.splice(d+n,0,a)}),e.removeFilesMessages(t,n),n[1][Y]=o.map(function(e){return e.elements}),n[0][Y]=r}},{key:"updateTextMessage",value:function(e,t,n){var r,i;if(t[1][B])e.renderText(t[1][B].bubbleElement,n,t[0][ue]);else{var a=e.createElements(n,t[0][ue]),s=(null==(r=t[1][Y])?void 0:r[0])||t[1][N];null==(i=s.outerContainer.parentElement)||i.insertBefore(a.outerContainer,s.outerContainer);var o=e.messageElementRefs.findIndex(function(e){return e===s});e.messageElementRefs.splice(o,0,a),t[1][B]=a}t[0][B]=n}},{key:"isElementActive",value:function(e){var t,n;return Bo.isActiveElement(null==(t=e[B])?void 0:t.bubbleElement[M])||Bo.isActiveElement(null==(n=e[N])?void 0:n.bubbleElement[M])}},{key:"update",value:function(t,n,r){var i=t.messageToElements[r];if(i){if(e.isElementActive(i[1]))return console[F]("Cannot update a message that is being streamed");n[B]&&e.updateTextMessage(t,i,n[B]),n[Y]?e.updateFileMessages(t,i,n[Y]):e.removeFilesMessages(t,i),n[N]&&e.updateHTMLMessage(t,i,n[N]),!n[B]&&i[1][B]&&e.removeTextHTMLMessage(t,i,B),!n[N]&&i[1][N]&&e.removeTextHTMLMessage(t,i,N);var a=t.messageElementRefs,s=t.avatar,o=t.name;Ir.classifyRoleMessages(a),Ir.resetAllRoleElements(a,s,o)}else console[F]("Message index not found. Please use the `getMessages` method to find the correct index")}}])}(),Lo=function(){return x(function e(){C(this,e)},null,[{key:"getText",value:function(e,t){var n,r;if(!(e.directConnection||e.connect||e.webModel||e.demo))return"Connect to any API using the [connect](".concat(D,"connect#connect-1) property or a popular service via [directConnection](").concat(D,"directConnection/#directConnection).\n Host AI entirely on your browser via a [webModel](").concat(D,"webModel).\n To get started checkout the [Start](https://deepchat.dev/start) page and live code [examples](https://deepchat.dev/examples/frameworks).\n To remove this message set the [demo](").concat(D,"modes#demo) property to true.");if(e.directConnection){if(!t.isDirectConnection())return"Please define a valid service inside\n          the [directConnection](".concat(D,"directConnection/#directConnection) object.");var i=null==(n=e.directConnection.openAI)?void 0:n.chat;if("object"==E(i)&&null!=(r=i.tools)&&r.find(function(e){return"function"===e.type})&&!i.function_handler)return"Please define the `function_handler` property inside the openAI [chat](".concat(D,"directConnection/openAI#Chat) object.")}else if(e.connect&&!e.connect.url&&!e.connect.handler)return"Please define a `url` or a `handler` property inside the [connect](".concat(D,"connect#connect-1) object.");return null}}])}(),Bo=function(e){function t(e,n,r){var i,a,s;C(this,t),i=d(this,t,[e]);var l=n.permittedErrorPrefixes,u=n.demo;i._errorMessageOverrides=null==(a=e.errorMessages)?void 0:a.overrides,i._onClearMessages=gr.onClearMessages.bind(i,e),i._onError=gr.onError.bind(i,e),i._isLoadingMessageAllowed=t.getDefaultDisplayLoadingMessage(e,n),"object"==E(e.displayLoadingBubble)&&e.displayLoadingBubble.toggle&&(e.displayLoadingBubble.toggle=i.setLoadingToggle.bind(i)),i._permittedErrorPrefixes=l,i.addSetupMessageIfNeeded(e,n)||i.populateIntroPanel(r),u&&i.prepareDemo(Ct.processDemo(u),e.loadHistory),i.addIntroductoryMessages(e,n);var c=new Zr(e,i,n);return i._displayServiceErrorMessages=null==(s=e.errorMessages)?void 0:s.displayServiceErrorMessages,e.getMessages=function(){return Ir.deepCloneMessagesWithReferences(i.messageToElements.map(function(e){return o(e,1)[0]}))},e.clearMessages=i.clearMessages.bind(i,n),e.refreshMessages=i.refreshTextMessages.bind(i,e.remarkable),e.scrollToBottom=kt.scrollToBottom.bind(i,i),e.addMessage=function(e,t){i.addAnyMessage(S(S({},e),{},{sendUpdate:!!t}),!t)},e.updateMessage=function(e,t){return Oo.update(i,e,t)},n.isWebModel()&&n.setUpMessages(i),e.textToSpeech&&St.processConfig(e.textToSpeech,function(e){i.textToSpeech=e}),i.elementRef.onscroll=k(g().m(function t(){var n,r;return g().w(function(t){for(;;)switch(t.n){case 0:e.loadHistory&&c.loadHistoryOnScroll(e.loadHistory),null==(n=i.scrollButton)||n.updateScroll(),null!=(r=i.browserStorage)&&r.trackScrollHeight&&i.browserStorage.addScrollHeight(i.elementRef.scrollTop);case 1:return t.a(2)}},t)})),i}return m(t,e),x(t,[{key:"setLoadingToggle",value:function(e){var t=this.messageElementRefs[this.messageElementRefs.length-1],n=Mr.isLoadingMessage(t);if(!e&&n)this.removeLastMessage(),delete this._activeLoadingConfig;else{if(this._activeLoadingConfig&&n){var r=Nt.getTargetWrapper(t.bubbleElement);if(r)return this._activeLoadingConfig=e||{},this.updateLoadingMessage(r);this.removeLastMessage()}this._activeLoadingConfig=e||{},this.addLoadingMessage(!0)}}},{key:"prepareDemo",value:function(e,t){var n;if("object"==E(e)){if(!t&&e.displayLoading){var r=e.displayLoading.history;null!=r&&r.small&&br.addMessage(this,!1),null!=r&&r.full&&br.addMessage(this)}e.displayErrors&&(e.displayErrors[Oe]&&this.addNewErrorMessage("",""),e.displayErrors.service&&this.addNewErrorMessage(L,""),e.displayErrors.speechToText&&this.addNewErrorMessage("speechToText","")),null!=(n=e.displayLoading)&&n.message&&this.addLoadingMessage(),e.response&&(this.customDemoResponse=e.response)}}},{key:"addSetupMessageIfNeeded",value:function(e,t){var n=Lo.getText(e,t);if(n){var r=this.createAndAppendNewMessageElement(n,j);this.applyCustomStyles(r,j,!1)}return!!n}},{key:"addIntroductoryMessages",value:function(e,t){var n=this;null!=e&&e.shadowRoot&&(this._introMessage=e.introMessage);var r=this._introMessage;null!=t&&t.isWebModel()&&(null!=r||(r=t.getIntroMessage(r)));var i=!(null!=e&&e.history||!(null!=e&&e.loadHistory||null!=t&&t.fetchHistory));r&&(Array.isArray(r)?r.forEach(function(e,t){if(0!==t){var r=n.messageElementRefs[n.messageElementRefs.length-1].innerContainer;Ir.hideRoleElements(r,n.avatar,n.name)}n.addIntroductoryMessage(e,i)}):this.addIntroductoryMessage(r,i))}},{key:"addIntroductoryMessage",value:function(e,t){var n,r;return null!=e&&e[B]?r=this.createAndAppendNewMessageElement(e[B],j):null!=e&&e[N]&&(r=jt.add(this,e[N],j)),r&&(this.applyCustomStyles(r,j,!1,null==(n=this.messageStyles)?void 0:n.intro),r.outerContainer[M].add(Mr.INTRO_CLASS),t&&(r.outerContainer[I].display="none")),r}},{key:"removeIntroductoryMessage",value:function(){var e=this.messageElementRefs[0];e.outerContainer[M].contains(Mr.INTRO_CLASS)&&(e.outerContainer.remove(),this.messageElementRefs.shift())}},{key:"addAnyMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e[F]?this.addNewErrorMessage(L,e[F],n):this.addNewMessage(e,t,n)}},{key:"tryAddTextMessage",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];void 0!==e[B]&&null!==n[B]&&(this.addNewTextMessage(e[B],e[ue],t,i),!r&&this.textToSpeech&&e[ue]!==U&&St.speak(e[B],this.textToSpeech))}},{key:"tryAddFileMessages",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e[Y]&&Array.isArray(e[Y])&&Po.addMessages(this,e[Y],e[ue],t,n)}},{key:"tryAddHTMLMessage",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==e[N]&&null!==e[N]){var r=jt.add(this,e[N],e[ue],t,n);!n&&Bt.isElementTemporary(r)&&delete e[N]}}},{key:"addNewMessage",value:function(e){var n,r,i,a,s=this,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e[ue]!==U&&(null==(n=this._hiddenAttachments)||n.removeHiddenFiles());var c=t.createMessageContent(e),d=null==(i=null==(r=this.textToSpeech)?void 0:r.audio)?void 0:i.displayText;"boolean"==typeof d&&!d&&delete c[B];var h=kt.isScrollbarAtBottomOfElement(this.elementRef),p={status:e.overwrite};return u?(this.tryAddFileMessages(c,h,u),this.tryAddHTMLMessage(c,p,u),this.tryAddTextMessage(c,p,e,l,u)):(this.tryAddTextMessage(c,p,e,l,u),this.tryAddHTMLMessage(c,p,u),this.tryAddFileMessages(c,h,u)),this.isValidMessageContent(c)&&!u&&(this.updateStateOnMessage(c,e.overwrite,e.sendUpdate,l),p.status||setTimeout(function(){return s.scrollToFirstElement(c[ue],h)}),l||null==(a=this.browserStorage)||a.addMessages(this.messageToElements.map(function(e){return o(e,1)[0]})),this.scrollButton&&c[ue]!==U&&this.tryUpdateHiddenMessageCount(l,e)),this._activeLoadingConfig&&this.addLoadingMessage(!1),c}},{key:"tryUpdateHiddenMessageCount",value:function(e,t){var n=this;(!e||void 0!==t.sendUpdate)&&setTimeout(function(){var e,t;return null==(t=null==(e=n.scrollButton)?void 0:e.updateHidden)?void 0:t.call(e)})}},{key:"isValidMessageContent",value:function(e){return e[B]||e[N]||e[Y]&&e[Y].length>0}},{key:"updateStateOnMessage",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t){var i=Ir.generateMessageBody(e,this.messageElementRefs);this.messageToElements.push([e,i])}n&&this.sendClientUpdate(e,r)}},{key:"removeMessageOnError",value:function(){var e=this.messageElementRefs[this.messageElementRefs.length-1],n=null==e?void 0:e.bubbleElement;(null!=n&&n[M].contains(Pr.MESSAGE_CLASS)&&""===n.textContent||t.isTemporaryElement(e))&&this.removeLastMessage()}},{key:"addNewErrorMessage",value:function(e,t){var n,r,i,a,s,o,l=this,u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null==(n=this._hiddenAttachments)||n.readdHiddenFiles(),this.removeMessageOnError();var c=this.getPermittedMessage(t)||(null==(r=this._errorMessageOverrides)?void 0:r[e])||(null==(i=this._errorMessageOverrides)?void 0:i[Oe])||"Error, please try again.",d=this.createMessageElementsOnOrientation(c,F,u);Ir.hideRoleElements(d.innerContainer,this.avatar,this.name);var h=d.bubbleElement,p=d.outerContainer;h[M].add(q),this.renderText(h,c);var f=mr.extractParticularSharedStyles(["fontSize","fontFamily"],null==(a=this.messageStyles)?void 0:a[Oe]);mr.applyCustomStylesToElements(d,!1,f),mr.applyCustomStylesToElements(d,!1,null==(s=this.messageStyles)?void 0:s[F]),u||this.appendOuterContainerElemet(p),this.textToSpeech&&St.speak(c,this.textToSpeech),null==(o=this._onError)||o.call(this,c),setTimeout(function(){return kt.scrollToBottom(l)})}},{key:"getPermittedMessage",value:function(e){if(e)for(var n=t.extractErrorMessages(e),r=0;r<n.length;r+=1){var i=n[r];if("string"==typeof i){if(this._displayServiceErrorMessages)return i;if(this._permittedErrorPrefixes){var a=t.checkPermittedErrorPrefixes(this._permittedErrorPrefixes,i);if(a)return a}}}}},{key:"removeError",value:function(){this.isLastMessageError()&&Ir.getLastMessageElement(this.elementRef).remove()}},{key:"addDefaultLoadingMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j,n=this.createMessageElements("",t),r=n.bubbleElement;n.bubbleElement[M].add(Et.DOTS_CONTAINER_CLASS);var i=R();return i[M].add("loading-message-dots"),r.appendChild(i),Et.setDots(r,e),n}},{key:"addLoadingMessage",value:function(){var e,t,n,r,i,a,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!Mr.isLoadingMessage(this.messageElementRefs[this.messageElementRefs.length-1])&&(this._activeLoadingConfig||s||this._isLoadingMessageAllowed)){var o=(null==(e=this._activeLoadingConfig)?void 0:e[ue])||j,l=(null==(t=this._activeLoadingConfig)?void 0:t[I])||(null==(r=null==(n=this.messageStyles)?void 0:n.loading)?void 0:r.message),u=null==l?void 0:l[N],c=u?jt.createElements(this,u,o,!1):this.addDefaultLoadingMessage(l,o);this.appendOuterContainerElemet(c.outerContainer),c.bubbleElement[M].add(Et.BUBBLE_CLASS),this.applyCustomStyles(c,o,!1,null==l?void 0:l.styles),null==(a=null==(i=this.avatar)?void 0:i.getAvatarContainer(c.innerContainer))||a[M].add("loading-avatar-container"),!this.focusMode&&kt.isScrollbarAtBottomOfElement(this.elementRef)&&kt.scrollToBottom(this)}}},{key:"updateLoadingMessage",value:function(e){var t,n=null==(t=this._activeLoadingConfig)?void 0:t[I],r=null==n?void 0:n[N];e.innerHTML=r||""}},{key:"populateIntroPanel",value:function(e){e&&(this._introPanel=new Io(e),Nt.apply(this,this._introPanel._elementRef),this.elementRef.appendChild(this._introPanel._elementRef))}},{key:"addMultipleFiles",value:(n=k(g().m(function e(t,n){return g().w(function(e){for(;;)if(0===e.n)return e.a(2,(this._hiddenAttachments=n,Promise.all((t||[]).map(function(e){return new Promise(function(t){if(e.type&&e.type!==ae){var n=new FileReader;n.readAsDataURL(e[Z]),n.onload=function(){var r=e[Z].name;t(w(w(w(w({},X,n.result),"name",r),"type",e.type),"ref",e[Z]))}}else{var r=e[Z].name||Z;t({name:r,type:ae,ref:e[Z]})}})}))))},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"clearMessages",value:function(e,n){var r,i,a,s,o,u=[];this.messageElementRefs.forEach(function(e){t.isActiveElement(e.bubbleElement[M])?u.push(e):e.outerContainer.remove()}),Array.from(this.elementRef.children).forEach(function(e){var t,n=null==(t=e.children[0])?void 0:t.children[0];null!=n&&n[M].contains(q)&&e.remove()}),this.messageElementRefs=u;var c=this.messageToElements.filter(function(e){return e[1][B]&&t.isActiveElement(e[1][B].bubbleElement[M])||e[1][N]&&t.isActiveElement(e[1][N].bubbleElement[M])});(r=this.messageToElements).splice.apply(r,[0,this.messageToElements.length].concat(l(c))),!1!==n&&(null!=(i=this._introPanel)&&i._elementRef&&this._introPanel.display(),this.addIntroductoryMessages()),null==(a=this.browserStorage)||a.clear(),null==(s=this.scrollButton)||s.clearHidden(),null==(o=this._onClearMessages)||o.call(this),delete e.sessionId}}],[{key:"getDefaultDisplayLoadingMessage",value:function(e,t){var n;return("object"!=E(e.displayLoadingBubble)||!e.displayLoadingBubble.toggle)&&(t.websocket?E(e.displayLoadingBubble)!==ct&&!!e.displayLoadingBubble:null===(n=E(e.displayLoadingBubble)===ct||e.displayLoadingBubble)||void 0===n||n)}},{key:"checkPermittedErrorPrefixes",value:function(e,t){for(var n=0;n<e.length;n+=1)if(t.startsWith(e[n]))return t}},{key:"extractErrorMessages",value:function(e){return Array.isArray(e)?e:e instanceof Error?[e.message]:"string"==typeof e?[e]:"object"==E(e)&&e[F]?[e[F]]:[]}},{key:"isActiveElement",value:function(e){return!!e&&(e.contains(Et.BUBBLE_CLASS)||e.contains(br.CLASS)||e.contains(Pr.MESSAGE_CLASS))}}]);var n}(Mr),No=function(){function e(){C(this,e)}return x(e,null,[{key:"adjustInputPadding",value:function(e,t){t[Ae].length>0&&e[M].add("text-input-inner-start-adjustment"),t[Me].length>0&&e[M].add("text-input-inner-end-adjustment")}},{key:"adjustForOutsideButton",value:function(e,t,n){0===n[Re].length&&n[Ie].length>0?(e[0][M].add(Ao),t[M].add(Ao)):0===n[Ie].length&&n[Re].length>0&&(e[3][M].add(Mo),t[M].add(Mo))}},{key:"adjustOutsideSubmit",value:function(e,t,n){if(!(n[Ae].length>0||n[Me].length>0)){if(0===n[Re].length&&n[Ie].length>0)return e[0][M].add(To),t[M].add(To),n[Ie].map(function(e){return e.button.elementRef[M].add("submit-button-enlarged")});if(0===n[Ie].length&&n[Re].length>0)return e[3][M].add(xo),t[M].add(xo),n[Re].map(function(e){return e.button.elementRef[M].add("submit-button-enlarged")})}}},{key:"set",value:function(t,n,r,i){!!e.adjustOutsideSubmit(n,r,i)||e.adjustForOutsideButton(n,r,i),e.adjustInputPadding(t,i)}}])}(),Fo=function(){function e(){C(this,e)}return x(e,null,[{key:"create",value:function(){return Array.from({length:4}).map(function(e,t){var n=R();return n[M].add("input-button-container"),(0===t||3===t)&&n[M].add("outer-button-container"),(1===t||2===t)&&n[M].add("inner-button-container"),n})}},{key:"add",value:function(e,t){e.insertBefore(t[1],e.firstChild),e.insertBefore(t[0],e.firstChild),e.appendChild(t[2]),e.appendChild(t[3])}},{key:"getContainerIndex",value:function(e){return e===Ie?0:e===Ae?1:e===Me?2:3}},{key:"addButton",value:function(t,n,r){n[M].add(r);var i=e.getContainerIndex(r);t[i].appendChild(n),3===i&&n[M].add(Re)}}])}(),Do=["camera","gifs","images","audio","mixedFiles","submit","microphone"],jo=function(){function e(){C(this,e)}return x(e,null,[{key:"addHighlightEvents",value:function(e,t){t.addEventListener("mouseenter",function(t){e.highlightedItem=t.target}),t.addEventListener("mouseleave",function(){e.highlightedItem=void 0})}},{key:"addItemEvents",value:function(t,n,r,i){Pt.add(n,i),n.addEventListener(Be,function(){r[Be]()}),e.addHighlightEvents(t,n)}},{key:"createItemText",value:function(t,n){var r=R();return Object.assign(r[I],n),r[M].add(e.TEXT_CLASS),r.textContent=t||"File",r}},{key:"createItemIcon",value:function(t,n){var r=R();return Object.assign(r[I],n),r[M].add(e.ICON_CLASS),r.appendChild(t),r}},{key:"populateItem",value:function(t,n,r){var i=t.elementRef,a=t.dropupText,s=t.svg,o=t.customStyles,l=i.children[0],u=o&&Object.values(o).find(function(e){var t;return""===(null==(t=e.svg)?void 0:t.content)});l[M].contains(va.INPUT_BUTTON_INNER_TEXT_CLASS)?(u||n.appendChild(e.createItemIcon(s,null==r?void 0:r.iconContainer)),n.appendChild(e.createItemText(l.textContent,null==r?void 0:r[B]))):(u||n.appendChild(e.createItemIcon(i.children[0],null==r?void 0:r.iconContainer)),n.appendChild(e.createItemText(a,null==r?void 0:r[B])))}},{key:"createItem",value:function(t,n,r){var i,a=R();Object.assign(a[I],null==(i=null==r?void 0:r.item)?void 0:i[Oe]),e.populateItem(n,a,r),a[M].add(e.MENU_ITEM_CLASS),a.tabIndex=0;var s=n.elementRef;if(n.isCustom)n.setDropupItem(t,a);else{var o=De.processStateful((null==r?void 0:r.item)||{});e.addItemEvents(t,a,s,o)}return a}}])}();jo.MENU_ITEM_CLASS="dropup-menu-item",jo.CUSTOM_BUTTON_ITEM_CLASS="dropup-menu-item-custom-button",jo.TEXT_CLASS="dropup-menu-item-text",jo.ICON_CLASS="dropup-menu-item-icon";var Uo=jo,Ho=function(e){function t(e,n,r,i){var a,s,o,l,u,c,h;C(this,t);var p=(null==(u=null==(l=null==(o=null==(s=null==e?void 0:e.styles)?void 0:s.button)?void 0:o[Oe])?void 0:l[B])?void 0:u.content)||"Custom ".concat(n),f=Ge.tryCreateConfig("Custom ".concat(n),null==e?void 0:e.tooltip);return(a=d(this,t,[t.createButtonElement(),'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" fill="none">\n  <rect x="2.5" y="2.5" width="17" height="17" rx="2" stroke="#000000" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',null==e?void 0:e.position,f,(null==(c=null==e?void 0:e.styles)?void 0:c.button)||f&&{},p]))._state=Oe,a.isCustom=!0,a._innerElements=a.createInnerElementsForStates(a.customStyles),a._menuStyles=i,a._onClick=e.onClick,a._dropupStyles=null==(h=e.styles)?void 0:h.dropup,a.setSetState(e),a.addClickListener(r),a.changeState(e.initialState,!0),a}return m(t,e),x(t,[{key:"createInnerElementsForStates",value:function(e){var t="custom-icon",n=this.createInnerElements(t,Oe,e);return w(w(w({},Oe,n),Ne,this.genStateInnerElements(t,Ne,n,e)),Fe,this.genStateInnerElements(t,Fe,n,e))}},{key:"setSetState",value:function(e){var t=this;e.setState=function(e){e===Oe&&t.changeToDefault(),e===Ne&&t.changeToActive(),e===Fe&&t.changeToDisabled()}}},{key:"addClickListener",value:function(e){var t=this;kt.assignButtonEvents(this.elementRef,function(){var n,r=null==(n=t._onClick)?void 0:n.call(t,t._state);null==e||e(),(r===Oe||r===Ne||r===Fe)&&t.changeState(r)})}},{key:"changeState",value:function(e,t){e===Fe?this.changeToDisabled(t):e===Ne?this.changeToActive(t):this.changeToDefault(t)}},{key:"applyDropupContentStyles",value:function(e){var t=Array.from(this.elementRef.children);if(null!=e&&e[B]){var n=t.find(function(e){return e[M].contains(Uo.TEXT_CLASS)});n&&Object.assign(n[I],e[B])}if(null!=e&&e.iconContainer){var r=t.find(function(e){return e[M].contains(Uo.ICON_CLASS)});r&&Object.assign(r[I],e.iconContainer)}}},{key:"resetDropupItem",value:function(e){var t,n,r;this.elementRef=Nt.replaceElementWithNewClone(this.elementRef,this._originalElementRef),this.elementRef.innerHTML="",""===(null==(t=null==e?void 0:e.svg)?void 0:t.content)||this.elementRef.appendChild(Uo.createItemIcon(this.svg,null==(n=this._menuStyles)?void 0:n.iconContainer)),this.elementRef.appendChild(Uo.createItemText(this.dropupText,null==(r=this._menuStyles)?void 0:r[B]))}},{key:"assignDropupItemStyle",value:function(e,t){var n;this.elementRef.parentElement&&this._originalElementRef&&this.resetDropupItem(t),Uo.addHighlightEvents(this._menu,this.elementRef),this.applyDropupContentStyles(e),Object.assign(this.elementRef[I],null==(n=null==e?void 0:e.item)?void 0:n[Oe]);var r=De.processStateful((null==e?void 0:e.item)||{});Pt.add(this.elementRef,r),this.addClickListener()}},{key:"changeToDefault",value:function(e){var n,r,i,a,s,o;!e&&this._state===Oe||(this.elementRef[M].contains(Uo.MENU_ITEM_CLASS)?this.assignDropupItemStyle(null==(n=this._dropupStyles)?void 0:n[Oe],null==(r=this.customStyles)?void 0:r[Oe]):(this.changeElementsByState(this._innerElements[Oe]),null!=(i=this.customStyles)&&i[Ne]&&ya.unsetAllCSS(this.elementRef,null==(a=this.customStyles)?void 0:a[Ne]),null!=(s=this.customStyles)&&s[Fe]&&ya.unsetAllCSS(this.elementRef,null==(o=this.customStyles)?void 0:o[Fe]),this.reapplyStateStyle(Oe,[Ne,Fe])),this.elementRef[M].remove(t.DISABLED_CONTAINER_CLASS,t.ACTIVE_CONTAINER_CLASS),this.elementRef[M].add(t.DEFAULT_CONTAINER_CLASS),pa.removeAriaDisabled(this.elementRef),this._state=Oe)}},{key:"changeToActive",value:function(e){var n,r;!e&&this._state===Ne||(this.elementRef[M].contains(Uo.MENU_ITEM_CLASS)?this.assignDropupItemStyle(null==(n=this._dropupStyles)?void 0:n[Ne],null==(r=this.customStyles)?void 0:r[Ne]):(this.changeElementsByState(this._innerElements[Ne]),this.reapplyStateStyle(Ne,[Fe,Oe])),this.elementRef[M].remove(t.DISABLED_CONTAINER_CLASS,t.DEFAULT_CONTAINER_CLASS),this.elementRef[M].add(t.ACTIVE_CONTAINER_CLASS),pa.removeAriaDisabled(this.elementRef),this._state=Ne)}},{key:"changeToDisabled",value:function(e){var n,r,i,a,s,o;!e&&this._state===Fe||(this.elementRef[M].contains(Uo.MENU_ITEM_CLASS)?this.assignDropupItemStyle(null==(n=this._dropupStyles)?void 0:n[Fe],null==(r=this.customStyles)?void 0:r[Fe]):(this.changeElementsByState(this._innerElements[Fe]),null!=(i=this.customStyles)&&i[Ne]&&ya.unsetAllCSS(this.elementRef,null==(a=this.customStyles)?void 0:a[Ne]),null!=(s=this.customStyles)&&s[Oe]&&ya.unsetAllCSS(this.elementRef,null==(o=this.customStyles)?void 0:o[Oe]),this.reapplyStateStyle(Fe,[Oe,Ne])),this.elementRef[M].remove(t.ACTIVE_CONTAINER_CLASS,t.DEFAULT_CONTAINER_CLASS),this.elementRef[M].add(t.DISABLED_CONTAINER_CLASS),pa.addAriaDisabled(this.elementRef),this._state=Fe)}},{key:"setDropupItem",value:function(e,t){this._menu=e,this.elementRef=t,this._originalElementRef=t.cloneNode(!0),this.changeState(this._state,!0)}},{key:"genStateInnerElements",value:function(e,n,r,i){var a,s,o,l,u=this.createInnerElements(e,n,i),c=null==(s=null==(a=null==i?void 0:i[n])?void 0:a.svg)?void 0:s.content,d=null==(l=null==(o=null==i?void 0:i[n])?void 0:o[B])?void 0:l.content;if(void 0===c||void 0===d){var h=ga.parseSVGTextElements(r),p=h.svg,f=h[B],m=ga.parseSVGTextElements(u),v=m.svg,g=m[B],y=[];t.addToInnerElements(y,c,p,v),t.addToInnerElements(y,d,f,g),u=y}return u}}],[{key:"createButtonElement",value:function(){var e=R();return e[M].add("input-button",t.BUTTON_CLASS),e}},{key:"addToInnerElements",value:function(e,t,n,r){void 0===t&&n?e.push(n.cloneNode(!0)):r&&e.push(r)}},{key:"add",value:function(e,n){var r=e.customButtons,i=e.focusInput,a=e.dropupStyles;null==r||r.forEach(function(e,r){var s={button:new t(e,r+1,i,null==a?void 0:a.menu)};n["".concat(t.INDICATOR_PREFIX).concat(r+1)]=s})}}])}(ba);Ho.INDICATOR_PREFIX="custom",Ho.BUTTON_CLASS="custom-button",Ho.DISABLED_CONTAINER_CLASS="custom-button-container-disabled",Ho.DEFAULT_CONTAINER_CLASS="custom-button-container-default",Ho.ACTIVE_CONTAINER_CLASS="custom-button-container-active";var qo=Ho,zo=function(){function e(){C(this,e)}return x(e,null,[{key:"focusItemWhenOnEdge",value:function(t,n){var r=t.elementRef,i=n?r.children[0]:r.children[r.children.length-1];e.focusSiblingItem(t,i,n,!0)}},{key:"focusSiblingItem",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?n:n[r?"nextSibling":"previousSibling"];i?(n.dispatchEvent(new MouseEvent("mouseleave")),i.dispatchEvent(new MouseEvent("mouseenter")),i.focus()):(n.dispatchEvent(new MouseEvent("mouseleave")),e.focusItemWhenOnEdge(t,r))}}])}(),Go=function(){return x(function e(t,n){var r,i=this;C(this,e),this._isOpen=!0,this._styles=n,this.elementRef=e.createElement(null==(r=this._styles)?void 0:r.container),this.close(),setTimeout(function(){return i.addWindowEvents(t)})},[{key:"open",value:function(){this.elementRef[I].display="block",this._isOpen=!0}},{key:"close",value:function(){this._isOpen&&(this.elementRef[I].display="none",this._isOpen=!1)}},{key:"toggle",value:function(){this._isOpen?this.close():this.open()}},{key:"addItem",value:function(e){var t=Uo.createItem(this,e,this._styles);this.elementRef.appendChild(t)}},{key:"addWindowEvents",value:function(e){this.clickEvent=this.windowClick.bind(this,e),window.addEventListener(Be,this.clickEvent),this.keyDownEvent=this.windowKeyDown.bind(this,e),window.addEventListener("keydown",this.keyDownEvent)}},{key:"windowClick",value:function(e,t){var n;!e.isConnected&&this.clickEvent?window.removeEventListener(Be,this.clickEvent):e.parentElement!==(null==(n=t.target.shadowRoot)?void 0:n.children[0])&&this.close()}},{key:"windowKeyDown",value:function(e,t){var n,r,i;!e.isConnected&&this.keyDownEvent?window.removeEventListener("keydown",this.keyDownEvent):this._isOpen&&(t.key===Ve.ESCAPE?(this.close(),null==(n=this.highlightedItem)||n.dispatchEvent(new MouseEvent("mouseleave"))):t.key===Ve.ENTER?(null==(r=this.highlightedItem)||r[Be](),null==(i=this.highlightedItem)||i.dispatchEvent(new MouseEvent("mouseleave"))):t.key===Ve.ARROW_DOWN?zo.focusSiblingItem(this,this.highlightedItem||this.elementRef.children[this.elementRef.children.length-1],!0):t.key===Ve.ARROW_UP&&zo.focusSiblingItem(this,this.highlightedItem||this.elementRef.children[0],!1))}}],[{key:"createElement",value:function(e){var t=R();return t.id=Pe,Object.assign(t[I],e),t}}])}(),Wo=function(e){function t(e,n){var r,i,a;C(this,t);var s=Ge.tryCreateConfig("Options",null==(i=null==n?void 0:n.button)?void 0:i.tooltip),o=(r=d(this,t,[t.createButtonElement(),'<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n    <path d="M16 0c-8.836 0-16 7.163-16 16s7.163 16 16 16c8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 30.032c-7.72 0-14-6.312-14-14.032s6.28-14 14-14 14 6.28 14 14-6.28 14.032-14 14.032zM23 15h-6v-6c0-0.552-0.448-1-1-1s-1 0.448-1 1v6h-6c-0.552 0-1 0.448-1 1s0.448 1 1 1h6v6c0 0.552 0.448 1 1 1s1-0.448 1-1v-6h6c0.552 0 1-0.448 1-1s-0.448-1-1-1z"></path>\n</svg>',void 0,s,{styles:null==(a=null==n?void 0:n.button)?void 0:a.styles}])).createInnerElementsForStates(r.customStyles);return r._menu=new Go(e,null==n?void 0:n.menu),r.addClickEvent(),r.buttonContainer=t.createButtonContainer(),r.changeElementsByState(o.styles),r.buttonContainer.appendChild(r.elementRef),r.elementRef[M].add(t.BUTTON_ICON_CLASS),r.buttonContainer.appendChild(r._menu.elementRef),r.reapplyStateStyle("styles"),r.addContainerEvents(e),r}return m(t,e),x(t,[{key:"createInnerElementsForStates",value:function(e){return{styles:this.createInnerElements("dropup-icon","styles",e)}}},{key:"addClickEvent",value:function(){var e=this;this.elementRef.onclick=this._menu.toggle.bind(this._menu),this.elementRef.onkeydown=function(t){t.key===Ve.ENTER&&setTimeout(function(){e._menu.toggle();var t=e._menu.elementRef.children[0];t.focus(),t.dispatchEvent(new MouseEvent("mouseenter"))})}}},{key:"addItem",value:function(e){this._menu.addItem(e)}},{key:"addContainerEvents",value:function(e){var n=this;e.addEventListener(Be,function(e){var r=e.target[M];!r.contains(t.BUTTON_ICON_CLASS)&&!r.contains(qo.DISABLED_CONTAINER_CLASS)&&n._menu.close()})}}],[{key:"createButtonElement",value:function(){var e=R();return e[M].add("input-button"),e}},{key:"createButtonContainer",value:function(){var e=R();return e.id="dropup-container",e}},{key:"getPosition",value:function(e,t){var n,r;return null!=(n=null==t?void 0:t.button)&&n.position?Ct.processPosition(null==(r=null==t?void 0:t.button)?void 0:r.position):e[Ie].length>0&&0===e[Re].length?Re:Ie}}])}(ba);Wo.BUTTON_ICON_CLASS="dropup-button";var Ko=Wo,Vo=function(){function e(){C(this,e)}return x(e,null,[{key:"addToDropup",value:function(e,t,n,r){var i=new Ko(n,r);Do.forEach(function(e){var n=t[Pe].findIndex(function(t){return t.buttonType===e}),r=t[Pe][n];r&&(i.addItem(r.button),t[Pe].splice(n,1))}),t[Pe].forEach(function(e){var t=e.button;return i.addItem(t)});var a=Ko.getPosition(t,r);Fo.addButton(e,i.buttonContainer,a),t[a].push({})}},{key:"addToSideContainer",value:function(e,t){[Ae,Me,Ie,Re].forEach(function(n){var r=n;t[r].forEach(function(t){Fo.addButton(e,t.button.elementRef,r)})})}},{key:"setPosition",value:function(e,t,n){var r=S(S({},e[t]),{},{buttonType:t});n.push(r),delete e[t]}},{key:"createPositionsToButtonsObj",value:function(){return w(w(w(w(w({},Pe,[]),Ie,[]),Ae,[]),Me,[]),Re,[])}},{key:"generatePositionToButtons",value:function(t){var n=e.createPositionsToButtonsObj();Object.keys(t).forEach(function(r){var i,a=null==(i=t[r])?void 0:i.button.position;a&&e.setPosition(t,r,n[a])}),0===n[Me].length&&t.submit&&e.setPosition(t,"submit",n[Me]),0===n[Re].length&&(t.submit?e.setPosition(t,"submit",n[Re]):t.microphone?e.setPosition(t,re,n[Re]):t.camera?e.setPosition(t,ee,n[Re]):t["".concat(qo.INDICATOR_PREFIX,"1")]&&e.setPosition(t,"".concat(qo.INDICATOR_PREFIX,"1"),n[Re])),t.submit&&e.setPosition(t,"submit",0===n[Ie].length?n[Ie]:n[Me]),t.microphone&&e.setPosition(t,re,0===n[Ie].length?n[Ie]:n[Me]);var r=Object.keys(t);return r.length>1||n[Pe].length>0?(Do.forEach(function(e){t[e]&&n[Pe].push(S(S({},t[e]),{},{buttonType:e}))}),r.forEach(function(e){var r=e;r.startsWith(qo.INDICATOR_PREFIX)&&t[r]&&n[Pe].push(S(S({},t[r]),{},{customType:r}))})):1===r.length&&e.setPosition(t,r[0],0===n[Re].length?n[Re]:n[Ie]),n}},{key:"addButtons",value:function(t,n,r,i){var a=e.generatePositionToButtons(n);return e.addToSideContainer(t,a),a[Pe].length>0&&e.addToDropup(t,a,r,i),a}}])}(),Xo=w(w(w(w({},$,{id:"upload-images-icon",svgString:'<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n  <path d="M20,15.2928932 L20,5.5 C20,4.67157288 19.3284271,4 18.5,4 L5.5,4 C4.67157288,4 4,4.67157288 4,5.5 L4,12.2928932 L7.14644661,9.14644661 C7.34170876,8.95118446 7.65829124,8.95118446 7.85355339,9.14644661 L13.5,14.7928932 L16.1464466,12.1464466 C16.3417088,11.9511845 16.6582912,11.9511845 16.8535534,12.1464466 L20,15.2928932 Z M20,16.7071068 L16.5,13.2071068 L13.8535534,15.8535534 C13.6582912,16.0488155 13.3417088,16.0488155 13.1464466,15.8535534 L7.5,10.2071068 L4,13.7071068 L4,18.5 C4,19.3284271 4.67157288,20 5.5,20 L18.5,20 C19.3284271,20 20,19.3284271 20,18.5 L20,16.7071068 Z M3,5.5 C3,4.11928813 4.11928813,3 5.5,3 L18.5,3 C19.8807119,3 21,4.11928813 21,5.5 L21,18.5 C21,19.8807119 19.8807119,21 18.5,21 L5.5,21 C4.11928813,21 3,19.8807119 3,18.5 L3,5.5 Z M15,6 L17,6 C17.5522847,6 18,6.44771525 18,7 L18,9 C18,9.55228475 17.5522847,10 17,10 L15,10 C14.4477153,10 14,9.55228475 14,9 L14,7 C14,6.44771525 14.4477153,6 15,6 Z M15,7 L15,9 L17,9 L17,7 L15,7 Z"/>\n</svg>\n',dropupText:"Image"}),te,{id:"upload-gifs-icon",svgString:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 5.9266752 5.6408391" height="21.31971" width="22.4">\n  <g>\n    <path d="m 5.2564627,1.548212 c -3.1136005,-0.4796804 -1.5568006,-0.2398402 0,0 z M 2.0001198,2.0922063 c 0.1556781,0 0.2657489,0.020893 0.3917849,0.080366 0.081154,0.038347 0.1153492,0.134065 0.076377,0.2138602 -0.038973,0.07979 -0.1363527,0.1134129 -0.2175069,0.075091 -0.078199,-0.036919 -0.1407455,-0.048792 -0.250655,-0.048792 -0.2260486,0 -0.3921482,0.2042182 -0.3921482,0.4801409 0,0.2761822 0.1663188,0.4810688 0.3921482,0.4810688 0.1117901,0 0.2064255,-0.046133 0.255659,-0.1284198 l 0.00162,-0.00389 V 3.0534032 l -0.098011,1.75e-4 c -0.081844,0 -0.1495979,-0.059305 -0.1612403,-0.1365887 l -0.00175,-0.023683 c 0,-0.08047 0.060311,-0.1470874 0.1389194,-0.1585331 l 0.024085,-0.00195 h 0.2612303 c 0.081842,0 0.149598,0.059305 0.1612404,0.1365891 l 0.00175,0.023683 -3.398e-4,0.3968809 v 0 l -0.00168,0.014211 v 0 l -0.00553,0.023034 v 0 l -0.00532,0.014145 c -0.098178,0.22826 -0.3236506,0.3528713 -0.5706303,0.3528713 -0.4240855,0 -0.7181621,-0.3622714 -0.7181621,-0.8016063 0,-0.4391857 0.2940275,-0.8006848 0.7181621,-0.8006848 z m 1.2034759,0.031275 c 0.081843,0 0.1495977,0.059305 0.1612403,0.1365891 l 0.00175,0.023683 v 1.2211775 c 0,0.088516 -0.07298,0.1602721 -0.1630073,0.1602721 -0.081841,0 -0.1495972,-0.059305 -0.1612397,-0.1365892 L 3.040589,3.5049308 V 2.2837527 c 0,-0.088516 0.07298,-0.1602721 0.1630067,-0.1602714 z m 0.7813442,0 0.5209469,0.00195 c 0.090025,3.048e-4 0.1627543,0.072306 0.1624458,0.1608234 -2.809e-4,0.08047 -0.06083,0.1468798 -0.1394772,0.158066 l -0.024092,0.00195 -0.3575326,-0.0013 v 0.4497782 l 0.2928918,2.27e-4 c 0.081842,0 0.1495979,0.059305 0.1612403,0.136589 l 0.00175,0.023683 c 0,0.080469 -0.06031,0.1470871 -0.1389193,0.1585393 l -0.024092,0.00195 -0.2928919,-2.336e-4 1.563e-4,0.2860316 c 0,0.080471 -0.06031,0.1470873 -0.1389193,0.1585395 l -0.024085,0.00195 c -0.081843,0 -0.1495979,-0.059305 -0.1612403,-0.1365826 l -0.00175,-0.023691 V 2.2841354 c 2.798e-4,-0.08047 0.060829,-0.1468797 0.1394758,-0.1580594 z"/>\n    <path d="m 5.0894191,1.0943261 c 0,-0.21918999 -0.177687,-0.39686999 -0.396876,-0.39686999 h -3.43959 c -0.2191879,0 -0.391262,0.1777519 -0.3968759,0.39686999 l -0.027082,3.4379266 c 0.040152,0.2939927 0.4235456,0.409415 0.4235456,0.409415 l 3.4785583,-0.00851 c 0,0 0.3008506,-0.1402998 0.3236271,-0.4201576 0.042911,-0.5272495 0.034693,-1.6106146 0.034693,-3.4186761 z m -4.49792494,0 c 0,-0.36530999 0.29614504,-0.66145999 0.66145894,-0.66145999 h 3.43959 c 0.365314,0 0.66146,0.29615 0.66146,0.66145999 v 3.43959 c 0,0.36532 -0.296146,0.66146 -0.66146,0.66146 h -3.43959 c -0.3653139,0 -0.66145894,-0.29614 -0.66145894,-0.66146 z"/>\n  </g>\n</svg>\n',dropupText:"GIF"}),ne,{id:"upload-audio-icon",svgString:'<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-49.49 -49.49 593.87 593.87" stroke-width="3.95908" transform="rotate(0)">\n  <g stroke-width="0"></g>\n  <g stroke-linecap="round" stroke-linejoin="round" stroke-width="0.98977"></g>\n  <g>\n    <g>\n      <g>\n        <path d="M163.205,76.413v293.301c-3.434-3.058-7.241-5.867-11.486-8.339c-21.38-12.452-49.663-15.298-77.567-7.846 c-49.038,13.096-80.904,54.519-71.038,92.337c4.019,15.404,14.188,28.221,29.404,37.087c13.553,7.894,29.87,11.933,47.115,11.933 c9.962,0,20.231-1.356,30.447-4.087c42.74-11.406,72.411-44.344,72.807-77.654h0.011v-0.162c0.002-0.166,0-0.331,0-0.496V187.072 l290.971-67.3v178.082c-3.433-3.055-7.238-5.863-11.481-8.334c-21.385-12.452-49.654-15.308-77.567-7.846 c-49.038,13.087-80.904,54.519-71.038,92.356c4.019,15.385,14.183,28.212,29.404,37.067c13.548,7.894,29.875,11.933,47.115,11.933 c9.962,0,20.231-1.356,30.452-4.087c42.74-11.413,72.411-44.346,72.804-77.654h0.004v-0.065c0.003-0.236,0.001-0.469,0-0.704V0 L163.205,76.413z M104.999,471.779c-22.543,6.038-45.942,3.846-62.572-5.846c-10.587-6.163-17.591-14.817-20.255-25.038 c-7.144-27.375,18.452-58.029,57.062-68.346c8.409-2.25,16.938-3.346,25.188-3.346c13.87,0,26.962,3.115,37.389,9.192 c10.587,6.163,17.591,14.817,20.255,25.029c0.809,3.102,1.142,6.248,1.139,9.4v0.321h0.014 C162.99,437.714,139.082,462.678,104.999,471.779z M182.898,166.853V92.067l290.971-67.298v74.784L182.898,166.853z M415.677,399.923c-22.558,6.038-45.942,3.837-62.587-5.846c-10.587-6.163-17.587-14.817-20.25-25.019 c-7.144-27.385,18.452-58.058,57.058-68.365c8.414-2.25,16.942-3.346,25.192-3.346c13.875,0,26.962,3.115,37.385,9.192 c10.596,6.163,17.596,14.817,20.26,25.029v0.01c0.796,3.05,1.124,6.144,1.135,9.244v0.468h0.02 C473.668,365.851,449.763,390.814,415.677,399.923z">\n        </path>\n      </g>\n    </g>\n  </g>\n</svg>',dropupText:"Audio"}),"mixedFiles",{id:"upload-mixed-files-icon",svgString:'<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M20 10.9696L11.9628 18.5497C10.9782 19.4783 9.64274 20 8.25028 20C6.85782 20 5.52239 19.4783 4.53777 18.5497C3.55315 17.6211 3 16.3616 3 15.0483C3 13.7351 3.55315 12.4756 4.53777 11.547L12.575 3.96687C13.2314 3.34779 14.1217 3 15.05 3C15.9783 3 16.8686 3.34779 17.525 3.96687C18.1814 4.58595 18.5502 5.4256 18.5502 6.30111C18.5502 7.17662 18.1814 8.01628 17.525 8.63535L9.47904 16.2154C9.15083 16.525 8.70569 16.6989 8.24154 16.6989C7.77738 16.6989 7.33224 16.525 7.00403 16.2154C6.67583 15.9059 6.49144 15.4861 6.49144 15.0483C6.49144 14.6106 6.67583 14.1907 7.00403 13.8812L14.429 6.88674" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',dropupText:"File"}),Jo=function(e){function t(e){var n;C(this,t),(null==e?void 0:e.position)===Pe&&(e.position=Re);var r=Ge.tryCreateConfig("Microphone",null==e?void 0:e.tooltip);return(n=d(this,t,[t.createMicrophoneElement(),fa,null==e?void 0:e.position,r,e])).isActive=!1,n._innerElements=n.createInnerElementsForStates(n.customStyles),n.changeToDefault(),n}return m(t,e),x(t,[{key:"createInnerElementsForStates",value:function(e){var t="microphone-icon";return w(w(w(w({},Oe,this.createInnerElements(t,Oe,e)),Ne,this.createInnerElements(t,Ne,e)),"unsupported",this.createInnerElements(t,"unsupported",e)),"commandMode",this.createInnerElements(t,"commandMode",e))}},{key:"changeToActive",value:function(){this.changeElementsByState(this._innerElements[Ne]),this.toggleIconFilter(Ne),this.reapplyStateStyle(Ne,[Oe,"commandMode"]),this.isActive=!0}},{key:"changeToDefault",value:function(){this.changeElementsByState(this._innerElements[Oe]),this.toggleIconFilter(Oe),this.reapplyStateStyle(Oe,[Ne,"commandMode"]),this.isActive=!1}},{key:"changeToCommandMode",value:function(){this.changeElementsByState(this._innerElements.commandMode),this.toggleIconFilter("command"),this.reapplyStateStyle("commandMode",[Ne])}},{key:"changeToUnsupported",value:function(){this.changeElementsByState(this._innerElements.unsupported),this.elementRef[M].add("unsupported-microphone"),this.reapplyStateStyle("unsupported",[Ne])}},{key:"toggleIconFilter",value:function(e){var t=this.elementRef.children[0];if("svg"===t.tagName.toLocaleLowerCase())switch(e){case Oe:t[M].remove("active-microphone-icon","command-microphone-icon"),t[M].add("default-microphone-icon");break;case Ne:t[M].remove("default-microphone-icon","command-microphone-icon"),t[M].add("active-microphone-icon");break;case"command":t[M].remove("active-microphone-icon","default-microphone-icon"),t[M].add("command-microphone-icon")}}}],[{key:"createMicrophoneElement",value:function(){var e=R();return e.id="microphone-button",e[M].add("input-button"),e}}])}(ba);function Zo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Yo,Qo,$o,el={},tl={},nl={},rl={},il={};function al(){if(Yo)return il;Yo=1,Object.defineProperty(il,"__esModule",{value:!0}),il.Text=void 0;var e=function(){function e(){C(this,e)}return x(e,null,[{key:"capitalize",value:function(t){return t.replace(e.FIRST_CHAR_REGEX,function(e){return e.toUpperCase()})}},{key:"lineBreak",value:function(t){return t.replace(e.DOUBLE_LINE,"<p></p>").replace(e.ONE_LINE,"<br>")}},{key:"isCharDefined",value:function(e){return void 0!==e&&"\xa0"!==e&&" "!==e&&"\n"!==e&&""!==e}},{key:"breakupIntoWordsArr",value:function(e){return e.split(/(\W+)/)}}])}();return il.Text=e,e.FIRST_CHAR_REGEX=/\S/,e.DOUBLE_LINE=/\n\n/g,e.ONE_LINE=/\n/g,il}function sl(){if(Qo)return rl;Qo=1,Object.defineProperty(rl,"__esModule",{value:!0}),rl.Translate=void 0;var e=al(),t=function(){return x(function e(){C(this,e)},null,[{key:"translate",value:function(t,n){for(var r=e.Text.breakupIntoWordsArr(t),i=0;i<r.length;i+=1)n[r[i]]&&(r[i]=n[r[i]]);return r.join("")}}])}();return rl.Translate=t,rl}var ol,ll={};function ul(){if(ol)return ll;ol=1,Object.defineProperty(ll,"__esModule",{value:!0}),ll.Browser=void 0;var e=x(function e(){C(this,e)});return ll.Browser=e,e.IS_SAFARI=function(){return void 0===e._IS_SAFARI&&(e._IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),e._IS_SAFARI},ll}var cl,dl={},hl={};var pl,fl={};var ml,vl={},gl={};function yl(){if(ml)return gl;ml=1,Object.defineProperty(gl,"__esModule",{value:!0}),gl.AutoScroll=void 0;var e=function(){function e(){C(this,e)}return x(e,null,[{key:"changeStateIfNeeded",value:function(e,t){t&&!e.isCursorAtEnd&&(e.endPadding="",e.scrollingSpan.innerHTML="&nbsp;")}},{key:"scrollGeneric",value:function(e,t){e.isCursorAtEnd?t.scrollTop=t.scrollHeight:e.scrollingSpan.scrollIntoView({block:"nearest"})}},{key:"scrollSafariPrimitiveToEnd",value:function(e){e.scrollLeft=e.scrollWidth,e.scrollTop=e.scrollHeight}},{key:"isElementOverflown",value:function(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}},{key:"isRequired",value:function(t,n){return t&&e.isElementOverflown(n)}}])}();return gl.AutoScroll=e,gl}var bl,kl={};function _l(){if(bl)return kl;bl=1,Object.defineProperty(kl,"__esModule",{value:!0}),kl.Elements=void 0;var e=function(){return x(function e(){C(this,e)},null,[{key:"isPrimitiveElement",value:function(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName}},{key:"createInterimSpan",value:function(){var e=document.createElement("span");return e.style.color="grey",e.style.pointerEvents="none",e}},{key:"createGenericSpan",value:function(){var e=document.createElement("span");return e.style.pointerEvents="none",e}},{key:"appendSpans",value:function(e,t){if(e.spansPopulated=!0,e.insertInCursorLocation&&document.activeElement===t){var n=window.getSelection();if(null!=n&&n.focusNode){var r=n.getRangeAt(0);return r.insertNode(e.scrollingSpan),r.insertNode(e.interimSpan),r.insertNode(e.finalSpan),r.collapse(!1),n.removeAllRanges(),void n.addRange(r)}}t.appendChild(e.finalSpan),t.appendChild(e.interimSpan),t.appendChild(e.scrollingSpan)}},{key:"applyCustomColors",value:function(e,t){t.interim&&(e.interimSpan.style.color=t.interim),t.final&&(e.finalSpan.style.color=t.final)}},{key:"isInsideShadowDOM",value:function(e){return e.getRootNode()instanceof ShadowRoot}}])}();return kl.Elements=e,kl}var Sl,wl,El={};function Cl(){if(Sl)return El;Sl=1,Object.defineProperty(El,"__esModule",{value:!0}),El.Cursor=void 0;var e=function(){function e(){C(this,e)}return x(e,null,[{key:"setOffsetForGeneric",value:function(t,n){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=0,a=0;a<t.childNodes.length;a+=1){var s=t.childNodes[a];if(s.childNodes.length>0){var o=e.setOffsetForGeneric(s,n,r);if(-1===o)return-1;r+=o}else if(null!==s.textContent){if(r+s.textContent.length>n){var l=document.createRange();l.setStart(s,n-r),l.collapse(!0);var u=window.getSelection();return null==u||u.removeAllRanges(),null==u||u.addRange(l),t.focus(),-1}r+=s.textContent.length,i+=s.textContent.length}}return i}},{key:"focusEndOfGeneric",value:function(e){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t))}},{key:"setOffsetForSafariGeneric",value:function(t,n){var r=window.getSelection();if(r){var i=e.getGenericElementCursorOffset(t,r,!0);e.setOffsetForGeneric(t,i+n)}}},{key:"setOffsetForPrimitive",value:function(e,t,n){n&&e.blur(),e.setSelectionRange(t,t),e.focus()}},{key:"getGenericElementCursorOffset",value:function(e,t,n){var r=0;if(t.rangeCount>0){var i=t.getRangeAt(0),a=i.cloneRange();a.selectNodeContents(e),n?a.setEnd(i.startContainer,i.startOffset):a.setEnd(i.endContainer,i.endOffset),r=a.toString().length}return r}}])}();return El.Cursor=e,El}function Tl(){if(wl)return vl;wl=1,Object.defineProperty(vl,"__esModule",{value:!0}),vl.CommandUtils=void 0;var e=yl(),t=_l(),n=ul(),r=Cl(),i=al(),a=function(){function a(){C(this,a)}return x(a,null,[{key:"processCommand",value:function(e,t){return(!t||!t.caseSensitive)&&(e=e.toLowerCase()),!1===(null==t?void 0:t.substrings)?i.Text.breakupIntoWordsArr(e):e}},{key:"process",value:function(e){var t;return!0===(null===(t=e.settings)||void 0===t?void 0:t.caseSensitive)?e:Object.keys(e).reduce(function(t,n){var r=e[n];return t[n]="string"==typeof r?a.processCommand(r,e.settings):r,t},{})}},{key:"toggleCommandModeOn",value:function(e){var t;e.isWaitingForCommand=!0,null===(t=e.onCommandModeTrigger)||void 0===t||t.call(e,!0)}},{key:"toggleCommandModeOff",value:function(e){var t;e.isWaitingForCommand&&(null===(t=e.onCommandModeTrigger)||void 0===t||t.call(e,!1),e.isWaitingForCommand=!1)}},{key:"setText",value:function(i,s,o,l){a.toggleCommandModeOff(i),t.Elements.isPrimitiveElement(l)?(l.value=o,i.isTargetInShadow||r.Cursor.setOffsetForPrimitive(l,o.length,!0),n.Browser.IS_SAFARI()&&i.autoScroll&&e.AutoScroll.scrollSafariPrimitiveToEnd(l)):(l.textContent=o,i.isTargetInShadow||r.Cursor.focusEndOfGeneric(l),setTimeout(function(){return e.AutoScroll.scrollGeneric(i,l)})),i.resetRecording(s)}},{key:"checkIfMatchesSubstring",value:function(e,t){return t.includes(e)}},{key:"checkIfMatchesWord",value:function(e,t,n){for(var r=e,i=n.length-1;i>=0;i-=1){for(var a=i,s=r.length-1;n[a]===r[s]&&s>=0;)a-=1,s-=1;if(s<0)return!0}return!1}},{key:"execCommand",value:function(e,t,n,r,s){var o,l,u,c=e.commands;if(c&&r&&n){var d=!0===(null===(o=c.settings)||void 0===o?void 0:o.caseSensitive)?t:t.toLowerCase(),h=i.Text.breakupIntoWordsArr(d),p=!1===(null===(l=c.settings)||void 0===l?void 0:l.substrings)?a.checkIfMatchesWord:a.checkIfMatchesSubstring;if(c.commandMode&&p(c.commandMode,d,h))return e.setInterimColorToFinal(),setTimeout(function(){return a.toggleCommandModeOn(e)}),{doNotProcessTranscription:!1};if(!c.commandMode||e.isWaitingForCommand){if(c.stop&&p(c.stop,d,h))return a.toggleCommandModeOff(e),setTimeout(function(){return e.stop()}),{doNotProcessTranscription:!1};if(c.pause&&p(c.pause,d,h))return a.toggleCommandModeOff(e),e.setInterimColorToFinal(),setTimeout(function(){var t;e.isPaused=!0,null===(t=e.onPauseTrigger)||void 0===t||t.call(e,!0)}),{doNotProcessTranscription:!1};if(c.resume&&p(c.resume,d,h))return e.isPaused=!1,null===(u=e.onPauseTrigger)||void 0===u||u.call(e,!1),a.toggleCommandModeOff(e),e.resetRecording(n),{doNotProcessTranscription:!0};if(c.reset&&p(c.reset,d,h))return void 0!==s&&a.setText(e,n,s,r),{doNotProcessTranscription:!0};if(c.removeAllText&&p(c.removeAllText,d,h))return a.setText(e,n,"",r),{doNotProcessTranscription:!0}}}}}])}();return vl.CommandUtils=a,vl}var xl,Al={};var Ml,Il,Rl,Pl={};function Ol(){if(Il)return dl;Il=1,Object.defineProperty(dl,"__esModule",{value:!0}),dl.Speech=void 0;var e=function(){if(cl)return hl;cl=1,Object.defineProperty(hl,"__esModule",{value:!0}),hl.EventListeners=void 0;var e=function(){function e(){C(this,e)}return x(e,null,[{key:"getElementIfFocusedOnAvailable",value:function(e,t){return Array.isArray(e)?e.find(function(e){return t===e}):t===e?e:void 0}},{key:"keyDownWindow",value:function(t){var n=this;t.element&&e.getElementIfFocusedOnAvailable(t.element,document.activeElement)&&(null!==e.KEY_DOWN_TIMEOUT&&clearTimeout(e.KEY_DOWN_TIMEOUT),e.KEY_DOWN_TIMEOUT=setTimeout(function(){e.KEY_DOWN_TIMEOUT=null,n.resetRecording(t)},500))}},{key:"mouseDownWindow",value:function(t,n){this.mouseDownElement=e.getElementIfFocusedOnAvailable(t,n.target)}},{key:"mouseUpWindow",value:function(e){this.mouseDownElement&&this.resetRecording(e),this.mouseDownElement=void 0}},{key:"add",value:function(t,n){var r=void 0===(null==n?void 0:n.insertInCursorLocation)||(null==n?void 0:n.insertInCursorLocation);null!=n&&n.element&&r&&(t.mouseDownEvent=e.mouseDownWindow.bind(t,n.element),document.addEventListener("mousedown",t.mouseDownEvent),t.mouseUpEvent=e.mouseUpWindow.bind(t,n),document.addEventListener("mouseup",t.mouseUpEvent),t.keyDownEvent=e.keyDownWindow.bind(t,n),document.addEventListener("keydown",t.keyDownEvent))}},{key:"remove",value:function(e){document.removeEventListener("mousedown",e.mouseDownEvent),document.removeEventListener("mouseup",e.mouseUpEvent),document.removeEventListener("keydown",e.keyDownEvent)}}])}();return hl.EventListeners=e,e.KEY_DOWN_TIMEOUT=null,hl}(),t=function(){if(pl)return fl;pl=1,Object.defineProperty(fl,"__esModule",{value:!0}),fl.PreResultUtils=void 0;var e=function(){return x(function e(){C(this,e)},null,[{key:"process",value:function(e,t,n,r,i){var a=null==r?void 0:r(t,n);return!!a&&(setTimeout(function(){a.restart?e.resetRecording(i):a.stop&&e.stop()}),(a.stop||a.restart)&&a.removeNewText)}}])}();return fl.PreResultUtils=e,fl}(),n=Tl(),r=yl(),i=function(){if(xl)return Al;xl=1,Object.defineProperty(Al,"__esModule",{value:!0}),Al.Highlight=void 0;var e=_l(),t=Cl(),n=function(){function n(){C(this,n)}return x(n,null,[{key:"setStateForPrimitive",value:function(e,t){var n,r;null!==t.selectionStart&&(n=t.selectionStart),null!==t.selectionEnd&&(r=t.selectionEnd),e.isHighlighted=n!==r}},{key:"setStateForGeneric",value:function(e,n){var r=window.getSelection();if(null!=r&&r.focusNode){var i=t.Cursor.getGenericElementCursorOffset(n,r,!0),a=t.Cursor.getGenericElementCursorOffset(n,r,!1);e.isHighlighted=i!==a}}},{key:"setState",value:function(t,r){document.activeElement===r&&(e.Elements.isPrimitiveElement(r)?n.setStateForPrimitive(t,r):n.setStateForGeneric(t,r))}},{key:"removeForGeneric",value:function(e,n){var r=window.getSelection();if(r){var i=t.Cursor.getGenericElementCursorOffset(n,r,!0);r.deleteFromDocument(),t.Cursor.setOffsetForGeneric(n,i),e.isHighlighted=!1}}},{key:"removeForPrimitive",value:function(e,n){var r=n.selectionStart,i=n.selectionEnd,a=n.value;if(r&&i){var s=a.substring(0,r)+a.substring(i);n.value=s,t.Cursor.setOffsetForPrimitive(n,r,e.autoScroll)}e.isHighlighted=!1}}])}();return Al.Highlight=n,Al}(),a=_l(),s=function(){if(Ml)return Pl;Ml=1,Object.defineProperty(Pl,"__esModule",{value:!0}),Pl.Padding=void 0;var e=_l(),t=Cl(),n=al(),r=function(){function r(){C(this,r)}return x(r,null,[{key:"setStateForPrimitiveElement",value:function(e,t){if(document.activeElement===t&&null!==t.selectionStart){var r=t.selectionStart,i=t.value[r-1],a=null===t.selectionEnd?r:t.selectionEnd,s=t.value[a];return n.Text.isCharDefined(i)&&(e.startPadding=" ",e.numberOfSpacesBeforeNewText=1),n.Text.isCharDefined(s)&&(e.endPadding=" ",e.numberOfSpacesAfterNewText=1),void(e.isCursorAtEnd=t.value.length===a)}var o=t.value[t.value.length-1];n.Text.isCharDefined(o)&&(e.startPadding=" ",e.numberOfSpacesBeforeNewText=1),e.isCursorAtEnd=!0}},{key:"setStateForGenericElement",value:function(e,r){var i,a,s;if(document.activeElement===r){var o=window.getSelection();if(null!=o&&o.focusNode){var l=t.Cursor.getGenericElementCursorOffset(r,o,!0),u=null===(i=r.textContent)||void 0===i?void 0:i[l-1],c=t.Cursor.getGenericElementCursorOffset(r,o,!1),d=null===(a=r.textContent)||void 0===a?void 0:a[c];return n.Text.isCharDefined(u)&&(e.startPadding=" "),n.Text.isCharDefined(d)&&(e.endPadding=" "),void(e.isCursorAtEnd=(null===(s=r.textContent)||void 0===s?void 0:s.length)===c)}}var h=r.innerText.charAt(r.innerText.length-1);n.Text.isCharDefined(h)&&(e.startPadding=" "),e.isCursorAtEnd=!0}},{key:"setState",value:function(t,n){e.Elements.isPrimitiveElement(n)?r.setStateForPrimitiveElement(t,n):r.setStateForGenericElement(t,n)}},{key:"adjustStateAfterRecodingPrimitiveElement",value:function(e,t){e.primitiveTextRecorded=!0,e.insertInCursorLocation&&document.activeElement===t&&(null!==t.selectionEnd&&(e.endPadding=e.endPadding+t.value.slice(t.selectionEnd)),null!==t.selectionStart)?e.startPadding=t.value.slice(0,t.selectionStart)+e.startPadding:e.startPadding=t.value+e.startPadding}},{key:"adjustSateForNoTextPrimitiveElement",value:function(e){1===e.numberOfSpacesBeforeNewText&&(e.startPadding=e.startPadding.substring(0,e.startPadding.length-1),e.numberOfSpacesBeforeNewText=0),1===e.numberOfSpacesAfterNewText&&(e.endPadding=e.endPadding.substring(1),e.numberOfSpacesAfterNewText=0)}}])}();return Pl.Padding=r,Pl}(),o=ul(),l=Cl(),u=al(),c=function(){return x(function e(){C(this,e),this.finalTranscript="",this.interimSpan=a.Elements.createInterimSpan(),this.finalSpan=a.Elements.createGenericSpan(),this.scrollingSpan=a.Elements.createGenericSpan(),this.isCursorAtEnd=!1,this.spansPopulated=!1,this.startPadding="",this.endPadding="",this.numberOfSpacesBeforeNewText=0,this.numberOfSpacesAfterNewText=0,this.isHighlighted=!1,this.primitiveTextRecorded=!1,this.recognizing=!1,this._displayInterimResults=!0,this.insertInCursorLocation=!0,this.autoScroll=!0,this.isRestarting=!1,this.isPaused=!1,this.isWaitingForCommand=!1,this.isTargetInShadow=!1,this.cannotBeStopped=!1,this.resetState()},[{key:"prepareBeforeStart",value:function(t){var r,i;if(null!=t&&t.element)if(e.EventListeners.add(this,t),Array.isArray(t.element)){var s=t.element.find(function(e){return e===document.activeElement})||t.element[0];if(!s)return;this.prepare(s)}else this.prepare(t.element);void 0!==(null==t?void 0:t.displayInterimResults)&&(this._displayInterimResults=t.displayInterimResults),null!=t&&t.textColor&&(this._finalTextColor=null===(r=null==t?void 0:t.textColor)||void 0===r?void 0:r.final,a.Elements.applyCustomColors(this,t.textColor)),void 0!==(null==t?void 0:t.insertInCursorLocation)&&(this.insertInCursorLocation=t.insertInCursorLocation),void 0!==(null==t?void 0:t.autoScroll)&&(this.autoScroll=t.autoScroll),this._onResult=null==t?void 0:t.onResult,this._onPreResult=null==t?void 0:t.onPreResult,this._onStart=null==t?void 0:t.onStart,this._onStop=null==t?void 0:t.onStop,this._onError=null==t?void 0:t.onError,this.onCommandModeTrigger=null==t?void 0:t.onCommandModeTrigger,this.onPauseTrigger=null==t?void 0:t.onPauseTrigger,this._options=t,null!==(i=this._options)&&void 0!==i&&i.commands&&(this.commands=n.CommandUtils.process(this._options.commands))}},{key:"prepare",value:function(e){s.Padding.setState(this,e),i.Highlight.setState(this,e),this.isTargetInShadow=a.Elements.isInsideShadowDOM(e),a.Elements.isPrimitiveElement(e)?(this._primitiveElement=e,this._originalText=this._primitiveElement.value):(this._genericElement=e,this._originalText=this._genericElement.textContent)}},{key:"resetRecording",value:function(e){this.isRestarting=!0,this.stop(!0),this.resetState(!0),this.start(e,!0)}},{key:"updateElements",value:function(e,r,i){var a,s=u.Text.capitalize(r);if(this.finalTranscript!==s||""!==e){t.PreResultUtils.process(this,i,""===e,this._onPreResult,this._options)&&(e="",i="");var o=this.commands&&n.CommandUtils.execCommand(this,i,this._options,this._primitiveElement||this._genericElement,this._originalText);if(o){if(o.doNotProcessTranscription)return;e="",i=""}if(!this.isPaused&&!this.isWaitingForCommand){null===(a=this._onResult)||void 0===a||a.call(this,i,""===e),this.finalTranscript=s,this._displayInterimResults||(e="");var l=""===this.finalTranscript&&""===e;this._primitiveElement?this.updatePrimitiveElement(this._primitiveElement,e,l):this._genericElement&&this.updateGenericElement(this._genericElement,e,l)}}}},{key:"updatePrimitiveElement",value:function(e,t,n){this.isHighlighted&&i.Highlight.removeForPrimitive(this,e),this.primitiveTextRecorded||s.Padding.adjustStateAfterRecodingPrimitiveElement(this,e),n&&s.Padding.adjustSateForNoTextPrimitiveElement(this);var a=this.startPadding+this.finalTranscript+t;if(e.value=a+this.endPadding,!this.isTargetInShadow){var u=a.length+this.numberOfSpacesAfterNewText;l.Cursor.setOffsetForPrimitive(e,u,this.autoScroll)}this.autoScroll&&o.Browser.IS_SAFARI()&&this.isCursorAtEnd&&r.AutoScroll.scrollSafariPrimitiveToEnd(e)}},{key:"updateGenericElement",value:function(e,t,n){this.isHighlighted&&i.Highlight.removeForGeneric(this,e),this.spansPopulated||a.Elements.appendSpans(this,e);var s=(n?"":this.startPadding)+u.Text.lineBreak(this.finalTranscript);this.finalSpan.innerHTML=s;var c=r.AutoScroll.isRequired(this.autoScroll,e);r.AutoScroll.changeStateIfNeeded(this,c);var d=u.Text.lineBreak(t)+(n?"":this.endPadding);this.interimSpan.innerHTML=d,o.Browser.IS_SAFARI()&&this.insertInCursorLocation&&l.Cursor.setOffsetForSafariGeneric(e,s.length+d.length),c&&r.AutoScroll.scrollGeneric(this,e),n&&(this.scrollingSpan.innerHTML="")}},{key:"finalise",value:function(t){this._genericElement&&(t?(this.finalSpan=a.Elements.createGenericSpan(),this.setInterimColorToFinal(),this.interimSpan=a.Elements.createInterimSpan(),this.scrollingSpan=a.Elements.createGenericSpan()):this._genericElement.textContent=this._genericElement.textContent,this.spansPopulated=!1),e.EventListeners.remove(this)}},{key:"setInterimColorToFinal",value:function(){this.interimSpan.style.color=this._finalTextColor||"black"}},{key:"resetState",value:function(e){this._primitiveElement=void 0,this._genericElement=void 0,this.finalTranscript="",this.finalSpan.innerHTML="",this.interimSpan.innerHTML="",this.scrollingSpan.innerHTML="",this.startPadding="",this.endPadding="",this.isHighlighted=!1,this.primitiveTextRecorded=!1,this.numberOfSpacesBeforeNewText=0,this.numberOfSpacesAfterNewText=0,e||(this.stopTimeout=void 0)}},{key:"setStateOnStart",value:function(){var e;this.recognizing=!0,this.isRestarting?this.isRestarting=!1:null===(e=this._onStart)||void 0===e||e.call(this)}},{key:"setStateOnStop",value:function(){var e;this.recognizing=!1,this.isRestarting||null===(e=this._onStop)||void 0===e||e.call(this)}},{key:"setStateOnError",value:function(e){var t;null===(t=this._onError)||void 0===t||t.call(this,e),this.recognizing=!1}}])}();return dl.Speech=c,dl}function Ll(){if(Rl)return tl;Rl=1,Object.defineProperty(tl,"__esModule",{value:!0}),tl.WebSpeech=void 0;var e=function(){if($o)return nl;$o=1,Object.defineProperty(nl,"__esModule",{value:!0}),nl.WebSpeechTranscript=void 0;var e=sl(),t=function(){return x(function e(){C(this,e)},null,[{key:"extract",value:function(t,n,r){for(var i="",a=t.resultIndex;a<t.results.length;++a){var s=t.results[a][0].transcript;r&&(s=e.Translate.translate(s,r)),t.results[a].isFinal?n+=s:i+=s}return{interimTranscript:i,finalTranscript:n,newText:i||n}}},{key:"extractSafari",value:function(t,n,r){for(var i="",a=t.resultIndex;a<t.results.length;++a){var s=t.results[a][0].transcript;r&&(s=e.Translate.translate(s,r)),i+=s}return{interimTranscript:"",finalTranscript:i,newText:i}}}])}();return nl.WebSpeechTranscript=t,nl}(),t=ul(),n=function(n){function r(){return C(this,r),d(this,r)}return m(r,n),x(r,[{key:"start",value:function(n){var r;void 0===this._extractText&&(this._extractText=t.Browser.IS_SAFARI()?e.WebSpeechTranscript.extractSafari:e.WebSpeechTranscript.extract),this.validate()&&(this.prepareBeforeStart(n),this.instantiateService(n),null===(r=this._service)||void 0===r||r.start(),this._translations=null==n?void 0:n.translations)}},{key:"validate",value:function(){return!!r.getAPI()||(this.error("Speech Recognition is unsupported"),!1)}},{key:"instantiateService",value:function(e){var t,n,i=r.getAPI();this._service=new i,this._service.continuous=!0,this._service.interimResults=null===(t=null==e?void 0:e.displayInterimResults)||void 0===t||t,this._service.lang=(null===(n=null==e?void 0:e.language)||void 0===n?void 0:n.trim())||"en-US",this.setEvents()}},{key:"setEvents",value:function(){var e=this;this._service&&(this._service.onstart=function(){e.setStateOnStart()},this._service.onerror=function(n){t.Browser.IS_SAFARI()&&"Another request is started"===n.message||"aborted"===n.error&&e.isRestarting||"no-speech"!==n.error&&e.error(n.message||n.error)},this._service.onaudioend=function(){e.setStateOnStop()},this._service.onend=function(){e._stopping=!1},this._service.onresult=function(t){if(E(t.results)>"u"&&e._service)e._service.onend=null,e._service.stop();else if(e._extractText&&!e._stopping){var n=e._extractText(t,e.finalTranscript,e._translations),r=n.interimTranscript,i=n.finalTranscript,a=n.newText;e.updateElements(r,i,a)}})}},{key:"stop",value:function(e){var t;this._stopping=!0,null===(t=this._service)||void 0===t||t.stop(),this.finalise(e)}},{key:"error",value:function(e){console.error(e),this.setStateOnError(e),this.stop()}}],[{key:"getAPI",value:function(){return window.webkitSpeechRecognition||window.SpeechRecognition}}])}(Ol().Speech);return tl.WebSpeech=n,tl}var Bl,Nl={};var Fl,Dl={},jl={};var Ul,Hl,ql={},zl={};function Gl(){if(Hl)return ql;Hl=1,Object.defineProperty(ql,"__esModule",{value:!0}),ql.AzureSpeechConfig=void 0;var e=(Ul||(Ul=1,Object.defineProperty(zl,"__esModule",{value:!0}),zl.README_URL=void 0,zl.README_URL="https://github.com/OvidijusParsiunas/speech-to-element"),zl),t=function(){function t(){C(this,t)}return x(t,null,[{key:"validateOptions",value:function(t,n){return n?n.subscriptionKey||n.token||n.retrieveToken?!!n.region||(t("Please define a 'region' property - more info: ".concat(e.README_URL)),!1):(t("Please define a 'subscriptionKey', 'token' or 'retrieveToken' property - more info: ".concat(e.README_URL)),!1):(t("Please provide subscription details - more info: ".concat(e.README_URL)),!1)}},{key:"getNewSpeechConfig",value:(r=k(g().m(function e(t,n){return g().w(function(e){for(;;)switch(e.n){case 0:if(!n.region){e.n=1;break}return e.a(2,n.subscriptionKey?t.fromSubscription(n.subscriptionKey.trim(),n.region.trim()):n.token?t.fromAuthorizationToken(n.token.trim(),n.region.trim()):n.retrieveToken?n.retrieveToken().then(function(e){return n.region?t.fromAuthorizationToken((null==e?void 0:e.trim())||"",n.region.trim()):null}).catch(function(e){return console.error(e),null}):null);case 1:return e.a(2)}},e)})),function(e,t){return r.apply(this,arguments)})},{key:"process",value:function(e,t){t.endpointId&&(e.endpointId=t.endpointId.trim()),t.language&&(e.speechRecognitionLanguage=t.language.trim())}},{key:"get",value:(n=k(g().m(function e(n,r){var i;return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.getNewSpeechConfig(n,r);case 1:return i=e.v,e.a(2,(i&&t.process(i,r),i))}},e)})),function(e,t){return n.apply(this,arguments)})}]);var n,r}();return ql.AzureSpeechConfig=t,ql}var Wl,Kl={};var Vl,Xl={};var Jl,Zl,Yl,Ql={};function $l(){if(Zl)return Dl;Zl=1,Object.defineProperty(Dl,"__esModule",{value:!0}),Dl.Azure=void 0;var e=function(){if(Fl)return jl;Fl=1,Object.defineProperty(jl,"__esModule",{value:!0}),jl.PreventConnectionStop=void 0;var e=function(){return x(function e(){C(this,e)},null,[{key:"applyPrevention",value:function(e){clearTimeout(e._manualConnectionStopPrevention),e.cannotBeStopped=!0,e._manualConnectionStopPrevention=setTimeout(function(){e.cannotBeStopped=!1},800)}},{key:"clearPrevention",value:function(e){clearTimeout(e._manualConnectionStopPrevention),e.cannotBeStopped=!1}}])}();return jl.PreventConnectionStop=e,jl}(),t=Gl(),n=function(){if(Wl)return Kl;Wl=1,Object.defineProperty(Kl,"__esModule",{value:!0}),Kl.StopTimeout=void 0;var e=function(){function e(){C(this,e)}return x(e,null,[{key:"set",value:function(e){e.stopTimeout=setTimeout(function(){return e.stop()},e.stopTimeoutMS)}},{key:"reset",value:function(t,n){t.stopTimeoutMS=n||e.DEFAULT_MS,e.stop(t),e.set(t)}},{key:"stop",value:function(e){e.stopTimeout&&clearTimeout(e.stopTimeout)}}])}();return Kl.StopTimeout=e,e.DEFAULT_MS=2e4,Kl}(),r=function(){if(Vl)return Xl;Vl=1,Object.defineProperty(Xl,"__esModule",{value:!0}),Xl.AzureAudioConfig=void 0;var e=function(){return x(function e(){C(this,e)},null,[{key:"get",value:function(e,t){return t?e.fromMicrophoneInput(t):e.fromDefaultMicrophoneInput()}}])}();return Xl.AzureAudioConfig=e,Xl}(),i=function(){if(Jl)return Ql;Jl=1,Object.defineProperty(Ql,"__esModule",{value:!0}),Ql.AzureTranscript=void 0;var e=sl(),t=function(){return x(function e(){C(this,e)},null,[{key:"extract",value:function(t,n,r,i){return i&&(t=e.Translate.translate(t,i)),r?{interimTranscript:"",finalTranscript:n+t,newText:t}:{interimTranscript:t,finalTranscript:n,newText:t}}}])}();return Ql.AzureTranscript=t,Ql}(),a=function(a){function s(){var e;return C(this,s),(e=d(this,s,arguments))._newTextPadding="",e}return m(s,a),x(s,[{key:"start",value:function(t,r){this._newTextPadding="",void 0===this.stopTimeout&&n.StopTimeout.reset(this,null==t?void 0:t.stopAfterSilenceMs),this.prepareBeforeStart(t),this.startAsync(t),r||e.PreventConnectionStop.applyPrevention(this)}},{key:"startAsync",value:(l=k(g().m(function e(t){var n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!this.validate(t)){e.n=2;break}return e.n=1,this.instantiateService(t);case 1:this._translations=null==t?void 0:t.translations,null===(n=this._service)||void 0===n||n.startContinuousRecognitionAsync(function(){},this.error);case 2:return e.a(2)}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"validate",value:function(e){return s.getAPI()?t.AzureSpeechConfig.validateOptions(this.error.bind(this),e):(this.moduleNotFound(),!1)}},{key:"instantiateService",value:(o=k(g().m(function e(n){var i,a,o,l,u,c,d,h,p;return g().w(function(e){for(;;)switch(e.n){case 0:return i=s.getAPI(),a=r.AzureAudioConfig.get(i.AudioConfig,n.deviceId),e.n=1,t.AzureSpeechConfig.get(i.SpeechConfig,n);case 1:(o=e.v)?(n.autoLanguage&&n.autoLanguage.languages.length>0?(u=n.autoLanguage,c=u.type,d=u.languages,h=d.slice(0,"Continuous"===c?10:4),p=i.AutoDetectSourceLanguageConfig.fromLanguages(h),"Continuous"===c&&(p.mode=1),l=i.SpeechRecognizer.FromConfig(o,p,a)):l=new i.SpeechRecognizer(o,a),this.setEvents(l),this._service=l,n.retrieveToken&&this.retrieveTokenInterval(n.retrieveToken)):this.error("Unable to contact Azure server");case 2:return e.a(2)}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"setEvents",value:function(e){e.recognizing=this.onRecognizing.bind(this),e.recognized=this.onRecognized.bind(this),e.sessionStarted=this.onSessionStarted.bind(this),e.canceled=this.onCanceled.bind(this),e.sessionStopped=this.onSessionStopped.bind(this)}},{key:"onRecognizing",value:function(e,t){if(!this._stopping){var r=i.AzureTranscript.extract(this._newTextPadding+t.result.text,this.finalTranscript,!1,this._translations),a=r.interimTranscript,s=r.finalTranscript,o=r.newText;n.StopTimeout.reset(this,this.stopTimeoutMS),this.updateElements(a,s,o)}}},{key:"onRecognized",value:function(e,t){var r=t.result;switch(r.reason){case window.SpeechSDK.ResultReason.Canceled:break;case window.SpeechSDK.ResultReason.RecognizedSpeech:if(r.text&&!this._stopping){var a=i.AzureTranscript.extract(this._newTextPadding+r.text,this.finalTranscript,!0,this._translations),s=a.interimTranscript,o=a.finalTranscript,l=a.newText;n.StopTimeout.reset(this,this.stopTimeoutMS),this.updateElements(s,o,l),""!==o&&(this._newTextPadding=" ")}}}},{key:"onCanceled",value:function(e,t){t.reason===window.SpeechSDK.CancellationReason.Error&&this.error(t.errorDetails)}},{key:"onSessionStarted",value:function(){e.PreventConnectionStop.clearPrevention(this),this.setStateOnStart()}},{key:"onSessionStopped",value:function(){this._retrieveTokenInterval||clearInterval(this._retrieveTokenInterval),this._stopping=!1,this.setStateOnStop()}},{key:"retrieveTokenInterval",value:function(e){var t=this;this._retrieveTokenInterval=setInterval(function(){null==e||e().then(function(e){t._service&&(t._service.authorizationToken=(null==e?void 0:e.trim())||"")}).catch(function(e){t.error(e)})},1e4)}},{key:"stop",value:function(e){var t;!e&&this._retrieveTokenInterval&&clearInterval(this._retrieveTokenInterval),this._stopping=!0,null===(t=this._service)||void 0===t||t.stopContinuousRecognitionAsync(),n.StopTimeout.stop(this),this.finalise(e)}},{key:"moduleNotFound",value:function(){console.error("speech recognition module not found:"),console.error("please install the 'microsoft-cognitiveservices-speech-sdk' npm package or add a script tag: <script src=\"https://aka.ms/csspeech/jsbrowserpackageraw\"><\/script>"),this.setStateOnError("speech recognition module not found")}},{key:"error",value:function(e){this._retrieveTokenInterval&&clearInterval(this._retrieveTokenInterval),console.error(e),this.setStateOnError(e),this.stop()}}],[{key:"getAPI",value:function(){return window.SpeechSDK}}]);var o,l}(Ol().Speech);return Dl.Azure=a,Dl}var eu=Zo(function(){if(Yl)return el;Yl=1,Object.defineProperty(el,"__esModule",{value:!0});var e=Ll(),t=Tl(),n=function(){if(Bl)return Nl;Bl=1,Object.defineProperty(Nl,"__esModule",{value:!0}),Nl.GlobalState=void 0;var e=function(){function e(){C(this,e)}return x(e,null,[{key:"doubleClickDetector",value:function(){return!!e.doubleClickPending||(e.doubleClickPending=!0,setTimeout(function(){e.doubleClickPending=!1},300),!1)}}])}();return Nl.GlobalState=e,e.doubleClickPending=!1,Nl}(),r=$l(),i=function(){function i(){C(this,i)}return x(i,null,[{key:"toggle",value:function(e,t){var r,a,s=e.toLocaleLowerCase().trim();null!==(r=n.GlobalState.service)&&void 0!==r&&r.recognizing?this.stop():"webspeech"===s?i.startWebSpeech(t):"azure"===s?i.startAzure(t):(console.error("service not found - must be either 'webspeech' or 'azure'"),null===(a=null==t?void 0:t.onError)||void 0===a||a.call(t,"service not found - must be either 'webspeech' or 'azure'"))}},{key:"startWebSpeech",value:function(t){i.stop()||(n.GlobalState.service=new e.WebSpeech,n.GlobalState.service.start(t))}},{key:"isWebSpeechSupported",value:function(){return!!e.WebSpeech.getAPI()}},{key:"startAzure",value:function(e){var t;i.stop()||null!==(t=n.GlobalState.service)&&void 0!==t&&t.cannotBeStopped||(n.GlobalState.service=new r.Azure,n.GlobalState.service.start(e))}},{key:"stop",value:function(){var e;return!!n.GlobalState.doubleClickDetector()||(!(null===(e=n.GlobalState.service)||void 0===e)&&e.recognizing&&n.GlobalState.service.stop(),!1)}},{key:"endCommandMode",value:function(){n.GlobalState.service&&t.CommandUtils.toggleCommandModeOff(n.GlobalState.service)}}])}();return el.default=i,el}()),tu=function(){return x(function e(t,n){C(this,e),this._silenceMS=2e3,this._stop=!0,"boolean"==typeof n&&!1===n&&(this._stop=!1),"number"==typeof t&&(this._silenceMS=t)},[{key:"setSilenceTimeout",value:function(e,t){var n=this;this._silenceTimeout=setTimeout(function(){var r;null==(r=e.submit)||r.call(e),eu.stop(),n._stop||setTimeout(t,ru.MICROPHONE_RESET_TIMEOUT_MS)},this._silenceMS)}},{key:"clearSilenceTimeout",value:function(){this._silenceTimeout&&clearTimeout(this._silenceTimeout)}},{key:"resetSilenceTimeout",value:function(e,t){this.clearSilenceTimeout(),this.setSilenceTimeout(e,t)}},{key:"onPause",value:function(e,t,n){e?this.resetSilenceTimeout(t,n):this.clearSilenceTimeout()}}])}(),nu=function(e){function t(e,n,r){var i;C(this,t);var a="object"==E(e.speechToText)?e.speechToText:{},s=(i=d(this,t,[null==a?void 0:a.button])).processConfiguration(n,e.speechToText),o=s.serviceName,l=s.processedConfig;if(i._addErrorMessage=r,"webspeech"!==o||eu.isWebSpeechSupported()){var u=!e.textInput||!e.textInput[Fe];kt.assignButtonEvents(i.elementRef,i.buttonClick.bind(i,n,u,o,l))}else i.changeToUnsupported();return setTimeout(function(){i._validationHandler=e._validationHandler}),i}return m(t,e),x(t,[{key:"processConfiguration",value:function(e,n){var r,i,a,s,o,l,u="object"==E(n)?n:{},c="object"==E(u.webSpeech)?u.webSpeech:{},d=u.azure||{},h=S(S({displayInterimResults:null!==(r=u.displayInterimResults)&&void 0!==r?r:void 0,textColor:null!==(i=u.textColor)&&void 0!==i?i:void 0,translations:null!==(a=u.translations)&&void 0!==a?a:void 0,commands:null!==(s=u.commands)&&void 0!==s?s:void 0,events:null!==(o=u.events)&&void 0!==o?o:void 0},c),d),p=null==(l=u.commands)?void 0:l.submit;return p&&(h.onPreResult=function(t){return t.toLowerCase().includes(p)?(setTimeout(function(){var t;return null==(t=e.submit)?void 0:t.call(e)}),eu.endCommandMode(),{restart:!0,removeNewText:!0}):null}),u.submitAfterSilence&&(this._silenceSubmit=new tu(u.submitAfterSilence,u.stopAfterSubmit)),{serviceName:t.getServiceName(u),processedConfig:h}}},{key:"buttonClick",value:function(e,t,n,r){var i=this,a=null==r?void 0:r.events;e.removePlaceholderStyle(),eu.toggle(n,S({insertInCursorLocation:!1,element:t?e.inputElementRef:void 0,onError:function(){var e;i.onError(),null==(e=i._silenceSubmit)||e.clearSilenceTimeout()},onStart:function(){var e;i.changeToActive(),null==(e=null==a?void 0:a.onStart)||e.call(a)},onStop:function(){var e,t,n;null==(e=i._validationHandler)||e.call(i),null==(t=i._silenceSubmit)||t.clearSilenceTimeout(),i.changeToDefault(),null==(n=null==a?void 0:a.onStop)||n.call(a)},onPauseTrigger:function(t){var n,r;null==(n=i._silenceSubmit)||n.onPause(t,e,i.elementRef.onclick),null==(r=null==a?void 0:a.onPauseTrigger)||r.call(a,t)},onPreResult:function(e,t){var n;null==(n=null==a?void 0:a.onPreResult)||n.call(a,e,t)},onResult:function(t,n){var r,s,o;n&&(null==(r=i._validationHandler)||r.call(i)),null==(s=i._silenceSubmit)||s.resetSilenceTimeout(e,i.elementRef.onclick),null==(o=null==a?void 0:a.onResult)||o.call(a,t,n)},onCommandModeTrigger:function(e){var t;i.onCommandModeTrigger(e),null==(t=null==a?void 0:a.onCommandModeTrigger)||t.call(a,e)}},r))}},{key:"onCommandModeTrigger",value:function(e){e?this.changeToCommandMode():this.changeToActive()}},{key:"onError",value:function(){this._addErrorMessage("speechToText","speech input error")}}],[{key:"getServiceName",value:function(e){return e.azure?"azure":"webspeech"}},{key:"toggleSpeechAfterSubmit",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e[Be](),n||setTimeout(function(){return e[Be]()},t.MICROPHONE_RESET_TIMEOUT_MS)}}])}(Jo);nu.MICROPHONE_RESET_TIMEOUT_MS=300;var ru=nu,iu=function(){function e(t,n,r,i,a){var s=this;C(this,e),this._attachments=[],this._fileCountLimit=99,this._acceptedFormat="",this._hiddenAttachments=new Set,r.maxNumberOfFiles&&(this._fileCountLimit=r.maxNumberOfFiles),this._toggleContainerDisplay=i,this._fileAttachmentsContainerRef=a,r.acceptedFormats&&(this._acceptedFormat=r.acceptedFormats),setTimeout(function(){s._validationHandler=t._validationHandler,s._onInput=n.onInput})}return x(e,[{key:"attemptAddFile",value:function(t,n){var r;return!!e.isFileTypeValid(t,this._acceptedFormat)&&(this.addAttachmentBasedOnType(t,n,!0),null==(r=this._onInput)||r.call(this,!0),!0)}},{key:"addAttachmentBasedOnType",value:function(t,n,r){var i=e.getTypeFromBlob(t);if(i===Q){var a=e.createImageAttachment(n);this.addFileAttachment(t,Q,a,r)}else if(i===ne){var s=su.createAudioAttachment(n);this.addFileAttachment(t,ne,s,r)}else{var o=e.createAnyFileAttachment(t.name);this.addFileAttachment(t,ae,o,r)}}},{key:"addFileAttachment",value:function(t,n,r,i){var a,s=e.createContainer(r);if(this._attachments.length>=this._fileCountLimit){var o=this._attachments[this._attachments.length-1].removeButton;null==o||o[Be]();var l=this._fileAttachmentsContainerRef.children;this._fileAttachmentsContainerRef.insertBefore(s,l[0])}else this._fileAttachmentsContainerRef.appendChild(s);var u={file:t,attachmentContainerElement:s,fileType:n};return i&&(u.removeButton=this.createRemoveAttachmentButton(u),s.appendChild(u.removeButton)),this._toggleContainerDisplay(!0),this._attachments.push(u),this._fileAttachmentsContainerRef.scrollTop=this._fileAttachmentsContainerRef.scrollHeight,null==(a=this._validationHandler)||a.call(this),u}},{key:"createRemoveAttachmentButton",value:function(e){var t=R();t[M].add("remove-file-attachment-button"),t.onclick=this.removeAttachment.bind(this,e);var n=R();return n[M].add("x-icon"),n.innerText="\xd7",t.appendChild(n),t}},{key:"removeAttachment",value:function(e,t){var n,r,i=this._attachments.findIndex(function(t){return t===e});if(!(i<0)){null==(n=this._onInput)||n.call(this,!(null==t||!t.isTrusted));var a=this._attachments[i].attachmentContainerElement;this._attachments.splice(i,1),su.stopAttachmentPlayback(a),a.remove(),this._toggleContainerDisplay(!1),null==(r=this._validationHandler)||r.call(this)}}},{key:"getFiles",value:function(){return Array.from(this._attachments).map(function(e){return w(w({},Z,e[Z]),"type",e.fileType)})}},{key:"hideAttachments",value:function(){var e=this;this._hiddenAttachments.clear(),this._attachments.forEach(function(t){setTimeout(function(){var e;return null==(e=t.removeButton)?void 0:e[Be]()}),e._hiddenAttachments.add(t)})}},{key:"removeAttachments",value:function(){this._attachments.forEach(function(e){setTimeout(function(){var t;return null==(t=e.removeButton)?void 0:t[Be]()})}),this._hiddenAttachments.clear()}},{key:"readdAttachments",value:function(){var e,t=this;Array.from(this._hiddenAttachments).forEach(function(e){t._fileAttachmentsContainerRef.appendChild(e.attachmentContainerElement),t._attachments.push(e)}),null==(e=this._onInput)||e.call(this,!1),this._hiddenAttachments.clear()}}],[{key:"isFileTypeValid",value:function(e,t){if(""===t)return!0;for(var n=t.split(","),r=0;r<n.length;r++){var i=n[r].trim();if(e.type===i)return!0;if(i.startsWith(".")){var a=i.slice(1);if(e.name.endsWith(a))return!0}else{if(e.name.endsWith(i))return!0;if(i.endsWith("/*")&&e.type.startsWith(i.slice(0,-2)))return!0}}return!1}},{key:"getTypeFromBlob",value:function(e){var t=e.type;return t.startsWith(Q)?Q:t.startsWith(ne)?ne:ae}},{key:"createImageAttachment",value:function(e){var t=new Image;return t[X]=e,t[M].add("image-attachment"),t}},{key:"createAnyFileAttachment",value:function(e){var t=R();t[M].add("border-bound-attachment"),Ke.IS_SAFARI&&t[M].add("border-bound-attachment-safari");var n=R();n[M].add("any-file-attachment-text");var r=R();return r[M].add("file-attachment-text-container"),r.appendChild(n),n.textContent=e,t.appendChild(r),t}},{key:"createContainer",value:function(e){var t=R();return t[M].add("file-attachment"),t.appendChild(e),t}}])}(),au=function(e){function t(e,n,r,i,a){return C(this,t),d(this,t,[e,n,r,i,a])}return m(t,e),x(t,[{key:"createTimer",value:function(e,n){var r=this,i=0,a=void 0!==n&&n<t.TIMER_LIMIT_S?n:t.TIMER_LIMIT_S;return setInterval(function(){var t;(i+=1)===a&&(null==(t=r.stopPlaceholderCallback)||t.call(r),r.clearTimer()),600===i&&e[M].add("audio-placeholder-text-4-digits");var n=Math.floor(i/60),s=(i%60).toString().padStart(2,"0");e.textContent="".concat(n,":").concat(s)},1e3)}},{key:"createPlaceholderAudioAttachment",value:function(e){var n=t.createAudioContainer(),r=R();r[M].add("audio-placeholder-text-3-digits");var i=R();i[M].add("file-attachment-text-container","audio-placeholder-text-3-digits-container"),i.appendChild(r);var a=ri.createSVGElement(Ea);return a[M].add("attachment-icon","stop-icon","not-removable-attachment-icon"),r.textContent="0:00",this._activePlaceholderTimer=this.createTimer(r,e),n.appendChild(i),this.addPlaceholderAudioAttachmentEvents(n,a,i),n}},{key:"addPlaceholderAudioAttachmentEvents",value:function(e,t,n){var r=this;e.addEventListener("mouseenter",function(){return e.replaceChildren(t)});e.addEventListener("mouseleave",function(){return e.replaceChildren(n)});e.addEventListener(Be,function(){var e;return null==(e=r.stopPlaceholderCallback)?void 0:e.call(r)})}},{key:"addPlaceholderAttachment",value:function(e,t){var n=this.createPlaceholderAudioAttachment(t);this._activePlaceholderAttachment=this.addFileAttachment(new File([],""),ne,n,!1),this.stopPlaceholderCallback=e}},{key:"completePlaceholderAttachment",value:function(e,n){var r=this._activePlaceholderAttachment;r&&(r[Z]=e,t.addAudioElements(r.attachmentContainerElement.children[0],n),r.removeButton=this.createRemoveAttachmentButton(r),r.attachmentContainerElement.appendChild(r.removeButton),this._activePlaceholderAttachment=void 0,this.clearTimer())}},{key:"removePlaceholderAttachment",value:function(){this._activePlaceholderAttachment&&(this.removeAttachment(this._activePlaceholderAttachment),this._activePlaceholderAttachment=void 0,this.clearTimer())}},{key:"clearTimer",value:function(){void 0!==this._activePlaceholderTimer&&(clearInterval(this._activePlaceholderTimer),this._activePlaceholderTimer=void 0,this.stopPlaceholderCallback=void 0)}}],[{key:"createAudioContainer",value:function(){var e=R();return e[M].add("border-bound-attachment","audio-attachment-icon-container"),Ke.IS_SAFARI&&e[M].add("border-bound-attachment-safari"),e}},{key:"addAudioElements",value:function(e,t){var n=e.parentElement?kt.cloneElement(e):e,r=R(ne);r[X]=t;var i=ri.createSVGElement(wa);i[M].add("attachment-icon","play-icon");var a=ri.createSVGElement(Ea);a[M].add("attachment-icon","stop-icon"),n.replaceChildren(i),r.onplay=function(){n.replaceChildren(a)},r.onpause=function(){n.replaceChildren(i),r.currentTime=0},r.onended=function(){n.replaceChildren(i)},kt.assignButtonEvents(n,function(){r.paused?r.play():r.pause()})}},{key:"createAudioAttachment",value:function(e){var n=t.createAudioContainer();return t.addAudioElements(n,e),n}},{key:"stopAttachmentPlayback",value:function(e){var t,n,r;null!=(r=null==(n=null==(t=e.children[0])?void 0:t.children)?void 0:n[0])&&r[M].contains("stop-icon")&&e.children[0][Be]()}}])}(iu);au.TIMER_LIMIT_S=5999;var su=au,ou=function(){return x(function e(){C(this,e)},null,[{key:"create",value:function(e,t,n,r,i,a){return a===ne?new su(e,t,n,r,i):new iu(e,t,n,r,i)}}])}(),lu=function(){function e(t,n,r){C(this,e),this._fileAttachmentsTypes=[],this.elementRef=this.createAttachmentContainer();var i="object"==E(r)&&!!r.displayFileAttachmentContainer;this.toggleContainerDisplay(i),t.appendChild(this.elementRef),n&&Object.assign(this.elementRef[I],n)}return x(e,[{key:"addType",value:function(e,t,n,r){var i=ou.create(e,t,n,this.toggleContainerDisplay.bind(this),this.elementRef,r);return this._fileAttachmentsTypes.push(i),i}},{key:"createAttachmentContainer",value:function(){var e=R();return e.id="file-attachment-container",e}},{key:"toggleContainerDisplay",value:function(e){e?this.elementRef[I].display="block":0===this.elementRef.children.length&&(this.elementRef[I].display="none")}},{key:"getAllFileData",value:function(){var e=this._fileAttachmentsTypes.map(function(e){return e.getFiles()}).flat();return e.length>0?e:void 0}},{key:"completePlaceholders",value:(t=k(g().m(function e(){return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Promise.all(this._fileAttachmentsTypes.map(function(){var e=k(g().m(function e(t){var n;return g().w(function(e){for(;;)if(0===e.n)return e.a(2,null==(n=t.stopPlaceholderCallback)?void 0:n.call(t))},e)}));return function(t){return e.apply(this,arguments)}}()));case 1:return e.a(2)}},e,this)})),function(){return t.apply(this,arguments)})},{key:"addFilesToAnyType",value:function(t){e.addFilesToType(t,this._fileAttachmentsTypes)}},{key:"hideFiles",value:function(){this._fileAttachmentsTypes.forEach(function(e){return e.hideAttachments()}),this.elementRef.replaceChildren(),this.toggleContainerDisplay(!1)}},{key:"removeHiddenFiles",value:function(){this._fileAttachmentsTypes.forEach(function(e){return e.removeAttachments()})}},{key:"readdHiddenFiles",value:function(){this._fileAttachmentsTypes.forEach(function(e){return e.readdAttachments()}),this.toggleContainerDisplay(!0)}},{key:"getNumberOfTypes",value:function(){return this._fileAttachmentsTypes.length}}],[{key:"addFilesToType",value:function(e,t){e.forEach(function(e){var n=new FileReader;n.readAsDataURL(e),n.onload=function(n){for(var r=0;r<t.length&&!t[r].attemptAddFile(e,n.target.result);r+=1);}})}}]);var t}(),uu=function(){function e(t,n,r){C(this,e),this._isOpen=!1,this._contentRef=e.createModalContent(n,null==r?void 0:r.backgroundColor),this._buttonPanel=e.createButtonPanel(null==r?void 0:r.backgroundColor),this._elementRef=e.createContainer(this._contentRef,r),this._elementRef.appendChild(this._buttonPanel),t.appendChild(this._elementRef),this._backgroundPanelRef=e.createDarkBackgroundPanel(),t.appendChild(this._backgroundPanelRef),this.addWindowEvents(t)}return x(e,[{key:"isOpen",value:function(){return this._isOpen}},{key:"addButtons",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach(function(t){pa.addAttributes(t),e._buttonPanel.appendChild(t)})}},{key:"close",value:function(){var t=this;this._elementRef[M].remove("show-modal"),this._elementRef[M].add("hide-modal"),this._backgroundPanelRef[M].remove("show-modal-background"),this._backgroundPanelRef[M].add("hide-modal-background"),this._isOpen=!1,setTimeout(function(){t._elementRef[I].display="none",t._backgroundPanelRef[I].display="none"},e.MODAL_CLOSE_TIMEOUT_MS)}},{key:"displayModalElements",value:function(){this._elementRef[I].display="flex",this._elementRef[M].remove("hide-modal"),this._elementRef[M].add("show-modal"),this._backgroundPanelRef[I].display="block",this._backgroundPanelRef[M].remove("hide-modal-background"),this._backgroundPanelRef[M].add("show-modal-background"),this._isOpen=!0}},{key:"openTextModal",value:function(e){this._contentRef.innerHTML=e,this.displayModalElements()}},{key:"addCloseButton",value:function(t,n,r){var i=this,a=n?e.createSVGButton(t):e.createTextButton(t);return this.addButtons(a),kt.assignButtonEvents(a,function(){i.close(),setTimeout(function(){null==r||r()},140)}),a}},{key:"addWindowEvents",value:function(e){this.keyDownEvent=this.windowKeyDown.bind(this,e),window.addEventListener("keydown",this.keyDownEvent)}},{key:"windowKeyDown",value:function(e,t){var n,r;!e.isConnected&&this.keyDownEvent?window.removeEventListener("keydown",this.keyDownEvent):this._isOpen&&(t.key===Ve.ESCAPE?(this.close(),null==(n=this.extensionCloseCallback)||n.call(this)):t.key===Ve.ENTER&&(this.close(),null==(r=this.extensionCloseCallback)||r.call(this)))}}],[{key:"createContainer",value:function(e,t){var n=R();return n[M].add("modal"),n.appendChild(e),t&&delete t.backgroundColor,Object.assign(n[I],t),n}},{key:"createModalContent",value:function(e,t){var n,r=R();return(n=r[M]).add.apply(n,l(e)),t&&(r[I].backgroundColor=t),R().appendChild(r),r}},{key:"createButtonPanel",value:function(e){var t=R();return t[M].add("modal-button-panel"),e&&(t[I].backgroundColor=e),t}},{key:"createDarkBackgroundPanel",value:function(){var e=R();return e.id="modal-background-panel",e}},{key:"createTextButton",value:function(e){var t=R();return t[M].add("modal-button"),t.textContent=e,t}},{key:"createSVGButton",value:function(e){var t=R();t[M].add("modal-button","modal-svg-button");var n=ri.createSVGElement(e);return n[M].add("modal-svg-button-icon"),t.appendChild(n),t}},{key:"createTextModalFunc",value:function(t,n,r){var i;if("object"==E(n)&&null!=(i=n[Y])&&i.infoModal){var a=new e(t,["modal-content"],n[Y].infoModal.containerStyle);return a.addCloseButton("OK",!1,r),a.openTextModal.bind(a,n.infoModalTextMarkUp||"")}}}])}();uu.MODAL_CLOSE_TIMEOUT_MS=190;var cu=uu,du=function(e){function t(e,n,r,i,a,s){var o,l,u,c,h,p,f,m,v,g,y;C(this,t);var b=Ct.processPosition(null==(l=null==r?void 0:r.button)?void 0:l.position),k=(null==(h=null==(c=null==(u=null==r?void 0:r.button)?void 0:u.styles)?void 0:c[B])?void 0:h.content)||s,_=Ge.tryCreateConfig("Upload File",null==(p=null==r?void 0:r.button)?void 0:p.tooltip),S=(o=d(this,t,[t.createButtonElement(),a,b,_,r.button,k])).createInnerElementsForStates(i,o.customStyles);return o._inputElement=t.createInputElement(null==(f=null==r?void 0:r[Y])?void 0:f.acceptedFormats),o.addClickEvent(e,r),o.changeElementsByState(S.styles),o.reapplyStateStyle("styles"),o._fileAttachmentsType=n,o._openModalOnce=!1===(null==(v=null==(m=r[Y])?void 0:m.infoModal)?void 0:v.openModalOnce)||null==(y=null==(g=r[Y])?void 0:g.infoModal)?void 0:y.openModalOnce,o}return m(t,e),x(t,[{key:"createInnerElementsForStates",value:function(e,t){return{styles:this.createInnerElements(e,"styles",t)}}},{key:"triggerImportPrompt",value:function(e){e.onchange=this.import.bind(this,e),e[Be]()}},{key:"import",value:function(e){lu.addFilesToType(Array.from(e[Y]||[]),[this._fileAttachmentsType]),e.value=""}},{key:"addClickEvent",value:function(e,t){var n=this.triggerImportPrompt.bind(this,this._inputElement),r=cu.createTextModalFunc(e,t,n);this.elementRef.onclick=this[Be].bind(this,r)}},{key:"click",value:function(e){!e||void 0!==this._openModalOnce&&!0!==this._openModalOnce?this.triggerImportPrompt(this._inputElement):(e(),!0===this._openModalOnce&&(this._openModalOnce=!1))}}],[{key:"createInputElement",value:function(e){var t=R("input");return t.type=Z,t.accept=e||"",t.hidden=!0,t.multiple=!0,t}},{key:"createButtonElement",value:function(){var e=R();return e[M].add("input-button"),e}}])}(ba),hu=function(){function e(){C(this,e)}return x(e,null,[{key:"create",value:function(t,n,r){var i=e.createElement(r);e.addEvents(i,t,n),t.appendChild(i)}},{key:"createElement",value:function(e){var t=R();return t.id="drag-and-drop",E(e)===ct&&Object.assign(t[I],e),t}},{key:"addEvents",value:function(t,n,r){n.ondragenter=function(n){n.preventDefault(),e.display(t)},t.ondragleave=function(n){n.preventDefault(),e.hide(t)},t.ondragover=function(e){e.preventDefault()},t.ondrop=function(n){n.preventDefault(),e.uploadFile(r,n),e.hide(t)}}},{key:"uploadFile",value:function(e,t){var n,r=null==(n=t.dataTransfer)?void 0:n[Y];r&&e.addFilesToAnyType(Array.from(r))}},{key:"display",value:function(e){e[I].display="block"}},{key:"hide",value:function(e){e[I].display="none"}},{key:"isEnabled",value:function(e,t){return(void 0===t||!1!==t)&&(!!t||e.getNumberOfTypes()>0)}}])}(),pu=function(){function e(){C(this,e)}return x(e,null,[{key:"validate",value:function(e,t,n,r,i,a,s){var o=!n.isSubmitProgrammaticallyDisabled&&e(r,i,s);return o?t.changeToSubmitIcon():t.changeToDisabledIcon(),null==a||a.addInputText(r||""),o}},{key:"useValidationFunc",value:(n=k(g().m(function t(n,r,i,a,s,o){var l,u,c;return g().w(function(t){for(;;)switch(t.n){case 0:return l=r.isTextInputEmpty()?"":r.inputElementRef.textContent,t.n=1,i.completePlaceholders();case 1:return u=i.getAllFileData(),c=null==u?void 0:u.map(function(e){return e[Z]}),t.a(2,e.validate(n,a,s,l,c,o))}},t)})),function(e,t,r,i,a,s){return n.apply(this,arguments)})},{key:"useValidationFuncProgrammatic",value:(t=k(g().m(function t(n,r,i,a,s){var o,l;return g().w(function(t){for(;;)if(0===t.n)return l=null==(o=r[Y])?void 0:o.map(function(e){return e[Z]}),t.a(2,e.validate(n,i,a,r[B],l,s,!0))},t)})),function(e,n,r,i,a){return t.apply(this,arguments)})},{key:"validateWebsocket",value:function(e,t){var n=e.websocket,r=e.connectSettings;return!(n&&r.url!==Gr.URL&&!Wr.canSendMessage(n))||(t.changeToDisabledIcon(),!1)}},{key:"attach",value:function(t,n,r,i,a,s){var o=t.validateInput||Ct.processValidateInput(t);t._validationHandler=function(){var t=k(g().m(function t(l){var u;return g().w(function(t){for(;;)switch(t.n){case 0:if(!a.status.loadingActive&&!a.status.requestInProgress&&e.validateWebsocket(n,a)){t.n=1;break}return t.a(2,!1);case 1:return u=o||n.canSendMessage,t.a(2,u?l?e.useValidationFuncProgrammatic(u,l,a,n,s):e.useValidationFunc(u,r,i,a,n,s):null)}},t)}));return function(e){return t.apply(this,arguments)}}()}}]);var t,n}(),fu=function(){return x(function e(){C(this,e)},null,[{key:"getFileName",value:function(e,t){var n=new Date,r=String(n.getHours()).padStart(2,"0"),i=String(n.getMinutes()).padStart(2,"0"),a=String(n.getSeconds()).padStart(2,"0");return"".concat(e,"-").concat(r,"-").concat(i,"-").concat(a,".").concat(t)}}])}(),mu=function(e){function t(e,n){var r,i,a;return C(this,t),(r=d(this,t,[n.button]))._waitingForBrowserApproval=!1,r._audioType=e,r._extension=(null==(i=n[Y])?void 0:i.format)||"mp3",r._maxDurationSeconds=null==(a=n[Y])?void 0:a.maxDurationSeconds,kt.assignButtonEvents(r.elementRef,r.buttonClick.bind(h(r))),r}return m(t,e),x(t,[{key:"buttonClick",value:function(){this._waitingForBrowserApproval||(this.isActive?this.stop():(this._waitingForBrowserApproval=!0,this.record()))}},{key:"stop",value:function(){var e=this;return new Promise(function(t){var n,r;e.changeToDefault(),null==(n=e._mediaRecorder)||n.stop(),null==(r=e._mediaStream)||r.getTracks().forEach(function(e){return e.stop()}),setTimeout(function(){t()},10)})}},{key:"record",value:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){e.changeToActive(),e._mediaRecorder=new MediaRecorder(t),e._audioType.addPlaceholderAttachment(e.stop.bind(e),e._maxDurationSeconds),e._mediaStream=t,e._mediaRecorder.addEventListener("dataavailable",function(t){e.createFile(t)}),e._mediaRecorder[oe]()}).catch(function(t){console[F](t),e.stop()}).finally(function(){e._waitingForBrowserApproval=!1})}},{key:"createFile",value:function(e){var t=this,n=new Blob([e.data],{type:"audio/".concat(this._extension)}),r=fu.getFileName(this._newFilePrefix||ne,this._extension),i=new File([n],r,{type:n.type}),a=new FileReader;a.readAsDataURL(i),a.onload=function(e){t._audioType.completePlaceholderAttachment(i,e.target.result)}}}])}(Jo),vu=function(){function e(){C(this,e)}return x(e,null,[{key:"resetSubmit",value:function(e,t){t?e.unsetCustomStateStyles(["loading","submit"]):e.unsetCustomStateStyles(["stop","loading","submit"]),e.reapplyStateStyle("submit")}},{key:"overwriteDefaultStyleWithSubmit",value:function(e,t){if(e.submit){var n=ce(e[t]||{});Sa.overwritePropertyObjectFromAnother(n,e.submit,["container",Oe]),Sa.overwritePropertyObjectFromAnother(n,e.submit,[B,"styles",Oe]),Sa.overwritePropertyObjectFromAnother(n,e.submit,["svg","styles",Oe]),e[t]=n}}},{key:"setUpDisabledButton",value:function(t){Sa.setPropertyValueIfDoesNotExist(t,["submit","container",Oe,"backgroundColor"],""),Sa.setPropertyValueIfDoesNotExist(t,[Fe,"container",Oe,"backgroundColor"],"unset"),Sa.setPropertyValueIfDoesNotExist(t.submit,["svg","styles",Oe,"filter"],""),Sa.setPropertyValueIfDoesNotExist(t[Fe],["svg","styles",Oe,"filter"],"brightness(0) saturate(100%) invert(70%) sepia(0%) saturate(5564%) hue-rotate(207deg) brightness(100%) contrast(97%)"),Sa.setPropertyValueIfDoesNotExist(t[Fe],[B,"styles",Oe,"color"],"grey"),e.overwriteDefaultStyleWithSubmit(t,Fe)}},{key:"process",value:function(t){var n=ce(t||{});return e.overwriteDefaultStyleWithSubmit(n,"loading"),e.overwriteDefaultStyleWithSubmit(n,"stop"),null!=t&&t.alwaysEnabled||e.setUpDisabledButton(n),n}}])}(),gu=function(e){function t(e,n,r,i,a,s){var o;C(this,t);var l=vu.process(e.submitButtonStyles),u=Ge.tryCreateConfig("Submit",null==l?void 0:l.tooltip);return(o=d(this,t,[t.createButtonContainerElement(),'<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="none" stroke-width="1" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">\n  <line x1="22" y1="2" x2="11" y2="14"></line>\n  <polygon points="22 2 15 22 11 14 2 10 22 2"></polygon>\n</svg>\n',null==l?void 0:l.position,u,l]))._isSVGLoadingIconOverriden=!1,o.status={requestInProgress:!1,loadingActive:!1},o._messages=r,o._textInput=n,o._fileAttachments=a,o._innerElements=o.createInnerElementsForStates(),o._stopClicked={listener:function(){}},o._serviceIO=i,o._alwaysEnabled=!(null==l||!l.alwaysEnabled),e.disableSubmitButton=o.disableSubmitButton.bind(h(o),i),o.attemptOverwriteLoadingStyle(e),s.microphone&&o.setUpSpeechToText(s.microphone.button,e.speechToText),setTimeout(function(){var t;o._validationHandler=e._validationHandler,o.assignHandlers(o._validationHandler),null==(t=o._validationHandler)||t.call(h(o))}),o}return m(t,e),x(t,[{key:"createInnerElementsForStates",value:function(){var e=this.createCustomElements(),n=e.submit,r=e.loading,i=e.stop;return w({submit:n,loading:r||[t.createLoadingIconElement()],stop:i||[t.createStopIconElement()]},Fe,this.createDisabledIconElement(n))}},{key:"createCustomElements",value:function(){var e=this,t=va.createCustomElements("submit",this.svg,this.customStyles),n={loading:void 0,stop:void 0};return Object.keys(n).forEach(function(t){var r=t,i=va.createCustomElements(r,e.svg,e.customStyles);i&&(n[r]=i)}),n.submit=t||this.buildDefaultIconElement("submit-icon"),n}},{key:"createDisabledIconElement",value:function(e){return va.createCustomElements(Fe,this.svg,this.customStyles)||[e[0].cloneNode(!0)]}},{key:"attemptOverwriteLoadingStyle",value:function(e){var t,n,r,i,a,s,o,l,u;if(!(null!=(n=null==(t=this.customStyles)?void 0:t.submit)&&n.svg||null!=(a=null==(i=null==(r=this.customStyles)?void 0:r.loading)?void 0:i.svg)&&a.content||null!=(l=null==(o=null==(s=this.customStyles)?void 0:s.loading)?void 0:o[B])&&l.content||void 0!==e.displayLoadingBubble&&!0!==e.displayLoadingBubble)){var c=R("style");c.textContent="\n        .loading-button > * {\n          filter: brightness(0) saturate(100%) invert(72%) sepia(0%) saturate(3044%) hue-rotate(322deg) brightness(100%)\n            contrast(96%) !important;\n        }",null==(u=e.shadowRoot)||u.appendChild(c),this._isSVGLoadingIconOverriden=!0}}},{key:"assignHandlers",value:function(e){this._serviceIO.completionsHandlers={onFinish:this.resetSubmit.bind(this,e)},this._serviceIO.streamHandlers={onOpen:this.changeToStopIcon.bind(this),onClose:this.resetSubmit.bind(this,e),stopClicked:this._stopClicked};var t=this._serviceIO.stream;"object"==E(t)&&"number"==typeof t.simulation&&(this._serviceIO.streamHandlers.simulationInterim=t.simulation)}},{key:"setUpSpeechToText",value:function(e,t){this._microphoneButton=e,this._stopSTTAfterSubmit="object"==E(t)&&t.stopAfterSubmit}},{key:"resetSubmit",value:function(e){this.status.requestInProgress=!1,this.status.loadingActive=!1,e()}},{key:"submitFromInput",value:(a=k(g().m(function e(){var t,n,r=this;return g().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._fileAttachments.completePlaceholders();case 1:t=this._fileAttachments.getAllFileData(),this._textInput.isTextInputEmpty()?this.attemptSubmit(w(w({},B,""),Y,t)):(n=this._textInput.inputElementRef.innerText.trim(),this.attemptSubmit(w(w({},B,n),Y,t))),(Ke.IS_SAFARI||Ke.IS_MOBILE)&&setTimeout(function(){return $e.focusEndOfInput(r._textInput.inputElementRef)});case 2:return e.a(2)}},e,this)})),function(){return a.apply(this,arguments)})},{key:"programmaticSubmit",value:(i=k(g().m(function e(t){var n,r=this;return g().w(function(e){for(;;)switch(e.n){case 0:"string"==typeof t&&(t=Ct.processSubmitUserMessage(t)),n=w({},B,t[B]),t[Y]&&(n[Y]=Array.from(t[Y]).map(function(e){return{file:e,type:iu.getTypeFromBlob(e)}})),t.custom&&(n.custom=t.custom),setTimeout(function(){return r.attemptSubmit(n,!0)});case 1:return e.a(2)}},e)})),function(e){return i.apply(this,arguments)})},{key:"attemptSubmit",value:(r=k(g().m(function e(t){var n,r,i,a,s,o,l,u=this,c=arguments;return g().w(function(e){for(;;)switch(e.n){case 0:return n=c.length>1&&void 0!==c[1]&&c[1],e.n=1,null==(r=this._validationHandler)?void 0:r.call(this,n?t:void 0);case 1:if(!1!==e.v){e.n=2;break}return e.a(2);case 2:if(this.changeToLoadingIcon(),this._textInput.clear(),Ke.IS_MOBILE&&setTimeout(function(){return u._textInput.inputElementRef.focus()}),"boolean"==typeof this._messages.focusMode||null==(i=this._messages.focusMode)||!i.fade){e.n=3;break}return e.n=3,_r.fadeAnimation(this._messages.elementRef,this._messages.focusMode.fade);case 3:return e.n=4,this.addNewMessage(t);case 4:return this._serviceIO.isWebModel()||this._messages.addLoadingMessage(),o=null==(a=t[Y])?void 0:a.map(function(e){return e[Z]}),l=w(w({},B,""===t[B]?void 0:t[B]),Y,o),e.n=5,this._serviceIO.callAPI(l,this._messages);case 5:null==(s=this._fileAttachments)||s.hideFiles();case 6:return e.a(2)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"addNewMessage",value:(n=k(g().m(function e(t){var n,r,i,a;return g().w(function(e){for(;;)switch(e.n){case 0:if(n=t.text,r=t.files,i=t.custom,a=w(w({},ue,U),"custom",i),n&&(a[B]=n),!r){e.n=2;break}return e.n=1,this._messages.addMultipleFiles(r,this._fileAttachments);case 1:a[Y]=e.v;case 2:this._serviceIO.sessionId&&(a._sessionId=this._serviceIO.sessionId),Object.keys(a).length>0&&this._messages.addNewMessage(a);case 3:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"stopStream",value:function(){var e,t,n;null==(t=(e=this._serviceIO.streamHandlers).onAbort)||t.call(e),null==(n=this._stopClicked)||n.listener(),this._validationHandler&&this.resetSubmit(this._validationHandler)}},{key:"changeToStopIcon",value:function(){this._serviceIO.websocket||(this.elementRef[M].remove(Eo,Co,wo),pa.removeAriaAttributes(this.elementRef),this.changeElementsByState(this._innerElements.stop),this.reapplyStateStyle("stop",["loading","submit"]),kt.assignButtonEvents(this.elementRef,this.stopStream.bind(this)),this.status.loadingActive=!1)}},{key:"changeToLoadingIcon",value:function(){this._serviceIO.websocket||(this._isSVGLoadingIconOverriden||this.changeElementsByState(this._innerElements.loading),this.elementRef[M].remove(wo,Co),pa.removeAriaDisabled(this.elementRef),this.elementRef[M].add(Eo),pa.addAriaBusy(this.elementRef),this.reapplyStateStyle("loading",["submit"]),kt.assignButtonEvents(this.elementRef,function(){}),this.status.requestInProgress=!0,this.status.loadingActive=!0)}},{key:"changeToSubmitIcon",value:function(){var e=this;this.elementRef[M].contains(wo)||(this.elementRef[M].remove(Eo,Co),pa.removeAriaAttributes(this.elementRef),this.elementRef[M].add(wo),this.changeElementsByState(this._innerElements.submit),vu.resetSubmit(this,this.status.loadingActive),kt.assignButtonEvents(this.elementRef,function(){var t;e.submitFromInput(),null!=(t=e._microphoneButton)&&t.isActive&&ru.toggleSpeechAfterSubmit(e._microphoneButton.elementRef,!!e._stopSTTAfterSubmit),setTimeout(function(){return $e.focusEndOfInput(e._textInput.inputElementRef)})}))}},{key:"changeToDisabledIcon",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._alwaysEnabled&&!e?this.changeToSubmitIcon():this.elementRef[M].contains(Co)||(this.elementRef[M].remove(Eo,wo),pa.removeAriaBusy(this.elementRef),this.elementRef[M].add(Co),pa.addAriaDisabled(this.elementRef),this.changeElementsByState(this._innerElements[Fe]),this.reapplyStateStyle(Fe,["submit"]),kt.assignButtonEvents(this.elementRef,function(){}))}},{key:"disableSubmitButton",value:function(e,t){var n;e.isSubmitProgrammaticallyDisabled=!1!==t,!this.status.requestInProgress&&!this.status.loadingActive&&(!1===t?null==(n=this._validationHandler)||n.call(this):this.changeToDisabledIcon(!0))}}],[{key:"createButtonContainerElement",value:function(){var e=R();return e[M].add("input-button"),e}},{key:"createLoadingIconElement",value:function(){var e=R();return e[M].add("loading-submit-button"),e}},{key:"createStopIconElement",value:function(){var e=R();return e.id="stop-icon",e}}]);var n,r,i,a}(ba),yu=function(e){function t(e,n,r,i){var a;C(this,t),(a=d(this,t,[e,["modal-content","modal-camera-content"],r]))._stopped=!1,a._format="image/png",a._canvas=R("canvas"),a._canvas[M].add("camera-modal-canvas");var s=a.addButtonsAndTheirEvents(n),o=s.captureButton,l=s.submitButton;return a._captureButton=o,a._submitButton=l,a._captureIcon=a._captureButton.children[0],a._refreshIcon=ri.createSVGElement('<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n  <path d="M27.1 14.313V5.396L24.158 8.34c-2.33-2.325-5.033-3.503-8.11-3.503C9.902 4.837 4.901 9.847 4.899 16c.001 6.152 5.003 11.158 11.15 11.16 4.276 0 9.369-2.227 10.836-8.478l.028-.122h-3.23l-.022.068c-1.078 3.242-4.138 5.421-7.613 5.421a8 8 0 0 1-5.691-2.359A7.993 7.993 0 0 1 8 16.001c0-4.438 3.611-8.049 8.05-8.049 2.069 0 3.638.58 5.924 2.573l-3.792 3.789H27.1z"/>\n</svg>\n'),a._refreshIcon[M].add("modal-svg-button-icon","modal-svg-refresh-icon"),"jpeg"===(null==i?void 0:i.format)&&(a._format="image/jpeg"),null!=i&&i.dimensions&&(a._dimensions=i.dimensions),a._contentRef.appendChild(a._canvas),a.extensionCloseCallback=a.stop,a}return m(t,e),x(t,[{key:"addButtonsAndTheirEvents",value:function(e){var t=cu.createSVGButton('<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <path d="M0 16q0 3.264 1.28 6.208t3.392 5.12 5.12 3.424 6.208 1.248 6.208-1.248 5.12-3.424 3.392-5.12 1.28-6.208-1.28-6.208-3.392-5.12-5.088-3.392-6.24-1.28q-3.264 0-6.208 1.28t-5.12 3.392-3.392 5.12-1.28 6.208zM4 16q0-3.264 1.6-6.016t4.384-4.352 6.016-1.632 6.016 1.632 4.384 4.352 1.6 6.016-1.6 6.048-4.384 4.352-6.016 1.6-6.016-1.6-4.384-4.352-1.6-6.048z"></path>\n</svg>\n');t[M].add("modal-svg-camera-button"),t.children[0][M].add("modal-svg-camera-icon");var n=this.addCloseButton('<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">\n  <path d="M195.2 195.2a64 64 0 0 1 90.496 0L512 421.504 738.304 195.2a64 64 0 0 1 90.496 90.496L602.496 512 828.8 738.304a64 64 0 0 1-90.496 90.496L512 602.496 285.696 828.8a64 64 0 0 1-90.496-90.496L421.504 512 195.2 285.696a64 64 0 0 1 0-90.496z"/>\n</svg>',!0);n[M].add("modal-svg-close-button"),n.children[0][M].add("modal-svg-close-icon");var r=cu.createSVGButton('<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M4.89163 13.2687L9.16582 17.5427L18.7085 8" stroke="#000000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>');return r[M].add("modal-svg-submit-button"),this.addButtons(t,r),this.addButtonEvents(t,n,r,e),{captureButton:t,submitButton:r}}},{key:"addButtonEvents",value:function(e,t,n,r){var i=this;kt.assignButtonEvents(e,this.capture.bind(this)),kt.assignButtonEvents(t,this.stop.bind(this)),kt.assignButtonEvents(n,function(){var e=i.getFile();e&&lu.addFilesToType([e],[r]),i.stop(),i.close()})}},{key:"stop",value:function(){var e=this;this._mediaStream&&this._mediaStream.getTracks().forEach(function(e){return e.stop()}),this._stopped=!0,setTimeout(function(){e._captureButton.replaceChildren(e._captureIcon),e._captureButton[M].replace("modal-svg-refresh-button","modal-svg-camera-button");var t=e._canvas.getContext("2d");null==t||t.clearRect(0,0,e._canvas.width,e._canvas.height)},cu.MODAL_CLOSE_TIMEOUT_MS)}},{key:"start",value:function(){var e=this;this._dataURL=void 0,this._submitButton[M].add("modal-svg-submit-".concat(Fe)),this._stopped=!1,navigator.mediaDevices.getUserMedia({video:this._dimensions||!0}).then(function(t){if(e._mediaStream=t,!e.isOpen())return e.stop();var n=R("video");n.srcObject=t,n.play(),requestAnimationFrame(e.updateCanvas.bind(e,n,e._canvas))}).catch(function(t){console[F](t),e.stop(),e.close()})}},{key:"capture",value:function(){this._dataURL?(this._captureButton.replaceChildren(this._captureIcon),this._captureButton[M].replace("modal-svg-refresh-button","modal-svg-camera-button"),this._submitButton[M].add("modal-svg-submit-".concat(Fe)),this._dataURL=void 0):(this._captureButton.replaceChildren(this._refreshIcon),this._captureButton[M].replace("modal-svg-camera-button","modal-svg-refresh-button"),this._submitButton[M].remove("modal-svg-submit-".concat(Fe)),this._dataURL=this._canvas.toDataURL())}},{key:"getFile",value:function(){if(this._dataURL){for(var e=atob(this._dataURL.split(",")[1]),t=new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);var r=new Uint8Array(t),i=new Blob([r],{type:this._format}),a="image/jpeg"===this._format?"jpeg":"png",s=fu.getFileName(this._newFilePrefix||"photo",a);return new File([i],s,{type:i.type})}}},{key:"updateCanvas",value:function(e,t){if(!this._stopped){if(!this._dataURL){t.width=e.videoWidth,t.height=e.videoHeight;var n=t.getContext("2d");null==n||n.drawImage(e,0,0,t.width,t.height)}requestAnimationFrame(this.updateCanvas.bind(this,e,t))}}},{key:"openCameraModal",value:function(e){this.displayModalElements(),e[oe]()}}],[{key:"createCameraModalFunc",value:function(e,n,r,i){var a=new t(e,n,r,i);return a.openCameraModal.bind(a,a)}}])}(cu),bu=function(e){function t(e,n,r){var i,a,s,o,l,u,c;C(this,t);var h=Ct.processPosition(null==(a=null==r?void 0:r.button)?void 0:a.position),p=(null==(l=null==(o=null==(s=null==r?void 0:r.button)?void 0:s.styles)?void 0:o[B])?void 0:l.content)||"Photo",f=Ge.tryCreateConfig("Camera",null==(u=null==r?void 0:r.button)?void 0:u.tooltip),m=(null==(c=null==r?void 0:r.button)?void 0:c.styles)||{},v=(i=d(this,t,[t.createButtonElement(),'<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <path d="M29 7h-4.599l-2.401-4h-12l-2.4 4h-4.6c-1 0-3 1-3 2.969v16.031c0 1.657 1.5 3 2.792 3h26.271c1.313 0 2.938-1.406 2.938-2.968v-16.032c0-1-1-3-3-3zM30 26.032c0 0.395-0.639 0.947-0.937 0.969h-26.265c-0.232-0.019-0.797-0.47-0.797-1v-16.031c0-0.634 0.851-0.953 1-0.969h5.732l2.4-4h9.802l1.785 3.030 0.55 0.97h5.731c0.705 0 0.99 0.921 1 1v16.032zM16 10c-3.866 0-7 3.134-7 7s3.134 7 7 7 7-3.134 7-7-3.134-7-7-7zM16 22c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z"></path>\n</svg>',h,f,m,p])).createInnerElementsForStates(i.customStyles);return r&&i.addClickEvent(e,n,r.modalContainerStyle,r[Y]),i.changeElementsByState(v.styles),i.reapplyStateStyle("styles"),i}return m(t,e),x(t,[{key:"createInnerElementsForStates",value:function(e){return{styles:this.createInnerElements("camera-icon","styles",e)}}},{key:"addClickEvent",value:function(e,t,n,r){var i=yu.createCameraModalFunc(e,t,n,r);kt.assignButtonEvents(this.elementRef,i)}}],[{key:"createButtonElement",value:function(){var e=R();return e[M].add("input-button"),e}}])}(ba),ku=function(){function e(t,n,r,i){C(this,e),this.elementRef=e.createPanelElement(t.inputAreaStyle);var a={},s=this.createFileUploadComponents(t,r,i,a),o=new Qe(t,r,s,n.browserStorage);t.speechToText&&!a.microphone&&(a.microphone={button:new ru(t,o,n.addNewErrorMessage.bind(n))});var l=new gu(t,o,n,r,s,a);o.submit=l.submitFromInput.bind(l),pu.attach(t,r,o,s,l,n.browserStorage),t.submitUserMessage=l.programmaticSubmit.bind(l),a.submit={button:l},t.customButtons&&qo.add(t,a),e.addElements(this.elementRef,o,a,i,s,t.dropupStyles),e.assignOnInput(t,r,s,o)}return x(e,[{key:"createFileUploadComponents",value:function(t,n,r,i){var a,s,o,l,u=new lu(this.elementRef,t.attachmentContainerStyle,n.demo);if(e.createUploadButtons(t,n,n.fileTypes||{},u,r,i),null!=(a=n[ee])&&a[Y]){var c=(null==(s=i[$])?void 0:s.fileType)||u.addType(t,n,n[ee][Y],$);i[ee]={button:new bu(r,c,n[ee])}}if(null!=(o=n.recordAudio)&&o[Y]){var d=(null==(l=i[ne])?void 0:l.fileType)||u.addType(t,n,n.recordAudio[Y],ne);i.microphone={button:new mu(d,n.recordAudio)}}return hu.isEnabled(u,t.dragAndDrop)&&hu.create(r,u,t.dragAndDrop),u}}],[{key:"createPanelElement",value:function(e){var t=R();return t.id="input",Object.assign(t[I],e),t}},{key:"createUploadButtons",value:function(e,t,n,r,i,a){Object.keys(n).forEach(function(s){var o=s,l=n[o];if(l[Y]){var u=r.addType(e,t,l[Y],o),c=Xo[o],d=c.id,h=c.svgString,p=c.dropupText,f=new du(i,u,l,d,h,p);a[o]={button:f,fileType:u}}})}},{key:"addElements",value:function(e,t,n,r,i,a){kt.addElements(e,t.elementRef);var s=Fo.create(),o=Vo.addButtons(s,n,r,a);No.set(t.inputElementRef,s,i.elementRef,o),Fo.add(e,s)}},{key:"assignOnInput",value:function(e,t,n,r){t.onInput=function(t){setTimeout(function(){var i=n.getAllFileData(),a=r.inputElementRef.innerText.trim(),s=w({},B,a);i&&(s[Y]=i.map(function(e){return e[Z]})),gr.onInput(e,s,t)})}}}])}(),_u=function(){function e(){C(this,e)}return x(e,null,[{key:"createElements",value:function(e,t,n){var r=R();r.id="chat-view";var i=!e.focusMode&&e.upwardsMode;r.classList.add(i?"deep-chat-upwards-mode":"deep-chat-downwards-mode");var a=new Bo(e,t,n);t.websocket&&Wr.createConnection(t,a);var s=new ku(e,a,t,r),o=i?a.elementRef.parentElement:a.elementRef;return kt.addElements(r,o,s.elementRef),r}},{key:"render",value:function(t,n,r,i){var a=e.createElements(t,r,i);n.replaceChildren(a),r.isCustomView()&&r.setUpView(a,n)}}])}(),Su=Object.defineProperty,wu=function(e,t,n,r){for(var i,a=void 0,s=e.length-1;s>=0;s--)(i=e[s])&&(a=i(t,n,a)||a);return a&&Su(t,n,a),a},Eu=function(e){function t(){var e,n;return C(this,t),(e=d(this,t)).getMessages=function(){return[]},e.submitUserMessage=function(){return console.warn(ve("submitUserMessage"))},e.addMessage=function(){return console.warn(ve("addMessage"))},e.updateMessage=function(){},e.clearMessages=function(){},e.focusInput=function(){return $e.focusFromParentElement(e._elementRef)},e.refreshMessages=function(){},e.scrollToBottom=function(){},e.disableSubmitButton=function(){},e.setPlaceholderText=function(){},e._hasBeenRendered=!1,e._auxiliaryStyleApplied=!1,e._elementRef=R(),e._elementRef.id="container",e.attachShadow({mode:"open"}).appendChild(e._elementRef),null==(n=e.shadowRoot)||n.appendChild(Ge.buildElement()),qe.apply('#validate-property-key-view{height:100%;position:relative;display:flex;justify-content:center;align-items:center;padding:8px}#loading-validate-key-property{display:inline-block;width:50px;height:50px}#loading-validate-key-property:after{content:" ";display:block;width:38px;height:38px;margin:1px;border-radius:50%;border:5px solid #5fb2ff;border-color:#5fb2ff transparent #5fb2ff transparent;animation:loading-spinner 1.4s linear infinite}#deep-chat-openai-realtime-container{height:100%;width:100%}#deep-chat-openai-realtime-avatar-container{height:60%;width:100%;display:flex;justify-content:center;align-items:center}#deep-chat-openai-realtime-avatar{border-radius:50%;height:110px;border:1px solid rgb(215,215,215);padding:8px;-webkit-user-select:none;user-select:none;margin-top:20px}#deep-chat-openai-realtime-buttons-container{height:40%;display:flex;position:relative}.deep-chat-openai-realtime-button-container{height:100%;width:50%;display:flex;justify-content:center;align-items:center}.deep-chat-openai-realtime-button{width:70px;height:70px;border-radius:50%;display:flex;justify-content:center;align-items:center;cursor:pointer}.deep-chat-openai-realtime-button-default{background-color:#e3e3e3}.deep-chat-openai-realtime-button-default:hover{background-color:#d4d4d4}.deep-chat-openai-realtime-button-default:active{background-color:#c5c5c5}.deep-chat-openai-realtime-button-loading{opacity:.7;pointer-events:none}.deep-chat-openai-realtime-microphone-active{background-color:#ffe7e7}.deep-chat-openai-realtime-microphone-active:hover{background-color:#ffdede}.deep-chat-openai-realtime-microphone-active:active{background-color:#ffd2d2}.deep-chat-openai-realtime-microphone>*{height:30px;width:30px}.deep-chat-openai-realtime-microphone-active>*{filter:brightness(0) saturate(100%) invert(35%) sepia(60%) saturate(1360%) hue-rotate(325deg) brightness(95%) contrast(92%)}.deep-chat-openai-realtime-toggle>*{height:32px;width:32px;padding-inline-start:3px;filter:brightness(0) saturate(100%) invert(22%) sepia(0%) saturate(4537%) hue-rotate(208deg) brightness(105%) contrast(91%)}.deep-chat-openai-realtime-button-unavailable{opacity:.45;pointer-events:none}#deep-chat-openai-realtime-error{color:red;position:absolute;top:calc(50% + 40px);inset-inline-start:50%;transform:translate(-50%,-50%);font-size:17px}#deep-chat-openai-realtime-loading{position:absolute;font-size:15px;top:50%;inset-inline-start:50%;transform:translate(-50%,-50%)}#insert-key-view{height:100%;position:relative}#insert-key-contents{text-align:center;position:absolute;inset-block-start:44%;inset-inline-start:50%;transform:translate(-50%,-50%);width:82%;display:flex;max-width:700px}#insert-key-title{margin-bottom:15px}#insert-key-input-container{margin-inline-end:2.7em;width:calc(100% - 80px)}#insert-key-input{padding:.3em 1.7em .3em .3em;border-width:1px;border-style:solid;border-radius:3px;width:100%;font-size:inherit}.insert-key-input-valid{border-color:gray}.insert-key-input-invalid{border-color:red}#visibility-icon-container{position:relative;float:inline-end;cursor:pointer;-webkit-user-select:none;user-select:none}.visibility-icon{filter:brightness(0) saturate(100%) invert(63%) sepia(1%) saturate(9%) hue-rotate(43deg) brightness(98%) contrast(92%);position:absolute;inset-inline-end:-1.7em;inset-block-start:-1.43em}#visible-icon{inset-block-start:-1.4em}.visibility-icon:hover{filter:unset}.visibility-icon>*{pointer-events:none}#start-button{border:1px solid grey;color:#454545;border-radius:4px;width:3em;display:flex;justify-content:center;align-items:center;cursor:pointer;padding:.28em .3em;-webkit-user-select:none;user-select:none;background-color:#fff}#start-button:hover{background-color:#f2f2f2}#start-button:active{background-color:#d2d2d2}#insert-key-help-text-container{width:100%;position:absolute;margin-top:32px;margin-bottom:20px}#insert-key-help-text-contents{width:100%;position:absolute}#insert-key-input-invalid-text{display:block;margin-top:1em;margin-bottom:.5em;color:red}.insert-key-input-help-text{display:block;margin-top:16px}#loading-key{display:inline-block;width:16px;height:16px}#loading-key:after{content:" ";display:block;width:11px;height:11px;margin:1px;border-radius:50%;border:2px solid #0084ff;border-color:#0084ff transparent #0084ff transparent;animation:loading-spinner 1.2s linear infinite}#error-view{color:red;font-size:1.2em;line-height:1.3em;margin-top:-5px;text-align:center;height:100%;display:flex;justify-content:center;align-items:center;padding-inline:8px}@keyframes loading-spinner{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.intro-panel{position:absolute;display:flex;justify-content:center;right:0;bottom:0;left:0;margin:auto;height:fit-content;top:-2.5em}pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!\n  Theme: a11y-dark\n  Author: @ericwbailey\n  Maintainer: @ericwbailey\n\n  Based on the Tomorrow Night Eighties theme: https://github.com/isagalaev/highlight.js/blob/master/src/styles/tomorrow-night-eighties.css\n*/.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}#messages,.deep-chat-upwards-mode #messages>div{overflow:auto;overflow-anchor:none}.deep-chat-upwards-mode #messages{height:100%;display:flex;flex-direction:column;justify-content:flex-end}.outer-message-container:last-child{margin-bottom:5px}.inner-message-container{display:flex;margin-inline:auto;width:calc(97.5% - 24px);max-width:100%}.message-bubble{margin-top:10px;word-wrap:break-word;width:fit-content;max-width:60%;border-radius:10px;padding:.42em .55em;height:fit-content;line-height:1.26em}.user-message-text{color:#fff;background-color:#0084ff;margin-inline-end:0px;margin-inline-start:auto}.ai-message-text{color:#000;background-color:#e4e6eb;margin-inline-start:0px;margin-inline-end:auto}.deep-chat-last-group-messages-active{height:100%}#scroll-button{position:absolute;top:75%;left:50%;right:50%;transform:translate(-50%,-50%);transition:opacity .1s ease;display:flex;opacity:0;padding:8px;background-color:#fff;border:.5px solid #000000;justify-content:center;align-items:center;white-space:nowrap;cursor:pointer}#scroll-button:hover{background-color:#fafafa}.loading-history-message-full-view{position:absolute;height:70%;width:100%;display:flex;align-items:center}.deep-chat-upwards-mode #messages .loading-history-message-full-view{height:100%}.loading-history-message-small{height:20px;margin-bottom:30px}.loading-history-message-small>div>div{scale:.6}.loading-history-message{margin-top:0;width:100%;max-width:100%;display:flex;justify-content:center;background-color:unset}.loading-history{width:70px}.loading-history div{position:absolute;width:var(--loading-history-width);height:var(--loading-history-height);margin:var(--loading-history-margin);border:var(--loading-history-border);border-radius:50%;animation:loading-spinner 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:var(--loading-history-color) transparent transparent transparent}.loading-history div:nth-child(1){animation-delay:-.45s}.loading-history div:nth-child(2){animation-delay:-.3s}.loading-history div:nth-child(3){animation-delay:-.15s}.html-message{max-width:unset}.error-message-text{margin-inline:auto;background-color:#f4c0c0;color:#474747;text-align:center;max-width:95%;margin-top:14px;margin-bottom:10px}.deep-chat-loading-message-dots-container{width:1em;padding-top:.6em;padding-bottom:.6em;padding-inline-start:1.3em;padding-inline-end:.75em}.loading-message-dots{position:relative;width:.45em;height:.45em;border-radius:5px;background-color:var(--loading-message-color);color:var(--loading-message-color);animation:loading-message-dots 1s infinite linear alternate;animation-delay:.5s}.loading-message-dots:before,.loading-message-dots:after{content:"";display:inline-block;position:absolute;top:0}.loading-message-dots:before{inset-inline-start:-.7em;width:.45em;height:.45em;border-radius:5px;background-color:var(--loading-message-color);color:var(--loading-message-color);animation:loading-message-dots 1s infinite alternate;animation-delay:0s}.loading-message-dots:after{inset-inline-start:.7em;width:.45em;height:.45em;border-radius:5px;background-color:var(--loading-message-color);color:var(--loading-message-color);animation:loading-message-dots 1s infinite alternate;animation-delay:1s}@keyframes loading-message-dots{0%{background-color:var(--loading-message-color)}50%,to{background-color:var(--loading-message-color-fade)}}.message-bubble>p:first-child,.message-bubble>.partial-render-message>p:first-child,.html-wrapper>p:first-child{margin-top:0}.message-bubble>p:last-child,.message-bubble>.partial-render-message:last-child>p,.html-wrapper>p:last-child{margin-bottom:0}pre{overflow:auto;display:block;word-break:break-all;word-wrap:break-word;border-radius:7px;background:#2b2b2b;color:#f8f8f2;margin-top:.8em;margin-bottom:.8em;padding:.6em;font-size:.9em;line-height:1.5em}.image-message{padding:0;display:flex;background-color:#ddd}.image-message>*,.image-message>*>*{width:100%;border-radius:8px;display:flex}.audio-message{width:60%;max-width:300px;height:2.2em;max-height:54px;padding:0;background-color:unset}.audio-player{width:100%;height:100%}.audio-player-safari{height:fit-content;width:40px}.audio-player-safari-start{float:inline-start}.audio-player-safari-end{float:inline-end}.any-file-message{padding:1px}.any-file-message-contents{display:flex}.any-file-message-icon-container{width:1.3em;min-width:1.3em;position:relative;border-radius:4px;margin-inline-start:6px;margin-inline-end:2px}.any-file-message-icon{background-color:#fff;border-radius:4px;position:absolute;width:1em;height:1.25em;padding:1px;margin-top:auto;margin-bottom:auto;top:0;bottom:0}.any-file-message-text{padding-top:5px;overflow-wrap:anywhere;padding-bottom:5px;padding-inline-end:7px}.message-bubble>a{color:inherit}.start-item-position{margin-inline-end:10px}.end-item-position{margin-inline-start:10px}.role-hidden{display:none}.avatar{padding-top:5px;width:1.5em;height:1.5em;border-radius:1px}.avatar-container{margin-top:9px}.name{margin-top:16px;font-size:15px}#drag-and-drop{position:absolute;display:none;z-index:10;height:calc(100% - 10px);width:calc(100% - 10px);background-color:#70c6ff4d;border:5px dashed #6dafff}#file-attachment-container{position:absolute;height:3.6em;width:calc(80% - 4px);top:-2.5em;border-radius:5px;overflow:auto;text-align:start;background-color:#d7d7d73b;padding-inline-start:4px}.file-attachment{width:2.85em;height:2.85em;display:inline-flex;margin-inline-end:.6em;margin-bottom:.44em;margin-top:4px;position:relative;background-color:#fff;border-radius:5px}.image-attachment{width:100%;height:100%;object-fit:cover;border-radius:5px}.border-bound-attachment{width:calc(100% - 2px);height:calc(100% - 2px);border:1px solid #c3c3c3;border-radius:5px;overflow:hidden}.border-bound-attachment-safari{width:calc(100% - 1px);height:calc(100% - 1px)}.audio-attachment-icon-container{cursor:pointer}.audio-attachment-icon-container:hover{background-color:#f8f8f8}.attachment-icon{inset-inline:0;bottom:0;top:2px;margin:auto;position:absolute;width:25px;-webkit-user-select:none;user-select:none}.not-removable-attachment-icon{top:0;right:0;bottom:0;left:0}.play-icon{filter:brightness(0) saturate(100%) invert(17%) sepia(0%) saturate(1392%) hue-rotate(67deg) brightness(98%) contrast(97%)}.stop-icon{filter:brightness(0) saturate(100%) invert(29%) sepia(90%) saturate(1228%) hue-rotate(198deg) brightness(93%) contrast(98%)}.audio-placeholder-text-3-digits{padding-inline-start:.26rem}.audio-placeholder-text-4-digits{padding-inline-start:.1rem}.any-file-attachment{padding:2px 0}.file-attachment-text-container{position:absolute;width:inherit;display:flex;align-items:center;height:100%;top:-1px}.audio-placeholder-text-3-digits-container{padding-top:1px;cursor:default}.any-file-attachment-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding-inline-start:.13em;margin-inline:auto}.remove-file-attachment-button{height:1.25em;width:1.25em;border:1px solid #cfcfcf;border-radius:25px;background-color:#fff;top:-4px;inset-inline-end:-5px;position:absolute;display:flex;justify-content:center;cursor:pointer;-webkit-user-select:none;user-select:none}.remove-file-attachment-button:hover{background-color:#e4e4e4}.remove-file-attachment-button:active{background-color:#d7d7d7}.x-icon{color:#4e4e4e;top:-.075em;position:relative;font-size:1.05em}.modal{display:none;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:80%;max-width:420px;max-height:80%;margin:auto;top:0;right:0;bottom:0;left:0;z-index:3}.modal-content{border-top:1px solid rgb(217,217,217);border-inline:1px solid rgb(217,217,217);border-start-start-radius:inherit;border-start-end-radius:inherit;background-color:#fff;overflow-y:auto;height:fit-content;max-height:calc(100% - 3.3em);width:100%}.modal-content>p{margin-inline:1em}.modal-content>ul{margin-inline-end:1em}.modal-button-panel{height:3.3em;border:1px solid;border-color:rgb(223,223,223) rgb(217,217,217) rgb(217,217,217);border-end-start-radius:inherit;border-end-end-radius:inherit;background-color:#fff;text-align:center;justify-content:center;display:flex;width:100%}.modal-button{min-width:2.5em;text-align:center;color:#fff;border-radius:5px;padding:.4em .4em .3em;height:1.25em;background-color:#3279b2;inset-block:0;margin-top:auto;margin-bottom:auto;cursor:pointer;-webkit-user-select:none;user-select:none;margin-inline:.31em}.modal-button:hover{background-color:#276da7}.modal-button:active{background-color:#1b5687}.modal-svg-button{padding:0 0 2px;width:2em;height:1.8em}.modal-svg-button-icon{width:100%;height:100%;filter:brightness(0) saturate(100%) invert(100%) sepia(15%) saturate(4%) hue-rotate(346deg) brightness(101%) contrast(102%)}#modal-background-panel{position:absolute;width:100%;height:100%;background-color:#00000042;z-index:2;display:none}.show-modal-background{animation:fadeInBackground .3s ease-in-out}@keyframes fadeInBackground{0%{opacity:0}to{opacity:1}}.show-modal{animation:fadeInModal .3s ease-in-out}@keyframes fadeInModal{0%{opacity:0;scale:.95}to{opacity:1;scale:1}}.hide-modal-background{animation:fadeOutBackground .2s ease-in-out}@keyframes fadeOutBackground{0%{opacity:1}to{opacity:0}}.hide-modal{animation:fadeOutModal .2s ease-in-out}@keyframes fadeOutModal{0%{opacity:1;scale:1}to{opacity:0;scale:.95}}.modal-camera-content{overflow:hidden;text-align:center;border:unset;height:100%;background-color:#2a2a2a;display:flex;justify-content:center}.camera-modal-canvas{max-width:100%;max-height:100%;margin-top:auto;margin-bottom:auto}.modal-svg-submit-button{background-color:green}.modal-svg-submit-button:hover{background-color:#007500}.modal-svg-submit-button:active{background-color:#006500}.modal-svg-submit-disabled{pointer-events:none;background-color:#747474}.modal-svg-close-button{height:1.56em;padding-top:.37em;padding-bottom:0;background-color:#c13e3e}.modal-svg-close-button:hover{background-color:#b43434}.modal-svg-close-button:active{background-color:#972929}.modal-svg-close-icon{width:80%;height:80%}.modal-svg-camera-button{height:1.6em;padding-top:.38em;padding-bottom:0}.modal-svg-camera-icon{height:76%}.modal-svg-refresh-icon{height:105%}.modal-svg-refresh-button{height:1.66em;padding-top:.11em;padding-bottom:.21em}.input-button-container{position:relative;z-index:1}.inside-end{position:absolute;inset-inline-end:calc(10% + .35em);inset-block-end:.85em}.inside-start{position:absolute;inset-inline-start:calc(10% + .35em);inset-block-end:.85em}.outside-start{position:absolute;inset-inline-end:calc(11px - .55em);inset-block-end:.88em}.outside-end{position:absolute;inset-inline-start:calc(11px - .55em);inset-block-end:.88em}#upload-images-icon{position:absolute;pointer-events:none;width:1.45em;height:1.45em;inset-inline-start:.11em;inset-block-end:.08em;filter:brightness(0) saturate(100%) invert(43%) sepia(0%) saturate(740%) hue-rotate(77deg) brightness(99%) contrast(92%)}#upload-gifs-icon{position:absolute;pointer-events:none;width:1.5em;height:1.48em;inset-inline-start:.07em;inset-block-end:.08em;filter:brightness(0) saturate(100%) invert(49%) sepia(0%) saturate(2586%) hue-rotate(12deg) brightness(93%) contrast(90%)}#upload-audio-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;inset-inline-start:.17em;inset-block-end:.2em;filter:brightness(0) saturate(100%) invert(15%) sepia(0%) saturate(337%) hue-rotate(125deg) brightness(91%) contrast(94%);transform:scaleX(.95)}#camera-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;inset-inline-start:.23em;inset-block-end:.2em;filter:brightness(0) saturate(100%) invert(52%) sepia(0%) saturate(161%) hue-rotate(164deg) brightness(91%) contrast(92%);transform:scaleX(.95)}#upload-mixed-files-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;inset-inline-start:.25em;inset-block-end:.2em;filter:brightness(0) saturate(100%) invert(53%) sepia(0%) saturate(36%) hue-rotate(74deg) brightness(98%) contrast(93%);transform:scaleX(.95)}#interim-text{color:gray}#microphone-button{padding-top:.5px}.outer-button-container>#microphone-button{padding-bottom:1px}#microphone-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;inset-inline-start:.25em;inset-block-end:.25em}.default-microphone-icon{filter:brightness(0) saturate(100%) invert(32%) sepia(0%) saturate(924%) hue-rotate(46deg) brightness(95%) contrast(99%)}.active-microphone-icon{filter:brightness(0) saturate(100%) invert(10%) sepia(97%) saturate(7495%) hue-rotate(0deg) brightness(101%) contrast(107%);border-radius:10px}.command-microphone-icon{filter:brightness(0) saturate(100%) invert(42%) sepia(96%) saturate(1067%) hue-rotate(77deg) brightness(99%) contrast(102%)}.unsupported-microphone{display:none}#submit-icon{height:100%;filter:brightness(0) saturate(100%) invert(32%) sepia(0%) saturate(924%) hue-rotate(46deg) brightness(95%) contrast(99%);width:1.21em}#stop-icon{background-color:#acacac;position:absolute;width:.95em;height:.95em;inset-inline-start:.35em;inset-block-end:.35em;border-radius:2px}.submit-button-enlarged{scale:1.1;margin-inline:.3em}.loading-submit-button{position:relative;inset-inline-start:calc(-9990px + .275em);width:.22em;height:.22em;border-radius:5px;background-color:#848484;color:#848484;box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484;animation:loading-submit-button 1.5s infinite linear;inset-block-end:-.75em}@keyframes loading-submit-button{0%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}16.667%{box-shadow:9990px -6px #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}33.333%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}50%{box-shadow:9990px 0 #848484,calc(9990px + .44em) -6px 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}66.667%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}83.333%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) -6px 0 0 #848484}to{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}}.tooltip{position:absolute;visibility:hidden;z-index:1;pointer-events:none;padding:5px;padding-inline:7px;background-color:#333;border-radius:5px;width:max-content}.tooltip-text{color:#fff;font-size:13px}.input-button{border-radius:4px;cursor:pointer;margin-bottom:.2em;-webkit-user-select:none;user-select:none}.input-button-svg{width:1.65em;height:1.65em}.input-button-svg-text{padding:1px;height:1.65em;display:flex}.input-button-svg-text>svg{padding:.22rem}.input-button-svg-text>div{margin-inline-start:2px}.input-button:hover,.input-button:focus-visible{background-color:#9c9c9c2e}.input-button:active{background-color:#9c9c9c5e}.input-button:active:not(:hover){background-color:transparent}.loading-button{cursor:auto}.loading-button:hover{background-color:unset}.text-button{filter:unset!important;display:flex;justify-content:center;align-items:center;margin-inline:4px;height:1.6em;width:max-content}#custom-icon{height:100%;width:1.2em}.custom-button-container-default{color:#505050}.custom-button-container-default>.dropup-menu-item-icon{color:unset}.custom-button-container-default>svg{filter:brightness(0) saturate(100%) invert(39%) sepia(1%) saturate(0%) hue-rotate(83deg) brightness(93%) contrast(90%)}.custom-button-container-default>.dropup-menu-item-icon>svg{position:absolute;inset-inline-start:.2em}.custom-button-container-active{background-color:#edf7ff;color:#0285ff}.custom-button-container-active:hover,.custom-button-container-active:focus-visible{background-color:#def0ff}.custom-button-container-active:active{background-color:#d2eaff}.custom-button-container-active>svg{filter:brightness(0) saturate(100%) invert(32%) sepia(34%) saturate(4196%) hue-rotate(196deg) brightness(107%) contrast(104%)}.custom-button-container-disabled{color:#aeaeae;cursor:auto}.custom-button-container-disabled>div{pointer-events:none}.custom-button-container-disabled:hover,.custom-button-container-disabled:focus-visible{background-color:transparent}.custom-button-container-disabled:active{background-color:transparent}.custom-button-container-disabled>svg{filter:brightness(0) saturate(100%) invert(67%) sepia(0%) saturate(818%) hue-rotate(28deg) brightness(102%) contrast(100%)}#text-input-container{background-color:#fff;width:80%;display:flex;border:1px solid #0000001a;border-radius:5px;margin-top:.8em;margin-bottom:.8em;box-shadow:#959da533 0 1px 12px;overflow-y:auto;max-height:200px;position:relative}.text-input-container-start-adjustment{margin-inline-start:1.5em}.text-input-container-end-adjustment{margin-inline-end:1.5em}.text-input-container-start-small-adjustment{margin-inline-start:1.1em}.text-input-container-start-small-adjustment>.outside-start{inset-inline-end:calc(14px - .55em)}.text-input-container-end-small-adjustment{margin-inline-end:1.1em}.text-input-container-end-small-adjustment>.outside-end{inset-inline-start:calc(14px - .55em)}#text-input{text-align:start;outline:none;word-wrap:break-word;line-break:auto}.text-input-styling{padding:.4em .5em;overflow:overlay;width:100%}.text-input-inner-start-adjustment{padding-inline-start:2.2em}.text-input-inner-end-adjustment{padding-inline-end:2em}.text-input-disabled{pointer-events:none;-webkit-user-select:none;user-select:none}[contenteditable]:empty:before{content:attr(deep-chat-placeholder-text);pointer-events:none}[contenteditable][textcolor]:empty:before{color:gray}.outside-end>#dropup-menu,.inside-end>#dropup-menu{inset-inline-end:0px}#dropup-icon{position:absolute;pointer-events:none;width:1.16em;height:1.2em;inset-inline-start:.265em;bottom:.43em;filter:brightness(0) saturate(100%) invert(54%) sepia(0%) saturate(724%) hue-rotate(6deg) brightness(92%) contrast(90%)}.dropup-button>*{pointer-events:none}#dropup-menu{background-color:#fff;position:absolute;transform:translateY(-100%);border-radius:5px;z-index:1;top:-.49em;box-shadow:#0003 -1px 2px 10px,#0000001a 0 2px 4px;cursor:pointer;-webkit-user-select:none;user-select:none}.dropup-menu-item{height:1.4em;padding-inline-start:.35em;padding-inline-end:.84em;padding-top:.28em;padding-bottom:.28em;display:flex;position:relative}.dropup-menu-item:hover,.dropup-menu-item:focus-visible{background-color:#f3f3f3}.dropup-menu-item:active{background-color:#ebebeb}.dropup-menu-item:active:not(:hover){background-color:transparent}.dropup-menu-item:first-child{padding-top:.49em;border-start-start-radius:inherit;border-start-end-radius:inherit}.dropup-menu-item:last-child{padding-bottom:.45em;border-end-start-radius:inherit;border-end-end-radius:inherit}.dropup-menu-item-icon{width:1.39em;position:relative}.dropup-menu-item-icon>svg{bottom:0!important;top:0!important;margin-bottom:auto;margin-top:auto}#dropup-menu-item-icon-element-custom{position:absolute;pointer-events:none;width:1.21em;height:1.21em;inset-inline-start:.28em;filter:brightness(0) saturate(100%) invert(15%) sepia(0%) saturate(337%) hue-rotate(125deg) brightness(91%) contrast(94%)}.dropup-menu-item-text{margin-inline-start:.56em;margin-top:.08em;width:max-content}#input{width:100%;display:inline-flex;text-align:center;margin-inline:auto;margin-top:auto;position:relative;justify-content:center}#chat-view{height:100%;grid-template-columns:100%}.deep-chat-downwards-mode{display:grid}.deep-chat-upwards-mode{display:flex;flex-direction:column}::-webkit-scrollbar{width:9px;height:9px}::-webkit-scrollbar-thumb{background-color:#d0d0d0;border-radius:5px}::-webkit-scrollbar-track{background-color:#f2f2f2}.deep-chat-web-model-button{margin-top:10px;margin-bottom:5px;margin-inline-start:1px}:host{all:initial;display:table-cell}#container{height:inherit;width:inherit;overflow:hidden}',e.shadowRoot),setTimeout(function(){e._hasBeenRendered||e.onRender()},20),e}return m(t,e),x(t,[{key:"changeToChatView",value:function(){this._activeService&&(this._activeService.validateKeyProperty=!1),this.onRender()}},{key:"onRender",value:function(){var e;Ue.attemptAppendStyleSheetToHead(this.style),Ct.processConnect(this),(!this._activeService||this._activeService.demo)&&(this._activeService=bo.create(this)),this.auxiliaryStyle&&!this._auxiliaryStyleApplied&&(qe.apply(this.auxiliaryStyle,this.shadowRoot),this._auxiliaryStyleApplied=!0),qe.applyDefaultStyleToComponent(this.style,this.chatStyle),Ct.checkForContainerStyles(this,this._elementRef),this._activeService.key&&this._activeService.validateKeyProperty?O.render(this._elementRef,this.changeToChatView.bind(this),this._activeService):this._activeService instanceof $r&&!this._activeService.key?this._activeService instanceof $r&&si.render(this._elementRef,this.changeToChatView.bind(this),this._activeService):(null!==(e=this._childElement)&&void 0!==e||(this._childElement=this.children[0]),_u.render(this,this._elementRef,this._activeService,this._childElement)),this._hasBeenRendered||gr.onRender(this),this._hasBeenRendered=!0}},{key:"disconnectedCallback",value:function(){di.chat=void 0}}])}(ni);wu([So("object")],Eu.prototype,"connect"),wu([So("object")],Eu.prototype,"directConnection"),wu([So("object")],Eu.prototype,"webModel"),wu([So("object")],Eu.prototype,"requestBodyLimits"),wu([So("function")],Eu.prototype,"requestInterceptor"),wu([So("function")],Eu.prototype,"responseInterceptor"),wu([So("function")],Eu.prototype,"validateInput"),wu([So("function")],Eu.prototype,"loadHistory"),wu([So("object")],Eu.prototype,"chatStyle"),wu([So("object")],Eu.prototype,"attachmentContainerStyle"),wu([So("object")],Eu.prototype,"dropupStyles"),wu([So("object")],Eu.prototype,"inputAreaStyle"),wu([So("object")],Eu.prototype,"textInput"),wu([So("object")],Eu.prototype,"defaultInput"),wu([So("object")],Eu.prototype,"submitButtonStyles"),wu([So("object")],Eu.prototype,"customButtons"),wu([So("string")],Eu.prototype,"auxiliaryStyle"),wu([So("array")],Eu.prototype,"history"),wu([So("object")],Eu.prototype,"browserStorage"),wu([So("object")],Eu.prototype,"introMessage"),wu([So("object")],Eu.prototype,"avatars"),wu([So("object")],Eu.prototype,"names"),wu([So("object")],Eu.prototype,"displayLoadingBubble"),wu([So("object")],Eu.prototype,"errorMessages"),wu([So("object")],Eu.prototype,"messageStyles"),wu([So("object")],Eu.prototype,"textToSpeech"),wu([So("object")],Eu.prototype,"speechToText"),wu([So("object")],Eu.prototype,"images"),wu([So("object")],Eu.prototype,"gifs"),wu([So("object")],Eu.prototype,"camera"),wu([So("object")],Eu.prototype,"audio"),wu([So("object")],Eu.prototype,"microphone"),wu([So("object")],Eu.prototype,"mixedFiles"),wu([So("object")],Eu.prototype,"dragAndDrop"),wu([So("object")],Eu.prototype,"htmlWrappers"),wu([So("object")],Eu.prototype,"htmlClassUtilities"),wu([So("object")],Eu.prototype,"remarkable"),wu([So("object")],Eu.prototype,"focusMode"),wu([So("boolean")],Eu.prototype,"upwardsMode"),wu([So("object")],Eu.prototype,"scrollButton"),wu([So("object")],Eu.prototype,"hiddenMessages"),wu([So("number")],Eu.prototype,"maxVisibleMessages"),wu([So("function")],Eu.prototype,"onMessage"),wu([So("function")],Eu.prototype,"onClearMessages"),wu([So("function")],Eu.prototype,"onComponentRender"),wu([So("function")],Eu.prototype,"onInput"),wu([So("function")],Eu.prototype,"onError"),wu([So("object")],Eu.prototype,"demo"),wu([So("object")],Eu.prototype,"_insertKeyViewStyles"),customElements.define("deep-chat",Eu);var Cu=n(5149),Tu=n(96540),xu=n.t(Tu,2);const Au=(0,Cu.a)({tagName:"deep-chat",elementClass:Eu,react:xu,events:{onactivate:"activate",onchange:"change"}})},78478(e,t,n){n.d(t,{A:()=>a});n(96540);var r=n(92303),i=n(74848);function a({children:e,fallback:t}){return(0,r.A)()?(0,i.jsx)(i.Fragment,{children:e?.()}):t??null}}}]);